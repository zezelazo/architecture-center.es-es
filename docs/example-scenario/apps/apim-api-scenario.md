---
title: Migración de una aplicación web a una arquitectura basada en API
titleSuffix: Azure Example Scenarios
description: Use Azure API Management para modernizar una aplicación web heredada.
author: begim
ms.date: 09/13/2018
ms.custom: fasttrack
ms.openlocfilehash: 257b9bb5c69afb00917f8934585c1164f909feb6
ms.sourcegitcommit: bb7fcffbb41e2c26a26f8781df32825eb60df70c
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/20/2018
ms.locfileid: "53643490"
---
# <a name="migrating-a-legacy-web-application-to-an-api-based-architecture-on-azure"></a><span data-ttu-id="274bc-103">Migración de una aplicación web heredada a una arquitectura basada en API en Azure</span><span class="sxs-lookup"><span data-stu-id="274bc-103">Migrating a legacy web application to an API-based architecture on Azure</span></span>

<span data-ttu-id="274bc-104">Una empresa de comercio electrónico del sector del turismo va a modernizar su pila de software heredado basado en explorador.</span><span class="sxs-lookup"><span data-stu-id="274bc-104">An e-commerce company in the travel industry is modernizing their legacy browser-based software stack.</span></span> <span data-ttu-id="274bc-105">Aunque la pila existente es principalmente monolítica, existen algunos [servicios HTTP basados en SOAP][soap] desde un proyecto reciente.</span><span class="sxs-lookup"><span data-stu-id="274bc-105">While their existing stack is mostly monolithic, some [SOAP-based HTTP services][soap] exist from a recent project.</span></span> <span data-ttu-id="274bc-106">Se están planteando la creación de flujos de ingresos adicionales para rentabilizar parte de la propiedad intelectual interna que han desarrollado.</span><span class="sxs-lookup"><span data-stu-id="274bc-106">They are considering the creation of additional revenue streams to monetize some of the internal intellectual property that's been developed.</span></span>

<span data-ttu-id="274bc-107">Los objetivos del proyecto incluyen la solución de la deuda técnica, la mejora del mantenimiento continuo y la aceleración del desarrollo de características con menos errores de regresión.</span><span class="sxs-lookup"><span data-stu-id="274bc-107">Goals for the project include addressing technical debt, improving ongoing maintenance, and accelerating feature development with fewer regression bugs.</span></span> <span data-ttu-id="274bc-108">El proyecto usará un proceso iterativo para evitar el riesgo, con algunos pasos que se realizan en paralelo:</span><span class="sxs-lookup"><span data-stu-id="274bc-108">The project will use an iterative process to avoid risk, with some steps performed in parallel:</span></span>

- <span data-ttu-id="274bc-109">El equipo de desarrollo modernizará el back-end de la aplicación, que se compone de bases de datos relacionales hospedadas en máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="274bc-109">The development team will modernize the application back end, which is composed of relational databases hosted on VMs.</span></span>
- <span data-ttu-id="274bc-110">El equipo de desarrollo interno de la empresa escribirá nuevas funcionalidades de negocio que se expondrán mediante nuevas API de HTTP.</span><span class="sxs-lookup"><span data-stu-id="274bc-110">The in-house development team will write new business functionality that will be exposed over new HTTP APIs.</span></span>
- <span data-ttu-id="274bc-111">Un equipo de desarrollo subcontratado creará una nueva interfaz de usuario basada en explorador, que se hospedará en Azure.</span><span class="sxs-lookup"><span data-stu-id="274bc-111">A contract development team will build a new browser-based UI, which will be hosted in Azure.</span></span>

<span data-ttu-id="274bc-112">Las nuevas características de la aplicación se entregará en fases.</span><span class="sxs-lookup"><span data-stu-id="274bc-112">New application features will be delivered in stages.</span></span> <span data-ttu-id="274bc-113">Dichas características reemplazarán gradualmente la funcionalidad de la interfaz de usuario cliente-servidor basada en explorador existente (hospedada en el entorno local) que impulsa su negocio de comercio electrónico actualmente.</span><span class="sxs-lookup"><span data-stu-id="274bc-113">These features will gradually replace the existing browser-based client-server UI functionality (hosted on-premises) that powers their e-commerce business today.</span></span>

<span data-ttu-id="274bc-114">El equipo de administración no está interesado en modernizar innecesariamente.</span><span class="sxs-lookup"><span data-stu-id="274bc-114">The management team does not want to modernize unnecessarily.</span></span> <span data-ttu-id="274bc-115">También desean mantener el control del ámbito y los costos.</span><span class="sxs-lookup"><span data-stu-id="274bc-115">They also want to maintain control of scope and costs.</span></span> <span data-ttu-id="274bc-116">Para ello, se ha decidido mantener los servicios HTTP SOAP existentes.</span><span class="sxs-lookup"><span data-stu-id="274bc-116">To do this, they have decided to preserve their existing SOAP HTTP services.</span></span> <span data-ttu-id="274bc-117">También pretenden minimizar los cambios en la interfaz de usuario existente.</span><span class="sxs-lookup"><span data-stu-id="274bc-117">They also intend to minimize changes to the existing UI.</span></span> <span data-ttu-id="274bc-118">[Azure API Management (APIM)][apim] se puede utilizar para solucionar muchos de los requisitos y restricciones del proyecto.</span><span class="sxs-lookup"><span data-stu-id="274bc-118">[Azure API Management (APIM)][apim] can be utilized to address many of the project's requirements and constraints.</span></span>

## <a name="architecture"></a><span data-ttu-id="274bc-119">Arquitectura</span><span class="sxs-lookup"><span data-stu-id="274bc-119">Architecture</span></span>

![Diagrama de la arquitectura][architecture]

<span data-ttu-id="274bc-121">La nueva interfaz de usuario se hospedará como una aplicación de plataforma como servicio (PaaS) en Azure y dependerá de las API HTTP nuevas y existentes.</span><span class="sxs-lookup"><span data-stu-id="274bc-121">The new UI will be hosted as a platform as a service (PaaS) application on Azure, and will depend on both existing and new HTTP APIs.</span></span> <span data-ttu-id="274bc-122">Estas API se entregarán con un conjunto de interfaces mejor diseñado que permita un mejor rendimiento y facilite la integración y la extensibilidad futura.</span><span class="sxs-lookup"><span data-stu-id="274bc-122">These APIs will ship with a better-designed set of interfaces enabling better performance, easier integration, and future extensibility.</span></span>

### <a name="components-and-security"></a><span data-ttu-id="274bc-123">Componentes y seguridad</span><span class="sxs-lookup"><span data-stu-id="274bc-123">Components and Security</span></span>

1. <span data-ttu-id="274bc-124">La aplicación web local existente continuará con el consumo directo de los servicios web locales existentes.</span><span class="sxs-lookup"><span data-stu-id="274bc-124">The existing on-premises web application will continue to directly consume the existing on-premises web services.</span></span>
2. <span data-ttu-id="274bc-125">Las llamadas desde la aplicación web existente a los servicios HTTP existentes permanecerán sin cambios.</span><span class="sxs-lookup"><span data-stu-id="274bc-125">Calls from the existing web app to the existing HTTP services will remain unchanged.</span></span> <span data-ttu-id="274bc-126">Estas llamadas son internas en la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="274bc-126">These calls are internal to the corporate network.</span></span>
3. <span data-ttu-id="274bc-127">Las llamadas entrantes se realizan desde Azure a los servicios internos existentes:</span><span class="sxs-lookup"><span data-stu-id="274bc-127">Inbound calls are made from Azure to the existing internal services:</span></span>
    - <span data-ttu-id="274bc-128">El equipo de seguridad permite que el tráfico desde la instancia de APIM pase a través del firewall corporativo hacia los servicios locales existentes [con transporte seguro (HTTPS/SSL)][apim-ssl].</span><span class="sxs-lookup"><span data-stu-id="274bc-128">The security team allows traffic from the APIM instance to pass through the corporate firewall to the existing on-premises services [using secure transport (HTTPS/SSL)][apim-ssl].</span></span>
    - <span data-ttu-id="274bc-129">El equipo de operaciones solo permitirá las llamadas entrantes a los servicios desde la instancia de APIM.</span><span class="sxs-lookup"><span data-stu-id="274bc-129">The operations team will allow inbound calls to the services only from the APIM instance.</span></span> <span data-ttu-id="274bc-130">Este requisito se cumple mediante la [inclusión en la lista de permitidos de la dirección IP de la instancia de APIM][apim-whitelist-ip] dentro del perímetro de la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="274bc-130">This requirement is met by [white-listing the IP address of the APIM instance][apim-whitelist-ip] within the corporate network perimeter.</span></span>
    - <span data-ttu-id="274bc-131">Se configura un nuevo módulo en la canalización de solicitudes de servicios HTTP local (para actuar **solo** en las conexiones que se originan externamente), la cual validará [un certificado que proporcionará la instancia de APIM][apim-mutualcert-auth].</span><span class="sxs-lookup"><span data-stu-id="274bc-131">A new module is configured into the on-premises HTTP services request pipeline (to act upon **only** those connections originating externally), which will validate [a certificate which APIM will provide][apim-mutualcert-auth].</span></span>
4. <span data-ttu-id="274bc-132">La nueva API:</span><span class="sxs-lookup"><span data-stu-id="274bc-132">The new API:</span></span>
    - <span data-ttu-id="274bc-133">Se expone solo mediante la instancia de APIM, que proporcionará la fachada de la API.</span><span class="sxs-lookup"><span data-stu-id="274bc-133">Is surfaced only through the APIM instance, which will provide the API facade.</span></span> <span data-ttu-id="274bc-134">No se podrá acceder a la nueva API directamente.</span><span class="sxs-lookup"><span data-stu-id="274bc-134">The new API won't be accessed directly.</span></span>
    - <span data-ttu-id="274bc-135">Se ha desarrollado y publicado como una [aplicación de API web de PaaS de Azure][azure-api-apps].</span><span class="sxs-lookup"><span data-stu-id="274bc-135">Is developed and published as an [Azure PaaS Web API App][azure-api-apps].</span></span>
    - <span data-ttu-id="274bc-136">Se incluye en la lista de permitidos (mediante la [configuración de la aplicación web][azure-appservice-ip-restrict]) para aceptar solo la dirección [VIP de APIM][apim-faq-vip].</span><span class="sxs-lookup"><span data-stu-id="274bc-136">Is white-listed (via [Web App settings][azure-appservice-ip-restrict]) to accept only the [APIM VIP][apim-faq-vip].</span></span>
    - <span data-ttu-id="274bc-137">Se hospeda en Azure Web Apps con el transporte seguro SSL activado.</span><span class="sxs-lookup"><span data-stu-id="274bc-137">Is hosted in Azure Web Apps with Secure Transport/SSL turned on.</span></span>
    - <span data-ttu-id="274bc-138">Tiene habilitada la autorización, [proporcionada por Azure App Service][azure-appservice-auth] con Azure Active Directory y OAuth2.</span><span class="sxs-lookup"><span data-stu-id="274bc-138">Has authorization enabled, [provided by the Azure App Service][azure-appservice-auth] using Azure Active Directory and OAuth2.</span></span>
5. <span data-ttu-id="274bc-139">La nueva aplicación web basada en explorador dependerá de la instancia de Azure API Management para **ambas** API: la API HTTP existente y la nueva API.</span><span class="sxs-lookup"><span data-stu-id="274bc-139">The new browser-based web application will depend on the Azure API Management instance for **both** the existing HTTP API and the new API.</span></span>

<span data-ttu-id="274bc-140">La instancia de APIM se configurará para asignar los servicios HTTP heredados a un nuevo contrato de API.</span><span class="sxs-lookup"><span data-stu-id="274bc-140">The APIM instance will be configured to map the legacy HTTP services to a new API contract.</span></span> <span data-ttu-id="274bc-141">Al hacerlo, la nueva interfaz de usuario web no es consciente de la integración con un conjunto de servicios y API heredadas y nuevas API.</span><span class="sxs-lookup"><span data-stu-id="274bc-141">By doing this, the new Web UI is unaware of the integration with a set of legacy services/APIs and new APIs.</span></span> <span data-ttu-id="274bc-142">En el futuro, el equipo del proyecto migrará gradualmente la funcionalidad a las nuevas API y retirará los servicios originales.</span><span class="sxs-lookup"><span data-stu-id="274bc-142">In the future, the project team will gradually port functionality to the new APIs and retire the original services.</span></span> <span data-ttu-id="274bc-143">Estos cambios se controlarán dentro de la configuración de APIM, lo que no afecta a la interfaz de usuario del front-end y evita el trabajo de renovación.</span><span class="sxs-lookup"><span data-stu-id="274bc-143">These changes will be handled within APIM configuration, leaving the front-end UI unaffected and avoiding redevelopment work.</span></span>

### <a name="alternatives"></a><span data-ttu-id="274bc-144">Alternativas</span><span class="sxs-lookup"><span data-stu-id="274bc-144">Alternatives</span></span>

- <span data-ttu-id="274bc-145">Si la organización planea mover la infraestructura completamente a Azure, incluidas las máquinas virtuales que hospedan las aplicaciones heredadas, APIM todavía sería una buena opción, ya que puede actuar como una fachada para cualquier punto de conexión HTTP direccionable.</span><span class="sxs-lookup"><span data-stu-id="274bc-145">If the organization was planning to move their infrastructure entirely to Azure, including the VMs hosting the legacy applications, then APIM would still be a great option since it can act as a facade for any addressable HTTP endpoint.</span></span>
- <span data-ttu-id="274bc-146">Si el cliente ha decidido mantener la privacidad de los puntos de conexión existentes y no los expone públicamente, su instancia de API Management podría vincularse a una instancia de [Azure Virtual Network (VNet)][azure-vnet]:</span><span class="sxs-lookup"><span data-stu-id="274bc-146">If the customer had decided to keep the existing endpoints private and not expose them publicly, their API Management instance could be linked to an [Azure Virtual Network (VNet)][azure-vnet]:</span></span>
  - <span data-ttu-id="274bc-147">En un [escenario de migración mediante lift-and-shift de Azure][azure-vm-lift-shift] vinculado a la red virtual de Azure implementada, el cliente podría direccionar directamente el servicio de back-end con direcciones IP privadas.</span><span class="sxs-lookup"><span data-stu-id="274bc-147">In an [Azure lift and shift scenario][azure-vm-lift-shift] linked to their deployed Azure Virtual Network, the customer could directly address the back-end service through private IP addresses.</span></span>
  - <span data-ttu-id="274bc-148">En el escenario local, la instancia de API Management llegara al servicio interno de forma privada mediante [Azure VPN Gateway y conexiones VPN de IPSec de sitio a sitio][azure-vpn] o [ ExpressRoute][azure-er], por lo que es un [escenario híbrido de Azure y entorno local][azure-hybrid].</span><span class="sxs-lookup"><span data-stu-id="274bc-148">In the on-premises scenario, the API Management instance could reach back to the internal service privately via an [Azure VPN gateway and site-to-site IPSec VPN connection][azure-vpn] or [ExpressRoute][azure-er] making this a [hybrid Azure and on-premises scenario][azure-hybrid].</span></span>
- <span data-ttu-id="274bc-149">La instancia de API Management se puede mantener privada mediante la implementación de la instancia de API Management en modo interno.</span><span class="sxs-lookup"><span data-stu-id="274bc-149">The API Management instance can be kept private by deploying the API Management instance in Internal mode.</span></span> <span data-ttu-id="274bc-150">A continuación, se podría utilizar la implementación con [Azure Application Gateway][azure-appgw] para permitir el acceso público para algunas API mientras que otras siguen siendo internas.</span><span class="sxs-lookup"><span data-stu-id="274bc-150">The deployment could then be used with an [Azure Application Gateway][azure-appgw] to enable public access for some APIs while others remain internal.</span></span> <span data-ttu-id="274bc-151">Para más información, consulte [Conexión de APIM en modo interno a una red virtual][apim-vnet-internal].</span><span class="sxs-lookup"><span data-stu-id="274bc-151">For more information, see [Connecting APIM in internal mode to a VNET][apim-vnet-internal].</span></span>

> [!NOTE]
> <span data-ttu-id="274bc-152">Para obtener información general sobre la conexión de API Management a una red virtual, [consulte aquí][apim-vnet].</span><span class="sxs-lookup"><span data-stu-id="274bc-152">For general information on connecting API Management to a VNET, [see here][apim-vnet].</span></span>

### <a name="availability-and-scalability"></a><span data-ttu-id="274bc-153">Disponibilidad y escalabilidad</span><span class="sxs-lookup"><span data-stu-id="274bc-153">Availability and scalability</span></span>

- <span data-ttu-id="274bc-154">Azure API Management se puede [escalar horizontalmente][apim-scaleout] mediante la elección de un plan de tarifa y la posterior adición de unidades.</span><span class="sxs-lookup"><span data-stu-id="274bc-154">Azure API Management can be [scaled out][apim-scaleout] by choosing a pricing tier and then adding units.</span></span>
- <span data-ttu-id="274bc-155">El escalado también puede ocurrir [automáticamente con el escalado automático][apim-autoscale].</span><span class="sxs-lookup"><span data-stu-id="274bc-155">Scaling also happen [automatically with auto scaling][apim-autoscale].</span></span>
- <span data-ttu-id="274bc-156">La [implementación en varias regiones][apim-multi-regions] permitirá opciones de conmutación por error y se puede realizar en el [plan Premium][apim-pricing].</span><span class="sxs-lookup"><span data-stu-id="274bc-156">[Deploying across multiple regions][apim-multi-regions] will enable fail over options and can be done in the [Premium tier][apim-pricing].</span></span>
- <span data-ttu-id="274bc-157">Considere la posibilidad de la [integración con Azure Application Insights][azure-apim-ai], que también expone las métricas mediante [Azure Monitor][azure-mon] para la supervisión.</span><span class="sxs-lookup"><span data-stu-id="274bc-157">Consider [Integrating with Azure Application Insights][azure-apim-ai], which also surfaces metrics through [Azure Monitor][azure-mon] for monitoring.</span></span>

## <a name="deploy-the-scenario"></a><span data-ttu-id="274bc-158">Implementación del escenario</span><span class="sxs-lookup"><span data-stu-id="274bc-158">Deploy the scenario</span></span>

<span data-ttu-id="274bc-159">Para empezar a trabajar, [cree una instancia de Azure API Management en el portal.][apim-create]</span><span class="sxs-lookup"><span data-stu-id="274bc-159">To get started, [create an Azure API Management instance in the portal.][apim-create]</span></span>

<span data-ttu-id="274bc-160">Como alternativa, puede elegir una [plantilla de inicio rápido][azure-quickstart-templates-apim] de Azure Resource Manager existente que se adapte a sus necesidades específicas.</span><span class="sxs-lookup"><span data-stu-id="274bc-160">Alternatively, you can choose from an existing Azure Resource Manager [quickstart template][azure-quickstart-templates-apim] that aligns to your specific use case.</span></span>

## <a name="pricing"></a><span data-ttu-id="274bc-161">Precios</span><span class="sxs-lookup"><span data-stu-id="274bc-161">Pricing</span></span>

<span data-ttu-id="274bc-162">API Management se ofrece en cuatro niveles: desarrollador, básico, estándar y premium.</span><span class="sxs-lookup"><span data-stu-id="274bc-162">API Management is offered in four tiers: developer, basic, standard, and premium.</span></span> <span data-ttu-id="274bc-163">Puede encontrar instrucciones detalladas sobre las diferencias entre estos niveles en la [guía de precios de Azure API Management.][apim-pricing]</span><span class="sxs-lookup"><span data-stu-id="274bc-163">You can find detailed guidance on the difference in these tiers at the [Azure API Management pricing guidance here.][apim-pricing]</span></span>

<span data-ttu-id="274bc-164">Los clientes pueden escalar API Management agregando o quitando unidades.</span><span class="sxs-lookup"><span data-stu-id="274bc-164">Customers can scale API Management by adding and removing units.</span></span> <span data-ttu-id="274bc-165">Cada unidad tiene una capacidad que depende de su nivel.</span><span class="sxs-lookup"><span data-stu-id="274bc-165">Each unit has capacity that depends on its tier.</span></span>

> [!NOTE]
> <span data-ttu-id="274bc-166">El nivel Desarrollador se puede usar para la evaluación de las características de API Management.</span><span class="sxs-lookup"><span data-stu-id="274bc-166">The Developer tier can be used for evaluation of the API Management features.</span></span> <span data-ttu-id="274bc-167">El nivel Desarrollador no se debe usar en producción.</span><span class="sxs-lookup"><span data-stu-id="274bc-167">The Developer tier should not be used for production.</span></span>

<span data-ttu-id="274bc-168">Para ver los costos proyectados y realizar la personalización pertinente en función de las necesidades de la implementación, puede modificar el número de unidades de escalado y las instancias de App Service en la [Calculadora de precios de Azure][pricing-calculator].</span><span class="sxs-lookup"><span data-stu-id="274bc-168">To view projected costs and customize to your deployment needs, you can modify the number of scale units and App Service instances in the [Azure Pricing Calculator][pricing-calculator].</span></span>

## <a name="related-resources"></a><span data-ttu-id="274bc-169">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="274bc-169">Related resources</span></span>

<span data-ttu-id="274bc-170">Consulte la amplia [documentación y artículos de referencia][apim] de Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="274bc-170">Review the extensive Azure API Management [documentation and reference articles][apim].</span></span>

<!-- links -->

[architecture]: ./media/architecture-apim-api-scenario.png
[apim-create]: /azure/api-management/get-started-create-service-instance
[apim-git]: /azure/api-management/api-management-configuration-repository-git
[apim-multi-regions]: /azure/api-management/api-management-howto-deploy-multi-region
[apim-autoscale]: /azure/api-management/api-management-howto-autoscale
[apim-scaleout]: /azure/api-management/upgrade-and-scale
[azure-apim-ai]: /azure/api-management/api-management-howto-app-insights
[azure-ai]: /azure/application-insights/
[azure-mon]: /azure/monitoring-and-diagnostics/monitoring-overview
[azure-appgw]: /azure/application-gateway/application-gateway-introduction
[apim-vnet-internal]: /azure/api-management/api-management-howto-integrate-internal-vnet-appgateway
[apim-vnet]: /azure/api-management/api-management-using-with-vnet
[azure-hybrid]: /azure/architecture/reference-architectures/hybrid-networking/
[azure-er]: /azure/expressroute/expressroute-introduction
[azure-vpn]: /azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal
[azure-vnet]: /azure/virtual-network/virtual-networks-overview
[azure-appservice-auth]: /azure/app-service/app-service-authentication-overview#identity-providers
[apim-faq-vip]: /azure/api-management/api-management-faq#is-the-api-management-gateway-ip-address-constant-can-i-use-it-in-firewall-rules
[azure-appservice-ip-restrict]: /azure/app-service/app-service-ip-restrictions
[azure-api-apps]: /azure/app-service/
[apim-ssl]: /azure/api-management/api-management-howto-manage-protocols-ciphers
[apim-mutualcert-auth]: /azure/api-management/api-management-howto-mutual-certificates
[apim-whitelist-ip]: /azure/api-management/api-management-faq#is-the-api-management-gateway-ip-address-constant-can-i-use-it-in-firewall-rules
[anti-corruption-layer-pattern]: /azure/architecture/patterns/anti-corruption-layer
[apim]: /azure/api-management/api-management-key-concepts
[apim-api-design-guidance]: /azure/architecture/best-practices/api-design
[visualstudio-youtube-solid-design]: https://youtu.be/agkWYPUcLpg
[azure-vm-lift-shift]: https://azure.microsoft.com/resources/azure-virtual-datacenter-lift-and-shift-guide/
[standard-pricing-calc]: https://azure.com/e/
[premium-pricing-calc]: https://azure.com/e/
[apim-pricing]: https://azure.microsoft.com/pricing/details/api-management/
[azure-quickstart-templates-apim]: https://azure.microsoft.com/resources/templates/?term=API+Management&pageNumber=1
[soap]: https://en.wikipedia.org/wiki/SOAP
[pricing-calculator]: https://azure.com/e/0e916a861fac464db61342d378cc0bd6
