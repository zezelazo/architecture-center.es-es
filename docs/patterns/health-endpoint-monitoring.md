---
title: Health Endpoint Monitoring
description: "Implementa comprobaciones funcionales en una aplicación a la que pueden acceder herramientas externas a través de los puntos de conexión expuestos en intervalos regulares."
keywords: "Patrón de diseño"
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- availability
- management-monitoring
- resiliency
ms.openlocfilehash: 36171d568b9b5bfbbd48ee762b16adea695cf0e9
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/14/2017
---
# <a name="health-endpoint-monitoring-pattern"></a><span data-ttu-id="4a917-104">Patrón Health Endpoint Monitoring (supervisión de puntos de conexión de estado)</span><span class="sxs-lookup"><span data-stu-id="4a917-104">Health Endpoint Monitoring pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="4a917-105">Implementa comprobaciones funcionales en una aplicación a la que pueden acceder herramientas externas a través de los puntos de conexión expuestos en intervalos regulares.</span><span class="sxs-lookup"><span data-stu-id="4a917-105">Implement functional checks in an application that external tools can access through exposed endpoints at regular intervals.</span></span> <span data-ttu-id="4a917-106">Este patrón puede ayudar a comprobar que las aplicaciones y los servicios funcionan correctamente.</span><span class="sxs-lookup"><span data-stu-id="4a917-106">This can help to verify that applications and services are performing correctly.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="4a917-107">Contexto y problema</span><span class="sxs-lookup"><span data-stu-id="4a917-107">Context and problem</span></span>

<span data-ttu-id="4a917-108">Es un procedimiento recomendado y, a menudo, un requisito empresarial, supervisar las aplicaciones web y los servicios de back-end, para asegurarse de que están disponibles y de que funcionan correctamente.</span><span class="sxs-lookup"><span data-stu-id="4a917-108">It's a good practice, and often a business requirement, to monitor web applications and back-end services, to ensure they're available and performing correctly.</span></span> <span data-ttu-id="4a917-109">Sin embargo, es más difícil supervisar los servicios que se ejecutan en la nube que supervisar los servicios locales.</span><span class="sxs-lookup"><span data-stu-id="4a917-109">However, it's more difficult to monitor services running in the cloud than it is to monitor on-premises services.</span></span> <span data-ttu-id="4a917-110">Por ejemplo, no tiene control total sobre el entorno de hospedaje, y los servicios normalmente dependen de otros servicios proporcionados por proveedores de plataforma y por otros.</span><span class="sxs-lookup"><span data-stu-id="4a917-110">For example, you don't have full control of the hosting environment, and the services typically depend on other services provided by platform vendors and others.</span></span>

<span data-ttu-id="4a917-111">Hay muchos factores que afectan a las aplicaciones hospedadas en la nube como la latencia de red, el rendimiento y la disponibilidad de los sistemas subyacentes de proceso y almacenamiento, y el ancho de banda de red entre ellos.</span><span class="sxs-lookup"><span data-stu-id="4a917-111">There are many factors that affect cloud-hosted applications such as network latency, the performance and availability of the underlying compute and storage systems, and the network bandwidth between them.</span></span> <span data-ttu-id="4a917-112">Se puede producir un error total o parcial en el servicio a causa de cualquiera de estos factores.</span><span class="sxs-lookup"><span data-stu-id="4a917-112">The service can fail entirely or partially due to any of these factors.</span></span> <span data-ttu-id="4a917-113">Por lo tanto, debe comprobar periódicamente que el servicio se está ejecutando correctamente para garantizar el nivel requerido de disponibilidad, el cual puede que forme parte de su Acuerdo de Nivel de Servicio (SLA).</span><span class="sxs-lookup"><span data-stu-id="4a917-113">Therefore, you must verify at regular intervals that the service is performing correctly to ensure the required level of availability, which might be part of your service level agreement (SLA).</span></span>

## <a name="solution"></a><span data-ttu-id="4a917-114">Solución</span><span class="sxs-lookup"><span data-stu-id="4a917-114">Solution</span></span>

<span data-ttu-id="4a917-115">Implemente el seguimiento de estado mediante el envío de solicitudes a un punto de conexión de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-115">Implement health monitoring by sending requests to an endpoint on the application.</span></span> <span data-ttu-id="4a917-116">La aplicación debe realizar las comprobaciones necesarias y devolver una indicación del estado.</span><span class="sxs-lookup"><span data-stu-id="4a917-116">The application should perform the necessary checks, and return an indication of its status.</span></span>

<span data-ttu-id="4a917-117">Una comprobación de seguimiento del estado normalmente combina dos factores:</span><span class="sxs-lookup"><span data-stu-id="4a917-117">A health monitoring check typically combines two factors:</span></span>

- <span data-ttu-id="4a917-118">Las comprobaciones (si existen) realizadas por la aplicación o servicio en respuesta a la solicitud del punto de conexión de la comprobación de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="4a917-118">The checks (if any) performed by the application or service in response to the request to the health verification endpoint.</span></span>
- <span data-ttu-id="4a917-119">El análisis de los resultados por la herramienta o marco que realiza la comprobación de estado.</span><span class="sxs-lookup"><span data-stu-id="4a917-119">Analysis of the results by the tool or framework that performs the health verification check.</span></span>

<span data-ttu-id="4a917-120">El código de respuesta indica el estado de la aplicación y, opcionalmente, el de los componentes o servicios que utiliza.</span><span class="sxs-lookup"><span data-stu-id="4a917-120">The response code indicates the status of the application and, optionally, any components or services it uses.</span></span> <span data-ttu-id="4a917-121">La herramienta o marco de supervisión es la que realiza la comprobación de latencia o de tiempo de respuesta.</span><span class="sxs-lookup"><span data-stu-id="4a917-121">The latency or response time check is performed by the monitoring tool or framework.</span></span> <span data-ttu-id="4a917-122">Esta ilustración proporciona información general sobre el patrón.</span><span class="sxs-lookup"><span data-stu-id="4a917-122">The figure provides an overview of the pattern.</span></span>

![Información general del patrón](./_images/health-endpoint-monitoring-pattern.png)

<span data-ttu-id="4a917-124">Otras comprobaciones que el código de seguimiento del estado puede llevar a cabo incluyen:</span><span class="sxs-lookup"><span data-stu-id="4a917-124">Other checks that might be carried out by the health monitoring code in the application include:</span></span>
- <span data-ttu-id="4a917-125">La comprobación del almacenamiento en la nube o de una base de datos para ver su disponibilidad y el tiempo de respuesta.</span><span class="sxs-lookup"><span data-stu-id="4a917-125">Checking cloud storage or a database for availability and response time.</span></span>
- <span data-ttu-id="4a917-126">La comprobación de otros servicios o recursos ubicados en la aplicación, o situados en otro lugar pero que la aplicación utiliza.</span><span class="sxs-lookup"><span data-stu-id="4a917-126">Checking other resources or services located in the application, or located elsewhere but used by the application.</span></span>

<span data-ttu-id="4a917-127">Existen servicios y herramientas disponibles que supervisan aplicaciones web mediante el envío de una solicitud a un conjunto configurable de puntos de conexión, y la evaluación de los resultados en comparación con un conjunto de reglas configurable.</span><span class="sxs-lookup"><span data-stu-id="4a917-127">Services and tools are available that monitor web applications by submitting a request to a configurable set of endpoints, and evaluating the results against a set of configurable rules.</span></span> <span data-ttu-id="4a917-128">Es relativamente fácil crear un punto de conexión de servicio cuyo único propósito consista en realizar algunas pruebas funcionales en el sistema.</span><span class="sxs-lookup"><span data-stu-id="4a917-128">It's relatively easy to create a service endpoint whose sole purpose is to perform some functional tests on the system.</span></span>

<span data-ttu-id="4a917-129">Entre las comprobaciones típicas que se pueden realizar mediante las herramientas de supervisión se incluyen:</span><span class="sxs-lookup"><span data-stu-id="4a917-129">Typical checks that can be performed by the monitoring tools include:</span></span>

- <span data-ttu-id="4a917-130">Validación del código de respuesta.</span><span class="sxs-lookup"><span data-stu-id="4a917-130">Validating the response code.</span></span> <span data-ttu-id="4a917-131">Por ejemplo, una respuesta HTTP 200 (OK) indica que la aplicación respondió sin errores.</span><span class="sxs-lookup"><span data-stu-id="4a917-131">For example, an HTTP response of 200 (OK) indicates that the application responded without error.</span></span> <span data-ttu-id="4a917-132">El sistema de supervisión puede también comprobar otros códigos de respuesta para dar unos resultados más completos.</span><span class="sxs-lookup"><span data-stu-id="4a917-132">The monitoring system might also check for other response codes to give more comprehensive results.</span></span>
- <span data-ttu-id="4a917-133">Comprobación del contenido de la respuesta para detectar errores, incluso cuando se devuelve un código de estado 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="4a917-133">Checking the content of the response to detect errors, even when a 200 (OK) status code is returned.</span></span> <span data-ttu-id="4a917-134">Esta permite detectar los errores que afectan a solo una sección de la página web o respuesta del servicio devueltas.</span><span class="sxs-lookup"><span data-stu-id="4a917-134">This can detect errors that affect only a section of the returned web page or service response.</span></span> <span data-ttu-id="4a917-135">Por ejemplo, la comprobación del título de una página o la búsqueda de una expresión específica que indique que se devolvió la página correcta.</span><span class="sxs-lookup"><span data-stu-id="4a917-135">For example, checking the title of a page or looking for a specific phrase that indicates the correct page was returned.</span></span>
- <span data-ttu-id="4a917-136">La medición del tiempo de respuesta, el cual indica una combinación de la latencia de red y el tiempo que la aplicación tardó en ejecutar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4a917-136">Measuring the response time, which indicates a combination of the network latency and the time that the application took to execute the request.</span></span> <span data-ttu-id="4a917-137">Un valor que aumenta puede indicar un problema emergente con la aplicación o la red.</span><span class="sxs-lookup"><span data-stu-id="4a917-137">An increasing value can indicate an emerging problem with the application or network.</span></span>
- <span data-ttu-id="4a917-138">Comprobación de recursos o servicios que se encuentran fuera de la aplicación, como una red de entrega de contenido que usa la aplicación para entregar contenido a partir de memorias caché globales.</span><span class="sxs-lookup"><span data-stu-id="4a917-138">Checking resources or services located outside the application, such as a content delivery network used by the application to deliver content from global caches.</span></span>
- <span data-ttu-id="4a917-139">Comprobación de la expiración de certificados SSL.</span><span class="sxs-lookup"><span data-stu-id="4a917-139">Checking for expiration of SSL certificates.</span></span>
- <span data-ttu-id="4a917-140">Medición del tiempo de respuesta de una búsqueda de DNS de la dirección URL de la aplicación para medir la latencia y los errores de DNS.</span><span class="sxs-lookup"><span data-stu-id="4a917-140">Measuring the response time of a DNS lookup for the URL of the application to measure DNS latency and DNS failures.</span></span>
- <span data-ttu-id="4a917-141">Validación de la dirección URL devuelta por la búsqueda de DNS para asegurarse de que las entradas son correctas.</span><span class="sxs-lookup"><span data-stu-id="4a917-141">Validating the URL returned by the DNS lookup to ensure correct entries.</span></span> <span data-ttu-id="4a917-142">Esto puede ayudar a evitar la redirección de solicitudes malintencionadas como resultado de un ataque al servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="4a917-142">This can help to avoid malicious request redirection through a successful attack on the DNS server.</span></span>

<span data-ttu-id="4a917-143">También resulta útil, siempre que sea posible, ejecutar estas comprobaciones desde ubicaciones diferentes locales u hospedadas para medir y comparar los tiempos de respuesta.</span><span class="sxs-lookup"><span data-stu-id="4a917-143">It's also useful, where possible, to run these checks from different on-premises or hosted locations to measure and compare response times.</span></span> <span data-ttu-id="4a917-144">Lo ideal sería supervisar las aplicaciones desde ubicaciones que estén cerca de los clientes para obtener una vista precisa del rendimiento de cada ubicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-144">Ideally you should monitor applications from locations that are close to customers to get an accurate view of the performance from each location.</span></span> <span data-ttu-id="4a917-145">Además de proporcionar un mecanismo de comprobación más potente, los resultados pueden ayudarle a decidir la ubicación de la implementación de la aplicación y si debe implementarla en más de un centro de datos.</span><span class="sxs-lookup"><span data-stu-id="4a917-145">In addition to providing a more robust checking mechanism, the results can help you decide on the deployment location for the application&mdash;and whether to deploy it in more than one datacenter.</span></span>

<span data-ttu-id="4a917-146">Las pruebas se deben ejecutar en todas las instancias de servicio que los clientes usen para garantizar que la aplicación funciona correctamente para todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="4a917-146">Tests should also be run against all the service instances that customers use to ensure the application is working correctly for all customers.</span></span> <span data-ttu-id="4a917-147">Por ejemplo, si el almacenamiento de un cliente se distribuye en más de una cuenta de almacenamiento, el proceso de supervisión debería comprobarlas todas.</span><span class="sxs-lookup"><span data-stu-id="4a917-147">For example, if customer storage is spread across more than one storage account, the monitoring process should check all of these.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="4a917-148">Problemas y consideraciones</span><span class="sxs-lookup"><span data-stu-id="4a917-148">Issues and considerations</span></span>

<span data-ttu-id="4a917-149">Tenga en cuenta los puntos siguientes al decidir cómo implementar este patrón:</span><span class="sxs-lookup"><span data-stu-id="4a917-149">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="4a917-150">Validación de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="4a917-150">How to validate the response.</span></span> <span data-ttu-id="4a917-151">Por ejemplo, ¿basta con solo un único código de estado 200 (OK) para comprobar que la aplicación funciona correctamente?</span><span class="sxs-lookup"><span data-stu-id="4a917-151">For example, is just a single 200 (OK) status code sufficient to verify the application is working correctly?</span></span> <span data-ttu-id="4a917-152">Aunque este proporciona la medida más básica de disponibilidad de las aplicaciones y es la implementación mínima de este patrón, proporciona poca información sobre las operaciones, tendencias y posibles problemas futuros de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-152">While this provides the most basic measure of application availability, and is the minimum implementation of this pattern, it provides little information about the operations, trends, and possible upcoming issues in the application.</span></span>

   >  <span data-ttu-id="4a917-153">Asegúrese de que la aplicación devuelve correctamente un 200 (OK) solo si se encuentra y procesa el recurso de destino.</span><span class="sxs-lookup"><span data-stu-id="4a917-153">Make sure that the application correctly returns a 200 (OK) only when the target resource is found and processed.</span></span> <span data-ttu-id="4a917-154">En algunos escenarios, como cuando se usa una página maestra para hospedar la página web de destino, el servidor devuelve un código de estado 200 (OK) en lugar de un código 404 (no encontrado), incluso aunque no se encuentre la página de contenido de destino.</span><span class="sxs-lookup"><span data-stu-id="4a917-154">In some scenarios, such as when using a master page to host the target web page, the server sends back a 200 (OK) status code instead of a 404 (Not Found) code, even when the target content page was not found.</span></span>

<span data-ttu-id="4a917-155">El número de puntos de conexión a exponer para una aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-155">The number of endpoints to expose for an application.</span></span> <span data-ttu-id="4a917-156">Un enfoque consiste en exponer al menos un punto de conexión para los servicios básicos que utiliza la aplicación y otro para los servicios de prioridad inferior, lo que permite que haya diferentes niveles de importancia que se asignarán a cada resultado de la supervisión.</span><span class="sxs-lookup"><span data-stu-id="4a917-156">One approach is to expose at least one endpoint for the core services that the application uses and another for lower priority services, allowing different levels of importance to be assigned to each monitoring result.</span></span> <span data-ttu-id="4a917-157">Considere también la posibilidad de exponer más puntos de conexión como, por ejemplo, uno para cada servicio básico, para conseguir granularidad adicional en la supervisión.</span><span class="sxs-lookup"><span data-stu-id="4a917-157">Also consider exposing more endpoints, such as one for each core service, for additional monitoring granularity.</span></span> <span data-ttu-id="4a917-158">Por ejemplo, una comprobación de estado puede comprobar la base de datos, el almacenamiento y un servicio de geocodificación externo que use una aplicación, cada uno de ellos con un nivel diferente de tiempo de actividad y de tiempo de respuesta.</span><span class="sxs-lookup"><span data-stu-id="4a917-158">For example, a health verification check might check the database, storage, and an external geocoding service that an application uses, with each requiring a different level of uptime and response time.</span></span> <span data-ttu-id="4a917-159">El estado de la aplicación puede seguir siendo correcto incluso aunque el servicio de geocodificación, o alguna otra tarea en segundo plano, no esté disponible durante algunos minutos.</span><span class="sxs-lookup"><span data-stu-id="4a917-159">The application could still be healthy if the geocoding service, or some other background task, is unavailable for a few minutes.</span></span>

<span data-ttu-id="4a917-160">Si debe utilizar el mismo punto de conexión para la supervisión que el que se usa para el acceso general, pero para una ruta de acceso específica diseñada para comprobaciones de estado, por ejemplo, /HealthCheck/{GUID}/ en el punto de conexión de acceso general.</span><span class="sxs-lookup"><span data-stu-id="4a917-160">Whether to use the same endpoint for monitoring as is used for general access, but to a specific path designed for health verification checks, for example, /HealthCheck/{GUID}/ on the general access endpoint.</span></span> <span data-ttu-id="4a917-161">Esto permite que las herramientas de supervisión ejecuten algunas pruebas funcionales en la aplicación, como agregar un nuevo registro de usuario, iniciar sesión y realizar una orden de prueba, al tiempo que también se comprueba que el punto de conexión de acceso general está disponible.</span><span class="sxs-lookup"><span data-stu-id="4a917-161">This allows some functional tests in the application to be run by the monitoring tools, such as adding a new user registration, signing in, and placing a test order, while also verifying that the general access endpoint is available.</span></span>

<span data-ttu-id="4a917-162">El tipo de información que se debe recopilar del servicio en respuesta a las solicitudes de supervisión, y la devolución de esta información.</span><span class="sxs-lookup"><span data-stu-id="4a917-162">The type of information to collect in the service in response to monitoring requests, and how to return this information.</span></span> <span data-ttu-id="4a917-163">La mayoría de las herramientas y marcos existentes mira solo el código de estado HTTP que devuelve el punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="4a917-163">Most existing tools and frameworks look only at the HTTP status code that the endpoint returns.</span></span> <span data-ttu-id="4a917-164">Para devolver y validar información adicional, es posible que deba crear un servicio o una utilidad de supervisión personalizados.</span><span class="sxs-lookup"><span data-stu-id="4a917-164">To return and validate additional information, you might have to create a custom monitoring utility or service.</span></span>

<span data-ttu-id="4a917-165">La cantidad de información que desea recopilar.</span><span class="sxs-lookup"><span data-stu-id="4a917-165">How much information to collect.</span></span> <span data-ttu-id="4a917-166">La realización de un procesamiento excesivo durante la comprobación puede sobrecargar la aplicación y afectar a otros usuarios.</span><span class="sxs-lookup"><span data-stu-id="4a917-166">Performing excessive processing during the check can overload the application and impact other users.</span></span> <span data-ttu-id="4a917-167">El tiempo que tarda puede superar el tiempo de espera del sistema de supervisión, por lo que se marcaría la aplicación como no disponible.</span><span class="sxs-lookup"><span data-stu-id="4a917-167">The time it takes might exceed the timeout of the monitoring system so it marks the application as unavailable.</span></span> <span data-ttu-id="4a917-168">La mayoría de las aplicaciones incluye instrumentaciones como controladores de error y contadores de rendimiento que registran el rendimiento y una detallada información del error, lo cual puede que sea suficiente en lugar de tener que devolver información adicional de una comprobación de estado.</span><span class="sxs-lookup"><span data-stu-id="4a917-168">Most applications include instrumentation such as error handlers and performance counters that log performance and detailed error information, this might be sufficient instead of returning additional information from a health verification check.</span></span>

<span data-ttu-id="4a917-169">Almacenamiento en caché del estado del punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="4a917-169">Caching the endpoint status.</span></span> <span data-ttu-id="4a917-170">Puede que sea costoso ejecutar la comprobación de estado con demasiada frecuencia.</span><span class="sxs-lookup"><span data-stu-id="4a917-170">It could be expensive to run the health check too frequently.</span></span> <span data-ttu-id="4a917-171">Si el estado de mantenimiento se notifica mediante un panel, por ejemplo, seguramente no deseará que todas las solicitudes del panel desencadenen una comprobación de estado.</span><span class="sxs-lookup"><span data-stu-id="4a917-171">If the health status is reported through a dashboard, for example, you don't want every request from the dashboard to trigger a health check.</span></span> <span data-ttu-id="4a917-172">En vez de eso, realice comprobaciones periódicas del estado del sistema y el estado de la caché.</span><span class="sxs-lookup"><span data-stu-id="4a917-172">Instead, periodically check the system health and cache the status.</span></span> <span data-ttu-id="4a917-173">Exponga un punto de conexión que devuelva el estado almacenado en caché.</span><span class="sxs-lookup"><span data-stu-id="4a917-173">Expose an endpoint that returns the cached status.</span></span>

<span data-ttu-id="4a917-174">Configuración de la seguridad de los puntos de conexión de supervisión para protegerlos del acceso público, que podría exponer a la aplicación a ataques malintencionados, al riesgo de exponer información confidencial o al de atraer ataques por denegación de servicio (DoS).</span><span class="sxs-lookup"><span data-stu-id="4a917-174">How to configure security for the monitoring endpoints to protect them from public access, which might expose the application to malicious attacks, risk the exposure of sensitive information, or attract denial of service (DoS) attacks.</span></span> <span data-ttu-id="4a917-175">Normalmente esto debe realizarse en la configuración de la aplicación para que se pueda actualizar fácilmente sin necesidad de reiniciar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-175">Typically this should be done in the application configuration so that it can be updated easily without restarting the application.</span></span> <span data-ttu-id="4a917-176">Considere el uso de una o varias de las técnicas siguientes:</span><span class="sxs-lookup"><span data-stu-id="4a917-176">Consider using one or more of the following techniques:</span></span>

- <span data-ttu-id="4a917-177">Protección del punto de conexión mediante autenticación.</span><span class="sxs-lookup"><span data-stu-id="4a917-177">Secure the endpoint by requiring authentication.</span></span> <span data-ttu-id="4a917-178">Puede hacerlo mediante una clave de seguridad de autenticación en el encabezado de la solicitud o mediante la transferencia de credenciales con la solicitud, siempre que el servicio o la herramienta de supervisión admita la autenticación.</span><span class="sxs-lookup"><span data-stu-id="4a917-178">You can do this by using an authentication security key in the request header or by passing credentials with the request, provided that the monitoring service or tool supports authentication.</span></span>

 - <span data-ttu-id="4a917-179">Use un punto de conexión oscuro u oculto.</span><span class="sxs-lookup"><span data-stu-id="4a917-179">Use an obscure or hidden endpoint.</span></span> <span data-ttu-id="4a917-180">Por ejemplo, exponga el punto de conexión en una dirección IP distinta a la usada por la URL de la aplicación predeterminada, configure el punto de conexión en un puerto HTTP no estándar y use una ruta compleja para probar la página.</span><span class="sxs-lookup"><span data-stu-id="4a917-180">For example, expose the endpoint on a different IP address to that used by the default application URL, configure the endpoint on a nonstandard HTTP port, and/or use a complex path to the test page.</span></span> <span data-ttu-id="4a917-181">Normalmente, puede especificar direcciones y puertos de puntos de conexión en la configuración de la aplicación, y agregar entradas para estos puntos de conexión en el servidor DNS si es necesario para evitar tener que especificar la dirección IP directamente.</span><span class="sxs-lookup"><span data-stu-id="4a917-181">You can usually specify additional endpoint addresses and ports in the application configuration, and add entries for these endpoints to the DNS server if required to avoid having to specify the IP address directly.</span></span>

 - <span data-ttu-id="4a917-182">Exponga un método en un punto de conexión que acepte un parámetro como valor de clave o valor de modo de operación.</span><span class="sxs-lookup"><span data-stu-id="4a917-182">Expose a method on an endpoint that accepts a parameter such as a key value or an operation mode value.</span></span> <span data-ttu-id="4a917-183">Dependiendo del valor proporcionado para este parámetro, cuando se recibe una solicitud el código puede realizar una prueba concreta o un conjunto de pruebas o devolver un error 404 (no encontrado) si no se reconoce el valor del parámetro.</span><span class="sxs-lookup"><span data-stu-id="4a917-183">Depending on the value supplied for this parameter, when a request is received the code can perform a specific test or set of tests, or return a 404 (Not Found) error if the parameter value isn't recognized.</span></span> <span data-ttu-id="4a917-184">Los valores de parámetro que se pueden reconocer se establecen en la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-184">The recognized parameter values could be set in the application configuration.</span></span>

     >  <span data-ttu-id="4a917-185">Es probable que los ataques por denegación de servicio tengan menos impacto en un punto de conexión independiente que realiza pruebas funcionales básicas que no afectan a las operaciones de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-185">DoS attacks are likely to have less impact on a separate endpoint that performs basic functional tests without compromising the operation of the application.</span></span> <span data-ttu-id="4a917-186">En la medida de lo posible, evite el uso de una prueba que pueda exponer información confidencial.</span><span class="sxs-lookup"><span data-stu-id="4a917-186">Ideally, avoid using a test that might expose sensitive information.</span></span> <span data-ttu-id="4a917-187">Si debe devolver información que pueda resultar útil a un atacante, tenga en cuenta la protección del punto de conexión y de los datos ante accesos no autorizados.</span><span class="sxs-lookup"><span data-stu-id="4a917-187">If you must return information that might be useful to an attacker, consider how you'll protect the endpoint and the data from unauthorized access.</span></span> <span data-ttu-id="4a917-188">En este caso, confiar simplemente en la oscuridad de un punto de conexión no es suficiente.</span><span class="sxs-lookup"><span data-stu-id="4a917-188">In this case just relying on obscurity isn't enough.</span></span> <span data-ttu-id="4a917-189">También debe considerar el uso de una conexión HTTPS y el cifrado de todos los datos confidenciales, aunque esto aumentará la carga en el servidor.</span><span class="sxs-lookup"><span data-stu-id="4a917-189">You should also consider using an HTTPS connection and encrypting any sensitive data, although this will increase the load on the server.</span></span>

- <span data-ttu-id="4a917-190">Acceso a un punto de conexión protegido mediante autenticación.</span><span class="sxs-lookup"><span data-stu-id="4a917-190">How to access an endpoint that's secured using authentication.</span></span> <span data-ttu-id="4a917-191">No todas las herramientas y marcos pueden configurarse para incluir las credenciales con la solicitud de comprobación de estado.</span><span class="sxs-lookup"><span data-stu-id="4a917-191">Not all tools and frameworks can be configured to include credentials with the health verification request.</span></span> <span data-ttu-id="4a917-192">Por ejemplo, las características de comprobación de estado integradas en Microsoft Azure no pueden proporcionar credenciales de autenticación.</span><span class="sxs-lookup"><span data-stu-id="4a917-192">For example, Microsoft Azure built-in health verification features can't provide authentication credentials.</span></span> <span data-ttu-id="4a917-193">Algunas alternativas de terceros son [Pingdom](https://www.pingdom.com/), [Panopta](http://www.panopta.com/), [NewRelic](https://newrelic.com/) y [Statuscake](https://www.statuscake.com/).</span><span class="sxs-lookup"><span data-stu-id="4a917-193">Some third-party alternatives are [Pingdom](https://www.pingdom.com/), [Panopta](http://www.panopta.com/), [NewRelic](https://newrelic.com/), and [Statuscake](https://www.statuscake.com/).</span></span>

- <span data-ttu-id="4a917-194">Cómo asegurarse de que el agente de supervisión funciona correctamente.</span><span class="sxs-lookup"><span data-stu-id="4a917-194">How to ensure that the monitoring agent is performing correctly.</span></span> <span data-ttu-id="4a917-195">Un enfoque consiste en exponer un punto de conexión que solo devuelve un valor de la configuración de la aplicación o un valor aleatorio que se puede utilizar para probar el agente.</span><span class="sxs-lookup"><span data-stu-id="4a917-195">One approach is to expose an endpoint that simply returns a value from the application configuration or a random value that can be used to test the agent.</span></span>

   >  <span data-ttu-id="4a917-196">Asegúrese también de que el sistema de supervisión realiza comprobaciones en él mismo como pruebas automáticas o pruebas integradas, para evitar que emita falsos resultados positivos.</span><span class="sxs-lookup"><span data-stu-id="4a917-196">Also ensure that the monitoring system performs checks on itself, such as a self-test and built-in test, to avoid it issuing false positive results.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="4a917-197">Cuándo usar este patrón</span><span class="sxs-lookup"><span data-stu-id="4a917-197">When to use this pattern</span></span>

<span data-ttu-id="4a917-198">Este patrón es útil para:</span><span class="sxs-lookup"><span data-stu-id="4a917-198">This pattern is useful for:</span></span>
- <span data-ttu-id="4a917-199">Supervisar sitios web y aplicaciones web para comprobar la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4a917-199">Monitoring websites and web applications to verify availability.</span></span>
- <span data-ttu-id="4a917-200">Supervisar sitios web y aplicaciones web para comprobar para que funcionan correctamente.</span><span class="sxs-lookup"><span data-stu-id="4a917-200">Monitoring websites and web applications to check for correct operation.</span></span>
- <span data-ttu-id="4a917-201">Supervisar servicios de nivel intermedio o compartidos para detectar y aislar un error que pueda afectar a otras aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="4a917-201">Monitoring middle-tier or shared services to detect and isolate a failure that could disrupt other applications.</span></span>
- <span data-ttu-id="4a917-202">Complementar la instrumentación que ya existe en la aplicación como los contadores de rendimiento y los controladores de errores.</span><span class="sxs-lookup"><span data-stu-id="4a917-202">Complementing existing instrumentation in the application, such as performance counters and error handlers.</span></span> <span data-ttu-id="4a917-203">La comprobación de estado no reemplaza la necesidad de registros y auditorías en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-203">Health verification checking doesn't replace the requirement for logging and auditing in the application.</span></span> <span data-ttu-id="4a917-204">La instrumentación puede proporcionar información valiosa para un marco existente que supervisa los contadores y registros de errores para detectar errores u otros problemas.</span><span class="sxs-lookup"><span data-stu-id="4a917-204">Instrumentation can provide valuable information for an existing framework that monitors counters and error logs to detect failures or other issues.</span></span> <span data-ttu-id="4a917-205">Sin embargo, no puede proporcionar información si la aplicación no está disponible.</span><span class="sxs-lookup"><span data-stu-id="4a917-205">However, it can't provide information if the application is unavailable.</span></span>

## <a name="example"></a><span data-ttu-id="4a917-206">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="4a917-206">Example</span></span>

<span data-ttu-id="4a917-207">Los siguientes ejemplos de código, tomados de la clase `HealthCheckController` (hay un ejemplo que muestra este patrón disponible en [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring)), muestran cómo exponer un punto de conexión para llevar a cabo un intervalo de comprobaciones de estado.</span><span class="sxs-lookup"><span data-stu-id="4a917-207">The following code examples, taken from the `HealthCheckController` class (a sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring)), demonstrates exposing an endpoint for performing a range of health checks.</span></span>

<span data-ttu-id="4a917-208">El método `CoreServices`, que se muestra a continuación en C#, realiza una serie de comprobaciones en los servicios usados en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4a917-208">The `CoreServices` method, shown below in C#, performs a series of checks on services used in the application.</span></span> <span data-ttu-id="4a917-209">Si todas las pruebas se ejecutan sin errores, el método devuelve un código de estado 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="4a917-209">If all of the tests run without error, the method returns a 200 (OK) status code.</span></span> <span data-ttu-id="4a917-210">Si alguna de las pruebas produce una excepción, el método devuelve un código de estado 500 (Error interno).</span><span class="sxs-lookup"><span data-stu-id="4a917-210">If any of the tests raises an exception, the method returns a 500 (Internal Error) status code.</span></span> <span data-ttu-id="4a917-211">El método puede opcionalmente devolver información adicional en caso de error, si la herramienta o marco de supervisión es capaz de hacer uso de esta.</span><span class="sxs-lookup"><span data-stu-id="4a917-211">The method could optionally return additional information when an error occurs, if the monitoring tool or framework is able to make use of it.</span></span>

```csharp
public ActionResult CoreServices()
{
  try
  {
    // Run a simple check to ensure the database is available.
    DataStore.Instance.CoreHealthCheck();

    // Run a simple check on our external service.
    MyExternalService.Instance.CoreHealthCheck();
  }
  catch (Exception ex)
  {
    Trace.TraceError("Exception in basic health check: {0}", ex.Message);

    // This can optionally return different status codes based on the exception.
    // Optionally it could return more details about the exception.
    // The additional information could be used by administrators who access the
    // endpoint with a browser, or using a ping utility that can display the
    // additional information.
    return new HttpStatusCodeResult((int)HttpStatusCode.InternalServerError);
  }
  return new HttpStatusCodeResult((int)HttpStatusCode.OK);
}
```
<span data-ttu-id="4a917-212">El método `ObscurePath` muestra cómo puede leer una ruta desde la configuración de la aplicación y utilizarla como punto de conexión para las pruebas.</span><span class="sxs-lookup"><span data-stu-id="4a917-212">The `ObscurePath` method shows how you can read a path from the application configuration and use it as the endpoint for tests.</span></span> <span data-ttu-id="4a917-213">Este ejemplo, en C#, también muestra cómo puede aceptar un identificador como parámetro y usarlo para comprobar las solicitudes válidas.</span><span class="sxs-lookup"><span data-stu-id="4a917-213">This example, in C#, also shows how you can accept an ID as a parameter and use it to check for valid requests.</span></span>

```csharp
public ActionResult ObscurePath(string id)
{
  // The id could be used as a simple way to obscure or hide the endpoint.
  // The id to match could be retrieved from configuration and, if matched,
  // perform a specific set of tests and return the result. If not matched it
  // could return a 404 (Not Found) status.

  // The obscure path can be set through configuration to hide the endpoint.
  var hiddenPathKey = CloudConfigurationManager.GetSetting("Test.ObscurePath");

  // If the value passed does not match that in configuration, return 404 (Not Found).
  if (!string.Equals(id, hiddenPathKey))
  {
    return new HttpStatusCodeResult((int)HttpStatusCode.NotFound);
  }

  // Else continue and run the tests...
  // Return results from the core services test.
  return this.CoreServices();
}
```

<span data-ttu-id="4a917-214">El método `TestResponseFromConfig` muestra cómo puede exponer un punto de conexión que realiza una comprobación para un valor de configuración especificado.</span><span class="sxs-lookup"><span data-stu-id="4a917-214">The `TestResponseFromConfig` method shows how you can expose an endpoint that performs a check for a specified configuration setting value.</span></span>

```csharp
public ActionResult TestResponseFromConfig()
{
  // Health check that returns a response code set in configuration for testing.
  var returnStatusCodeSetting = CloudConfigurationManager.GetSetting(
                                                          "Test.ReturnStatusCode");

  int returnStatusCode;

  if (!int.TryParse(returnStatusCodeSetting, out returnStatusCode))
  {
    returnStatusCode = (int)HttpStatusCode.OK;
  }

  return new HttpStatusCodeResult(returnStatusCode);
}
```
## <a name="monitoring-endpoints-in-azure-hosted-applications"></a><span data-ttu-id="4a917-215">Supervisión de puntos de conexión en aplicaciones hospedadas en Azure</span><span class="sxs-lookup"><span data-stu-id="4a917-215">Monitoring endpoints in Azure hosted applications</span></span>

<span data-ttu-id="4a917-216">Algunas opciones para la supervisión de puntos de conexión en las aplicaciones de Azure son:</span><span class="sxs-lookup"><span data-stu-id="4a917-216">Some options for monitoring endpoints in Azure applications are:</span></span>

- <span data-ttu-id="4a917-217">Usar las características integradas de supervisión de Azure.</span><span class="sxs-lookup"><span data-stu-id="4a917-217">Use the built-in monitoring features of Azure.</span></span>

- <span data-ttu-id="4a917-218">Usar un servicio de otro fabricante o un marco como Microsoft System Center Operations Manager.</span><span class="sxs-lookup"><span data-stu-id="4a917-218">Use a third-party service or a framework such as Microsoft System Center Operations Manager.</span></span>

- <span data-ttu-id="4a917-219">Crear una utilidad personalizada o un servicio que se ejecuta en su propio servidor o en uno hospedado.</span><span class="sxs-lookup"><span data-stu-id="4a917-219">Create a custom utility or a service that runs on your own or on a hosted server.</span></span>

   >  <span data-ttu-id="4a917-220">Aunque Azure proporciona un conjunto de opciones de supervisión razonablemente completo, puede usar herramientas y servicios adicionales para proporcionar aún más información.</span><span class="sxs-lookup"><span data-stu-id="4a917-220">Even though Azure provides a reasonably comprehensive set of monitoring options, you can use additional services and tools to provide extra information.</span></span> <span data-ttu-id="4a917-221">Los servicios de administración de Azure proporcionan un mecanismo integrado de supervisión para las reglas de alerta.</span><span class="sxs-lookup"><span data-stu-id="4a917-221">Azure Management Services provides a built-in monitoring mechanism for alert rules.</span></span> <span data-ttu-id="4a917-222">La sección de alertas de la página de los servicios de administración de Azure Portal le permite configurar hasta diez reglas de alerta por suscripción para los servicios.</span><span class="sxs-lookup"><span data-stu-id="4a917-222">The alerts section of the management services page in the Azure portal allows you to configure up to ten alert rules per subscription for your services.</span></span> <span data-ttu-id="4a917-223">Estas reglas permiten especificar una condición y un valor de umbral para un servicio como el de carga de la CPU o el número de solicitudes o errores por segundo, y el servicio puede enviar automáticamente notificaciones por correo electrónico a las direcciones que se definan en cada regla.</span><span class="sxs-lookup"><span data-stu-id="4a917-223">These rules specify a condition and a threshold value for a service such as CPU load, or the number of requests or errors per second, and the service can automatically send email notifications to addresses you define in each rule.</span></span>

<span data-ttu-id="4a917-224">Las condiciones que se pueden supervisar varían según el mecanismo de hospedaje que elija para su aplicación (por ejemplo, Web Sites, Cloud Services, Virtual Machines, o Mobile Services), pero todos estos incluyen la capacidad de crear una regla de alerta que utiliza un punto de conexión web que especifica en la configuración del servicio.</span><span class="sxs-lookup"><span data-stu-id="4a917-224">The conditions you can monitor vary depending on the hosting mechanism you choose for your application (such as Web Sites, Cloud Services, Virtual Machines, or Mobile Services), but all of these include the ability to create an alert rule that uses a web endpoint you specify in the settings for your service.</span></span> <span data-ttu-id="4a917-225">Este punto de conexión debe responder de forma puntual para que el sistema de alerta pueda detectar que la aplicación está funcionando correctamente.</span><span class="sxs-lookup"><span data-stu-id="4a917-225">This endpoint should respond in a timely way so that the alert system can detect that the application is operating correctly.</span></span>

>  <span data-ttu-id="4a917-226">Lea más información acerca de la [creación de notificaciones de alerta][portal-alerts].</span><span class="sxs-lookup"><span data-stu-id="4a917-226">Read more information about [creating alert notifications][portal-alerts].</span></span>

<span data-ttu-id="4a917-227">Si hospeda la aplicación en la web o en los roles de trabajo de Azure Cloud Services, o en Virtual Machines, puede aprovechar uno de los servicios integrados en Azure que se llama Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="4a917-227">If you host your application in Azure Cloud Services web and worker roles or Virtual Machines, you can take advantage of one of the built-in services in Azure called Traffic Manager.</span></span> <span data-ttu-id="4a917-228">Traffic Manager es un servicio de enrutamiento y equilibrio de carga que puede distribuir las solicitudes a instancias específicas de la aplicación hospedada en Cloud Services según un intervalo de reglas y opciones.</span><span class="sxs-lookup"><span data-stu-id="4a917-228">Traffic Manager is a routing and load-balancing service that can distribute requests to specific instances of your Cloud Services hosted application based on a range of rules and settings.</span></span>

<span data-ttu-id="4a917-229">Además de enrutar las solicitudes, Traffic Manager hace ping de forma regular en la dirección URL, el puerto y la ruta de acceso relativa que especifique para determinar qué instancias de la aplicación definida en sus reglas están activas y responden a las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="4a917-229">In addition to routing requests, Traffic Manager pings a URL, port, and relative path that you specify on a regular basis to determine which instances of the application defined in its rules are active and are responding to requests.</span></span> <span data-ttu-id="4a917-230">Si detecta un código de estado 200 (OK), marca la aplicación como disponible.</span><span class="sxs-lookup"><span data-stu-id="4a917-230">If it detects a status code 200 (OK), it marks the application as available.</span></span> <span data-ttu-id="4a917-231">Cualquier otro código de estado hace que Traffic Manager marque la aplicación como sin conexión.</span><span class="sxs-lookup"><span data-stu-id="4a917-231">Any other status code causes Traffic Manager to mark the application as offline.</span></span> <span data-ttu-id="4a917-232">Puede ver el estado en la consola de Traffic Manager y configurar la regla para volver a enrutar las solicitudes a otras instancias de la aplicación que están respondiendo.</span><span class="sxs-lookup"><span data-stu-id="4a917-232">You can view the status in the Traffic Manager console, and configure the rule to reroute requests to other instances of the application that are responding.</span></span>

<span data-ttu-id="4a917-233">Sin embargo, Traffic Manager solo esperará diez segundos a recibir una respuesta desde la dirección URL de supervisión.</span><span class="sxs-lookup"><span data-stu-id="4a917-233">However, Traffic Manager will only wait ten seconds to receive a response from the monitoring URL.</span></span> <span data-ttu-id="4a917-234">Por lo tanto, debe asegurarse de que el código de comprobación de estado se ejecute en ese tiempo, lo que permite la latencia de red para el recorrido de ida desde Traffic Manager a la aplicación y a la inversa.</span><span class="sxs-lookup"><span data-stu-id="4a917-234">Therefore, you should ensure that your health verification code executes in this time, allowing for network latency for the round trip from Traffic Manager to your application and back again.</span></span>

>  <span data-ttu-id="4a917-235">Lea más información sobre el uso de [Traffic Manager para supervisar las aplicaciones](https://azure.microsoft.com/documentation/services/traffic-manager/).</span><span class="sxs-lookup"><span data-stu-id="4a917-235">Read more information about using [Traffic Manager to monitor your applications](https://azure.microsoft.com/documentation/services/traffic-manager/).</span></span> <span data-ttu-id="4a917-236">Traffic Manager también se analiza en [Multiple Datacenter Deployment Guidance](https://msdn.microsoft.com/library/dn589779.aspx) (Guía para la implementación de varios centros de datos).</span><span class="sxs-lookup"><span data-stu-id="4a917-236">Traffic Manager is also discussed in [Multiple Datacenter Deployment Guidance](https://msdn.microsoft.com/library/dn589779.aspx).</span></span>

## <a name="related-guidance"></a><span data-ttu-id="4a917-237">Instrucciones relacionadas</span><span class="sxs-lookup"><span data-stu-id="4a917-237">Related guidance</span></span>

<span data-ttu-id="4a917-238">Las directrices siguientes pueden ser útiles a la hora de implementar este patrón:</span><span class="sxs-lookup"><span data-stu-id="4a917-238">The following guidance can be useful when implementing this pattern:</span></span>
- <span data-ttu-id="4a917-239">[Orientación sobre instrumentación y telemetría](https://msdn.microsoft.com/library/dn589775.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a917-239">[Instrumentation and Telemetry Guidance](https://msdn.microsoft.com/library/dn589775.aspx).</span></span> <span data-ttu-id="4a917-240">La comprobación del estado de los servicios y componentes se suele realizar mediante sondeo, pero también es útil tener información de contexto para supervisar el rendimiento de la aplicación y detectar los eventos que se producen en el tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="4a917-240">Checking the health of services and components is typically done by probing, but it's also useful to have information in place to monitor application performance and detect events that occur at runtime.</span></span> <span data-ttu-id="4a917-241">Estos datos se pueden transmitir a herramientas de supervisión como información adicional para la supervisión de estado.</span><span class="sxs-lookup"><span data-stu-id="4a917-241">This data can be transmitted back to monitoring tools as additional information for health monitoring.</span></span> <span data-ttu-id="4a917-242">La orientación sobre instrumentación y telemetría explora la recopilación de información remota de diagnósticos que la instrumentación recopila en las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="4a917-242">Instrumentation and Telemetry Guidance explores gathering remote diagnostics information that's collected by instrumentation in applications.</span></span>
- <span data-ttu-id="4a917-243">[Recepción de notificaciones de alerta][portal-alerts].</span><span class="sxs-lookup"><span data-stu-id="4a917-243">[Receiving alert notifications][portal-alerts].</span></span>
- <span data-ttu-id="4a917-244">Este patrón incluye una [aplicación de ejemplo](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring) descargable.</span><span class="sxs-lookup"><span data-stu-id="4a917-244">This pattern includes a downloadable [sample application](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring).</span></span>

[portal-alerts]: https://azure.microsoft.com/documentation/articles/insights-receive-alert-notifications/
