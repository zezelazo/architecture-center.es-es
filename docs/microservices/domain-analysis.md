---
title: "Análisis de dominios para microservicios"
description: "Análisis de dominios para microservicios"
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: dc07c5195299c88a946accbe4e13a997afaaff90
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/29/2017
---
# <a name="designing-microservices-domain-analysis"></a><span data-ttu-id="5fc98-103">Diseño de microservicios: análisis de dominios</span><span class="sxs-lookup"><span data-stu-id="5fc98-103">Designing microservices: Domain analysis</span></span> 

<span data-ttu-id="5fc98-104">Uno de los mayores desafíos de los microservicios es definir los límites de los servicios individuales.</span><span class="sxs-lookup"><span data-stu-id="5fc98-104">One of the biggest challenges of microservices is to define the boundaries of individual services.</span></span> <span data-ttu-id="5fc98-105">La regla general es que un servicio debe hacer "algo"; sin embargo, llevarla a la práctica requiere una minuciosa reflexión.</span><span class="sxs-lookup"><span data-stu-id="5fc98-105">The general rule is that a service should do "one thing" &mdash; but putting that rule into practice requires careful thought.</span></span> <span data-ttu-id="5fc98-106">No hay ningún proceso mecánico que cree el diseño "correcto".</span><span class="sxs-lookup"><span data-stu-id="5fc98-106">There is no mechanical process that will produce the "right" design.</span></span> <span data-ttu-id="5fc98-107">Debe meditar detenidamente sobre el dominio de su empresa, los requisitos y los objetivos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-107">You have to think deeply about your business domain, requirements, and goals.</span></span> <span data-ttu-id="5fc98-108">En caso contrario, puede terminar con un diseño incoherente que exhiba algunas características no deseables, como son dependencias ocultas entre servicios, un acoplamiento rígido o interfaces mal diseñadas.</span><span class="sxs-lookup"><span data-stu-id="5fc98-108">Otherwise, you can end up with a haphazard design that exhibits some undesirable characteristics, such as hidden dependencies between services, tight coupling, or poorly designed interfaces.</span></span> <span data-ttu-id="5fc98-109">En este capítulo, se adopta un enfoque basado en dominios para el diseño de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-109">In this chapter, we take a domain-driven approach to designing microservices.</span></span> 

<span data-ttu-id="5fc98-110">Los microservicios deben diseñarse alrededor de las funcionalidades de la empresa, no en capas horizontales como el acceso a datos o la mensajería.</span><span class="sxs-lookup"><span data-stu-id="5fc98-110">Microservices should be designed around business capabilities, not horizontal layers such as data access or messaging.</span></span> <span data-ttu-id="5fc98-111">Además, deben tener un acoplamiento flexible y una alta cohesión funcional.</span><span class="sxs-lookup"><span data-stu-id="5fc98-111">In addition, they should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="5fc98-112">Los microservicios exhiben un *acoplamiento flexible* si puede cambiar un servicio sin necesidad de que los demás se actualicen al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="5fc98-112">Microservices are *loosely coupled* if you can change one service without requiring other services to be updated at the same time.</span></span> <span data-ttu-id="5fc98-113">Un microservicio es *coherente* si tiene un propósito único y bien definido, como administrar las cuentas de usuario o realizar el seguimiento del historial de entregas.</span><span class="sxs-lookup"><span data-stu-id="5fc98-113">A microservice is *cohesive* if it has a single, well-defined purpose, such as managing user accounts or tracking delivery history.</span></span> <span data-ttu-id="5fc98-114">Un servicio debe encapsular el conocimiento del dominio y abstraer ese conocimiento ante los clientes.</span><span class="sxs-lookup"><span data-stu-id="5fc98-114">A service should encapsulate domain knowledge and abstract that knowledge from clients.</span></span> <span data-ttu-id="5fc98-115">Por ejemplo, un cliente debe poder programar un dron sin conocer los detalles sobre el algoritmo de programación y el modo en que la flota de drones se administra.</span><span class="sxs-lookup"><span data-stu-id="5fc98-115">For example, a client should be able to schedule a drone without knowing the details of the scheduling algorithm or how the drone fleet is managed.</span></span>

<span data-ttu-id="5fc98-116">El diseño basado en dominios (DDD) proporciona una plataforma que puede ayudarle en gran medida a diseñar bien los microservicios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-116">Domain-driven design (DDD) provides a framework that can get you most of the way to a set of well-designed microservices.</span></span> <span data-ttu-id="5fc98-117">El diseño basado en dominios tiene dos fases distintas, tácticas y estratégicas.</span><span class="sxs-lookup"><span data-stu-id="5fc98-117">DDD has two distinct phases, strategic and tactical.</span></span> <span data-ttu-id="5fc98-118">En el diseño basado en dominios estratégico, se define la estructura a gran escala del sistema.</span><span class="sxs-lookup"><span data-stu-id="5fc98-118">In strategic DDD, you are defining the large-scale structure of the system.</span></span> <span data-ttu-id="5fc98-119">Ayuda a garantizar que la arquitectura permanece centrada en las funcionalidades del negocio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-119">Strategic DDD helps to ensure that your architecture remains focused on business capabilities.</span></span> <span data-ttu-id="5fc98-120">El diseño basado en dominios táctico proporciona un conjunto de modelos de diseño que puede usar para crear el modelo de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-120">Tactical DDD provides a set of design patterns that you can use to create the domain model.</span></span> <span data-ttu-id="5fc98-121">Estos modelos incluyen entidades, agregados y servicios de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-121">These patterns include entities, aggregates, and domain services.</span></span> <span data-ttu-id="5fc98-122">Los modelos tácticos le ayudarán a diseñar microservicios coherentes y con acoplamiento flexible.</span><span class="sxs-lookup"><span data-stu-id="5fc98-122">These tactical patterns will help you to design microservices that are both loosely coupled and cohesive.</span></span>

![](./images/ddd-process.png)

<span data-ttu-id="5fc98-123">En este capítulo y en el siguiente, usaremos los siguientes pasos con la aplicación Drone Delivery:</span><span class="sxs-lookup"><span data-stu-id="5fc98-123">In this chapter and the next, we'll walk through the following steps, applying them to the Drone Delivery application:</span></span> 

1. <span data-ttu-id="5fc98-124">Empiece por analizar el dominio de la empresa para conocer los requisitos funcionales de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5fc98-124">Start by analyzing the business domain to understand the application's functional requirements.</span></span> <span data-ttu-id="5fc98-125">El resultado de este paso es una descripción informal del dominio, que puede perfilarse en un conjunto más formal de modelos de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-125">The output of this step is an informal description of the domain, which can be refined into a more formal set of domain models.</span></span> 

2. <span data-ttu-id="5fc98-126">A continuación, defina los *contextos delimitados* del dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-126">Next, define the *bounded contexts* of the domain.</span></span> <span data-ttu-id="5fc98-127">Cada contexto delimitado contiene un modelo de dominio que representa un subdominio concreto de la aplicación mayor.</span><span class="sxs-lookup"><span data-stu-id="5fc98-127">Each bounded context contains a domain model that represents a particular subdomain of the larger application.</span></span> 

3. <span data-ttu-id="5fc98-128">Dentro de un contexto delimitado, se aplican los modelos tácticos de diseño basado en dominios para definir las entidades, los agregados y los servicios de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-128">Within a bounded context, apply tactical DDD patterns to define entities, aggregates, and domain services.</span></span> 
 
4. <span data-ttu-id="5fc98-129">Use los resultados del paso anterior para identificar los microservicios en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5fc98-129">Use the results from the previous step to identity the microservices in your application.</span></span>

<span data-ttu-id="5fc98-130">En este capítulo, trataremos los tres primeros pasos, relacionados principalmente con el diseño basado en dominios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-130">In this chapter, we cover the first three steps, which are primarily concerned with DDD.</span></span> <span data-ttu-id="5fc98-131">En el próximo capítulo, se identificarán los microservicios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-131">In the next chapter, we will identify the microservices.</span></span> <span data-ttu-id="5fc98-132">Sin embargo, es importante recordar que el diseño basado en dominios es un proceso iterativo y en curso.</span><span class="sxs-lookup"><span data-stu-id="5fc98-132">However, it's important to remember that DDD is an iterative, ongoing process.</span></span> <span data-ttu-id="5fc98-133">Los límites del servicio no son fijos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-133">Service boundaries aren't fixed in stone.</span></span> <span data-ttu-id="5fc98-134">A medida que una aplicación evolucione, puede decidir dividir un servicio en varios menores.</span><span class="sxs-lookup"><span data-stu-id="5fc98-134">As an application evolves, you may decide to break apart a service into several smaller services.</span></span>

> [!NOTE]
> <span data-ttu-id="5fc98-135">Este capítulo no está pensado para mostrar un análisis de dominio completo y minucioso.</span><span class="sxs-lookup"><span data-stu-id="5fc98-135">This chapter is not meant to show a complete and comprehensive domain analysis.</span></span> <span data-ttu-id="5fc98-136">Hemos hecho deliberadamente que el ejemplo sea breve para ilustrar los puntos principales.</span><span class="sxs-lookup"><span data-stu-id="5fc98-136">We deliberately kept the example brief, in order to illustrate the main points.</span></span> <span data-ttu-id="5fc98-137">Para obtener más información sobre el diseño basado en dominios, se recomienda el libro de Eric Evans *Domain-Driven Design* (Diseño basado en dominios), en el que se usó el término por primera vez.</span><span class="sxs-lookup"><span data-stu-id="5fc98-137">For more background on DDD, we recommend Eric Evans' *Domain-Driven Design*, the book that first introduced the term.</span></span> <span data-ttu-id="5fc98-138">Otra buena referencia es *Implementing Domain-Driven Design* (Implementación del diseño basado en dominios), de Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="5fc98-138">Another good reference is *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span> 

## <a name="analyze-the-domain"></a><span data-ttu-id="5fc98-139">Análisis del dominio</span><span class="sxs-lookup"><span data-stu-id="5fc98-139">Analyze the domain</span></span>

<span data-ttu-id="5fc98-140">El empleo de un método de diseño basado en dominios le ayudará a diseñar los microservicios de modo que cada servicio constituya una solución natural para un requisito empresarial funcional.</span><span class="sxs-lookup"><span data-stu-id="5fc98-140">Using a DDD approach will help you to design microservices so that every service forms a natural fit to a functional business requirement.</span></span> <span data-ttu-id="5fc98-141">Puede servirle de ayuda para evitar la trampa que supone permitir que los límites de la organización o las elecciones de tecnología dicten el diseño.</span><span class="sxs-lookup"><span data-stu-id="5fc98-141">It can help you to avoid the trap of letting organizational boundaries or technology choices dictate your design.</span></span>

<span data-ttu-id="5fc98-142">Antes de escribir ningún código, necesita una visión general del sistema que se va a crear.</span><span class="sxs-lookup"><span data-stu-id="5fc98-142">Before writing any code, you need a bird's eye view of the system that you are creating.</span></span> <span data-ttu-id="5fc98-143">Con el diseño basado en dominios, se empieza por modelar el dominio empresarial y se crea un *modelo de dominio*.</span><span class="sxs-lookup"><span data-stu-id="5fc98-143">DDD starts by modeling the business domain and creating a *domain model*.</span></span> <span data-ttu-id="5fc98-144">El modelo de dominio es un modelo abstracto del ámbito empresarial.</span><span class="sxs-lookup"><span data-stu-id="5fc98-144">The domain model is an abstract model of the business domain.</span></span> <span data-ttu-id="5fc98-145">Extrae y organiza el conocimiento del dominio, y proporciona un lenguaje común para los desarrolladores y los expertos en los dominios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-145">It distills and organizes domain knowledge, and provides a common language for developers and domain experts.</span></span> 

<span data-ttu-id="5fc98-146">Empiece por asignar todas las funciones empresariales y sus conexiones.</span><span class="sxs-lookup"><span data-stu-id="5fc98-146">Start by mapping all of the business functions and their connections.</span></span> <span data-ttu-id="5fc98-147">Probablemente, esto requerirá la colaboración de los expertos en dominios, los arquitectos de software y otros actores implicados.</span><span class="sxs-lookup"><span data-stu-id="5fc98-147">This will likely be a collaborative effort that involves domain experts, software architects, and other stakeholders.</span></span> <span data-ttu-id="5fc98-148">No es necesario usar ningún formalismo concreto.</span><span class="sxs-lookup"><span data-stu-id="5fc98-148">You don't need to use any particular formalism.</span></span>  <span data-ttu-id="5fc98-149">Esboce un diagrama o dibuje en una pizarra.</span><span class="sxs-lookup"><span data-stu-id="5fc98-149">Sketch a diagram or draw on whiteboard.</span></span>

<span data-ttu-id="5fc98-150">A medida que rellene el diagrama, puede empezar a identificar subdominios discretos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-150">As you fill in the diagram, you may start to identify discrete subdomains.</span></span> <span data-ttu-id="5fc98-151">¿Qué funciones están estrechamente relacionadas?</span><span class="sxs-lookup"><span data-stu-id="5fc98-151">Which functions are closely related?</span></span> <span data-ttu-id="5fc98-152">¿Cuáles son fundamentales para la empresa y cuáles proporcionan servicios auxiliares?</span><span class="sxs-lookup"><span data-stu-id="5fc98-152">Which functions are core to the business, and which provide ancillary services?</span></span> <span data-ttu-id="5fc98-153">¿Cuál es el gráfico de dependencias?</span><span class="sxs-lookup"><span data-stu-id="5fc98-153">What is the dependency graph?</span></span> <span data-ttu-id="5fc98-154">Durante esta fase inicial, no se preocupe de las tecnologías ni de los detalles de implementación.</span><span class="sxs-lookup"><span data-stu-id="5fc98-154">During this initial phase, you aren't concerned with technologies or implementation details.</span></span> <span data-ttu-id="5fc98-155">Es decir, debe tener en cuenta el lugar donde la aplicación tendrá que integrarse con sistemas externos, como CRM o sistemas de facturación o de procesamiento de pagos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-155">That said, you should note the place where the application will need to integrate with external systems, such as CRM, payment processing, or billing systems.</span></span> 

## <a name="drone-delivery-analyzing-the-business-domain"></a><span data-ttu-id="5fc98-156">Drone Delivery: análisis del dominio empresarial.</span><span class="sxs-lookup"><span data-stu-id="5fc98-156">Drone Delivery: Analyzing the business domain.</span></span>

<span data-ttu-id="5fc98-157">Después del análisis inicial del dominio, el equipo de Fabrikam ha propuesto un borrador que representa el dominio para Drone Delivery.</span><span class="sxs-lookup"><span data-stu-id="5fc98-157">After some initial domain analysis, the Fabrikam team came up with a rough sketch that depicts the Drone Delivery domain.</span></span>

![](./images/ddd1.svg) 

- <span data-ttu-id="5fc98-158">El elemento **Shipping** (envío) se coloca en el centro del diagrama, ya que es importante para el negocio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-158">**Shipping** is placed in the center of the diagram, because it's core to the business.</span></span> <span data-ttu-id="5fc98-159">Todo lo demás dentro del diagrama existe para habilitar esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="5fc98-159">Everything else in the diagram exists to enable this functionality.</span></span>
- <span data-ttu-id="5fc98-160">El elemento **Drone management** (administración de drones) también es esencial para la empresa.</span><span class="sxs-lookup"><span data-stu-id="5fc98-160">**Drone management** is also core to the business.</span></span> <span data-ttu-id="5fc98-161">La funcionalidad que está estrechamente relacionada con la anterior es **Drone repair** (reparación de drones) y el uso de **predictive analysis**  (análisis predictivos) que permiten predecir el momento en que los drones tienen que someterse a tareas de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="5fc98-161">Functionality that is closely related to drone management includes **drone repair** and using **predictive analysis** to predict when drones need servicing and maintenance.</span></span> 
- <span data-ttu-id="5fc98-162">**ETA analysis** (análisis del tiempo estimado de llegada) proporciona estimaciones de tiempo para la recogida y la entrega.</span><span class="sxs-lookup"><span data-stu-id="5fc98-162">**ETA analysis** provides time estimates for pickup and delivery.</span></span> 
- <span data-ttu-id="5fc98-163">La funcionalidad **Third-party transportation** (transporte de terceros) permitirá que la aplicación programe métodos de transporte alternativo, si un dron no puede entregar un paquete completo.</span><span class="sxs-lookup"><span data-stu-id="5fc98-163">**Third-party transportation** will enable the application to schedule alternative transportation methods if a package cannot be shipped entirely by drone.</span></span>
- <span data-ttu-id="5fc98-164">La funcionalidad **Drone sharing** (uso compartido de drones) es una posible extensión del negocio principal.</span><span class="sxs-lookup"><span data-stu-id="5fc98-164">**Drone sharing** is a possible extension of the core business.</span></span> <span data-ttu-id="5fc98-165">La empresa puede tener drones de sobra durante ciertas horas y alquilar el excedente que, de otro modo, permanecería inactivo.</span><span class="sxs-lookup"><span data-stu-id="5fc98-165">The company may have excess drone capacity during certain hours, and could rent out drones that would otherwise be idle.</span></span> <span data-ttu-id="5fc98-166">Esta característica no estará en la versión inicial.</span><span class="sxs-lookup"><span data-stu-id="5fc98-166">This feature will not be in the initial release.</span></span>
- <span data-ttu-id="5fc98-167">La funcionalidad **Video surveillance** (vigilancia por vídeo) es otra área que la empresa podría expandir en versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="5fc98-167">**Video surveillance** is another area that the company might expand into later.</span></span>
- <span data-ttu-id="5fc98-168">**User accounts** (cuentas de usuario), **Invoicing** (facturación) y **Call center** (centro de llamadas) son subdominios que contribuyen al negocio principal.</span><span class="sxs-lookup"><span data-stu-id="5fc98-168">**User accounts**, **Invoicing**, and **Call center** are subdomains that support the core business.</span></span>
 
<span data-ttu-id="5fc98-169">Tenga en cuenta que, en este punto del proceso, no hemos tomado decisiones sobre la implementación o las tecnologías.</span><span class="sxs-lookup"><span data-stu-id="5fc98-169">Notice that at this point in the process, we haven't made any decisions about implementation or technologies.</span></span> <span data-ttu-id="5fc98-170">Algunos de los subsistemas pueden implicar a sistemas de software externos o servicios de terceros.</span><span class="sxs-lookup"><span data-stu-id="5fc98-170">Some of the subsystems may involve external software systems or third-party services.</span></span> <span data-ttu-id="5fc98-171">Aun así, la aplicación requiere interactuar con estos sistemas y servicios, por lo que es importante incluirlos en el modelo de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-171">Even so, the application needs to interact with these systems and services, so it's important to include them in the domain model.</span></span> 

> [!NOTE]
> <span data-ttu-id="5fc98-172">Cuando una aplicación depende de un sistema externo, existe el riesgo de que el esquema de datos o la API del sistema externo se infiltren en la aplicación, poniendo en peligro a la larga el diseño de la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="5fc98-172">When an application depends on an external system, there is a risk that the external system's data schema or API will leak into your application, ultimately compromising the architectural design.</span></span> <span data-ttu-id="5fc98-173">Esto ocurre especialmente con sistemas heredados que pueden no seguir procedimientos recomendados modernos y podrían usar esquemas de datos complejos o API obsoletas.</span><span class="sxs-lookup"><span data-stu-id="5fc98-173">This is particularly true with legacy systems that may not follow modern best practices, and may use convoluted data schemas or obsolete APIs.</span></span> <span data-ttu-id="5fc98-174">En ese caso, es importante contar con un límite bien definido entre dichos sistemas externos y la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5fc98-174">In that case, it's important to have a well-defined boundary between these external systems and the application.</span></span> <span data-ttu-id="5fc98-175">Considere el uso del [patrón Strangler](../patterns/strangler.md) o del [patrón Anti-Corruption Layer](../patterns/anti-corruption-layer.md) para este propósito.</span><span class="sxs-lookup"><span data-stu-id="5fc98-175">Consider using the [Strangler Pattern](../patterns/strangler.md) or the [Anti-Corruption Layer Pattern](../patterns/anti-corruption-layer.md) for this purpose.</span></span>

## <a name="define-bounded-contexts"></a><span data-ttu-id="5fc98-176">Definición de contextos delimitados</span><span class="sxs-lookup"><span data-stu-id="5fc98-176">Define bounded contexts</span></span>

<span data-ttu-id="5fc98-177">El modelo de dominio incluirá representaciones de cosas reales del mundo, como son usuarios, drones, paquetes y otras.</span><span class="sxs-lookup"><span data-stu-id="5fc98-177">The domain model will include representations of real things in the world &mdash; users, drones, packages, and so forth.</span></span> <span data-ttu-id="5fc98-178">Pero eso no significa que todas las partes del sistema deban usar las mismas representaciones para las mismas cosas.</span><span class="sxs-lookup"><span data-stu-id="5fc98-178">But that doesn't mean that every part of the system needs to use the same representations for the same things.</span></span> 

<span data-ttu-id="5fc98-179">Por ejemplo, los subsistemas que controlan la reparación de drones y el análisis predictivo tendrán que representar los drones con muchas características físicas, como su historial de mantenimiento, kilometraje, antigüedad, número de modelo, características de rendimiento, etcétera.</span><span class="sxs-lookup"><span data-stu-id="5fc98-179">For example, subsystems that handle drone repair and predictive analysis will need to represent many physical characteristics drones, such as their maintenance history, mileage, age, model number, performance characteristics, and so on.</span></span> <span data-ttu-id="5fc98-180">Pero, cuando llega el momento de programar una entrega, no importan esos elementos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-180">But when it's time to schedule a delivery, we don't care about those things.</span></span> <span data-ttu-id="5fc98-181">El subsistema de programación solo necesita saber si un dron está disponible y el tiempo estimado para la recogida y la entrega.</span><span class="sxs-lookup"><span data-stu-id="5fc98-181">The scheduling subsystem only needs to know whether a drone is available, and the ETA for pickup and delivery.</span></span> 

<span data-ttu-id="5fc98-182">Si se ha intentado crear un modelo único para ambos subsistemas, sería innecesariamente complejo.</span><span class="sxs-lookup"><span data-stu-id="5fc98-182">If we tried to create a single model for both of these subsystems, it would be unnecessarily complex.</span></span> <span data-ttu-id="5fc98-183">También resultaría más difícil para el modelo evolucionar con el tiempo, porque los cambios deberán satisfacer a varios equipos que trabajen en subsistemas independientes.</span><span class="sxs-lookup"><span data-stu-id="5fc98-183">It would also become harder for the model to evolve over time, because any changes will need to satisfy multiple teams working on separate subsystems.</span></span> <span data-ttu-id="5fc98-184">Por lo tanto, a menudo es mejor diseñar modelos independientes que representen la misma entidad del mundo real (en este caso, un dron) en dos contextos diferentes.</span><span class="sxs-lookup"><span data-stu-id="5fc98-184">Therefore, it's often better to design separate models that represent the same real-world entity (in this case, a drone) in two different contexts.</span></span> <span data-ttu-id="5fc98-185">Cada modelo contiene solo las características y los atributos que sean pertinentes en su contexto determinado.</span><span class="sxs-lookup"><span data-stu-id="5fc98-185">Each model contains only the features and attributes that are relevant within its particular context.</span></span>

<span data-ttu-id="5fc98-186">Aquí es donde entra en juego el concepto del diseño basado en dominios referente a los *contextos limitados*.</span><span class="sxs-lookup"><span data-stu-id="5fc98-186">This is where the DDD concept of *bounded contexts* comes into play.</span></span> <span data-ttu-id="5fc98-187">Un contexto delimitado es simplemente el límite dentro de un dominio donde se aplica un modelo de dominio en particular.</span><span class="sxs-lookup"><span data-stu-id="5fc98-187">A bounded context is simply the boundary within a domain where a particular domain model applies.</span></span> <span data-ttu-id="5fc98-188">Si examinamos el diagrama anterior, podemos agrupar la funcionalidad teniendo en cuenta si varias funciones compartirán un único modelo de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-188">Looking at the previous diagram, we can group functionality according to whether various functions will share a single domain model.</span></span> 

![](./images/ddd2.svg) 
 
<span data-ttu-id="5fc98-189">Los contextos delimitados no están necesariamente aislados entre sí.</span><span class="sxs-lookup"><span data-stu-id="5fc98-189">Bounded contexts are not necessarily isolated from one another.</span></span> <span data-ttu-id="5fc98-190">En este diagrama, las líneas continuas que conectan los contextos delimitados representan los lugares donde dos de ellos interactúan.</span><span class="sxs-lookup"><span data-stu-id="5fc98-190">In this diagram, the solid lines connecting the bounded contexts represent places where two bounded contexts interact.</span></span> <span data-ttu-id="5fc98-191">Por ejemplo, el envío depende de las cuentas de usuario (Accouns) para obtener información sobre los clientes y de la administración de drones (Drone management) para programar los de la flota.</span><span class="sxs-lookup"><span data-stu-id="5fc98-191">For example, Shipping depends on User Accounts to get information about customers, and on Drone Management to schedule drones from the fleet.</span></span>

<span data-ttu-id="5fc98-192">En el libro *Domain Driven Design* de Eric Evans, se describen varios patrones para mantener la integridad de un modelo de dominio cuando interactúa con otro contexto delimitado.</span><span class="sxs-lookup"><span data-stu-id="5fc98-192">In the book *Domain Driven Design*, Eric Evans describes several patterns for maintaining the integrity of a domain model when it interacts with another bounded context.</span></span> <span data-ttu-id="5fc98-193">Uno de los principios fundamentales de los microservicios es que los servicios se comunican a través de API bien definidas.</span><span class="sxs-lookup"><span data-stu-id="5fc98-193">One of the main principles of microservices is that services communicate through well-defined APIs.</span></span> <span data-ttu-id="5fc98-194">Este método se corresponde con dos patrones que Evans llama Open Host Service (servicio de host abierto) y Published Language (lenguaje publicado).</span><span class="sxs-lookup"><span data-stu-id="5fc98-194">This approach corresponds to two patterns that Evans calls Open Host Service and Published Language.</span></span> <span data-ttu-id="5fc98-195">La idea subyacente en Open Host Service es que un subsistema define un protocolo formal (API) para que otros se comuniquen con él.</span><span class="sxs-lookup"><span data-stu-id="5fc98-195">The idea of Open Host Service is that a subsystem defines a formal protocol (API) for other subsystems to communicate with it.</span></span> <span data-ttu-id="5fc98-196">Published Language amplía esta idea publicando la API de forma que otros equipos puedan usarla para escribir clientes.</span><span class="sxs-lookup"><span data-stu-id="5fc98-196">Published Language extends this idea by publishing the API in a form that other teams can use to write clients.</span></span> <span data-ttu-id="5fc98-197">En el capítulo sobre el [diseño de API](./api-design.md), se trata sobre el uso de [OpenAPI Specification](https://www.openapis.org/specification/repo) (Especificación de OpenAPI), conocida anteriormente como Swagger, para definir las descripciones de la interfaz independiente del lenguaje para las API de REST, expresadas en formato JSON o YAML.</span><span class="sxs-lookup"><span data-stu-id="5fc98-197">In the chapter on [API Design](./api-design.md), we discuss using [OpenAPI Specification](https://www.openapis.org/specification/repo) (formerly known as Swagger) to define language-agnostic interface descriptions for REST APIs, expressed in JSON or YAML format.</span></span>

<span data-ttu-id="5fc98-198">En el resto de este viaje, nos centraremos en el contexto delimitado del envío.</span><span class="sxs-lookup"><span data-stu-id="5fc98-198">For the rest of this journey, we will focus on the Shipping bounded context.</span></span> 

## <a name="tactical-ddd"></a><span data-ttu-id="5fc98-199">Diseño basado en dominios táctico</span><span class="sxs-lookup"><span data-stu-id="5fc98-199">Tactical DDD</span></span>

<span data-ttu-id="5fc98-200">Durante la fase estratégica del diseño basado en dominios (DDD), se asigna el dominio empresarial y se definen los contextos delimitados para los modelos de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-200">During the strategic phase of DDD, you are mapping out the business domain and defining bounded contexts for your domain models.</span></span> <span data-ttu-id="5fc98-201">El diseño basado en dominios táctico consiste en definir los modelos de dominio con más precisión.</span><span class="sxs-lookup"><span data-stu-id="5fc98-201">Tactical DDD is when you define your domain models with more precision.</span></span> <span data-ttu-id="5fc98-202">Los patrones tácticos se aplican dentro de un único contexto delimitado.</span><span class="sxs-lookup"><span data-stu-id="5fc98-202">The tactical patterns are applied within a single bounded context.</span></span> <span data-ttu-id="5fc98-203">En una arquitectura de microservicios, interesan especialmente los patrones de agregados y entidades.</span><span class="sxs-lookup"><span data-stu-id="5fc98-203">In a microservices architecture, we are particularly interested in the entity and aggregate patterns.</span></span> <span data-ttu-id="5fc98-204">Aplicar estos patrones nos ayudará a identificar los límites naturales de los servicios de nuestra aplicación (consulte el [siguiente capítulo](./microservice-boundaries.md)).</span><span class="sxs-lookup"><span data-stu-id="5fc98-204">Applying these patterns will help us to identify natural boundaries for the services in our application (see [next chapter](./microservice-boundaries.md)).</span></span> <span data-ttu-id="5fc98-205">Como principio general, un microservicio no debe ser menor que un agregado ni mayor que un contexto delimitado.</span><span class="sxs-lookup"><span data-stu-id="5fc98-205">As a general principle, a microservice should be no smaller than an aggregate, and no larger than a bounded context.</span></span> <span data-ttu-id="5fc98-206">En primer lugar, revisaremos los patrones tácticos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-206">First, we'll review the tactical patterns.</span></span> <span data-ttu-id="5fc98-207">A continuación, se podrán aplicar al contexto delimitado de envío, en la aplicación Drone Delivery.</span><span class="sxs-lookup"><span data-stu-id="5fc98-207">Then we'll apply them to the Shipping bounded context in the Drone Delivery application.</span></span> 

### <a name="overview-of-the-tactical-patterns"></a><span data-ttu-id="5fc98-208">Información general sobre los patrones tácticos</span><span class="sxs-lookup"><span data-stu-id="5fc98-208">Overview of the tactical patterns</span></span>

<span data-ttu-id="5fc98-209">En esta sección se proporciona un breve resumen de los patrones tácticos del diseño basado en dominios, por lo que, si ya está familiarizado con él, podría omitir esta sección.</span><span class="sxs-lookup"><span data-stu-id="5fc98-209">This section provides a brief summary of the tactical DDD patterns, so if you are already familiar with DDD, you can probably skip this section.</span></span> <span data-ttu-id="5fc98-210">Los patrones se describen con más detalle en los capítulos 5 y 6 del libro de Eric Evans, y en el libro *Implementing Domain-Driven Design* de Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="5fc98-210">The patterns are described in more detail in chapters 5 &ndash; 6 of Eric Evans' book, and in *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span> 

![](./images/ddd-patterns.png)

<span data-ttu-id="5fc98-211">**Entidades**.</span><span class="sxs-lookup"><span data-stu-id="5fc98-211">**Entities**.</span></span> <span data-ttu-id="5fc98-212">Una entidad es un objeto con una identidad única que persiste en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="5fc98-212">An entity is an object with a unique identity that persists over time.</span></span> <span data-ttu-id="5fc98-213">Por ejemplo, en una aplicación bancaria, las cuentas y los clientes serían entidades.</span><span class="sxs-lookup"><span data-stu-id="5fc98-213">For example, in a banking application, customers and accounts would be entities.</span></span> 

- <span data-ttu-id="5fc98-214">Una entidad tiene un identificador único en el sistema, que se puede usar para buscar la entidad o para recuperarla.</span><span class="sxs-lookup"><span data-stu-id="5fc98-214">An entity has a unique identifier in the system, which can be used to look up or retrieve the entity.</span></span> <span data-ttu-id="5fc98-215">Eso no significa que el identificador siempre se exponga directamente a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-215">That doesn't mean the identifier is always exposed directly to users.</span></span> <span data-ttu-id="5fc98-216">Podría ser un identificado único (GUID) o una clave principal de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-216">It could be a GUID or a primary key in a database.</span></span> 
- <span data-ttu-id="5fc98-217">Una identidad puede abarcar varios contextos delimitados y puede durar más que la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5fc98-217">An identity may span multiple bounded contexts, and may endure beyond the lifetime of the application.</span></span> <span data-ttu-id="5fc98-218">Por ejemplo, los números de cuentas bancarias o los identificadores emitidos por entidades gubernamentales no están asociados a la duración de una aplicación en particular.</span><span class="sxs-lookup"><span data-stu-id="5fc98-218">For example, bank account numbers or government-issued IDs are not tied to the lifetime of a particular application.</span></span>
- <span data-ttu-id="5fc98-219">Los atributos de una entidad pueden cambiar con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="5fc98-219">The attributes of an entity may change over time.</span></span> <span data-ttu-id="5fc98-220">Por ejemplo, el nombre o la dirección de una persona pueden variar, pero ella sigue siendo la misma.</span><span class="sxs-lookup"><span data-stu-id="5fc98-220">For example, a person's name or address might change, but they are still the same person.</span></span> 
- <span data-ttu-id="5fc98-221">Una entidad puede contener referencias a otras entidades.</span><span class="sxs-lookup"><span data-stu-id="5fc98-221">An entity can hold references to other entities.</span></span>
 
<span data-ttu-id="5fc98-222">**Objetos de valor**.</span><span class="sxs-lookup"><span data-stu-id="5fc98-222">**Value objects**.</span></span> <span data-ttu-id="5fc98-223">Un objeto de valor no tiene identidad.</span><span class="sxs-lookup"><span data-stu-id="5fc98-223">A value object has no identity.</span></span> <span data-ttu-id="5fc98-224">Se define únicamente mediante los valores de sus atributos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-224">It is defined only by the values of its attributes.</span></span> <span data-ttu-id="5fc98-225">Los objetos de valor también son inmutables.</span><span class="sxs-lookup"><span data-stu-id="5fc98-225">Value objects are also immutable.</span></span> <span data-ttu-id="5fc98-226">Para actualizar un objeto de valor, siempre hay que crear una nueva instancia que reemplace a la anterior.</span><span class="sxs-lookup"><span data-stu-id="5fc98-226">To update a value object, you always create a new instance to replace the old one.</span></span> <span data-ttu-id="5fc98-227">Los objetos de valor pueden tener métodos que encapsulen la lógica del dominio, pero esos métodos no deben afectar al estado del objeto.</span><span class="sxs-lookup"><span data-stu-id="5fc98-227">Value objects can have methods that encapsulate domain logic, but those methods should have no side-effects on the object's state.</span></span> <span data-ttu-id="5fc98-228">Ejemplos típicos de objetos de valor son los colores, las fechas y horas, y los valores de divisa.</span><span class="sxs-lookup"><span data-stu-id="5fc98-228">Typical examples of value objects include colors, dates and times, and currency values.</span></span> 

<span data-ttu-id="5fc98-229">**Agregados**.</span><span class="sxs-lookup"><span data-stu-id="5fc98-229">**Aggregates**.</span></span> <span data-ttu-id="5fc98-230">Un agregado define un límite de coherencia alrededor de una o varias entidades.</span><span class="sxs-lookup"><span data-stu-id="5fc98-230">An aggregate defines a consistency boundary around one or more entities.</span></span> <span data-ttu-id="5fc98-231">Una entidad exacta en un agregado es la raíz.</span><span class="sxs-lookup"><span data-stu-id="5fc98-231">Exactly one entity in an aggregate is the root.</span></span> <span data-ttu-id="5fc98-232">La búsqueda se realiza con el identificador de la entidad raíz.</span><span class="sxs-lookup"><span data-stu-id="5fc98-232">Lookup is done using the root entity's identifier.</span></span> <span data-ttu-id="5fc98-233">Cualquier otra entidad en el agregado es secundaria de la raíz y se hace referencia a ella siguiendo punteros desde esta.</span><span class="sxs-lookup"><span data-stu-id="5fc98-233">Any other entities in the aggregate are children of the root, and are referenced by following pointers from the root.</span></span> 

<span data-ttu-id="5fc98-234">El propósito de un agregado es modelar las invariantes transaccionales.</span><span class="sxs-lookup"><span data-stu-id="5fc98-234">The purpose of an aggregate is to model transactional invariants.</span></span> <span data-ttu-id="5fc98-235">Las cosas en el mundo real tienen redes complejas de relaciones.</span><span class="sxs-lookup"><span data-stu-id="5fc98-235">Things in the real world have complex webs of relationships.</span></span> <span data-ttu-id="5fc98-236">Los clientes crean pedidos, los pedidos contienen productos, los productos tienen proveedores y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="5fc98-236">Customers create orders, orders contain products, products have suppliers, and so on.</span></span> <span data-ttu-id="5fc98-237">Si la aplicación modifica varios objetos relacionados, ¿cómo podemos garantizar la coherencia?</span><span class="sxs-lookup"><span data-stu-id="5fc98-237">If the application modifies several related objects, how does it guarantee consistency?</span></span> <span data-ttu-id="5fc98-238">¿Cómo se realiza el seguimiento de los elementos invariables y cómo se aplican?</span><span class="sxs-lookup"><span data-stu-id="5fc98-238">How do we keep track of invariants and enforce them?</span></span>  

<span data-ttu-id="5fc98-239">A menudo, las aplicaciones tradicionales han usado las transacciones de base de datos para asegurar la coherencia.</span><span class="sxs-lookup"><span data-stu-id="5fc98-239">Traditional applications have often used database transactions to enforce consistency.</span></span> <span data-ttu-id="5fc98-240">En una aplicación distribuida, sin embargo, eso a menudo no es factible.</span><span class="sxs-lookup"><span data-stu-id="5fc98-240">In a distributed application, however, that's often not feasible.</span></span> <span data-ttu-id="5fc98-241">Una sola transacción comercial puede abarcar varios almacenes de datos, puede ser de ejecución prolongada o implicar a servicios de terceros.</span><span class="sxs-lookup"><span data-stu-id="5fc98-241">A single business transaction may span multiple data stores, or may be long running, or may involve third-party services.</span></span> <span data-ttu-id="5fc98-242">En última instancia, depende de la aplicación, no del nivel de datos, el aplicar los valores invariables necesarios para el dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-242">Ultimately it's up to the application, not the data layer, to enforce the invariants required for the domain.</span></span> <span data-ttu-id="5fc98-243">Eso es lo que los agregados se supone que modelan.</span><span class="sxs-lookup"><span data-stu-id="5fc98-243">That's what aggregates are meant to model.</span></span>

> [!NOTE]
> <span data-ttu-id="5fc98-244">Un agregado puede constar de una sola entidad, sin entidades secundarias.</span><span class="sxs-lookup"><span data-stu-id="5fc98-244">An aggregate might consist of a single entity, without child entities.</span></span> <span data-ttu-id="5fc98-245">Lo que lo convierte en agregado es el límite transaccional.</span><span class="sxs-lookup"><span data-stu-id="5fc98-245">What makes it an aggregate is the transactional boundary.</span></span>

<span data-ttu-id="5fc98-246">**Servicios de aplicación y de dominio**.</span><span class="sxs-lookup"><span data-stu-id="5fc98-246">**Domain and application services**.</span></span> <span data-ttu-id="5fc98-247">En la terminología del diseño basado en dominios, un servicio es un objeto que implementa alguna lógica sin mantener ningún estado.</span><span class="sxs-lookup"><span data-stu-id="5fc98-247">In DDD terminology, a service is an object that implements some logic without holding any state.</span></span> <span data-ttu-id="5fc98-248">Evans distingue entre *servicios de dominio*, que encapsulan la lógica del dominio, y *servicios de aplicación*, que proporcionan la funcionalidad técnica, como la autenticación del usuario o el envío de un mensaje SMS.</span><span class="sxs-lookup"><span data-stu-id="5fc98-248">Evans distinguishes between *domain services*, which encapsulate domain logic, and *application services*, which provide technical functionality, such as user authentication or sending an SMS message.</span></span> <span data-ttu-id="5fc98-249">Los servicios de dominio a menudo se utilizan para modelar el comportamiento que abarca varias entidades.</span><span class="sxs-lookup"><span data-stu-id="5fc98-249">Domain services are often used to model behavior that spans multiple entities.</span></span> 

> [!NOTE]
> <span data-ttu-id="5fc98-250">El término *servicio* está saturado en el desarrollo de software.</span><span class="sxs-lookup"><span data-stu-id="5fc98-250">The term *service* is overloaded in software development.</span></span> <span data-ttu-id="5fc98-251">La definición aquí no está relacionada directamente con los microservicios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-251">The definition here is not directly related to microservices.</span></span>

<span data-ttu-id="5fc98-252">**Eventos de dominio**.</span><span class="sxs-lookup"><span data-stu-id="5fc98-252">**Domain events**.</span></span> <span data-ttu-id="5fc98-253">Los eventos de dominio se pueden utilizar para notificar a otras partes del sistema cuando sucede algo.</span><span class="sxs-lookup"><span data-stu-id="5fc98-253">Domain events can be used to notify other parts of the system when something happens.</span></span> <span data-ttu-id="5fc98-254">Como sugiere su nombre, los eventos de dominio deben significar algo dentro del dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-254">As the name suggests, domain events should mean something within the domain.</span></span> <span data-ttu-id="5fc98-255">Por ejemplo, "se inserta un registro en una tabla" no es un evento de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-255">For example, "a record was inserted into a table" is not a domain event.</span></span> <span data-ttu-id="5fc98-256">"Se canceló una entrega" es un evento de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-256">"A delivery was cancelled" is a domain event.</span></span> <span data-ttu-id="5fc98-257">Los eventos de dominio son especialmente importantes en una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-257">Domain events are especially relevant in a microservices architecture.</span></span> <span data-ttu-id="5fc98-258">Dado que los microservicios se distribuyen y no comparten los almacenes de datos, los eventos de dominio proporcionan una manera de que los microservicios se coordinen entre sí.</span><span class="sxs-lookup"><span data-stu-id="5fc98-258">Because microservices are distributed and don't share data stores, domain events provide a way for microservices to coordinate with each other.</span></span> <span data-ttu-id="5fc98-259">En el capítulo [Comunicación entre servicios](./interservice-communication.md) se describe la mensajería asincrónica con más detalle.</span><span class="sxs-lookup"><span data-stu-id="5fc98-259">The chapter [Interservice communication](./interservice-communication.md) discusses asynchronous messaging in more detail.</span></span>
 
<span data-ttu-id="5fc98-260">Hay otros patrones del diseño basado en dominios que no se mencionan aquí, como son los generadores, los repositorios y los módulos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-260">There are a few other DDD patterns not listed here, including factories, repositories, and modules.</span></span> <span data-ttu-id="5fc98-261">Pueden ser patrones útiles cuando se vaya a implementar un microservicio, pero son menos importantes al diseñar los límites entre microservicios.</span><span class="sxs-lookup"><span data-stu-id="5fc98-261">These can be useful patterns for when you are implementing a microservice, but they are less relevant when designing the boundaries between microservice.</span></span>

## <a name="drone-delivery-applying-the-patterns"></a><span data-ttu-id="5fc98-262">Drone Delivery: aplicación de patrones</span><span class="sxs-lookup"><span data-stu-id="5fc98-262">Drone delivery: Applying the patterns</span></span>

<span data-ttu-id="5fc98-263">Empezaremos con los escenarios que el contexto delimitado de envío debe controlar.</span><span class="sxs-lookup"><span data-stu-id="5fc98-263">We start with the scenarios that the Shipping bounded context must handle.</span></span>

- <span data-ttu-id="5fc98-264">Un cliente puede solicitar un dron para recoger las mercancías de una empresa que se registre en el servicio de entrega de drones.</span><span class="sxs-lookup"><span data-stu-id="5fc98-264">A customer can request a drone to pick up goods from a business that is registered with the drone delivery service.</span></span>
- <span data-ttu-id="5fc98-265">El remitente genera una etiqueta (código de barras o RFID) para colocar en el paquete.</span><span class="sxs-lookup"><span data-stu-id="5fc98-265">The sender generates a tag (barcode or RFID) to put on the package.</span></span> 
- <span data-ttu-id="5fc98-266">Un dron recogerá el paquete en la ubicación de origen y lo entregará en la ubicación de destino.</span><span class="sxs-lookup"><span data-stu-id="5fc98-266">A drone will pick up and deliver a package from the source location to the destination location.</span></span>
- <span data-ttu-id="5fc98-267">Cuando un cliente programa una entrega, el sistema proporciona un tiempo estimado de llegada (ETA) según la información de la ruta, las condiciones meteorológicas y los datos históricos.</span><span class="sxs-lookup"><span data-stu-id="5fc98-267">When a customer schedules a delivery, the system provides an ETA based on route information, weather conditions, and historical data.</span></span> 
- <span data-ttu-id="5fc98-268">Cuando el dron está en vuelo, el usuario puede realizar el seguimiento de la ubicación actual y del tiempo estimado de llegada más reciente.</span><span class="sxs-lookup"><span data-stu-id="5fc98-268">When the drone is in flight, a user can track the current location and the latest ETA.</span></span> 
- <span data-ttu-id="5fc98-269">Hasta que un dron recoja el paquete, el cliente puede cancelar una entrega.</span><span class="sxs-lookup"><span data-stu-id="5fc98-269">Until a drone has picked up the package, the customer can cancel a delivery.</span></span>
- <span data-ttu-id="5fc98-270">Se notifica al cliente cuándo se completa la entrega.</span><span class="sxs-lookup"><span data-stu-id="5fc98-270">The customer is notified when the delivery is completed.</span></span>
- <span data-ttu-id="5fc98-271">El remitente puede solicitar al cliente la confirmación de la entrega, en forma de una firma o de una huella digital.</span><span class="sxs-lookup"><span data-stu-id="5fc98-271">The sender can request delivery confirmation from the customer, in the form of a signature or finger print.</span></span>
- <span data-ttu-id="5fc98-272">Los usuarios pueden ver el historial de una entrega completada.</span><span class="sxs-lookup"><span data-stu-id="5fc98-272">Users can look up the history of a completed delivery.</span></span>

<span data-ttu-id="5fc98-273">En estos casos, el equipo de desarrollo identificó las siguientes **entidades**.</span><span class="sxs-lookup"><span data-stu-id="5fc98-273">From these scenarios, the development team identified the following **entities**.</span></span>

- <span data-ttu-id="5fc98-274">Entrega</span><span class="sxs-lookup"><span data-stu-id="5fc98-274">Delivery</span></span>
- <span data-ttu-id="5fc98-275">Paquete</span><span class="sxs-lookup"><span data-stu-id="5fc98-275">Package</span></span>
- <span data-ttu-id="5fc98-276">Dron</span><span class="sxs-lookup"><span data-stu-id="5fc98-276">Drone</span></span>
- <span data-ttu-id="5fc98-277">Cuenta</span><span class="sxs-lookup"><span data-stu-id="5fc98-277">Account</span></span>
- <span data-ttu-id="5fc98-278">Confirmación</span><span class="sxs-lookup"><span data-stu-id="5fc98-278">Confirmation</span></span>
- <span data-ttu-id="5fc98-279">Notificación</span><span class="sxs-lookup"><span data-stu-id="5fc98-279">Notification</span></span>
- <span data-ttu-id="5fc98-280">Etiqueta</span><span class="sxs-lookup"><span data-stu-id="5fc98-280">Tag</span></span>

<span data-ttu-id="5fc98-281">Las cuatro primeras (entrega, paquete, dron y cuenta) son todos **agregados** que representan los límites de la coherencia transaccional.</span><span class="sxs-lookup"><span data-stu-id="5fc98-281">The first four, Delivery, Package, Drone, and Account, are all **aggregates** that represent transactional consistency boundaries.</span></span> <span data-ttu-id="5fc98-282">Las confirmaciones y las notificaciones son las entidades secundarias de las entregas y las etiquetas son las entidades secundarias de los paquetes.</span><span class="sxs-lookup"><span data-stu-id="5fc98-282">Confirmations and Notifications are child entities of Deliveries, and Tags are child entities of Packages.</span></span> 

<span data-ttu-id="5fc98-283">Los **objetos de valor** en este diseño incluyen la ubicación (Location), el tiempo estimado (ETA), el peso del paquete (PackageWeight) y su tamaño (PackageSize).</span><span class="sxs-lookup"><span data-stu-id="5fc98-283">The **value objects** in this design include Location, ETA, PackageWeight, and PackageSize.</span></span> 

<span data-ttu-id="5fc98-284">Para ilustrar esto, se proporciona un diagrama UML del agregado de entrega.</span><span class="sxs-lookup"><span data-stu-id="5fc98-284">To illustrate, here is a UML diagram of the Delivery aggregate.</span></span> <span data-ttu-id="5fc98-285">Tenga en cuenta que contiene referencias a otros agregados, como son la cuenta, el paquete y el dron.</span><span class="sxs-lookup"><span data-stu-id="5fc98-285">Notice that it holds references to other aggregates, including Account, Package, and Drone.</span></span>

![](./images/delivery-entity.png)

<span data-ttu-id="5fc98-286">Hay dos eventos de dominio:</span><span class="sxs-lookup"><span data-stu-id="5fc98-286">There are two domain events:</span></span>

- <span data-ttu-id="5fc98-287">Mientras un dron está volando, la entidad Dron envía eventos DroneStatus que describen la ubicación y el estado del dron (en vuelo, en tierra).</span><span class="sxs-lookup"><span data-stu-id="5fc98-287">While a drone is in flight, the Drone entity sends DroneStatus events that describe the drone's location and status (in-flight, landed).</span></span>

- <span data-ttu-id="5fc98-288">La entidad de entrega (Delivery) envía eventos de seguimiento de la entrega (DeliveryTracking) cada vez que cambia la fase de una entrega.</span><span class="sxs-lookup"><span data-stu-id="5fc98-288">The Delivery entity sends DeliveryTracking events whenever the stage of a delivery changes.</span></span> <span data-ttu-id="5fc98-289">Entre estos, se incluyen los de creación, reprogramación, preparada y completada (DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff y DeliveryCompleted, respectivamente).</span><span class="sxs-lookup"><span data-stu-id="5fc98-289">These include DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff, and DeliveryCompleted.</span></span> 

<span data-ttu-id="5fc98-290">Tenga en cuenta que estos eventos describen aspectos significativos dentro del modelo de dominio.</span><span class="sxs-lookup"><span data-stu-id="5fc98-290">Notice that these events describe things that are meaningful within the domain model.</span></span> <span data-ttu-id="5fc98-291">Describen algo sobre este y no están vinculados a una construcción de un lenguaje de programación determinado.</span><span class="sxs-lookup"><span data-stu-id="5fc98-291">They describe something about the domain, and aren't tied to a particular programming language construct.</span></span>

<span data-ttu-id="5fc98-292">El equipo de desarrollo identificó un área más de funcionalidad, que no encaja claramente en ninguna de las entidades descritas hasta ahora.</span><span class="sxs-lookup"><span data-stu-id="5fc98-292">The development team identified one more area of functionality, which doesn't fit neatly into any of the entities described so far.</span></span> <span data-ttu-id="5fc98-293">Una parte del sistema debe coordinar todos los pasos implicados en la programación o actualización de una entrega.</span><span class="sxs-lookup"><span data-stu-id="5fc98-293">Some part of the system must coordinate all of the steps involved in scheduling or updating a delivery.</span></span> <span data-ttu-id="5fc98-294">Por lo tanto, el equipo de desarrollo agrega dos **servicios de dominio** al diseño: un *programador* (Scheduler) que coordina los pasos y un *supervisor* que supervisa el estado de cada paso, con el fin de detectar si en alguno se generó un error o se agotó su tiempo asignado. Esta es una variación del patrón [Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md) (supervisor del agente de programación).</span><span class="sxs-lookup"><span data-stu-id="5fc98-294">Therefore, the development team added two **domain services** to the design: a *Scheduler* that coordinates the steps, and a *Supervisor* that monitors the status of each step, in order to detect whether any steps have failed or timed out. This is a variation of the [Scheduler Agent Supervisor pattern](../patterns/scheduler-agent-supervisor.md).</span></span>

![](./images/drone-ddd.png)

> [!div class="nextstepaction"]
> [<span data-ttu-id="5fc98-295">Identificación de los límites de los microservicios</span><span class="sxs-lookup"><span data-stu-id="5fc98-295">Identifying microservice boundaries</span></span>](./microservice-boundaries.md)
