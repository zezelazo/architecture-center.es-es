---
title: CI/CD para microservicios
description: Integración continua y entrega continua para microservicios
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 7d8a81b7bc236e50d722a68a0115b9220d4e094f
ms.sourcegitcommit: 786bafefc731245414c3c1510fc21027afe303dc
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/12/2017
ms.locfileid: "26653069"
---
# <a name="designing-microservices-continuous-integration"></a><span data-ttu-id="7c7d9-103">Diseño de microservicios: integración continua</span><span class="sxs-lookup"><span data-stu-id="7c7d9-103">Designing microservices: Continuous integration</span></span>

<span data-ttu-id="7c7d9-104">La integración continua y la entrega continua (CI/CD) son un requisito clave para el buen funcionamiento de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-104">Continuous integration and continuous delivery (CI/CD) are a key requirement for achieving success with microservices.</span></span> <span data-ttu-id="7c7d9-105">Sin un buen proceso de CI/CD, no disfrutará de la agilidad que los microservicios prometen.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-105">Without a good CI/CD process, you will not achieve the agility that microservices promise.</span></span> <span data-ttu-id="7c7d9-106">Algunos de los desafíos de CI/CD para microservicios surgen debido a la existencia de varias bases de código y de entornos de compilación heterogéneos para los diversos servicios.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-106">Some of the CI/CD challenges for microservices arise from having multiple code bases and heterogenous build environments for the various services.</span></span> <span data-ttu-id="7c7d9-107">En este capítulo se describen los desafíos y se recomiendan algunas estrategias para resolver los problemas.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-107">This chapter describes the challenges and recommends some approaches to the problem.</span></span>

![](./images/ci-cd.png)

<span data-ttu-id="7c7d9-108">Una de las principales razones para adoptar una arquitectura de microservicios es la existencia de ciclos de lanzamiento más rápidos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-108">Faster release cycles are one of the biggest reasons to adopt a microservices architecture.</span></span> 

<span data-ttu-id="7c7d9-109">En una aplicación completamente monolítica, hay una canalización de compilación única cuya salida es el ejecutable de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-109">In a purely monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="7c7d9-110">Todo el trabajo de desarrollo se envía a esta canalización.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-110">All development work feeds into this pipeline.</span></span> <span data-ttu-id="7c7d9-111">Si se encuentra un error de alta prioridad, debe integrarse, probarse y publicarse una corrección, lo que puede retrasar el lanzamiento de nuevas características.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-111">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="7c7d9-112">Es cierto que puede mitigar estos problemas con módulos correctamente factorizados y el uso de ramas de características para minimizar el impacto de los cambios de código.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-112">It's true that you can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="7c7d9-113">No obstante, a medida que la aplicación se hace más compleja y se van añadiendo más características, el proceso de publicación de un monolito tiende a hacerse más frágil, con lo que tiene más posibilidades de presentar errores.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-113">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span> 

<span data-ttu-id="7c7d9-114">Según la filosofía de los microservicios, nunca debería haber una larga serie de versiones en la que todos los equipos tengan que hacer cola.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-114">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="7c7d9-115">El equipo que compila el servicio "A" podrá publicar una actualización en cualquier momento, sin tener que esperar a que los cambios realizados en el servicio "B" se combinen, prueben e implementen.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-115">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span> <span data-ttu-id="7c7d9-116">El proceso de CI/CD es fundamental para que esto sea posible.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-116">The CI/CD process is critical to making this possible.</span></span> <span data-ttu-id="7c7d9-117">La canalización de versión debe estar automatizada y ser altamente fiable, de forma que el riesgo de tener que implementar actualizaciones se reduzca al mínimo.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-117">Your release pipeline must be automated and highly reliable, so that the risks of deploying updates are minimized.</span></span> <span data-ttu-id="7c7d9-118">Si va a promover versiones a producción una o varias veces al día, las regresiones e interrupciones del servicio deben ser muy poco frecuentes.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-118">If you are releasing to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="7c7d9-119">Al mismo tiempo, si se implementa una actualización con errores, debe disponer de un método fiable para ponerla al día o revertirla rápidamente a una versión anterior de un servicio.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-119">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

![](./images/cicd-monolith.png)

<span data-ttu-id="7c7d9-120">Cuando hablamos de CI/CD, estamos hablando realmente de varios procesos relacionados: la integración continua, la entrega continua y la implementación continua.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-120">When we talk about CI/CD, we are really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="7c7d9-121">La integración continua implica que los cambios en el código se combinarán frecuentemente en la rama principal mediante procesos de compilación y prueba automatizados, a fin de garantizar que el código de la rama principal siempre tenga calidad de producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-121">Continuous integration means that code changes are frequently merged into the main branch, using automated build and test processes to ensure that  code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="7c7d9-122">La entrega continua hace que los cambios en el código que pasan el proceso de integración continua se publiquen automáticamente en un entorno similar a la producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-122">Continuous delivery means that code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="7c7d9-123">La implementación en el entorno de producción real puede requerir aprobación manual, pero, en caso contrario, se realiza automáticamente.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-123">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="7c7d9-124">El objetivo es que el código siempre esté *listo* para implementarse en producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-124">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="7c7d9-125">La implementación continua hace que los cambios en el código que pasan el proceso de CI/CD se implementen automáticamente en producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-125">Continuous deployment means that code changes that pass the CI/CD process are automatically deployed into production.</span></span>

<span data-ttu-id="7c7d9-126">En el contexto de Kubernetes y de los microservicios, durante la fase de integración continua se compilan y prueban imágenes de contenedor, además de insertar esas imágenes en un registro de contenedor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-126">In the context of Kubernetes and microservices, the CI stage is concerned with building and testing container images, and pushing those images to a container registry.</span></span> <span data-ttu-id="7c7d9-127">En la fase de implementación, se actualizan las especificaciones de pod para recoger la imagen de producción más reciente.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-127">In the deployment stage, pod specs are updated to pick up the latest production image.</span></span>

## <a name="challenges"></a><span data-ttu-id="7c7d9-128">Desafíos</span><span class="sxs-lookup"><span data-stu-id="7c7d9-128">Challenges</span></span>

- <span data-ttu-id="7c7d9-129">**Muchas bases de código pequeñas e independientes**.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-129">**Many small independent code bases**.</span></span> <span data-ttu-id="7c7d9-130">Cada equipo es responsable de compilar su propio servicio, con su propia canalización de compilación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-130">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="7c7d9-131">En algunas organizaciones, los equipos pueden usar repositorios de código distintos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-131">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="7c7d9-132">Esto podría provocar una situación en la que los diferentes equipos se especialicen en una parte distinta del proceso de compilación del sistema, pero nadie en la organización sepa realmente cómo implementar la aplicación completa.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-132">This could lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="7c7d9-133">Por ejemplo, ¿qué ocurriría en un escenario de recuperación ante desastres si fuera necesario implementar rápidamente en un nuevo clúster?</span><span class="sxs-lookup"><span data-stu-id="7c7d9-133">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>   

- <span data-ttu-id="7c7d9-134">**Varios lenguajes y plataformas**.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-134">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="7c7d9-135">Si cada equipo usa su propio conjunto de tecnologías, puede ser difícil crear un único proceso de compilación que sirva para toda la organización.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-135">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="7c7d9-136">El proceso de compilación debe ser lo suficientemente flexible como para que cada equipo pueda adaptarlo al lenguaje o la plataforma que utiliza.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-136">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span> 

- <span data-ttu-id="7c7d9-137">**Integración y pruebas de carga**.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-137">**Integration and load testing**.</span></span> <span data-ttu-id="7c7d9-138">Si cada equipo publica actualizaciones a su propio ritmo, puede resultar complicado diseñar una solución de pruebas integral sólida, especialmente si los servicios tienen dependencias en otros servicios.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-138">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="7c7d9-139">Además, poner en marcha un clúster de producción completo puede ser costoso, por lo que resulta poco probable que cada equipo pueda ejecutar su propio clúster completo a escala de producción solo para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-139">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will be able to run its own full cluster at production scales, just for testing.</span></span> 

- <span data-ttu-id="7c7d9-140">**Administración de versiones**.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-140">**Release management**.</span></span> <span data-ttu-id="7c7d9-141">Cada equipo debe tener la capacidad de implementar una actualización en producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-141">Every team should have the ability to deploy an update to production.</span></span> <span data-ttu-id="7c7d9-142">Eso no significa que cada miembro del equipo tenga permiso para hacerlo.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-142">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="7c7d9-143">Sin embargo, contar con un rol de administrador de versiones centralizado puede reducir la velocidad de las implementaciones.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-143">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span> <span data-ttu-id="7c7d9-144">Cuanto más automatizado y fiable sea el proceso de CI/CD, menor será la necesidad de contar con una autoridad central.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-144">The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="7c7d9-145">No obstante, puede tener una directiva para publicar actualizaciones de características importantes y otra distinta para publicar correcciones de errores menores.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-145">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="7c7d9-146">Un enfoque descentralizado no implica la ausencia completa de autoridad.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-146">Being decentralized does not mean there should be zero governance.</span></span>

- <span data-ttu-id="7c7d9-147">**Control de versiones de imágenes de contenedor**.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-147">**Container image versioning**.</span></span> <span data-ttu-id="7c7d9-148">Durante el ciclo de desarrollo y pruebas, el proceso de CI/CD compilará muchas imágenes de contenedor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-148">During the development and test cycle, the CI/CD process will build many container images.</span></span> <span data-ttu-id="7c7d9-149">Solo algunas de ellas serán candidatas a publicarse y, de estas, solo algunas se enviarán a producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-149">Only some of those are candidates for release, and then only some of those release candidates will get pushed into production.</span></span> <span data-ttu-id="7c7d9-150">Debe tener una estrategia de control de versiones clara, para saber qué imágenes se están implementando actualmente en producción y pueda revertir a una versión anterior si es necesario.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-150">You should have a clear versioning strategy, so that you know which images are currently deployed to production, and can roll back to a previous version if necessary.</span></span> 

- <span data-ttu-id="7c7d9-151">**Actualizaciones del servicio**.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-151">**Service updates**.</span></span> <span data-ttu-id="7c7d9-152">Cuando se actualiza un servicio a una nueva versión, no debería interrumpir otros servicios que dependen de él.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-152">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span> <span data-ttu-id="7c7d9-153">Si hace una actualización gradual, durante un tiempo se ejecutarán distintas versiones a la vez.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-153">If you do a rolling update, there will be a period of time when a mix of versions is running.</span></span> 
 
<span data-ttu-id="7c7d9-154">Estos desafíos reflejan una tensión fundamental.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-154">These challenges reflect a fundamental tension.</span></span> <span data-ttu-id="7c7d9-155">Por una parte, los equipos tienen que trabajar con la mayor independencia posible.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-155">On the one hand, teams need to work as independently as possible.</span></span> <span data-ttu-id="7c7d9-156">Por otro lado, se necesita cierta coordinación para que una sola persona pueda realizar tareas como ejecutar una prueba de integración, volver a implementar toda la solución en un nuevo clúster o revertir una actualización con errores.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-156">On the other hand, some coordination is needed so that a single person can do tasks like running an integration test, redeploying the entire solution to a new cluster, or rolling back a bad update.</span></span> 
 
## <a name="cicd-approaches-for-microservices"></a><span data-ttu-id="7c7d9-157">Estrategias de CI/CD para microservicios</span><span class="sxs-lookup"><span data-stu-id="7c7d9-157">CI/CD approaches for microservices</span></span>

<span data-ttu-id="7c7d9-158">Es una buena práctica que cada equipo de servicio incluya su entorno de compilación en un contenedor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-158">It's a good practice for every service team to containerize their build environment.</span></span> <span data-ttu-id="7c7d9-159">Este contenedor debe tener todas las herramientas de compilación necesarias para compilar los artefactos de código para su servicio.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-159">This container should have all of the build tools necessary to build the code artifacts for their service.</span></span> <span data-ttu-id="7c7d9-160">A menudo puede encontrar una imagen de Docker oficial para su lenguaje y plataforma.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-160">Often you can find an official Docker image for your language and framework.</span></span> <span data-ttu-id="7c7d9-161">Puede usar `docker run` o Docker Compose para ejecutar la compilación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-161">Then you can use `docker run` or Docker Compose to run the build.</span></span> 

<span data-ttu-id="7c7d9-162">Con este enfoque, es muy fácil configurar un nuevo entorno de compilación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-162">With this approach, it's trivial to set up a new build environment.</span></span> <span data-ttu-id="7c7d9-163">Un desarrollador que desee compilar el código no tendrá que instalar un conjunto de herramientas de compilación, sino que solo tendrá que ejecutar la imagen de contenedor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-163">A developer who wants to build your code doesn't need to install a set of build tools, but simply runs the container image.</span></span> <span data-ttu-id="7c7d9-164">Y, lo que puede ser más importante: podrá configurarse el servidor de compilación para que haga lo mismo.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-164">Perhaps more importantly, your build server can be configured to do the same thing.</span></span> <span data-ttu-id="7c7d9-165">De este modo, no necesita instalar esas herramientas en el servidor de compilación ni administrar versiones en conflicto de herramientas.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-165">That way, you don't need to install those tools onto the build server, or manage conflicting versions of tools.</span></span> 

<span data-ttu-id="7c7d9-166">Para el desarrollo y las pruebas locales, use Docker para ejecutar el servicio dentro de un contenedor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-166">For local development and testing, use Docker to run the service inside a container.</span></span> <span data-ttu-id="7c7d9-167">Como parte de este proceso, puede que tenga que ejecutar otros contenedores que tienen servicios ficticios o bases de datos de prueba necesarios para realizar pruebas locales.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-167">As part of this process, you may need to run other containers that have mock services or test databases needed for local testing.</span></span> <span data-ttu-id="7c7d9-168">Podría utilizar Docker Compose para coordinar estos contenedores, o usar Minikube para ejecutar Kubernetes localmente.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-168">You could use Docker Compose to coordinate these containers, or use Minikube to run Kubernetes locally.</span></span> 

<span data-ttu-id="7c7d9-169">Cuando el código esté listo, abra una solicitud de incorporación de cambios y combínelo con la versión maestra.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-169">When the code is ready, open a pull request and merge into master.</span></span> <span data-ttu-id="7c7d9-170">Esto iniciará un trabajo en el servidor de compilación:</span><span class="sxs-lookup"><span data-stu-id="7c7d9-170">This will start a job on the build server:</span></span>

1. <span data-ttu-id="7c7d9-171">Compile los recursos del código.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-171">Build the code assets.</span></span> 
2. <span data-ttu-id="7c7d9-172">Ejecute pruebas unitarias en el código.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-172">Run unit tests against the code.</span></span>
3. <span data-ttu-id="7c7d9-173">Compile la imagen de contenedor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-173">Build the container image.</span></span>
4. <span data-ttu-id="7c7d9-174">Pruebe la imagen de contenedor mediante la ejecución de pruebas funcionales en un contenedor en ejecución.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-174">Test the container image by running functional tests on a running container.</span></span> <span data-ttu-id="7c7d9-175">Este paso puede detectar errores en el archivo de Docker, como, por ejemplo, un punto de entrada incorrecto.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-175">This step can catch errors in the Docker file, such as a bad entry point.</span></span>
5. <span data-ttu-id="7c7d9-176">Inserte la imagen en el registro de contenedor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-176">Push the image to a container registry.</span></span>
6. <span data-ttu-id="7c7d9-177">Actualice el clúster de prueba con la nueva imagen para ejecutar pruebas de integración.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-177">Update the test cluster with the new image to run integration tests.</span></span>

<span data-ttu-id="7c7d9-178">Cuando la imagen esté lista para pasar a producción, actualice los archivos de implementación según sea necesario para especificar la imagen más reciente, incluidos los archivos de configuración de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-178">When the image is ready to go into production, update the deployment files as needed to specify the latest image, including any Kubernetes configuration files.</span></span> <span data-ttu-id="7c7d9-179">A continuación, aplique la actualización al clúster de producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-179">Then apply the update to the production cluster.</span></span>

<span data-ttu-id="7c7d9-180">A continuación, se incluyen diversas recomendaciones para que las implementaciones sean más fiables:</span><span class="sxs-lookup"><span data-stu-id="7c7d9-180">Here are some recommendations for making deployments more reliable:</span></span>
 
- <span data-ttu-id="7c7d9-181">Defina convenciones para toda la organización de etiquetas contenedoras, control de versiones y nomenclatura para los recursos implementados en el clúster (pods, servicios, etc.).</span><span class="sxs-lookup"><span data-stu-id="7c7d9-181">Define organization-wide conventions for container tags, versioning, and naming conventions for resources deployed to the cluster (pods, services, and so on).</span></span> <span data-ttu-id="7c7d9-182">Esto puede ayudar a diagnosticar problemas de implementación más fácilmente.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-182">That can make it easier to diagnose deployment issues.</span></span> 

- <span data-ttu-id="7c7d9-183">Cree dos registros de contenedor independientes, uno para desarrollo/pruebas y otro para producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-183">Create two separate container registries, one for development/testing and one for production.</span></span> <span data-ttu-id="7c7d9-184">No inserte una imagen en el registro de producción hasta que esté listo para implementarla en producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-184">Don't push an image to the production registry until you're ready to deploy it into production.</span></span> <span data-ttu-id="7c7d9-185">Si combina esta práctica con el versionamiento semántico de imágenes de contenedor, puede reducir la posibilidad de implementar accidentalmente una versión que no se ha aprobado para su publicación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-185">If you combine this practice with semantic versioning of container images, it can reduce the chance of accidentally deploying a version that wasn't approved for release.</span></span>

## <a name="updating-services"></a><span data-ttu-id="7c7d9-186">Actualización de los servicios</span><span class="sxs-lookup"><span data-stu-id="7c7d9-186">Updating services</span></span>

<span data-ttu-id="7c7d9-187">Existen diversas estrategias de actualización de un servicio que ya está en producción.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-187">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="7c7d9-188">Aquí analizaremos tres de las más frecuentes: la actualización gradual, la implementación azul-verde y el lanzamiento controlado.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-188">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-update"></a><span data-ttu-id="7c7d9-189">Actualización gradual</span><span class="sxs-lookup"><span data-stu-id="7c7d9-189">Rolling update</span></span> 

<span data-ttu-id="7c7d9-190">En una actualización gradual, se implementan nuevas instancias de un servicio y las instancias nuevas empiezan a recibir solicitudes de forma inmediata.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-190">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="7c7d9-191">A medida que llegan nuevas instancias, se eliminan las anteriores.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-191">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="7c7d9-192">Las actualizaciones graduales son el comportamiento predeterminado en Kubernetes cuando se actualiza la especificación de pod para una implementación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-192">Rolling updates are the default behavior in Kubernetes when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="7c7d9-193">El controlador de implementación crea un ReplicaSet nuevo para los pods actualizados.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-193">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="7c7d9-194">A continuación, se escala verticalmente el nuevo ReplicaSet mientras se reduce verticalmente el anterior a fin de mantener el número de réplicas deseado.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-194">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="7c7d9-195">Los pods antiguos no se eliminarán hasta que los nuevos estén listos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-195">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="7c7d9-196">Kubernetes mantiene un historial de la actualización, por lo que puede usar kubectl para revertir una actualización si es necesario.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-196">Kubernetes keeps a history of the update, so you can use kubectl to roll back an update if needed.</span></span> 

<span data-ttu-id="7c7d9-197">Si el servicio lleva a cabo una tarea de inicio prolongada, puede definir un sondeo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-197">If your service performs a long startup task, you can define a readiness probe.</span></span> <span data-ttu-id="7c7d9-198">El sondeo de disponibilidad indica si el contenedor está listo para empezar a recibir tráfico.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-198">The readiness probe reports when the container is ready to start receiving traffic.</span></span> <span data-ttu-id="7c7d9-199">Kubernetes no enviará tráfico al pod hasta que el sondeo devuelva un resultado satisfactorio.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-199">Kubernetes won't send traffic to the pod until the probe reports success.</span></span> 

<span data-ttu-id="7c7d9-200">Las actualizaciones graduales plantean el desafío de que, durante el proceso de actualización, se ejecuta una combinación de versiones antiguas y nuevas que reciben tráfico.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-200">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="7c7d9-201">Durante este período, una solicitud podría dirigirse a cualquiera de las dos versiones.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-201">During this period, any request could get routed to either of the two versions.</span></span> <span data-ttu-id="7c7d9-202">Esto podría ser problemático, en función del alcance de los cambios entre las dos versiones.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-202">That may or may not cause problems, depending on the scope of the changes between the two versions.</span></span> 

### <a name="blue-green-deployment"></a><span data-ttu-id="7c7d9-203">Implementación azul-verde</span><span class="sxs-lookup"><span data-stu-id="7c7d9-203">Blue-green deployment</span></span>

<span data-ttu-id="7c7d9-204">En una implementación azul-verde, se implemente la nueva versión junto con la versión anterior.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-204">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="7c7d9-205">Después de validar la nueva versión, se cambia todo el tráfico a la vez desde la versión anterior a la nueva versión.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-205">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="7c7d9-206">Tras el cambio, deberá supervisar la aplicación para detectar posibles problemas.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-206">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="7c7d9-207">Si algo va mal, puede volver a la versión anterior.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-207">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="7c7d9-208">Si no hubiera ningún problema, puede eliminar la versión anterior.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-208">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="7c7d9-209">Con una aplicación de n niveles o monolítica más tradicional, la implementación azul-verde normalmente implicaba el aprovisionamiento de dos entornos idénticos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-209">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="7c7d9-210">La nueva versión se implementaría en un entorno de ensayo y se redirigiría el tráfico del cliente al entorno de ensayo &mdash;, por ejemplo, intercambiando las direcciones IP virtuales.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-210">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span>

<span data-ttu-id="7c7d9-211">En Kubernetes, no es necesario aprovisionar un clúster diferente para realizar implementaciones azul-verde.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-211">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="7c7d9-212">En su lugar, puede utilizar selectores.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-212">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="7c7d9-213">Cree un nuevo recurso de implementación con una nueva especificación de pod y un conjunto diferente de etiquetas.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-213">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="7c7d9-214">Cree esta implementación sin eliminar la implementación anterior ni modificar el servicio que hace referencia a ella.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-214">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="7c7d9-215">Una vez que se ejecutan los nuevos pods, puede actualizar el selector del servicio para que se corresponda con la nueva implementación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-215">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span> 

<span data-ttu-id="7c7d9-216">Una de las ventajas de las implementaciones azul-verde es que el servicio cambia todos los pods al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-216">An advantage of blue-green deployments is that the service switches all the pods at the same time.</span></span> <span data-ttu-id="7c7d9-217">Después de haber actualizado el servicio, todas las nuevas solicitudes se dirigirán a la nueva versión.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-217">After the service is updated, all new requests get routed to the new version.</span></span> <span data-ttu-id="7c7d9-218">Una desventaja es que durante la actualización, se ejecuta el doble de pods para el servicio (actual y siguiente).</span><span class="sxs-lookup"><span data-stu-id="7c7d9-218">One drawback is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="7c7d9-219">Si los pods requieren una gran cantidad de recursos de CPU o memoria, debe escalar horizontalmente el clúster de forma temporal para controlar el consumo de recursos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-219">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span> 

### <a name="canary-release"></a><span data-ttu-id="7c7d9-220">Lanzamiento controlado</span><span class="sxs-lookup"><span data-stu-id="7c7d9-220">Canary release</span></span>

<span data-ttu-id="7c7d9-221">En un lanzamiento controlado, se implementa una versión actualizada en un pequeño número de clientes.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-221">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="7c7d9-222">A continuación, supervisará el comportamiento del servicio nuevo antes de distribuirlo a todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-222">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="7c7d9-223">Esto le permitirá realizar una implementación lenta de un modo controlado, observar datos reales y detectar problemas antes de que se ven afectados todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-223">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="7c7d9-224">Un lanzamiento controlado es más complejo de administrar que una actualización gradual o azul-verde, ya que debe dirigir de forma dinámica las solicitudes a versiones distintas del servicio.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-224">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span> <span data-ttu-id="7c7d9-225">En Kubernetes, puede configurar un servicio para abarcar dos conjuntos de réplicas (uno para cada versión) y ajustar manualmente el número de réplicas.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-225">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="7c7d9-226">Sin embargo, este enfoque es bastante genérico, debido a la forma en que Kubernetes equilibra la carga entre los pods.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-226">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="7c7d9-227">Por ejemplo, si tiene un total de diez réplicas, solo puede cambiar el tráfico en incrementos del 10 %.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-227">For example, if you have a total of ten replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="7c7d9-228">Si utiliza una malla de servicio, puede utilizar las reglas de enrutamiento de malla de servicio para implementar una estrategia de lanzamiento controlado más sofisticada.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-228">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span> <span data-ttu-id="7c7d9-229">Aquí tiene algunos recursos que pueden serle de ayuda:</span><span class="sxs-lookup"><span data-stu-id="7c7d9-229">Here are some resources that may be helpful:</span></span>

- <span data-ttu-id="7c7d9-230">Kubernetes sin malla de servicio: [Implementaciones de lanzamiento controlado](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span><span class="sxs-lookup"><span data-stu-id="7c7d9-230">Kubernetes without service mesh: [Canary deployments](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span></span>
- <span data-ttu-id="7c7d9-231">Linkerd: [Enrutamiento de solicitud dinámica](https://linkerd.io/features/routing/)</span><span class="sxs-lookup"><span data-stu-id="7c7d9-231">Linkerd: [Dynamic request routing](https://linkerd.io/features/routing/)</span></span>
- <span data-ttu-id="7c7d9-232">Istio: [Implementaciones de lanzamiento controlado con Istio](https://istio.io/blog/canary-deployments-using-istio.html)</span><span class="sxs-lookup"><span data-stu-id="7c7d9-232">Istio: [Canary Deployments using Istio](https://istio.io/blog/canary-deployments-using-istio.html)</span></span>

## <a name="conclusion"></a><span data-ttu-id="7c7d9-233">Conclusión</span><span class="sxs-lookup"><span data-stu-id="7c7d9-233">Conclusion</span></span>

<span data-ttu-id="7c7d9-234">En los últimos años, ha habido un cambio drástico en el sector, al pasar de la creación de *sistemas de registro* a la creación de *sistemas de interacción*.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-234">In recent years, there has been a sea change in the industry, a movement from building *systems of record* to building *systems of engagement*.</span></span>

<span data-ttu-id="7c7d9-235">Los sistemas de registro son aplicaciones de administración de datos del área de operaciones tradicionales.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-235">Systems of record are traditional back-office data management applications.</span></span> <span data-ttu-id="7c7d9-236">Estos sistemas se basan en un sistema de administración de bases de datos relacionales, que es el único origen de datos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-236">At the heart of these systems there often sits an RDBMS that is the single source of truth.</span></span> <span data-ttu-id="7c7d9-237">El término "sistema de interacción" (System of Engagement) se atribuye a Geoffrey Moore, que lo acuñó en su trabajo *Systems of Engagement and the Future of Enterprise IT* de 2011.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-237">The term "system of engagement" is credited to Geoffrey Moore, in his 2011 paper *Systems of Engagement and the Future of Enterprise IT*.</span></span> <span data-ttu-id="7c7d9-238">Los sistemas de interacción son aplicaciones que se centran en la comunicación y la colaboración.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-238">Systems of engagement are applications focused on communication and collaboration.</span></span> <span data-ttu-id="7c7d9-239">Conectan personas en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-239">They connect people in real time.</span></span> <span data-ttu-id="7c7d9-240">Deben estar disponibles en todo momento.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-240">They must be available 24/7.</span></span> <span data-ttu-id="7c7d9-241">Se introducen periódicamente nuevas características sin tener que desconectar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-241">New features are introduced regularly without taking the application offline.</span></span> <span data-ttu-id="7c7d9-242">Los usuarios tienen mayores expectativas y menos paciencia con los retrasos o tiempos de inactividad inesperados.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-242">Users expect more and are less patient of unexpected delays or downtime.</span></span>

<span data-ttu-id="7c7d9-243">Para los consumidores, una mejor experiencia de usuario puede tener un valor cuantificable en el negocio.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-243">In the consumer space, a better user experience can have measurable business value.</span></span> <span data-ttu-id="7c7d9-244">La cantidad de tiempo que un usuario interactúe con una aplicación puede traducirse directamente en ingresos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-244">The amount of time that a user engages with an application may translate directly into revenue.</span></span> <span data-ttu-id="7c7d9-245">Además, en el mundo de los sistemas empresariales, las expectativas de los usuarios han cambiado.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-245">And in the realm of business systems, users' expectations have changed.</span></span> <span data-ttu-id="7c7d9-246">Si estos sistemas tienen como objetivo fomentar la comunicación y la colaboración, deben seguir el ejemplo de aplicaciones orientadas al consumidor.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-246">If these systems aim to foster communication and collaboration, they must take their cue from consumer-facing applications.</span></span>

<span data-ttu-id="7c7d9-247">Los microservicios ofrecen una respuesta a este panorama cambiante.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-247">Microservices are a response to this changing landscape.</span></span> <span data-ttu-id="7c7d9-248">Al descomponer una aplicación monolítica en un grupo de servicios con acoplamiento flexible, podemos controlar el ciclo de versiones de cada servicio y habilitar actualizaciones frecuentes sin tiempo de inactividad ni cambios drásticos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-248">By decomposing a monolithic application into a group of loosely coupled services, we can control the release cycle of each service, and enable frequent updates without downtime or breaking changes.</span></span> <span data-ttu-id="7c7d9-249">Los microservicios también ayudan con la escalabilidad, el aislamiento de errores y la resistencia.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-249">Microservices also help with scalability, failure isolation, and resiliency.</span></span> <span data-ttu-id="7c7d9-250">Mientras tanto, las plataformas en la nube permiten compilar y ejecutar microservicios cada vez más fácilmente, con aprovisionamiento automatizado de recursos de proceso, orquestadores de contenedor como servicio y entornos sin servidor basados en eventos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-250">Meanwhile, cloud platforms are making it easier to build and run microservices, with automated provisioning of compute resources, container orchestrators as a service, and event-driven serverless environments.</span></span>

<span data-ttu-id="7c7d9-251">No obstante, como hemos visto, las arquitecturas de microservicios también presentan una gran cantidad de desafíos.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-251">But as we've seen, microservices architectures also being a lot of challenges.</span></span> <span data-ttu-id="7c7d9-252">Para tener éxito, debe empezar con un diseño sólido.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-252">To succeed, you must start from a solid design.</span></span> <span data-ttu-id="7c7d9-253">Debe pensar detenidamente cómo analizar el dominio, elegir las tecnologías, modelar datos, diseñar API y crear una referencia cultural de DevOps consolidada.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-253">You must put careful thought into analyzing the domain, choosing technologies, modeling data, designing APIs, and building a mature DevOps culture.</span></span> <span data-ttu-id="7c7d9-254">Esperamos que esta guía y la [implementación de referencia](https://github.com/mspnp/microservices-reference-implementation) adjunta le hayan ayudado a aclarar el proceso.</span><span class="sxs-lookup"><span data-stu-id="7c7d9-254">We hope that this guide, and the accompanying [reference implementation](https://github.com/mspnp/microservices-reference-implementation), has helped to illuminate the journey.</span></span> 

