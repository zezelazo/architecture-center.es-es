---
title: Aplicación Windows de n niveles con SQL Server
titleSuffix: Azure Reference Architectures
description: Implemente una arquitectura de varios niveles en Azure para lograr una mayor disponibilidad, seguridad, escalabilidad y facilidad de uso.
author: MikeWasson
ms.date: 11/12/2018
ms.openlocfilehash: 38983dec83718f53fc1ffd79c1347582200f5db0
ms.sourcegitcommit: 88a68c7e9b6b772172b7faa4b9fd9c061a9f7e9d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/08/2018
ms.locfileid: "53120141"
---
# <a name="windows-n-tier-application-on-azure-with-sql-server"></a><span data-ttu-id="08719-103">Aplicación Windows de n niveles en Azure con SQL Server</span><span class="sxs-lookup"><span data-stu-id="08719-103">Windows N-tier application on Azure with SQL Server</span></span>

<span data-ttu-id="08719-104">Esta arquitectura de referencia muestra cómo implementar máquinas virtuales y una red virtual configurada para una aplicación de n niveles, con SQL Server en Windows para la capa de datos.</span><span class="sxs-lookup"><span data-stu-id="08719-104">This reference architecture shows how to deploy VMs and a virtual network configured for an N-tier application, using SQL Server on Windows for the data tier.</span></span> <span data-ttu-id="08719-105">[**Implemente esta solución**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="08719-105">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Arquitectura de n niveles con Microsoft Azure](./images/n-tier-sql-server.png)

<span data-ttu-id="08719-107">*Descargue un [archivo Visio][visio-download] de esta arquitectura.*</span><span class="sxs-lookup"><span data-stu-id="08719-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="08719-108">Arquitectura</span><span class="sxs-lookup"><span data-stu-id="08719-108">Architecture</span></span>

<span data-ttu-id="08719-109">La arquitectura consta de los siguientes componentes:</span><span class="sxs-lookup"><span data-stu-id="08719-109">The architecture has the following components:</span></span>

- <span data-ttu-id="08719-110">**Grupo de recursos**.</span><span class="sxs-lookup"><span data-stu-id="08719-110">**Resource group**.</span></span> <span data-ttu-id="08719-111">Los [grupos de recursos][resource-manager-overview] se utilizan para agrupar los recursos, para que puedan administrarse según su duración, su propietario u otros criterios.</span><span class="sxs-lookup"><span data-stu-id="08719-111">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>

- <span data-ttu-id="08719-112">**Red virtual (VNet) y subredes**.</span><span class="sxs-lookup"><span data-stu-id="08719-112">**Virtual network (VNet) and subnets**.</span></span> <span data-ttu-id="08719-113">Cada máquina virtual de Azure se implementa en una red virtual que se puede dividir en subredes.</span><span class="sxs-lookup"><span data-stu-id="08719-113">Every Azure VM is deployed into a VNet that can be segmented into subnets.</span></span> <span data-ttu-id="08719-114">Cree una subred independiente para cada nivel.</span><span class="sxs-lookup"><span data-stu-id="08719-114">Create a separate subnet for each tier.</span></span>

- <span data-ttu-id="08719-115">**Application Gateway**.</span><span class="sxs-lookup"><span data-stu-id="08719-115">**Application gateway**.</span></span> <span data-ttu-id="08719-116">[Azure Application Gateway](/azure/application-gateway/) es un equilibrador de carga de nivel 7.</span><span class="sxs-lookup"><span data-stu-id="08719-116">[Azure Application Gateway](/azure/application-gateway/) is a layer 7 load balancer.</span></span> <span data-ttu-id="08719-117">En esta arquitectura, enruta las solicitudes HTTP al front-end web.</span><span class="sxs-lookup"><span data-stu-id="08719-117">In this architecture, it routes HTTP requests to the web front end.</span></span> <span data-ttu-id="08719-118">Application Gateway proporciona también un [firewall de aplicaciones web](/azure/application-gateway/waf-overview) (WAF) que protege la aplicación contra puntos vulnerables de la seguridad comunes.</span><span class="sxs-lookup"><span data-stu-id="08719-118">Application Gateway also provides a [web application firewall](/azure/application-gateway/waf-overview) (WAF) that protects the application from common exploits and vulnerabilities.</span></span>

- <span data-ttu-id="08719-119">**NSG**.</span><span class="sxs-lookup"><span data-stu-id="08719-119">**NSGs**.</span></span> <span data-ttu-id="08719-120">Use [grupos de seguridad de red][nsg] (NSG) para restringir el tráfico de red dentro de la red virtual.</span><span class="sxs-lookup"><span data-stu-id="08719-120">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="08719-121">Por ejemplo, en la arquitectura de tres niveles que se muestra aquí, el nivel de base de datos no acepta el tráfico procedente del front-end web, solo el procedente del nivel de empresa y la subred de administración.</span><span class="sxs-lookup"><span data-stu-id="08719-121">For example, in the three-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>

- <span data-ttu-id="08719-122">**Protección contra DDoS**.</span><span class="sxs-lookup"><span data-stu-id="08719-122">**DDoS Protection**.</span></span> <span data-ttu-id="08719-123">Aunque la plataforma Azure proporciona protección básica contra ataques de denegación de servicio distribuido (DDoS), se recomienda usar el [estándar de protección contra DDoS][ddos], que tiene características de mitigación de DDoS.</span><span class="sxs-lookup"><span data-stu-id="08719-123">Although the Azure platform provides basic protection against distributed denial of service (DDoS) attacks, we recommend using [DDoS Protection Standard][ddos], which has enhanced DDoS mitigation features.</span></span> <span data-ttu-id="08719-124">Consulte [Consideraciones sobre la seguridad](#security-considerations).</span><span class="sxs-lookup"><span data-stu-id="08719-124">See [Security considerations](#security-considerations).</span></span>

- <span data-ttu-id="08719-125">**Máquinas virtuales**.</span><span class="sxs-lookup"><span data-stu-id="08719-125">**Virtual machines**.</span></span> <span data-ttu-id="08719-126">Para obtener recomendaciones sobre la configuración de máquinas virtuales, consulte [Ejecución de una VM con Windows en Azure](./windows-vm.md) y [Ejecución de una VM con Linux en Azure](./linux-vm.md).</span><span class="sxs-lookup"><span data-stu-id="08719-126">For recommendations on configuring VMs, see [Run a Windows VM on Azure](./windows-vm.md) and [Run a Linux VM on Azure](./linux-vm.md).</span></span>

- <span data-ttu-id="08719-127">**Conjuntos de disponibilidad**.</span><span class="sxs-lookup"><span data-stu-id="08719-127">**Availability sets**.</span></span> <span data-ttu-id="08719-128">Cree un [conjunto de disponibilidad][azure-availability-sets] y aprovisione al menos dos máquinas virtuales en cada nivel, que hace que las máquinas virtuales que sean aptas para un [Acuerdo de Nivel de Servicio (SLA)][vm-sla] superior.</span><span class="sxs-lookup"><span data-stu-id="08719-128">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier, which makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla].</span></span>

- <span data-ttu-id="08719-129">**Equilibradores de carga.**</span><span class="sxs-lookup"><span data-stu-id="08719-129">**Load balancers**.</span></span> <span data-ttu-id="08719-130">Use [Azure Load Balancer][load-balancer] para distribuir el tráfico de red desde el nivel web al nivel de empresa y desde el nivel de empresa a SQL Server.</span><span class="sxs-lookup"><span data-stu-id="08719-130">Use [Azure Load Balancer][load-balancer] to distribute network traffic from the web tier to the business tier, and from the business tier to SQL Server.</span></span>

- <span data-ttu-id="08719-131">**Dirección IP pública**.</span><span class="sxs-lookup"><span data-stu-id="08719-131">**Public IP address**.</span></span> <span data-ttu-id="08719-132">Se necesita una dirección IP pública para que la aplicación reciba el tráfico de Internet.</span><span class="sxs-lookup"><span data-stu-id="08719-132">A public IP address is needed for the application to receive Internet traffic.</span></span>

- <span data-ttu-id="08719-133">**JumpBox**.</span><span class="sxs-lookup"><span data-stu-id="08719-133">**Jumpbox**.</span></span> <span data-ttu-id="08719-134">También se denomina [host bastión].</span><span class="sxs-lookup"><span data-stu-id="08719-134">Also called a [bastion host].</span></span> <span data-ttu-id="08719-135">Se trata de una máquina virtual segura en la red que usan los administradores para conectarse al resto de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="08719-135">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="08719-136">El JumpBox tiene un NSG que solo permite el tráfico remoto que procede de direcciones IP públicas de una lista segura.</span><span class="sxs-lookup"><span data-stu-id="08719-136">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="08719-137">El NSG debe permitir el tráfico de escritorio remoto (RDP).</span><span class="sxs-lookup"><span data-stu-id="08719-137">The NSG should permit remote desktop (RDP) traffic.</span></span>

- <span data-ttu-id="08719-138">**Grupo de disponibilidad AlwaysOn de SQL Server**</span><span class="sxs-lookup"><span data-stu-id="08719-138">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="08719-139">Proporciona alta disponibilidad en el nivel de datos, al habilitar la replicación y la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="08719-139">Provides high availability at the data tier, by enabling replication and failover.</span></span> <span data-ttu-id="08719-140">Usa la tecnología de clúster de conmutación por error de Windows Server (WSFC) para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="08719-140">It uses Windows Server Failover Cluster (WSFC) technology for failover.</span></span>

- <span data-ttu-id="08719-141">**Servidores de Active Directory Domain Services (AD DS)**.</span><span class="sxs-lookup"><span data-stu-id="08719-141">**Active Directory Domain Services (AD DS) Servers**.</span></span> <span data-ttu-id="08719-142">Los objetos de equipo del clúster de conmutación por error y sus roles en clúster asociados se crean en Active Directory Domain Services (AD DS).</span><span class="sxs-lookup"><span data-stu-id="08719-142">The computer objects for the failover cluster and its associated clustered roles are created in Active Directory Domain Services (AD DS).</span></span>

- <span data-ttu-id="08719-143">**Testigo en la nube**.</span><span class="sxs-lookup"><span data-stu-id="08719-143">**Cloud Witness**.</span></span> <span data-ttu-id="08719-144">Un clúster de conmutación por error requiere que más de la mitad de sus nodos se estén ejecutando, lo que se conoce como tener cuórum.</span><span class="sxs-lookup"><span data-stu-id="08719-144">A failover cluster requires more than half of its nodes to be running, which is known as having quorum.</span></span> <span data-ttu-id="08719-145">Si el clúster tiene solo dos nodos, una partición de la red podría provocar que cada uno de ellos creyera que es el principal.</span><span class="sxs-lookup"><span data-stu-id="08719-145">If the cluster has just two nodes, a network partition could cause each node to think it's the master node.</span></span> <span data-ttu-id="08719-146">En ese caso, se necesita un *testigo* que sea quien dilucide cuál es el principal y establezca el cuórum.</span><span class="sxs-lookup"><span data-stu-id="08719-146">In that case, you need a *witness* to break ties and establish quorum.</span></span> <span data-ttu-id="08719-147">Un testigo es un recurso, como por ejemplo un disco compartido, que puede actuar como dilucidador para establecer el cuórum.</span><span class="sxs-lookup"><span data-stu-id="08719-147">A witness is a resource such as a shared disk that can act as a tie breaker to establish quorum.</span></span> <span data-ttu-id="08719-148">Un testigo en la nube es un tipo de testigo que usa Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="08719-148">Cloud Witness is a type of witness that uses Azure Blob Storage.</span></span> <span data-ttu-id="08719-149">Para más información acerca del concepto de quórum, consulte [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum) (Descripción del cuórum de clúster y de grupo).</span><span class="sxs-lookup"><span data-stu-id="08719-149">To learn more about the concept of quorum, see [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum).</span></span> <span data-ttu-id="08719-150">Para más información acerca del testigo en la nube, consulte [Implementación de un testigo en la nube en un clúster de conmutación por error](/windows-server/failover-clustering/deploy-cloud-witness).</span><span class="sxs-lookup"><span data-stu-id="08719-150">For more information about Cloud Witness, see [Deploy a Cloud Witness for a Failover Cluster](/windows-server/failover-clustering/deploy-cloud-witness).</span></span>

- <span data-ttu-id="08719-151">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="08719-151">**Azure DNS**.</span></span> <span data-ttu-id="08719-152">[Azure DNS][azure-dns] es un servicio de hospedaje para dominios DNS.</span><span class="sxs-lookup"><span data-stu-id="08719-152">[Azure DNS][azure-dns] is a hosting service for DNS domains.</span></span> <span data-ttu-id="08719-153">Proporciona resolución de nombres mediante la infraestructura de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="08719-153">It provides name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="08719-154">Al hospedar dominios en Azure, puede administrar los registros DNS con las mismas credenciales, API, herramientas y facturación que con los demás servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="08719-154">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>

## <a name="recommendations"></a><span data-ttu-id="08719-155">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="08719-155">Recommendations</span></span>

<span data-ttu-id="08719-156">Los requisitos pueden diferir de los de la arquitectura que se describe aquí.</span><span class="sxs-lookup"><span data-stu-id="08719-156">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="08719-157">Use estas recomendaciones como punto inicial.</span><span class="sxs-lookup"><span data-stu-id="08719-157">Use these recommendations as a starting point.</span></span>

### <a name="vnet--subnets"></a><span data-ttu-id="08719-158">Red virtual/subredes</span><span class="sxs-lookup"><span data-stu-id="08719-158">VNet / Subnets</span></span>

<span data-ttu-id="08719-159">Cuando cree la red virtual, determine cuántas direcciones IP requieren los recursos de cada subred.</span><span class="sxs-lookup"><span data-stu-id="08719-159">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="08719-160">Especifique una máscara de subred y un intervalo de direcciones de la red virtual lo suficientemente grande para la dirección IP requerida con el uso de la notación [CIDR].</span><span class="sxs-lookup"><span data-stu-id="08719-160">Specify a subnet mask and a VNet address range large enough for the required IP addresses, using [CIDR] notation.</span></span> <span data-ttu-id="08719-161">Use un espacio de direcciones que se encuentre dentro de los [bloques de direcciones IP privados][private-ip-space] estándar, que son 10.0.0.0/8, 172.16.0.0/12 y 192.168.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="08719-161">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="08719-162">Elija un intervalo de direcciones que no se superponga con la red local, en caso de que necesite configurar una puerta de enlace entre la red virtual y la red local más adelante.</span><span class="sxs-lookup"><span data-stu-id="08719-162">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premise network later.</span></span> <span data-ttu-id="08719-163">Una vez creada la red virtual, no se puede cambiar el intervalo de direcciones.</span><span class="sxs-lookup"><span data-stu-id="08719-163">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="08719-164">Diseñe subredes teniendo en cuenta los requisitos de funcionalidad y seguridad.</span><span class="sxs-lookup"><span data-stu-id="08719-164">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="08719-165">Todas las máquinas virtuales dentro del mismo nivel o rol deben incluirse en la misma subred, lo que puede servir como un límite de seguridad.</span><span class="sxs-lookup"><span data-stu-id="08719-165">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="08719-166">Para obtener más información sobre el diseño de redes virtuales y subredes, vea [Planeación y diseño de redes virtuales de Azure][plan-network].</span><span class="sxs-lookup"><span data-stu-id="08719-166">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

### <a name="load-balancers"></a><span data-ttu-id="08719-167">Equilibradores de carga</span><span class="sxs-lookup"><span data-stu-id="08719-167">Load balancers</span></span>

<span data-ttu-id="08719-168">No exponga las máquinas virtuales directamente a Internet; en su lugar, asigne una dirección IP privada a cada una.</span><span class="sxs-lookup"><span data-stu-id="08719-168">Don't expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="08719-169">El cliente se conecta mediante una dirección IP pública asociada a la puerta de enlace de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="08719-169">Clients connect using the public IP address  associated with the Application Gateway.</span></span>

<span data-ttu-id="08719-170">Defina reglas del equilibrador de carga para dirigir el tráfico de red a las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="08719-170">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="08719-171">Por ejemplo, para habilitar el tráfico HTTP, asigne el puerto 80 de la configuración de front-end al puerto 80 del grupo de direcciones de back-end.</span><span class="sxs-lookup"><span data-stu-id="08719-171">For example, to enable HTTP traffic, map port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="08719-172">Cuando un cliente envía una solicitud HTTP al puerto 80, el equilibrador de carga selecciona una dirección IP de back-end mediante un [algoritmo hash][load-balancer-hashing] que incluye la dirección IP de origen.</span><span class="sxs-lookup"><span data-stu-id="08719-172">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="08719-173">Las solicitudes del cliente se distribuyen entre todas las máquinas virtuales del grupo de direcciones de back-end.</span><span class="sxs-lookup"><span data-stu-id="08719-173">Client requests are distributed across all the VMs in the back-end address pool.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="08719-174">Grupos de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="08719-174">Network security groups</span></span>

<span data-ttu-id="08719-175">Use reglas NSG para restringir el tráfico entre los niveles.</span><span class="sxs-lookup"><span data-stu-id="08719-175">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="08719-176">En la arquitectura de tres niveles mostrada anteriormente, el nivel web no se comunica directamente con el nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="08719-176">In the three-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="08719-177">Para exigir esto, el nivel de base de datos debe bloquear el tráfico entrante desde la subred del nivel Web.</span><span class="sxs-lookup"><span data-stu-id="08719-177">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>

1. <span data-ttu-id="08719-178">Deniegue todo el tráfico entrante de la red virtual.</span><span class="sxs-lookup"><span data-stu-id="08719-178">Deny all inbound traffic from the VNet.</span></span> <span data-ttu-id="08719-179">(Use la etiqueta `VIRTUAL_NETWORK` de la regla).</span><span class="sxs-lookup"><span data-stu-id="08719-179">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span>
2. <span data-ttu-id="08719-180">Permita el tráfico entrante de la subred del nivel Business.</span><span class="sxs-lookup"><span data-stu-id="08719-180">Allow inbound traffic from the business tier subnet.</span></span>
3. <span data-ttu-id="08719-181">Permita el tráfico entrante de la propia subred del nivel de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="08719-181">Allow inbound traffic from the database tier subnet itself.</span></span> <span data-ttu-id="08719-182">Esta regla permite la comunicación entre las máquinas virtuales de la base de datos, lo cual es necesario para la replicación y la conmutación por error de esta.</span><span class="sxs-lookup"><span data-stu-id="08719-182">This rule allows communication between the database VMs, which is needed for database replication and failover.</span></span>
4. <span data-ttu-id="08719-183">Permita el tráfico RDP (puerto 3389) desde la subred de JumpBox.</span><span class="sxs-lookup"><span data-stu-id="08719-183">Allow RDP traffic (port 3389) from the jumpbox subnet.</span></span> <span data-ttu-id="08719-184">Esta regla permite a los administradores conectarse al nivel de base de datos desde JumpBox.</span><span class="sxs-lookup"><span data-stu-id="08719-184">This rule lets administrators connect to the database tier from the jumpbox.</span></span>

<span data-ttu-id="08719-185">Cree las reglas 2 &ndash; 4 con una prioridad más alta que la primera regla para que puedan invalidarla.</span><span class="sxs-lookup"><span data-stu-id="08719-185">Create rules 2 &ndash; 4 with higher priority than the first rule, so they override it.</span></span>

### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="08719-186">Grupos de disponibilidad AlwaysOn de SQL Server</span><span class="sxs-lookup"><span data-stu-id="08719-186">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="08719-187">Se recomiendan los [grupos de disponibilidad AlwaysOn][sql-alwayson] para alta disponibilidad de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="08719-187">We recommend [Always On Availability Groups][sql-alwayson] for SQL Server high availability.</span></span> <span data-ttu-id="08719-188">Antes de Windows Server 2016, los grupos de disponibilidad AlwaysOn requerían un controlador de dominio y todos los nodos del grupo de disponibilidad debían estar en el mismo dominio de AD.</span><span class="sxs-lookup"><span data-stu-id="08719-188">Prior to Windows Server 2016, Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same AD domain.</span></span>

<span data-ttu-id="08719-189">Otros niveles se conectan a la base de datos a través de una [escucha de grupo de disponibilidad][sql-alwayson-listeners].</span><span class="sxs-lookup"><span data-stu-id="08719-189">Other tiers connect to the database through an [availability group listener][sql-alwayson-listeners].</span></span> <span data-ttu-id="08719-190">La escucha permite a un cliente SQL conectarse sin conocer el nombre de la instancia física de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="08719-190">The listener enables a SQL client to connect without knowing the name of the physical instance of SQL Server.</span></span> <span data-ttu-id="08719-191">Las máquinas virtuales que acceden a la base de datos deben estar unidas al dominio.</span><span class="sxs-lookup"><span data-stu-id="08719-191">VMs that access the database must be joined to the domain.</span></span> <span data-ttu-id="08719-192">El cliente (en este caso, otro nivel) utiliza DNS para resolver el nombre de la red virtual de la escucha en direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="08719-192">The client (in this case, another tier) uses DNS to resolve the listener's virtual network name into IP addresses.</span></span>

<span data-ttu-id="08719-193">Configure el grupo de disponibilidad AlwaysOn de SQL Server como sigue:</span><span class="sxs-lookup"><span data-stu-id="08719-193">Configure the SQL Server Always On Availability Group as follows:</span></span>

1. <span data-ttu-id="08719-194">Cree un clúster de clústeres de conmutación por error de Windows Server (WSFC), un grupo de disponibilidad AlwaysOn de SQL Server y una réplica principal.</span><span class="sxs-lookup"><span data-stu-id="08719-194">Create a Windows Server Failover Clustering (WSFC) cluster, a SQL Server Always On Availability Group, and a primary replica.</span></span> <span data-ttu-id="08719-195">Para más información, vea [Introducción a Grupos de disponibilidad AlwaysOn][sql-alwayson-getting-started].</span><span class="sxs-lookup"><span data-stu-id="08719-195">For more information, see [Getting Started with Always On Availability Groups][sql-alwayson-getting-started].</span></span>
2. <span data-ttu-id="08719-196">Cree un equilibrador de carga interno con una dirección IP privada estática.</span><span class="sxs-lookup"><span data-stu-id="08719-196">Create an internal load balancer with a static private IP address.</span></span>
3. <span data-ttu-id="08719-197">Cree una escucha de grupo de disponibilidad y asigne el nombre DNS de la escucha a la dirección IP del equilibrador de carga interno.</span><span class="sxs-lookup"><span data-stu-id="08719-197">Create an availability group listener, and map the listener's DNS name to the IP address of an internal load balancer.</span></span>
4. <span data-ttu-id="08719-198">Cree una regla del equilibrador de carga para el puerto de escucha de SQL Server (puerto TCP 1433 de forma predeterminada).</span><span class="sxs-lookup"><span data-stu-id="08719-198">Create a load balancer rule for the SQL Server listening port (TCP port 1433 by default).</span></span> <span data-ttu-id="08719-199">La regla del equilibrador de carga debe habilitar la *IP flotante*, también denominada Direct Server Return.</span><span class="sxs-lookup"><span data-stu-id="08719-199">The load balancer rule must enable *floating IP*, also called Direct Server Return.</span></span> <span data-ttu-id="08719-200">Esto causa que la máquina virtual responda directamente al cliente, lo que permite establecer una conexión directa con la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="08719-200">This causes the VM to reply directly to the client, which enables a direct connection to the primary replica.</span></span>

   > [!NOTE]
   > <span data-ttu-id="08719-201">Cuando la IP flotante está habilitada, el número de puerto de front-end debe ser el mismo que el número de puerto de back-end en la regla del equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="08719-201">When floating IP is enabled, the front-end port number must be the same as the back-end port number in the load balancer rule.</span></span>
   >

<span data-ttu-id="08719-202">Cuando un cliente SQL intenta conectarse, el equilibrador de carga enruta la solicitud de conexión a la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="08719-202">When a SQL client tries to connect, the load balancer routes the connection request to the primary replica.</span></span> <span data-ttu-id="08719-203">Si se produce una conmutación por error a otra réplica, el equilibrador de carga enruta automáticamente las nuevas solicitudes a una nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="08719-203">If there is a failover to another replica, the load balancer automatically routes new requests to a new primary replica.</span></span> <span data-ttu-id="08719-204">Para más información, vea [Configuración de un equilibrador de carga para Grupos de disponibilidad AlwaysOn de SQL Server][sql-alwayson-ilb].</span><span class="sxs-lookup"><span data-stu-id="08719-204">For more information, see [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb].</span></span>

<span data-ttu-id="08719-205">Durante una conmutación por error, se cierran las conexiones de cliente existentes.</span><span class="sxs-lookup"><span data-stu-id="08719-205">During a failover, existing client connections are closed.</span></span> <span data-ttu-id="08719-206">Una vez completada la conmutación por error, las conexiones nuevas se enrutarán a la nueva réplica principal.</span><span class="sxs-lookup"><span data-stu-id="08719-206">After the failover completes, new connections will be routed to the new primary replica.</span></span>

<span data-ttu-id="08719-207">Si la aplicación realiza significativamente más lecturas que escrituras, puede descargar algunas de las consultas de solo lectura en una réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="08719-207">If your application makes significantly more reads than writes, you can offload some of the read-only queries to a secondary replica.</span></span> <span data-ttu-id="08719-208">Vea [Usar un agente de escucha para conectarse a una réplica secundaria de solo lectura (enrutamiento de solo lectura)][sql-alwayson-read-only-routing].</span><span class="sxs-lookup"><span data-stu-id="08719-208">See [Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)][sql-alwayson-read-only-routing].</span></span>

<span data-ttu-id="08719-209">Pruebe la implementación mediante el [forzado de una conmutación por error manual][sql-alwayson-force-failover] del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="08719-209">Test your deployment by [forcing a manual failover][sql-alwayson-force-failover] of the availability group.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="08719-210">JumpBox</span><span class="sxs-lookup"><span data-stu-id="08719-210">Jumpbox</span></span>

<span data-ttu-id="08719-211">No permita el acceso mediante RDP desde la red pública de Internet a las máquinas virtuales que ejecutan la carga de trabajo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="08719-211">Don't allow RDP access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="08719-212">En su lugar, todo el acceso RDP a estas máquinas virtuales debe realizarse a través de JumpBox.</span><span class="sxs-lookup"><span data-stu-id="08719-212">Instead, all RDP access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="08719-213">Un administrador inicia sesión en JumpBox y, después, en la otra máquina virtual desde JumpBox.</span><span class="sxs-lookup"><span data-stu-id="08719-213">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="08719-214">JumpBox permite el tráfico RDP desde Internet, pero solo desde direcciones IP conocidas y seguras.</span><span class="sxs-lookup"><span data-stu-id="08719-214">The jumpbox allows RDP traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="08719-215">JumpBox tiene unos requisitos de rendimiento mínimos, por lo que puede seleccionar un pequeño tamaño de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="08719-215">The jumpbox has minimal performance requirements, so select a small VM size.</span></span> <span data-ttu-id="08719-216">Cree una [dirección IP pública] para JumpBox.</span><span class="sxs-lookup"><span data-stu-id="08719-216">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="08719-217">Coloque JumpBox en la misma red virtual que las demás máquinas virtuales, pero en una subred de administración independiente.</span><span class="sxs-lookup"><span data-stu-id="08719-217">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="08719-218">Para proteger JumpBox, agregue una regla de grupo de seguridad de red que permita las conexiones RDP solo desde un conjunto seguro de direcciones IP públicas.</span><span class="sxs-lookup"><span data-stu-id="08719-218">To secure the jumpbox, add an NSG rule that allows RDP connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="08719-219">Configure el NSG para las demás subredes, a fin de permitir el tráfico RDP de la subred de administración.</span><span class="sxs-lookup"><span data-stu-id="08719-219">Configure the NSGs for the other subnets to allow RDP traffic from the management subnet.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="08719-220">Consideraciones sobre escalabilidad</span><span class="sxs-lookup"><span data-stu-id="08719-220">Scalability considerations</span></span>

<span data-ttu-id="08719-221">Para los niveles web y de empresa, considere la posibilidad de usar [conjuntos de escalado de máquinas virtuales][vmss], en lugar de implementar máquinas virtuales independientes en un conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="08719-221">For the web and business tiers, consider using [virtual machine scale sets][vmss], instead of deploying separate VMs into an availability set.</span></span> <span data-ttu-id="08719-222">Los conjuntos de escalado facilitan la implementación y administración de un conjunto de máquinas virtuales idénticas y el escalado automático de dichas máquinas en función de sus métricas de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="08719-222">A scale set makes it easy to deploy and manage a set of identical VMs, and autoscale the VMs based on performance metrics.</span></span> <span data-ttu-id="08719-223">A medida que aumenta la carga en las máquinas virtuales, se agregan más máquinas virtuales automáticamente al equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="08719-223">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="08719-224">Considere la posibilidad de usar conjuntos de escalado si necesita escalar horizontalmente las máquinas virtuales de inmediato o si necesita realizar el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="08719-224">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="08719-225">Hay dos maneras básicas de configurar máquinas virtuales implementadas en un conjunto de escalado:</span><span class="sxs-lookup"><span data-stu-id="08719-225">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="08719-226">Use extensiones para configurar la máquina virtual después de implementarla.</span><span class="sxs-lookup"><span data-stu-id="08719-226">Use extensions to configure the VM after it's deployed.</span></span> <span data-ttu-id="08719-227">Con este método, las nuevas instancias de máquina virtual pueden tardar más en iniciarse que una máquina virtual sin extensiones.</span><span class="sxs-lookup"><span data-stu-id="08719-227">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="08719-228">Implemente un [disco administrado](/azure/storage/storage-managed-disks-overview) con una imagen de disco personalizada.</span><span class="sxs-lookup"><span data-stu-id="08719-228">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="08719-229">Esta opción puede ser más rápida de implementar.</span><span class="sxs-lookup"><span data-stu-id="08719-229">This option may be quicker to deploy.</span></span> <span data-ttu-id="08719-230">Sin embargo, requiere que la imagen esté actualizada.</span><span class="sxs-lookup"><span data-stu-id="08719-230">However, it requires you to keep the image up-to-date.</span></span>

<span data-ttu-id="08719-231">Para más información, consulte [Consideraciones de diseño para conjuntos de escalado][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="08719-231">For more information, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="08719-232">Cuando utilice cualquier solución de escalado automático, pruébela con antelación con cargas de trabajo de nivel de producción.</span><span class="sxs-lookup"><span data-stu-id="08719-232">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="08719-233">Cada suscripción de Azure tiene límites predeterminados establecidos, incluido un número máximo de máquinas virtuales por región.</span><span class="sxs-lookup"><span data-stu-id="08719-233">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="08719-234">Puede aumentar el límite si rellena una solicitud de soporte técnico.</span><span class="sxs-lookup"><span data-stu-id="08719-234">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="08719-235">Para más información, consulte [Límites, cuotas y restricciones de suscripción y servicios de Microsoft Azure][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="08719-235">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="08719-236">Consideraciones sobre disponibilidad</span><span class="sxs-lookup"><span data-stu-id="08719-236">Availability considerations</span></span>

<span data-ttu-id="08719-237">Si no usa conjuntos de escalado de máquinas virtuales, coloque las máquinas virtuales del mismo nivel en un conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="08719-237">If you don't use virtual machine scale sets, put VMs for the same tier into an availability set.</span></span> <span data-ttu-id="08719-238">Cree al menos dos máquinas virtuales en el conjunto de disponibilidad, para admitir el [SLA de disponibilidad para máquinas virtuales de Azure][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="08719-238">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="08719-239">Para más información, consulte [Administración de la disponibilidad de las máquinas virtuales][availability-set].</span><span class="sxs-lookup"><span data-stu-id="08719-239">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> <span data-ttu-id="08719-240">Los conjuntos de escalado usan automáticamente *grupos de selección de ubicación*, que actúan como un conjunto de disponibilidad implícito.</span><span class="sxs-lookup"><span data-stu-id="08719-240">Scale sets automatically use *placement groups*, which act as an implicit availability set.</span></span>

<span data-ttu-id="08719-241">El equilibrador de carga usa [sondeos de mantenimiento][health-probes] para supervisar la disponibilidad de las instancias de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="08719-241">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="08719-242">Si un sondeo no puede acceder a una instancia antes de que expire, el equilibrador de carga deja de enviar tráfico a esa máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="08719-242">If a probe can't reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="08719-243">Sin embargo, el equilibrador de carga continuará con el sondeo y, si la máquina virtual vuelve a estar disponible, el equilibrador de carga reanudará el envío del tráfico a esa máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="08719-243">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="08719-244">A continuación, se presentan algunas recomendaciones sobre los sondeos de mantenimiento del equilibrador de carga:</span><span class="sxs-lookup"><span data-stu-id="08719-244">Here are some recommendations on load balancer health probes:</span></span>

- <span data-ttu-id="08719-245">Los sondeos pueden probar los protocolos HTTP o TCP.</span><span class="sxs-lookup"><span data-stu-id="08719-245">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="08719-246">Si las máquinas virtuales ejecutan un servidor HTTP, cree un sondeo HTTP.</span><span class="sxs-lookup"><span data-stu-id="08719-246">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="08719-247">De lo contrario, cree un sondeo TCP.</span><span class="sxs-lookup"><span data-stu-id="08719-247">Otherwise create a TCP probe.</span></span>
- <span data-ttu-id="08719-248">Para un sondeo HTTP, especifique la ruta de acceso a un punto de conexión HTTP.</span><span class="sxs-lookup"><span data-stu-id="08719-248">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="08719-249">El sondeo comprueba si hay una respuesta HTTP 200 desde esta ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="08719-249">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="08719-250">Puede ser la ruta de acceso raíz ("/") o un punto de conexión de supervisión de mantenimiento que implementa alguna lógica personalizada para comprobar el mantenimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="08719-250">This path can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="08719-251">El punto de conexión debe permitir solicitudes HTTP anónimas.</span><span class="sxs-lookup"><span data-stu-id="08719-251">The endpoint must allow anonymous HTTP requests.</span></span>
- <span data-ttu-id="08719-252">El sondeo se envía desde una [dirección IP conocida][health-probe-ip], 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="08719-252">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="08719-253">No bloquee el tráfico que llega a esta dirección IP, ni el que parte de ella, en las directivas de firewall o en las reglas del grupo de seguridad de red.</span><span class="sxs-lookup"><span data-stu-id="08719-253">Don't block traffic to or from this IP address in any firewall policies or NSG rules.</span></span>
- <span data-ttu-id="08719-254">Use [registros de sondeo de mantenimiento][health-probe-log] para ver el estado de los sondeos de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="08719-254">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="08719-255">Habilite el registro en Azure Portal para cada equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="08719-255">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="08719-256">Los registros se escriben en Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="08719-256">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="08719-257">Los registros muestran el número de máquinas virtuales que no reciben tráfico de red debido la falta de respuesta en los sondeos.</span><span class="sxs-lookup"><span data-stu-id="08719-257">The logs show how many VMs aren't getting network traffic because of failed probe responses.</span></span>

<span data-ttu-id="08719-258">Si necesita más disponibilidad de la que proporciona el [Acuerdo de Nivel de Servicio de Azure para máquinas virtuales][vm-sla], considere la replicación de la aplicación entre dos regiones y use Azure Traffic Manager para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="08719-258">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, consider replication the application across two regions, using Azure Traffic Manager for failover.</span></span> <span data-ttu-id="08719-259">Para más información, consulte [Aplicación de n niveles para varias regiones para obtener alta disponibilidad][multi-dc].</span><span class="sxs-lookup"><span data-stu-id="08719-259">For more information, see [Multi-region N-tier application for high availability][multi-dc].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="08719-260">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="08719-260">Security considerations</span></span>

<span data-ttu-id="08719-261">Las redes virtuales son un límite de aislamiento del tráfico de Azure.</span><span class="sxs-lookup"><span data-stu-id="08719-261">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="08719-262">Las máquinas virtuales de una red virtual no se pueden comunicar directamente con las de otra.</span><span class="sxs-lookup"><span data-stu-id="08719-262">VMs in one VNet can't communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="08719-263">Las máquinas virtuales que se encuentran en la misma red virtual se pueden comunicar entre sí, a menos que se creen [grupos de seguridad de red][nsg] (NSG) para restringir el tráfico.</span><span class="sxs-lookup"><span data-stu-id="08719-263">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="08719-264">Para más información, consulte [Servicios en la nube de Microsoft y seguridad de red][network-security].</span><span class="sxs-lookup"><span data-stu-id="08719-264">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="08719-265">**DMZ**.</span><span class="sxs-lookup"><span data-stu-id="08719-265">**DMZ**.</span></span> <span data-ttu-id="08719-266">Considere la posibilidad de agregar una aplicación virtual de red (NVA) para crear una red perimetral entre la red de Internet y la red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="08719-266">Consider adding a network virtual appliance (NVA) to create a DMZ between the Internet and the Azure virtual network.</span></span> <span data-ttu-id="08719-267">NVA es un término genérico para una aplicación virtual que puede realizar tareas relacionadas con la red, como firewall, inspección de paquetes, auditoría y enrutamiento personalizado.</span><span class="sxs-lookup"><span data-stu-id="08719-267">NVA is a generic term for a virtual appliance that can perform network-related tasks, such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="08719-268">Para más información, vea [Implementación de una red perimetral entre Internet y Azure][dmz].</span><span class="sxs-lookup"><span data-stu-id="08719-268">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

<span data-ttu-id="08719-269">**Cifrado**.</span><span class="sxs-lookup"><span data-stu-id="08719-269">**Encryption**.</span></span> <span data-ttu-id="08719-270">Cifre información confidencial en reposo y use [Azure Key Vault][azure-key-vault] para administrar las claves de cifrado de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="08719-270">Encrypt sensitive data at rest and use [Azure Key Vault][azure-key-vault] to manage the database encryption keys.</span></span> <span data-ttu-id="08719-271">Key Vault puede almacenar las claves de cifrado en módulos de seguridad de hardware (HSM).</span><span class="sxs-lookup"><span data-stu-id="08719-271">Key Vault can store encryption keys in hardware security modules (HSMs).</span></span> <span data-ttu-id="08719-272">Para más información, consulte [Configuración de la integración de Azure Key Vault para SQL Server en máquinas virtuales de Azure][sql-keyvault].</span><span class="sxs-lookup"><span data-stu-id="08719-272">For more information, see [Configure Azure Key Vault Integration for SQL Server on Azure VMs][sql-keyvault].</span></span> <span data-ttu-id="08719-273">También se recomienda almacenar los secretos de aplicación como, por ejemplo, las cadenas de conexión de base de datos, en Key Vault.</span><span class="sxs-lookup"><span data-stu-id="08719-273">It's also recommended to store application secrets, such as database connection strings, in Key Vault.</span></span>

<span data-ttu-id="08719-274">**DDoS Protection**.</span><span class="sxs-lookup"><span data-stu-id="08719-274">**DDoS protection**.</span></span> <span data-ttu-id="08719-275">De forma predeterminada, la plataforma Azure proporciona protección básica contra DDoS.</span><span class="sxs-lookup"><span data-stu-id="08719-275">The Azure platform provides basic DDoS protection by default.</span></span> <span data-ttu-id="08719-276">El objetivo de dicha es proteger la infraestructura de Azure en su conjunto.</span><span class="sxs-lookup"><span data-stu-id="08719-276">This basic protection is targeted at protecting the Azure infrastructure as a whole.</span></span> <span data-ttu-id="08719-277">Aunque la protección básica contra DDoS se habilita automáticamente, se recomienda usar [DDoS Protection Estándar][ddos].</span><span class="sxs-lookup"><span data-stu-id="08719-277">Although basic DDoS protection is automatically enabled, we recommend using [DDoS Protection Standard][ddos].</span></span> <span data-ttu-id="08719-278">Para detectar las amenazas, la protección estándar usa un ajuste que se puede adaptar en función de los patrones de tráfico de red de la aplicación,</span><span class="sxs-lookup"><span data-stu-id="08719-278">Standard protection uses adaptive tuning, based on your application's network traffic patterns, to detect threats.</span></span> <span data-ttu-id="08719-279">lo que le permite aplicar mitigaciones frente a ataques de denegación de servicio distribuido que podrían pasar desapercibidas para las directivas de DDoS para toda la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="08719-279">This allows it to apply mitigations against DDoS attacks that might go unnoticed by the infrastructure-wide DDoS policies.</span></span> <span data-ttu-id="08719-280">La protección estándar también proporciona alertas, telemetría y análisis a través de Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="08719-280">Standard protection also provides alerting, telemetry, and analytics through Azure Monitor.</span></span> <span data-ttu-id="08719-281">Para más información, consulte [Azure DDoS Protection: procedimientos recomendados y arquitecturas de referencia][ddos-best-practices].</span><span class="sxs-lookup"><span data-stu-id="08719-281">For more information, see [Azure DDoS Protection: Best practices and reference architectures][ddos-best-practices].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="08719-282">Implementación de la solución</span><span class="sxs-lookup"><span data-stu-id="08719-282">Deploy the solution</span></span>

<span data-ttu-id="08719-283">Hay disponible una implementación de esta arquitectura de referencia en [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="08719-283">A deployment for this reference architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="08719-284">La implementación completa puede tardar un máximo de dos horas, lo que incluye la ejecución de los scripts para configurar AD DS, el clúster de conmutación por error de Windows Server y el grupo de disponibilidad de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="08719-284">The entire deployment can take up to two hours, which includes running the scripts to configure AD DS, the Windows Server failover cluster, and the SQL Server availability group.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="08719-285">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="08719-285">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deployment-steps"></a><span data-ttu-id="08719-286">Pasos de implementación</span><span class="sxs-lookup"><span data-stu-id="08719-286">Deployment steps</span></span>

1. <span data-ttu-id="08719-287">Ejecute el siguiente comando para crear un grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="08719-287">Run the following command to create a resource group.</span></span>

    ```azurecli
    az group create --location <location> --name <resource-group-name>
    ```

2. <span data-ttu-id="08719-288">Ejecute el siguiente comando para crear una cuenta de almacenamiento para el testigo en la nube.</span><span class="sxs-lookup"><span data-stu-id="08719-288">Run the following command to create a Storage account for the Cloud Witness.</span></span>

    ```azurecli
    az storage account create --location <location> \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --sku Standard_LRS
    ```

3. <span data-ttu-id="08719-289">Vaya a la carpeta `virtual-machines\n-tier-windows` del repositorio de GitHub de las arquitecturas de referencia.</span><span class="sxs-lookup"><span data-stu-id="08719-289">Navigate to the `virtual-machines\n-tier-windows` folder of the reference architectures GitHub repository.</span></span>

4. <span data-ttu-id="08719-290">Abra el archivo `n-tier-windows.json` .</span><span class="sxs-lookup"><span data-stu-id="08719-290">Open the `n-tier-windows.json` file.</span></span>

5. <span data-ttu-id="08719-291">Busque todas las instancias de "witnessStorageBlobEndPoint" y reemplace el texto del marcador de posición por el nombre de la cuenta de almacenamiento del paso 2.</span><span class="sxs-lookup"><span data-stu-id="08719-291">Search for all instances of "witnessStorageBlobEndPoint" and replace the placeholder text with the name of the Storage account from step 2.</span></span>

    ```json
    "witnessStorageBlobEndPoint": "https://[replace-with-storageaccountname].blob.core.windows.net",
    ```

6. <span data-ttu-id="08719-292">Ejecute el siguiente comando para mostrar las claves de la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="08719-292">Run the following command to list the account keys for the storage account.</span></span>

    ```azurecli
    az storage account keys list \
      --account-name <storage-account-name> \
      --resource-group <resource-group-name>
    ```

    <span data-ttu-id="08719-293">La salida debe tener un aspecto similar al siguiente.</span><span class="sxs-lookup"><span data-stu-id="08719-293">The output should look like the following.</span></span> <span data-ttu-id="08719-294">Copie el valor de `key1`.</span><span class="sxs-lookup"><span data-stu-id="08719-294">Copy the value of `key1`.</span></span>

    ```json
    [
    {
        "keyName": "key1",
        "permissions": "Full",
        "value": "..."
    },
    {
        "keyName": "key2",
        "permissions": "Full",
        "value": "..."
    }
    ]
    ```

7. <span data-ttu-id="08719-295">En el archivo `n-tier-windows.json`, busque todas las instancias de "witnessStorageAccountKey" y pegue la clave de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="08719-295">In the `n-tier-windows.json` file, search for all instances of "witnessStorageAccountKey" and paste in the account key.</span></span>

    ```json
    "witnessStorageAccountKey": "[replace-with-storagekey]"
    ```

8. <span data-ttu-id="08719-296">En el archivo `n-tier-windows.json`, busque todas las instancias de `[replace-with-password]` y `[replace-with-sql-password]`, y reemplácelas por una contraseña segura.</span><span class="sxs-lookup"><span data-stu-id="08719-296">In the `n-tier-windows.json` file, search for all instances of `[replace-with-password]` and `[replace-with-sql-password]` replace them with a strong password.</span></span> <span data-ttu-id="08719-297">Guarde el archivo.</span><span class="sxs-lookup"><span data-stu-id="08719-297">Save the file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="08719-298">Si cambia el nombre de usuario del administrador, también debe actualizar los bloques `extensions` en el archivo JSON.</span><span class="sxs-lookup"><span data-stu-id="08719-298">If you change the adminstrator user name, you must also update the `extensions` blocks in the JSON file.</span></span>

9. <span data-ttu-id="08719-299">Ejecute el siguiente comando para implementar la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="08719-299">Run the following command to deploy the architecture.</span></span>

    ```azurecli
    azbb -s <your subscription_id> -g <resource_group_name> -l <location> -p n-tier-windows.json --deploy
    ```

<span data-ttu-id="08719-300">Para obtener más información sobre la implementación de esta arquitectura de referencia de ejemplo mediante Azure Bulding Blocks, visite el [repositorio de GitHub][git].</span><span class="sxs-lookup"><span data-stu-id="08719-300">For more information on deploying this sample reference architecture using Azure Building Blocks, visit the [GitHub repository][git].</span></span>

<!-- links -->
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-dc]: multi-region-sql-server.md
[n-tier]: n-tier.md
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-windows-manage-availability#configure-each-application-tier-into-separate-availability-sets
[azure-dns]: /azure/dns/dns-overview
[azure-key-vault]: https://azure.microsoft.com/services/key-vault
[host bastión]: https://en.wikipedia.org/wiki/Bastion_host
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[CIDR]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[cidr]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[ddos]: /azure/virtual-network/ddos-protection-overview
[ddos-best-practices]: /azure/security/azure-ddos-best-practices
[git]: https://github.com/mspnp/template-building-blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-windows
[nsg]: /azure/virtual-network/virtual-networks-nsg
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[Dirección IP pública]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[public IP address]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[sql-alwayson]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-alwayson-force-failover]: https://msdn.microsoft.com/library/ff877957.aspx
[sql-alwayson-getting-started]: https://msdn.microsoft.com/library/gg509118.aspx
[sql-alwayson-ilb]: /azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-alwayson-int-listener
[sql-alwayson-listeners]: https://msdn.microsoft.com/library/hh213417.aspx
[sql-alwayson-read-only-routing]: https://technet.microsoft.com/library/hh213417.aspx#ConnectToSecondary
[sql-keyvault]: /azure/virtual-machines/virtual-machines-windows-ps-sql-keyvault
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[wsfc-whats-new]: https://technet.microsoft.com/windows-server-docs/failover-clustering/whats-new-in-failover-clustering
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[load-balancer]: /azure/load-balancer/
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[subscription-limits]: /azure/azure-subscription-service-limits
[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[network-security]: /azure/best-practices-network-security
