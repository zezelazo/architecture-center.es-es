---
title: Arquitectura de referencia de Azure IoT
description: Arquitectura recomendada para aplicaciones de IoT en Azure que usa componentes de PaaS (plataforma como servicio)
titleSuffix: Azure Reference Architectures
author: MikeWasson
ms.date: 01/09/2019
ms.openlocfilehash: c0aa1771abc99b1f17f1e553c9626e50a386f34c
ms.sourcegitcommit: d5ea427c25f9f7799cc859b99f328739ca2d8c1c
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 01/15/2019
ms.locfileid: "54307695"
---
# <a name="azure-iot-reference-architecture"></a><span data-ttu-id="8be1e-103">Arquitectura de referencia de Azure IoT</span><span class="sxs-lookup"><span data-stu-id="8be1e-103">Azure IoT reference architecture</span></span>

<span data-ttu-id="8be1e-104">Esta arquitectura de referencia muestra una arquitectura recomendada para aplicaciones de IoT en Azure que usa componentes de PaaS (plataforma como servicio).</span><span class="sxs-lookup"><span data-stu-id="8be1e-104">This reference architecture shows a recommended architecture for IoT applications on Azure using PaaS (platform-as-a-service) components.</span></span>

![Diagrama de la arquitectura](./_images/iot.png)

<span data-ttu-id="8be1e-106">Las aplicaciones de IoT se pueden describir como **objetos** (dispositivos) que envían datos que generan **conclusiones**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-106">IoT applications can be described as **things** (devices) sending data that generates **insights**.</span></span> <span data-ttu-id="8be1e-107">Estas conclusiones generan **acciones** que sirven para mejorar un negocio o proceso.</span><span class="sxs-lookup"><span data-stu-id="8be1e-107">These insights generate **actions** to improve a business or process.</span></span> <span data-ttu-id="8be1e-108">Un ejemplo es un motor (el objeto) que envía datos de temperatura.</span><span class="sxs-lookup"><span data-stu-id="8be1e-108">An example is an engine (the thing) sending temperature data.</span></span> <span data-ttu-id="8be1e-109">Estos datos se utilizan para evaluar si el motor está funcionando según lo esperado (las conclusiones).</span><span class="sxs-lookup"><span data-stu-id="8be1e-109">This data is used to evaluate whether the engine is performing as expected (the insight).</span></span> <span data-ttu-id="8be1e-110">Las conclusiones se emplean para clasificar por orden de prioridad y de manera proactiva la programación de mantenimiento del motor (las acciones).</span><span class="sxs-lookup"><span data-stu-id="8be1e-110">The insight is used to proactively prioritize the maintenance schedule for the engine (the action).</span></span>

<span data-ttu-id="8be1e-111">Esta arquitectura de referencia usa componentes de PaaS (plataforma como servicio) de Azure.</span><span class="sxs-lookup"><span data-stu-id="8be1e-111">This reference architecture uses Azure PaaS (platform-as-a-service) components.</span></span> <span data-ttu-id="8be1e-112">Otras opciones para crear soluciones de IoT en Azure incluyen:</span><span class="sxs-lookup"><span data-stu-id="8be1e-112">Other options for building IoT solutions on Azure include:</span></span>

- <span data-ttu-id="8be1e-113">[Azure IoT Central](/azure/iot-central/).</span><span class="sxs-lookup"><span data-stu-id="8be1e-113">[Azure IoT Central](/azure/iot-central/).</span></span> <span data-ttu-id="8be1e-114">IoT Central es una solución SaaS (software como servicio) totalmente administrada.</span><span class="sxs-lookup"><span data-stu-id="8be1e-114">IoT Central is a fully managed SaaS (software-as-a-service) solution.</span></span> <span data-ttu-id="8be1e-115">Resume las opciones técnicas y le permite centrarse exclusivamente en la solución.</span><span class="sxs-lookup"><span data-stu-id="8be1e-115">It abstracts the technical choices and lets you focus on your solution exclusively.</span></span> <span data-ttu-id="8be1e-116">El inconveniente es que se trata de una solución menos personalizable que una solución basada en PaaS.</span><span class="sxs-lookup"><span data-stu-id="8be1e-116">This simplicity comes with a tradeoff in being less customizable than a PaaS-based solution.</span></span>
- <span data-ttu-id="8be1e-117">Uso de componentes de OSS como la pila de SMACK (Spark, Mesos, Akka, Cassandra, Kafka) que se implementan en máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="8be1e-117">Using OSS components such as the SMACK stack (Spark, Mesos, Akka, Cassandra, Kafka) deployed on Azure VMs.</span></span> <span data-ttu-id="8be1e-118">Este enfoque ofrece un buen grado de control, pero es más complejo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-118">This approach offers a great deal of control but is more complex.</span></span>

<span data-ttu-id="8be1e-119">A nivel general, existen dos maneras de procesar datos de telemetría, las rutas de acceso activas y las inactivas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-119">At a high level, there are two ways to process telemetry data, hot path and cold path.</span></span> <span data-ttu-id="8be1e-120">La diferencia tiene que ver con los requisitos de latencia y de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-120">The difference has to do with requirements for latency and data access.</span></span>

- <span data-ttu-id="8be1e-121">Las **rutas de acceso activas** analizan los datos según llegan, casi en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="8be1e-121">The **hot path** analyzes data in near-real-time, as it arrives.</span></span> <span data-ttu-id="8be1e-122">En las rutas de acceso activas, los datos de telemetría se deben procesar con una latencia muy baja.</span><span class="sxs-lookup"><span data-stu-id="8be1e-122">In the hot path, telemetry must be processed with very low latency.</span></span> <span data-ttu-id="8be1e-123">Una ruta de acceso activa se implementa normalmente mediante un motor de procesamiento de flujos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-123">The hot path is typically implemented using a stream processing engine.</span></span> <span data-ttu-id="8be1e-124">La salida puede desencadenar una alerta o escribirse en un formato estructurado que se puede consultar mediante herramientas de análisis.</span><span class="sxs-lookup"><span data-stu-id="8be1e-124">The output may trigger an alert, or be written to a structured format that can be queried using analytical tools.</span></span>
- <span data-ttu-id="8be1e-125">Las **rutas de acceso inactivas** realizan un procesamiento por lotes en intervalos más prolongados (cada hora o diariamente).</span><span class="sxs-lookup"><span data-stu-id="8be1e-125">The **cold path** performs batch processing at longer intervals (hourly or daily).</span></span> <span data-ttu-id="8be1e-126">La ruta de acceso inactiva se emplea normalmente con grandes volúmenes de datos, pero los resultados no se necesitan de manera tan urgente como en el caso de las rutas de acceso activas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-126">The cold path typically operates over large volumes of data, but the results don't need to be as timely as the hot path.</span></span> <span data-ttu-id="8be1e-127">En las rutas de acceso inactivas, se capturan los datos de telemetría sin procesar y, posteriormente, se introducen en un proceso por lotes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-127">In the cold path, raw telemetry is captured and then fed into a batch process.</span></span>

## <a name="architecture"></a><span data-ttu-id="8be1e-128">Arquitectura</span><span class="sxs-lookup"><span data-stu-id="8be1e-128">Architecture</span></span>

<span data-ttu-id="8be1e-129">Esta arquitectura consta de los siguientes componentes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-129">This architecture consists of the following components.</span></span> <span data-ttu-id="8be1e-130">Puede que algunas aplicaciones no requieran todos los componentes que se mencionan aquí.</span><span class="sxs-lookup"><span data-stu-id="8be1e-130">Some applications may not require every component listed here.</span></span>

<span data-ttu-id="8be1e-131">**Dispositivos IoT**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-131">**IoT devices**.</span></span> <span data-ttu-id="8be1e-132">Dispositivos se pueden registrar de forma segura con la nube y pueden conectarse a esta para enviar y recibir datos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-132">Devices can securely register with the cloud, and can connect to the cloud to send and receive data.</span></span> <span data-ttu-id="8be1e-133">Algunos dispositivos pueden ser **dispositivos perimetrales** que realizan algún tipo de procesamiento de datos en el propio dispositivo o en una puerta de enlace de campo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-133">Some devices may be **edge devices** that perform some data processing on the device itself or in a field gateway.</span></span> <span data-ttu-id="8be1e-134">Se recomienda usar [Azure IoT Edge](/azure/iot-edge/) para el procesamiento perimetral.</span><span class="sxs-lookup"><span data-stu-id="8be1e-134">We recommend [Azure IoT Edge](/azure/iot-edge/) for edge processing.</span></span>

<span data-ttu-id="8be1e-135">**Puerta de enlace en la nube**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-135">**Cloud gateway**.</span></span> <span data-ttu-id="8be1e-136">Una puerta de enlace en la nube proporciona un centro en la nube para que los dispositivos se conecten de forma segura a la nube y envíen datos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-136">A cloud gateway provides a cloud hub for devices to connect securely to the cloud and send data.</span></span> <span data-ttu-id="8be1e-137">También proporciona administración de dispositivos y funcionalidades como comandos o el control de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-137">It also provides device management, capabilities, including command and control of devices.</span></span> <span data-ttu-id="8be1e-138">Para la puerta de enlace en la nube, se recomienda [IoT Hub](/azure/iot-hub/).</span><span class="sxs-lookup"><span data-stu-id="8be1e-138">For the cloud gateway, we recommend [IoT Hub](/azure/iot-hub/).</span></span> <span data-ttu-id="8be1e-139">IoT Hub es un servicio hospedado en la nube que ingiere eventos de dispositivos y que actúa como un agente de mensajes entre los dispositivos y los servicios back-end.</span><span class="sxs-lookup"><span data-stu-id="8be1e-139">IoT Hub is a hosted cloud service that ingests events from devices, acting as a message broker between devices and backend services.</span></span> <span data-ttu-id="8be1e-140">IoT Hub proporciona conectividad segura, ingesta de eventos, comunicación bidireccional y administración de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-140">IoT Hub provides secure connectivity, event ingestion, bidirectional communication, and device management.</span></span>

<span data-ttu-id="8be1e-141">**Aprovisionamiento de dispositivos**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-141">**Device provisioning.**</span></span> <span data-ttu-id="8be1e-142">Para registrar y conectar grandes conjuntos de dispositivos, se recomienda usar [IoT Hub Device Provisioning Service](/azure/iot-dps/) (DPS).</span><span class="sxs-lookup"><span data-stu-id="8be1e-142">For registering and connecting large sets of devices, we recommend using the [IoT Hub Device Provisioning Service](/azure/iot-dps/) (DPS).</span></span> <span data-ttu-id="8be1e-143">DPS le permite asignar y registrar dispositivos en determinados puntos de conexión de Azure IoT Hub a escala.</span><span class="sxs-lookup"><span data-stu-id="8be1e-143">DPS lets you assign and register devices to specific Azure IoT Hub endpoints at scale.</span></span>

<span data-ttu-id="8be1e-144">**Procesamiento de flujos**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-144">**Stream processing**.</span></span> <span data-ttu-id="8be1e-145">El procesamiento de flujos analiza grandes flujos de registros de datos y evalúa las reglas de esos flujos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-145">Stream processing analyzes large streams of data records and evaluates rules for those streams.</span></span> <span data-ttu-id="8be1e-146">Para el procesamiento de flujos de datos se recomienda usar [Azure Stream Analytics](/azure/stream-analytics/).</span><span class="sxs-lookup"><span data-stu-id="8be1e-146">For stream processing, we recommend [Azure Stream Analytics](/azure/stream-analytics/).</span></span> <span data-ttu-id="8be1e-147">Stream Analytics puede ejecutar un análisis complejo a escala mediante funciones basadas en ventanas de tiempo, agregaciones de flujos y combinaciones de orígenes de datos externos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-147">Stream Analytics can execute complex analysis at scale, using time windowing functions, stream aggregations, and external data source joins.</span></span> <span data-ttu-id="8be1e-148">Otra opción es Apache Spark en [Azure Databricks](/azure/azure-databricks/).</span><span class="sxs-lookup"><span data-stu-id="8be1e-148">Another option is Apache Spark on [Azure Databricks](/azure/azure-databricks/).</span></span>

<span data-ttu-id="8be1e-149">El aprendizaje automático permite que se ejecuten algoritmos de predicción en datos de telemetría históricos, lo cual permite escenarios como el de mantenimiento predictivo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-149">Machine learning allows predictive algorithms to be executed over historical telemetry data, enabling scenarios such as predictive maintenance.</span></span> <span data-ttu-id="8be1e-150">Para el aprendizaje automático se recomienda usar el [servicio Azure Machine Learning](/azure/machine-learning/service/).</span><span class="sxs-lookup"><span data-stu-id="8be1e-150">For machine learning, we recommend [Azure Machine Learning Service](/azure/machine-learning/service/).</span></span>

<span data-ttu-id="8be1e-151">El **almacenamiento en rutas de acceso semiactivas** contiene los datos que deben estar disponibles inmediatamente desde el dispositivo para su uso en informes o su visualización.</span><span class="sxs-lookup"><span data-stu-id="8be1e-151">**Warm path storage** holds data that must be available immediately from device for reporting and visualization.</span></span> <span data-ttu-id="8be1e-152">Para el almacenamiento en rutas de acceso semiactivas, se recomienda [Cosmos DB](/azure/cosmos-db/introduction).</span><span class="sxs-lookup"><span data-stu-id="8be1e-152">For warm path storage, we recommend [Cosmos DB](/azure/cosmos-db/introduction).</span></span> <span data-ttu-id="8be1e-153">Cosmos DB es una base de datos de varios modelos distribuida de forma global.</span><span class="sxs-lookup"><span data-stu-id="8be1e-153">Cosmos DB is a globally distributed, multi-model database.</span></span>

<span data-ttu-id="8be1e-154">El **almacenamiento en rutas de acceso inactivas** contiene datos que hay que mantener a largo plazo y se usa para el procesamiento por lotes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-154">**Cold path storage** holds data that is kept longer term and is used for batch processing.</span></span> <span data-ttu-id="8be1e-155">Para este tipo de almacenamiento, se recomienda [Azure Blob Storage](/azure/storage/blobs/storage-blobs-introduction).</span><span class="sxs-lookup"><span data-stu-id="8be1e-155">For cold path storage, we recommend [Azure Blob Storage](/azure/storage/blobs/storage-blobs-introduction).</span></span> <span data-ttu-id="8be1e-156">Los datos se pueden archivar en Blob Storage de forma indefinida a bajo costo y son fácilmente accesibles para el procesamiento por lotes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-156">Data can be archived in Blob storage indefinitely at low cost, and is easily accessible for batch processing.</span></span>

<span data-ttu-id="8be1e-157">La **transformación de datos** permite manipular o agregar el flujo de datos de telemetría.</span><span class="sxs-lookup"><span data-stu-id="8be1e-157">**Data transformation** manipulates or aggregates the telemetry stream.</span></span> <span data-ttu-id="8be1e-158">Algunos ejemplos incluyen la transformación de protocolos como, por ejemplo, la conversión de datos binarios a JSON o la combinación de puntos de datos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-158">Examples include protocol transformation, such as converting binary data to JSON, or combining data points.</span></span> <span data-ttu-id="8be1e-159">Si los datos deben transformarse antes de llegar a IoT Hub, se recomienda usar una [puerta de enlace de protocolo](/azure/iot-hub/iot-hub-protocol-gateway) (no se muestra).</span><span class="sxs-lookup"><span data-stu-id="8be1e-159">If the data must be transformed before reaching IoT Hub, we recommend using a [protocol gateway](/azure/iot-hub/iot-hub-protocol-gateway) (not shown).</span></span> <span data-ttu-id="8be1e-160">En caso contrario, se pueden transformar los datos después de que lleguen a IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="8be1e-160">Otherwise, data can be transformed after it reaches IoT Hub.</span></span> <span data-ttu-id="8be1e-161">En ese caso, se recomienda usar [Azure Functions](/azure/azure-functions/).</span><span class="sxs-lookup"><span data-stu-id="8be1e-161">In that case, we recommend using [Azure Functions](/azure/azure-functions/).</span></span> <span data-ttu-id="8be1e-162">Functions dispone de integración incorporada con IoT Hub, Cosmos DB y Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="8be1e-162">Functions has built-in integration with IoT Hub, Cosmos DB, and Blob Storage.</span></span>

<span data-ttu-id="8be1e-163">La **integración de procesos empresariales** lleva a cabo acciones basadas en las conclusiones que se generan a partir de los datos del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-163">**Business process integration** performs actions based on insights from the device data.</span></span> <span data-ttu-id="8be1e-164">Esto puede incluir el almacenamiento de mensajes informativos, la generación de alarmas, el envío de mensajes de correo electrónico o de SMS, o la integración con CRM.</span><span class="sxs-lookup"><span data-stu-id="8be1e-164">This could include storing informational messages, raising alarms, sending email or SMS messages, or integrating with CRM.</span></span> <span data-ttu-id="8be1e-165">Se recomienda usar [Azure Logic Apps](/azure/logic-apps/logic-apps-overview) para la integración de procesos empresariales.</span><span class="sxs-lookup"><span data-stu-id="8be1e-165">We recommend using [Azure Logic Apps](/azure/logic-apps/logic-apps-overview) for business process integration.</span></span>

<span data-ttu-id="8be1e-166">La **administración de usuarios** restringe qué usuarios o grupos pueden realizar acciones en los dispositivos como, por ejemplo, actualizar el firmware.</span><span class="sxs-lookup"><span data-stu-id="8be1e-166">**User management** restricts which users or groups can perform actions on devices, such as upgrading firmware.</span></span> <span data-ttu-id="8be1e-167">También permite definir funcionalidades para los usuarios en las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="8be1e-167">It also defines capabilities for users in applications.</span></span> <span data-ttu-id="8be1e-168">Se recomienda usar [Azure Active Directory](/azure/active-directory/) para autenticar y autorizar a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="8be1e-168">We recommend using [Azure Active Directory](/azure/active-directory/) to authenticate and authorize users.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="8be1e-169">Consideraciones sobre escalabilidad</span><span class="sxs-lookup"><span data-stu-id="8be1e-169">Scalability considerations</span></span>

<span data-ttu-id="8be1e-170">Una aplicación de IoT se debe crear como servicios discretos que se pueden escalar de forma independiente.</span><span class="sxs-lookup"><span data-stu-id="8be1e-170">An IoT application should be built as discrete services that can scale independently.</span></span> <span data-ttu-id="8be1e-171">Tenga en cuenta los siguientes puntos de escalabilidad:</span><span class="sxs-lookup"><span data-stu-id="8be1e-171">Consider the following scalability points:</span></span>

<span data-ttu-id="8be1e-172">**IoTHub**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-172">**IoTHub**.</span></span> <span data-ttu-id="8be1e-173">Para IoT Hub, tenga en cuenta los siguientes factores de escala:</span><span class="sxs-lookup"><span data-stu-id="8be1e-173">For IoT Hub, consider the following scale factors:</span></span>

- <span data-ttu-id="8be1e-174">La [cuota diaria](/azure/iot-hub/iot-hub-devguide-quotas-throttling) máxima de mensajes en IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="8be1e-174">The maximum [daily quota](/azure/iot-hub/iot-hub-devguide-quotas-throttling) of messages into IoT Hub.</span></span>
- <span data-ttu-id="8be1e-175">La cuota de los dispositivos conectados en una instancia de IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="8be1e-175">The quota of connected devices in an IoT Hub instance.</span></span>
- <span data-ttu-id="8be1e-176">Rendimiento de ingesta: la rapidez con la que IoT Hub puede ingerir mensajes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-176">Ingestion throughput &mdash; how quickly IoT Hub can ingest messages.</span></span>
- <span data-ttu-id="8be1e-177">Rendimiento de procesamiento: la rapidez con la que se procesan los mensajes entrantes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-177">Processing throughput &mdash; how quickly the incoming messages are processed.</span></span>

<span data-ttu-id="8be1e-178">Cada instancia de IoT Hub se aprovisiona con un determinado número de unidades en un nivel determinado.</span><span class="sxs-lookup"><span data-stu-id="8be1e-178">Each IoT hub is provisioned with a certain number of units in a specific tier.</span></span> <span data-ttu-id="8be1e-179">El nivel y el número de unidades determinan la cuota diaria máxima de mensajes que los dispositivos pueden enviar al centro.</span><span class="sxs-lookup"><span data-stu-id="8be1e-179">The tier and number of units determine the maximum daily quota of messages that devices can send to the hub.</span></span> <span data-ttu-id="8be1e-180">Para más información, consulte las cuotas y limitaciones de IoT.</span><span class="sxs-lookup"><span data-stu-id="8be1e-180">For more information, see IoT Hub quotas and throttling.</span></span> <span data-ttu-id="8be1e-181">Se puede escalar verticalmente un centro sin interrumpir las operaciones existentes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-181">You can scale up a hub without interrupting existing operations.</span></span>

<span data-ttu-id="8be1e-182">**Stream Analytics**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-182">**Stream Analytics**.</span></span> <span data-ttu-id="8be1e-183">Los trabajos de Stream Analytics se escalan mejor si son paralelos en todos los puntos de la canalización de Stream Analytics, desde el de entrada al de consulta y al de salida.</span><span class="sxs-lookup"><span data-stu-id="8be1e-183">Stream Analytics jobs scale best if they are parallel at all points in the Stream Analytics pipeline, from input to query to output.</span></span> <span data-ttu-id="8be1e-184">Un trabajo totalmente paralelo permite a Stream Analytics dividir el trabajo entre varios nodos de proceso.</span><span class="sxs-lookup"><span data-stu-id="8be1e-184">A fully parallel job allows Stream Analytics to split the work across multiple compute nodes.</span></span> <span data-ttu-id="8be1e-185">En caso contrario, Stream Analytics tiene que combinar los datos del flujo en un solo lugar.</span><span class="sxs-lookup"><span data-stu-id="8be1e-185">Otherwise, Stream Analytics has to combine the stream data into one place.</span></span> <span data-ttu-id="8be1e-186">Para más información, consulte [Aprovechamiento de la paralelización de consultas en Azure Stream Analytics](/azure/stream-analytics/stream-analytics-parallelization).</span><span class="sxs-lookup"><span data-stu-id="8be1e-186">For more information, see [Leverage query parallelization in Azure Stream Analytics](/azure/stream-analytics/stream-analytics-parallelization).</span></span>

<span data-ttu-id="8be1e-187">IoT Hub realiza automáticamente particiones de los mensajes de dispositivo según el id. de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-187">IoT Hub automatically partitions device messages based on the device ID.</span></span> <span data-ttu-id="8be1e-188">Todos los mensajes de un dispositivo concreto llegarán siempre a la misma partición, aunque una única partición puede tener mensajes de varios dispositivos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-188">All of the messages from a particular device will always arrive on the same partition, but a single partition will have messages from multiple devices.</span></span> <span data-ttu-id="8be1e-189">Por tanto, la unidad de paralelización es el identificador de partición.</span><span class="sxs-lookup"><span data-stu-id="8be1e-189">Therefore, the unit of parallelization is the partition ID.</span></span>

<span data-ttu-id="8be1e-190">**Funciones**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-190">**Functions**.</span></span> <span data-ttu-id="8be1e-191">Cuando se lee desde el punto de conexión de Event Hubs, hay un máximo de instancias de funciones por cada partición del centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-191">When reading from the Event Hubs endpoint, there is a maximum of function instance per event hub partition.</span></span> <span data-ttu-id="8be1e-192">La velocidad máxima de procesamiento viene determinada por la velocidad con la que una instancia de función puede procesar los eventos procedentes de una única partición.</span><span class="sxs-lookup"><span data-stu-id="8be1e-192">The maximum processing rate is determined by how fast one function instance can process the events from a single partition.</span></span> <span data-ttu-id="8be1e-193">La función debe procesar los mensajes en lotes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-193">The function should process messages in batches.</span></span>

<span data-ttu-id="8be1e-194">**Cosmos DB**.</span><span class="sxs-lookup"><span data-stu-id="8be1e-194">**Cosmos DB**.</span></span> <span data-ttu-id="8be1e-195">Para escalar horizontalmente una colección de Cosmos DB, cree la colección con una clave de partición e inclúyala en cada documento que escriba.</span><span class="sxs-lookup"><span data-stu-id="8be1e-195">To scale out a Cosmos DB collection, create the collection with a partition key and include the partition key in each document that you write.</span></span> <span data-ttu-id="8be1e-196">Para más información, consulte [Procedimientos recomendados al elegir una clave de partición](/azure/cosmos-db/partition-data#best-practices-when-choosing-a-partition-key).</span><span class="sxs-lookup"><span data-stu-id="8be1e-196">For more information, see [Best practices when choosing a partition key](/azure/cosmos-db/partition-data#best-practices-when-choosing-a-partition-key).</span></span>

- <span data-ttu-id="8be1e-197">Si almacena y actualiza un documento único por dispositivo, el identificador de dispositivo es una buena clave de partición.</span><span class="sxs-lookup"><span data-stu-id="8be1e-197">If you store and update a single document per device, the device ID is a good partition key.</span></span> <span data-ttu-id="8be1e-198">Las escrituras se distribuyen uniformemente entre las claves.</span><span class="sxs-lookup"><span data-stu-id="8be1e-198">Writes are evenly distributed across the keys.</span></span> <span data-ttu-id="8be1e-199">El tamaño de cada partición está estrictamente limitado porque hay un solo documento para cada valor de clave.</span><span class="sxs-lookup"><span data-stu-id="8be1e-199">The size of each partition is strictly bounded, because there is a single document for each key value.</span></span>
- <span data-ttu-id="8be1e-200">Si almacena un documento independiente para cada mensaje de dispositivo, el hecho de usar el id. de dispositivo como clave de partición haría que se superara rápidamente el límite de 10 GB por partición.</span><span class="sxs-lookup"><span data-stu-id="8be1e-200">If you store a separate document for every device message, using the device ID as a partition key would quickly exceed the 10-GB limit per partition.</span></span> <span data-ttu-id="8be1e-201">En este caso, el identificador de mensaje sería una mejor clave de partición.</span><span class="sxs-lookup"><span data-stu-id="8be1e-201">Message ID is a better partition key in that case.</span></span> <span data-ttu-id="8be1e-202">Normalmente, seguiría incluyendo el id. de dispositivo en el documento con fines de indexación y consulta.</span><span class="sxs-lookup"><span data-stu-id="8be1e-202">Typically you would still include device ID in the document for indexing and querying.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="8be1e-203">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="8be1e-203">Security considerations</span></span>

### <a name="trustworthy-and-secure-communication"></a><span data-ttu-id="8be1e-204">Comunicación segura y confiable</span><span class="sxs-lookup"><span data-stu-id="8be1e-204">Trustworthy and secure communication</span></span>

<span data-ttu-id="8be1e-205">Toda la información que se recibe desde un dispositivo o que se envía a este debe ser de confianza.</span><span class="sxs-lookup"><span data-stu-id="8be1e-205">All information received from and sent to a device must be trustworthy.</span></span> <span data-ttu-id="8be1e-206">A menos que un dispositivo pueda admitir las siguientes funcionalidades criptográficas, se debería limitar a la comunicación con las redes locales y toda comunicación con Internet debería pasar a través de una puerta de enlace de campo:</span><span class="sxs-lookup"><span data-stu-id="8be1e-206">Unless a device can support the following cryptographic capabilities, it should be constrained to local networks and all internetwork communication should go through a field gateway:</span></span>

- <span data-ttu-id="8be1e-207">Cifrado de datos con un algoritmo de cifrado de claves simétricas posiblemente seguro, analizado públicamente y ampliamente implementado.</span><span class="sxs-lookup"><span data-stu-id="8be1e-207">Data encryption with a provably secure, publicly analyzed, and broadly implemented symmetric-key encryption algorithm.</span></span>
- <span data-ttu-id="8be1e-208">Firma digital con un algoritmo de firma de claves simétricas posiblemente seguro, analizado públicamente y ampliamente implementado.</span><span class="sxs-lookup"><span data-stu-id="8be1e-208">Digital signature with a provably secure, publicly analyzed, and broadly implemented symmetric-key signature algorithm.</span></span>
- <span data-ttu-id="8be1e-209">Compatibilidad con TLS 1.2 para TCP o con cualquier otra ruta de acceso de comunicación basada en flujos, o con DTLS 1.2 para rutas de acceso de comunicación basadas en datagramas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-209">Support for either TLS 1.2 for TCP or other stream-based communication paths or DTLS 1.2 for datagram-based communication paths.</span></span> <span data-ttu-id="8be1e-210">La compatibilidad con la administración de certificados X.509 es opcional y se puede sustituir por el modo de clave previamente compartida para TLS, que es más eficiente en el nivel de procesos y en el nivel inalámbrico, y que se puede implementar con compatibilidad con los algoritmos AES y SHA-2.</span><span class="sxs-lookup"><span data-stu-id="8be1e-210">Support of X.509 certificate handling is optional and can be replaced by the more compute-efficient and wire-efficient pre-shared key mode for TLS, which can be implemented with support for the AES and SHA-2 algorithms.</span></span>
- <span data-ttu-id="8be1e-211">Almacén de claves actualizable y claves por dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-211">Updateable key-store and per-device keys.</span></span> <span data-ttu-id="8be1e-212">Cada dispositivo debe contar con material o tokens de clave exclusivos que lo identifiquen en el sistema.</span><span class="sxs-lookup"><span data-stu-id="8be1e-212">Each device must have unique key material or tokens that identify it toward the system.</span></span> <span data-ttu-id="8be1e-213">Los dispositivos deben almacenar la clave de forma segura en el dispositivo (por ejemplo, con un almacén de claves seguro).</span><span class="sxs-lookup"><span data-stu-id="8be1e-213">The devices should store the key securely on the device (for example, using a secure key-store).</span></span> <span data-ttu-id="8be1e-214">El dispositivo debe ser capaz de actualizar las claves o tokens periódicamente, o como reacción en situaciones de emergencia como, por ejemplo, una infracción del sistema.</span><span class="sxs-lookup"><span data-stu-id="8be1e-214">The device should be able to update the keys or tokens periodically, or reactively in emergency situations such as a system breach.</span></span>
- <span data-ttu-id="8be1e-215">El firmware y el software de la aplicación del dispositivo deben permitir las actualizaciones para habilitar la reparación de las vulnerabilidades de seguridad descubiertas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-215">The firmware and application software on the device must allow for updates to enable the repair of discovered security vulnerabilities.</span></span>

<span data-ttu-id="8be1e-216">No obstante, muchos dispositivos están demasiado restringidos para admitir estos requisitos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-216">However, many devices are too constrained to support these requirements.</span></span> <span data-ttu-id="8be1e-217">En ese caso, debe usarse una puerta de enlace de campo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-217">In that case, a field gateway should be used.</span></span> <span data-ttu-id="8be1e-218">Los dispositivos se conectan de forma segura a la puerta de enlace de campo mediante una red de área local y la puerta de enlace permite una comunicación segura con la nube.</span><span class="sxs-lookup"><span data-stu-id="8be1e-218">Devices connect securely to the field gateway through a local area network, and the gateway enables secure communication to the cloud.</span></span>

### <a name="physical-tamper-proofing"></a><span data-ttu-id="8be1e-219">Corrección de alteraciones físicas</span><span class="sxs-lookup"><span data-stu-id="8be1e-219">Physical tamper proofing</span></span>

<span data-ttu-id="8be1e-220">Se recomienda encarecidamente que el diseño del dispositivo incorpore características que lo protejan contra cualquier intento de manipulación física, para ayudar a garantizar la integridad de la seguridad y la confiabilidad de todo el sistema.</span><span class="sxs-lookup"><span data-stu-id="8be1e-220">It is strongly recommended that device design incorporates features that defend against physical manipulation attempts, to help ensure the security integrity and trustworthiness of the overall system.</span></span>

<span data-ttu-id="8be1e-221">Por ejemplo: </span><span class="sxs-lookup"><span data-stu-id="8be1e-221">For example:</span></span>

- <span data-ttu-id="8be1e-222">Elija microcontroladores o microprocesadores, o hardware auxiliar que proporcione almacenamiento seguro y uso de material de clave criptográfica como, por ejemplo, la integración de un módulo de plataforma segura (TPM).</span><span class="sxs-lookup"><span data-stu-id="8be1e-222">Choose microcontrollers/microprocessors or auxiliary hardware that provide secure storage and use of cryptographic key material, such as trusted platform module (TPM) integration.</span></span>
- <span data-ttu-id="8be1e-223">Cargador de arranque y carga de software seguras, ancladas en el TPM.</span><span class="sxs-lookup"><span data-stu-id="8be1e-223">Secure boot loader and secure software loading, anchored in the TPM.</span></span>
- <span data-ttu-id="8be1e-224">Use sensores para detectar intentos de intrusión e intentos de manipular el entorno del dispositivo con alertas y una posible "autodestrucción digital" del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8be1e-224">Use sensors to detect intrusion attempts and attempts to manipulate the device environment with alerting and potentially “digital self-destruction” of the device.</span></span>

<span data-ttu-id="8be1e-225">Para otras consideraciones de seguridad, consulte [Arquitectura de seguridad de Internet de las cosas (IoT)](/azure/iot-fundamentals/iot-security-architecture).</span><span class="sxs-lookup"><span data-stu-id="8be1e-225">For additional security considerations, see [Internet of Things (IoT) security architecture](/azure/iot-fundamentals/iot-security-architecture).</span></span>

### <a name="monitoring-and-logging"></a><span data-ttu-id="8be1e-226">Supervisión y registro</span><span class="sxs-lookup"><span data-stu-id="8be1e-226">Monitoring and logging</span></span>

<span data-ttu-id="8be1e-227">Los sistemas de registro y supervisión se usan para determinar si la solución funciona y para ayudar a solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-227">Logging and monitoring systems are used to determine whether the solution is functioning and to help troubleshoot problems.</span></span> <span data-ttu-id="8be1e-228">Los sistemas de supervisión y registro ayudan a responder a las siguientes preguntas operativas:</span><span class="sxs-lookup"><span data-stu-id="8be1e-228">Monitoring and logging systems help answer the following operational questions:</span></span>

- <span data-ttu-id="8be1e-229">¿Se encuentran los dispositivos o sistemas en una condición de error?</span><span class="sxs-lookup"><span data-stu-id="8be1e-229">Are devices or systems in an error condition?</span></span>
- <span data-ttu-id="8be1e-230">¿Están configurados correctamente?</span><span class="sxs-lookup"><span data-stu-id="8be1e-230">Are devices or systems correctly configured?</span></span>
- <span data-ttu-id="8be1e-231">¿Generan los datos adecuados?</span><span class="sxs-lookup"><span data-stu-id="8be1e-231">Are devices or systems generating accurate data?</span></span>
- <span data-ttu-id="8be1e-232">¿Cumplen los sistemas las expectativas de la empresa y de los clientes finales?</span><span class="sxs-lookup"><span data-stu-id="8be1e-232">Are systems meeting the expectations of both the business and end customers?</span></span>

<span data-ttu-id="8be1e-233">Las herramientas de registro y supervisión se componen normalmente de los siguientes cuatro componentes:</span><span class="sxs-lookup"><span data-stu-id="8be1e-233">Logging and monitoring tools are typically comprised of the following four components:</span></span>

- <span data-ttu-id="8be1e-234">Herramientas de rendimiento del sistema y de visualización de la escala de tiempo para supervisar el sistema y poder solucionar problemas básicos.</span><span class="sxs-lookup"><span data-stu-id="8be1e-234">System performance and timeline visualization tools to monitor the system and for basic troubleshooting.</span></span>
- <span data-ttu-id="8be1e-235">Ingesta de datos almacenados en búfer para almacenar en búfer los datos de registro.</span><span class="sxs-lookup"><span data-stu-id="8be1e-235">Buffered data ingestion, to buffer log data.</span></span>
- <span data-ttu-id="8be1e-236">Almacenamiento persistente para almacenar datos de registro.</span><span class="sxs-lookup"><span data-stu-id="8be1e-236">Persistence store to store log data.</span></span>
- <span data-ttu-id="8be1e-237">Funcionalidades de búsqueda y consulta para visualizar los datos de registro para su uso en un proceso de solución de problemas en profundidad.</span><span class="sxs-lookup"><span data-stu-id="8be1e-237">Search and query capabilities, to view log data for use in detailed troubleshooting.</span></span>

<span data-ttu-id="8be1e-238">Los sistemas de supervisión proporcionan información sobre el estado, la seguridad, la estabilidad y el rendimiento de una solución de IoT.</span><span class="sxs-lookup"><span data-stu-id="8be1e-238">Monitoring systems provide insights into the health, security, and stability, and performance of an IoT solution.</span></span> <span data-ttu-id="8be1e-239">Estos sistemas también pueden proporcionar una vista más detallada, registrar cambios de configuración de los componentes y proporcionar datos de registro extraídos que pueden revelar posibles vulnerabilidades de seguridad, mejorar el proceso de administración de incidentes y ayudar al propietario del sistema a solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-239">These systems can also provide a more detailed view, recording component configuration changes and providing extracted logging data that can surface potential security vulnerabilities, enhance the incident management process, and help the owner of the system troubleshoot problems.</span></span> <span data-ttu-id="8be1e-240">Las soluciones integrales de supervisión incluyen la posibilidad de consultar la información de subsistemas concretos o de agregarla entre varios subsistemas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-240">Comprehensive monitoring solutions include the ability to query information for specific subsystems or aggregating across multiple subsystems.</span></span>

<span data-ttu-id="8be1e-241">El desarrollo del sistema de supervisión debe empezar por definir un funcionamiento correcto, el cumplimiento normativo y los requisitos de auditoría.</span><span class="sxs-lookup"><span data-stu-id="8be1e-241">Monitoring system development should begin by defining healthy operation, regulatory compliance, and audit requirements.</span></span> <span data-ttu-id="8be1e-242">Las métricas recopiladas pueden incluir:</span><span class="sxs-lookup"><span data-stu-id="8be1e-242">Metrics collected may include:</span></span>

- <span data-ttu-id="8be1e-243">Dispositivos físicos, dispositivos perimetrales y componentes de infraestructura que notifican cambios de configuración.</span><span class="sxs-lookup"><span data-stu-id="8be1e-243">Physical devices, edge devices, and infrastructure components reporting configuration changes.</span></span>
- <span data-ttu-id="8be1e-244">Aplicaciones que notifican cambios de configuración, registros de auditoría de seguridad, velocidad de solicitudes, tiempos de respuesta, tasas de error y estadísticas sobre recolección de elementos no utilizados para lenguajes administrados.</span><span class="sxs-lookup"><span data-stu-id="8be1e-244">Applications reporting configuration changes, security audit logs, request rates, response times, error rates, and garbage collection statistics for managed languages.</span></span>
- <span data-ttu-id="8be1e-245">Bases de datos, almacenes persistentes y memorias caché que informan sobre el rendimiento de las operaciones de consulta y escritura, los cambios de esquemas, los registros de auditoría de seguridad, los bloqueos e interbloqueos, el rendimiento de la indexación y el uso de la CPU, la memoria y el disco.</span><span class="sxs-lookup"><span data-stu-id="8be1e-245">Databases, persistence stores, and caches reporting query and write performance, schema changes, security audit log, locks or deadlocks, index performance, CPU, memory, and disk usage.</span></span>
- <span data-ttu-id="8be1e-246">Servicios administrados (IaaS, PaaS, SaaS, and FaaS) que informan sobre métricas de mantenimiento y cambios de configuración que afectan al estado y el rendimiento del sistema dependiente.</span><span class="sxs-lookup"><span data-stu-id="8be1e-246">Managed services (IaaS, PaaS, SaaS, and FaaS) reporting health metrics and configuration changes that impact dependent system health and performance.</span></span>

<span data-ttu-id="8be1e-247">La visualización de las métricas de supervisión sirve para alertar a los operadores sobre inestabilidades del sistema y facilitan la respuesta ante incidentes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-247">Visualization of monitoring metrics alert operators to system instabilities and facilitate incident response.</span></span>

### <a name="tracing-telemetry"></a><span data-ttu-id="8be1e-248">Seguimiento de los datos de telemetría</span><span class="sxs-lookup"><span data-stu-id="8be1e-248">Tracing telemetry</span></span>

<span data-ttu-id="8be1e-249">El seguimiento de los datos de telemetría permite a un operador seguir el recorrido de un fragmento de datos de telemetría desde la creación a través del sistema.</span><span class="sxs-lookup"><span data-stu-id="8be1e-249">Tracing telemetry allows an operator to follow the journey of a piece of telemetry from creation through the system.</span></span> <span data-ttu-id="8be1e-250">Este seguimiento es importante para los procesos de depuración y solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="8be1e-250">Tracing is important for debugging and troubleshooting.</span></span> <span data-ttu-id="8be1e-251">En el caso de las soluciones de IoT que usan Azure IoT Hub y los [SDK de dispositivos de IoT Hub](/azure/iot-hub/iot-hub-devguide-sdks), los datagramas de seguimiento se pueden originar como mensajes de la nube al dispositivo e incluir en el flujo de telemetría.</span><span class="sxs-lookup"><span data-stu-id="8be1e-251">For IoT solutions that use Azure IoT Hub and the [IoT Hub Device SDKs](/azure/iot-hub/iot-hub-devguide-sdks), tracing datagrams can be originated as Cloud-to-Device messages and included in the telemetry stream.</span></span>

### <a name="logging"></a><span data-ttu-id="8be1e-252">Registro</span><span class="sxs-lookup"><span data-stu-id="8be1e-252">Logging</span></span>

<span data-ttu-id="8be1e-253">Los sistemas de registro son una parte integral a la hora de comprender qué acciones o actividades ha realizado una solución, qué errores se han producido y puede proporcionar ayuda para solucionar esos errores.</span><span class="sxs-lookup"><span data-stu-id="8be1e-253">Logging systems are integral in understanding what actions or activities a solution has performed, failures that have occurred, and can provide help in fixing those failures.</span></span> <span data-ttu-id="8be1e-254">Los registros se pueden analizar para ayudar a entender y solucionar condiciones de error, mejorar las características de rendimiento y garantizar el cumplimiento con las normas y directrices vigentes.</span><span class="sxs-lookup"><span data-stu-id="8be1e-254">Logs can be analyzed to help understand and remedy error conditions, enhance performance characteristics, and ensure compliance with governing rule and regulations.</span></span>

<span data-ttu-id="8be1e-255">Aunque el registro de texto sin formato tiene un menor impacto en los costos de desarrollo iniciales, es más difícil de analizar y leer por parte de una máquina.</span><span class="sxs-lookup"><span data-stu-id="8be1e-255">Though plain-text logging is lower impact on upfront development costs, it is more challenging for a machine to parse/read.</span></span> <span data-ttu-id="8be1e-256">Se recomienda usar el registro estructurado, ya que la información recopilada resulta analizable para una máquina y legible para los usuarios.</span><span class="sxs-lookup"><span data-stu-id="8be1e-256">We recommend structured logging be used, as collected information is both machine parsable and human readable.</span></span> <span data-ttu-id="8be1e-257">El registro estructurado agrega contexto situacional y metadatos a la información del registro.</span><span class="sxs-lookup"><span data-stu-id="8be1e-257">Structured logging adds situational context and metadata to the log information.</span></span> <span data-ttu-id="8be1e-258">En el registro estructurado, las propiedades son el elemento principal, tienen un formato de pares clave-valor y se emplean con un esquema fijo para mejorar las funcionalidades de búsqueda y consulta.</span><span class="sxs-lookup"><span data-stu-id="8be1e-258">In structured logging, properties are first class citizens formatted as key/value pairs, or with a fixed schema, to enhance search and query capabilities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8be1e-259">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="8be1e-259">Next steps</span></span>

- <span data-ttu-id="8be1e-260">Para un análisis más detallado de la arquitectura y las opciones de implementación más recomendables, consulte el archivo PDF [Arquitectura de referencia de IoT de Microsoft Azure](http://aka.ms/iotrefarchitecture).</span><span class="sxs-lookup"><span data-stu-id="8be1e-260">For a more detailed discussion of the recommended architecture and implementation choices, see [Microsoft Azure IoT Reference Architecture](http://aka.ms/iotrefarchitecture) (PDF).</span></span>

- <span data-ttu-id="8be1e-261">Para obtener documentación detallada sobre los distintos servicios de IoT de Azure, consulte [Aspectos básicos de IoT de Azure](/azure/iot-fundamentals/).</span><span class="sxs-lookup"><span data-stu-id="8be1e-261">For detailed documentation of the various Azure IoT services, see [Azure IoT Fundamentals](/azure/iot-fundamentals/).</span></span>
