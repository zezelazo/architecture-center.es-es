---
title: 'Integración empresarial mediante colas de mensajes y eventos: Azure Integration Services'
description: Esta referencia de arquitectura muestra cómo puede implementar un patrón de integración empresarial con Azure Logic Apps, Azure API Management, Azure Service Bus y Azure Event Grid
author: mattfarm
ms.author: mattfarm
ms.reviewer: jonfan, estfan, LADocs
ms.topic: article
ms.date: 12/03/2018
ms.openlocfilehash: 6a4d7ce81dfae48f760693a4fc875d5ad59abe3a
ms.sourcegitcommit: e7e0e0282fa93f0063da3b57128ade395a9c1ef9
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/05/2018
ms.locfileid: "52919110"
---
# <a name="enterprise-integration-on-azure-using-message-queues-and-events"></a><span data-ttu-id="74123-103">Integración empresarial en Azure mediante colas de mensajes y eventos</span><span class="sxs-lookup"><span data-stu-id="74123-103">Enterprise integration on Azure using message queues and events</span></span>

<span data-ttu-id="74123-104">Esta arquitectura integra sistemas de back-end empresariales y usa las colas de mensajes y los eventos para desacoplar los servicios, con el fin de aumentar la escalabilidad y la fiabilidad.</span><span class="sxs-lookup"><span data-stu-id="74123-104">This architecture integrates enterprise backend systems, using message queues and events to decouple services for greater scalability and reliability.</span></span> <span data-ttu-id="74123-105">Los sistemas de back-end pueden incluir sistemas de software como servicio (SaaS), servicios de Azure y servicios web existentes de su empresa.</span><span class="sxs-lookup"><span data-stu-id="74123-105">The backend systems may include software as a service (SaaS) systems, Azure services, and existing web services in your enterprise.</span></span>

![Diagrama de arquitectura: integración empresarial con colas y eventos](./_images/enterprise-integration-queues-events.png)

## <a name="architecture"></a><span data-ttu-id="74123-107">Arquitectura</span><span class="sxs-lookup"><span data-stu-id="74123-107">Architecture</span></span>

<span data-ttu-id="74123-108">La arquitectura que se muestra aquí se basa en una arquitectura más sencilla que se muestra en el artículo [Integración empresarial básica en Azure][basic-enterprise-integration].</span><span class="sxs-lookup"><span data-stu-id="74123-108">The architecture shown here builds on a simpler architecture that is shown in [Basic enterprise integration][basic-enterprise-integration].</span></span> <span data-ttu-id="74123-109">Dicha arquitectura usa [Logic Apps][logic-apps] para organizar los flujos de trabajo y [API Management][apim] para crear catálogos de API.</span><span class="sxs-lookup"><span data-stu-id="74123-109">That architecture uses [Logic Apps][logic-apps] to orchestrate workflows and [API Management][apim] to create catalogs of APIs.</span></span>

<span data-ttu-id="74123-110">Esta versión de la arquitectura agrega dos componentes que ayudan a que el sistema sea más confiable y escalable:</span><span class="sxs-lookup"><span data-stu-id="74123-110">This version of the architecture adds two components that help make the system more reliable and scalable:</span></span>

- <span data-ttu-id="74123-111">**[Azure Service Bus][service-bus]**.</span><span class="sxs-lookup"><span data-stu-id="74123-111">**[Azure Service Bus][service-bus]**.</span></span> <span data-ttu-id="74123-112">Service Bus es un agente de mensajes seguro y confiable.</span><span class="sxs-lookup"><span data-stu-id="74123-112">Service Bus is a secure, reliable message broker.</span></span>  

- <span data-ttu-id="74123-113">**[Azure Event Grid][event-grid]**.</span><span class="sxs-lookup"><span data-stu-id="74123-113">**[Azure Event Grid][event-grid]**.</span></span> <span data-ttu-id="74123-114">Event Grid es un servicio de enrutamiento de eventos.</span><span class="sxs-lookup"><span data-stu-id="74123-114">Event Grid is an event routing service.</span></span> <span data-ttu-id="74123-115">Usa un modelo de generación de eventos de publicación o suscripción (pub o sub).</span><span class="sxs-lookup"><span data-stu-id="74123-115">It uses a publish/subscribe (pub/sub) eventing model.</span></span>

<span data-ttu-id="74123-116">La comunicación asincrónica mediante un agente de mensajes proporciona una serie de ventajas con respecto a la realización de llamadas directas, sincrónicas a servicios de back-end:</span><span class="sxs-lookup"><span data-stu-id="74123-116">Asynchronous communication using a message broker provides a number of advantages over making direct, synchronous calls to backend services:</span></span>

- <span data-ttu-id="74123-117">Proporciona la nivelación de carga para controlar los picos de cargas de trabajo, mediante el [patrón de nivelación de carga basado en cola](../../patterns/queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="74123-117">Provides load-leveling to handle bursts in workloads, using the [Queue-Based Load Leveling pattern](../../patterns/queue-based-load-leveling.md).</span></span>
- <span data-ttu-id="74123-118">Realiza un seguimiento confiable del progreso de los flujos de trabajo de ejecución prolongada que implican varios pasos o varias aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="74123-118">Reliably tracks the progress of long-running workflows that involve multiple steps or multiple applications.</span></span>
- <span data-ttu-id="74123-119">Ayuda a desacoplar aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="74123-119">Helps to decouple applications.</span></span>
- <span data-ttu-id="74123-120">Se integra con los sistemas existentes basados en mensajes.</span><span class="sxs-lookup"><span data-stu-id="74123-120">Integrates with existing message-based systems.</span></span>
- <span data-ttu-id="74123-121">Permite poner en cola el trabajo cuando algún sistema de back-end no está disponible.</span><span class="sxs-lookup"><span data-stu-id="74123-121">Allows work to be queued when a backend system is not available.</span></span>

<span data-ttu-id="74123-122">Event Grid permite a los distintos componentes en el sistema reaccionar ante eventos cuando estos se produzcan, en lugar de confiar en sondeos o tareas programadas.</span><span class="sxs-lookup"><span data-stu-id="74123-122">Event Grid enables the various components in the system to react to events as they happen, rather than relying on polling or scheduled tasks.</span></span> <span data-ttu-id="74123-123">Igual que hace una cola de mensajes, le ayuda a desacoplar aplicaciones y servicios.</span><span class="sxs-lookup"><span data-stu-id="74123-123">As with a message queue, it helps decouple applications and services.</span></span> <span data-ttu-id="74123-124">Una aplicación o un servicio puede publicar eventos y todos los suscriptores interesados recibirán notificaciones.</span><span class="sxs-lookup"><span data-stu-id="74123-124">An application or service can publish events, and any interested subscribers will be notified.</span></span> <span data-ttu-id="74123-125">Se pueden agregar suscriptores sin actualizar al remitente.</span><span class="sxs-lookup"><span data-stu-id="74123-125">New subscribers can be added without updating the sender.</span></span>

<span data-ttu-id="74123-126">Muchos servicios de Azure admiten el envío de eventos a Event Grid.</span><span class="sxs-lookup"><span data-stu-id="74123-126">Many Azure services support sending events to Event Grid.</span></span> <span data-ttu-id="74123-127">Por ejemplo, una aplicación lógica puede escuchar un evento cuando se agregan nuevos archivos a un almacén de blobs.</span><span class="sxs-lookup"><span data-stu-id="74123-127">For example, a logic app can listen for an event when new files are added to a blob store.</span></span> <span data-ttu-id="74123-128">Este patrón permite los flujos de trabajo reactivos, donde cargar un archivo o poner un mensaje en una cola inicia una serie de procesos.</span><span class="sxs-lookup"><span data-stu-id="74123-128">This pattern enables reactive workflows, where uploading a file or putting a message on a queue kicks off a series of processes.</span></span> <span data-ttu-id="74123-129">Los procesos se pueden ejecutar en paralelo o en una secuencia concreta.</span><span class="sxs-lookup"><span data-stu-id="74123-129">The processes might be executed in parallel or in a specific sequence.</span></span> 

## <a name="recommendations"></a><span data-ttu-id="74123-130">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="74123-130">Recommendations</span></span>

<span data-ttu-id="74123-131">Las recomendaciones que se describen en el artículo [Integración empresarial básica en Azure][basic-enterprise-integration] se aplican a esta arquitectura.</span><span class="sxs-lookup"><span data-stu-id="74123-131">The recommendations described in [Basic enterprise integration][basic-enterprise-integration] apply to this architecture.</span></span> <span data-ttu-id="74123-132">También se aplican las siguientes recomendaciones:</span><span class="sxs-lookup"><span data-stu-id="74123-132">The following recommendations also apply:</span></span>

### <a name="service-bus"></a><span data-ttu-id="74123-133">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="74123-133">Service Bus</span></span> 

<span data-ttu-id="74123-134">Service Bus tiene dos modos de entrega, *extracción* o *inserción*.</span><span class="sxs-lookup"><span data-stu-id="74123-134">Service Bus has two delivery modes, *pull* or *push*.</span></span> <span data-ttu-id="74123-135">En el modelo de extracción, el receptor realiza sondeos de continuamente para detectar mensajes nuevos.</span><span class="sxs-lookup"><span data-stu-id="74123-135">In the pull model, the receiver continuously polls for new messages.</span></span> <span data-ttu-id="74123-136">El sondeo puede ser ineficaz, sobre todo si hay varias colas y cada una de ellas recibe unos pocos mensajes, o si pasa mucho tiempo entre los mensajes.</span><span class="sxs-lookup"><span data-stu-id="74123-136">Polling can be inefficient, especially if you have many queues that each receive a few messages, or if there a lot of time between messages.</span></span> <span data-ttu-id="74123-137">En el modelo de inserción, Service Bus envía un evento a través de Event Grid cuando hay mensajes nuevos.</span><span class="sxs-lookup"><span data-stu-id="74123-137">In the push model, Service Bus sends an event through Event Grid when there are new messages.</span></span> <span data-ttu-id="74123-138">El receptor se suscribe al evento.</span><span class="sxs-lookup"><span data-stu-id="74123-138">The receiver subscribes to the event.</span></span> <span data-ttu-id="74123-139">Cuando se desencadena el evento, el receptor extrae el siguiente lote de mensajes de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="74123-139">When the event is triggered, the receiver pulls the next batch of messages from Service Bus.</span></span> 

<span data-ttu-id="74123-140">Cuando se crea una aplicación lógica para consumir mensajes de Service Bus, se recomienda usar el modelo de inserción con la integración de Event Grid.</span><span class="sxs-lookup"><span data-stu-id="74123-140">When you create a logic app to consume Service Bus messages, we recommend using the push model with Event Grid integration.</span></span> <span data-ttu-id="74123-141">A menudo resulta más económico, ya que la aplicación lógica no necesita sondear Service Bus.</span><span class="sxs-lookup"><span data-stu-id="74123-141">It's often more cost efficient, because the logic app doesn't need to poll Service Bus.</span></span> <span data-ttu-id="74123-142">Para más información, consulte [Introducción a la integración de Azure Service Bus en Event Grid](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept).</span><span class="sxs-lookup"><span data-stu-id="74123-142">For more information, see [Azure Service Bus to Event Grid integration overview](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept).</span></span> <span data-ttu-id="74123-143">En la actualidad, se requiere el [nivel Premium](https://azure.microsoft.com/pricing/details/service-bus/) de Service Bus para las notificaciones de Event Grid.</span><span class="sxs-lookup"><span data-stu-id="74123-143">Currently, Service Bus [Premium tier](https://azure.microsoft.com/pricing/details/service-bus/) is required for Event Grid notifications.</span></span>

<span data-ttu-id="74123-144">Use [PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) para acceder a un grupo de mensajes.</span><span class="sxs-lookup"><span data-stu-id="74123-144">Use [PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) for accessing a group of messages.</span></span> <span data-ttu-id="74123-145">Cuando usa PeekLock, la aplicación lógica puede realizar los pasos necesarios para validar cada mensaje antes de completar o abandonar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="74123-145">When you use PeekLock, the logic app can perform steps to validate each message before completing or abandoning the message.</span></span> <span data-ttu-id="74123-146">Este enfoque protege contra la pérdida accidental de datos.</span><span class="sxs-lookup"><span data-stu-id="74123-146">This approach protects against accidental message loss.</span></span>

### <a name="event-grid"></a><span data-ttu-id="74123-147">Event Grid</span><span class="sxs-lookup"><span data-stu-id="74123-147">Event Grid</span></span> 

<span data-ttu-id="74123-148">Cuando se activa un desencadenador de Event Grid, significa que se ha producido *al menos un* evento.</span><span class="sxs-lookup"><span data-stu-id="74123-148">When an Event Grid trigger fires, it means *at least one* event happened.</span></span> <span data-ttu-id="74123-149">Por ejemplo, cuando una aplicación lógica recibe un desencadenador de Event Grid en un mensaje de Service Bus, debe asumir que varios mensajes puedan estar disponibles para procesarlos.</span><span class="sxs-lookup"><span data-stu-id="74123-149">For example, when a logic app gets an Event Grid triggers for a Service Bus message, it should assume that several messages might be available to process.</span></span>

<span data-ttu-id="74123-150">Event Grid usa un modelo sin servidor.</span><span class="sxs-lookup"><span data-stu-id="74123-150">Event Grid uses a serverless model.</span></span> <span data-ttu-id="74123-151">La facturación se calcula en función del número de operaciones (ejecuciones de eventos).</span><span class="sxs-lookup"><span data-stu-id="74123-151">Billing is calculated based on the number of operations (event executions).</span></span> <span data-ttu-id="74123-152">Para más información, consulte [Precios de Event Grid](https://azure.microsoft.com/pricing/details/event-grid/).</span><span class="sxs-lookup"><span data-stu-id="74123-152">For more information, see [Event Grid pricing](https://azure.microsoft.com/pricing/details/event-grid/).</span></span> <span data-ttu-id="74123-153">Actualmente no existen consideraciones sobre los niveles en Event Grid.</span><span class="sxs-lookup"><span data-stu-id="74123-153">Currently, there are no tier considerations for Event Grid.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="74123-154">Consideraciones sobre escalabilidad</span><span class="sxs-lookup"><span data-stu-id="74123-154">Scalability considerations</span></span>

<span data-ttu-id="74123-155">El nivel Premium de Service Bus puede escalar horizontalmente el número de unidades de mensajería para alcanzar una mayor escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="74123-155">To achieve higher scalability, the Service Bus Premium tier can scale out the number of messaging units.</span></span> <span data-ttu-id="74123-156">Las configuraciones de nivel Premium pueden tener una, dos o cuatro unidades de mensajería.</span><span class="sxs-lookup"><span data-stu-id="74123-156">Premium tier configurations can have one, two, or four messaging units.</span></span> <span data-ttu-id="74123-157">Para más información sobre el escalado de Service Bus, consulte [Procedimientos recomendados para mejorar el rendimiento mediante la mensajería de Service Bus](/azure/service-bus-messaging/service-bus-performance-improvements).</span><span class="sxs-lookup"><span data-stu-id="74123-157">For more information about scaling Service Bus, see [Best practices for performance improvements by using Service Bus Messaging](/azure/service-bus-messaging/service-bus-performance-improvements).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="74123-158">Consideraciones sobre disponibilidad</span><span class="sxs-lookup"><span data-stu-id="74123-158">Availability considerations</span></span>

<span data-ttu-id="74123-159">Revise el SLA de cada servicio:</span><span class="sxs-lookup"><span data-stu-id="74123-159">Review the SLA for each service:</span></span>

- <span data-ttu-id="74123-160">[SLA de API Management][apim-sla]</span><span class="sxs-lookup"><span data-stu-id="74123-160">[API Management SLA][apim-sla]</span></span>
- <span data-ttu-id="74123-161">[Acuerdo de Nivel de Servicio de Event Grid][event-grid-sla]</span><span class="sxs-lookup"><span data-stu-id="74123-161">[Event Grid SLA][event-grid-sla]</span></span>
- <span data-ttu-id="74123-162">[Acuerdo de Nivel de Servicio de Logic Apps][logic-apps-sla]</span><span class="sxs-lookup"><span data-stu-id="74123-162">[Logic Apps SLA][logic-apps-sla]</span></span>
- <span data-ttu-id="74123-163">[Acuerdo de Nivel de Servicio de Service Bus][sb-sla]</span><span class="sxs-lookup"><span data-stu-id="74123-163">[Service Bus SLA][sb-sla]</span></span>

<span data-ttu-id="74123-164">Considere la posibilidad de implementar la recuperación ante desastres geográfica en el nivel Premium de Service Bus para habilitar la conmutación por error si se produce una interrupción grave.</span><span class="sxs-lookup"><span data-stu-id="74123-164">To enable failover if a serious outage occurs, consider implementing geo-disaster recovery in Service Bus Premium.</span></span> <span data-ttu-id="74123-165">Para más información, consulte [Recuperación ante desastres geográfica de Azure Service Bus](/azure/service-bus-messaging/service-bus-geo-dr).</span><span class="sxs-lookup"><span data-stu-id="74123-165">For more information, see [Azure Service Bus geo-disaster recovery](/azure/service-bus-messaging/service-bus-geo-dr).</span></span>

## <a name="security-considerations"></a><span data-ttu-id="74123-166">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="74123-166">Security considerations</span></span>

<span data-ttu-id="74123-167">Proteja Service Bus con una firma de acceso compartido (SAS).</span><span class="sxs-lookup"><span data-stu-id="74123-167">To secure Service Bus, use shared access signature (SAS).</span></span> <span data-ttu-id="74123-168">Puede usar la [autenticación de SAS](/azure/service-bus-messaging/service-bus-sas) para conceder acceso a un usuario a los recursos de Service Bus con derechos específicos.</span><span class="sxs-lookup"><span data-stu-id="74123-168">You can grant a user access to Service Bus resources with specific rights by using [SAS authentication](/azure/service-bus-messaging/service-bus-sas).</span></span> <span data-ttu-id="74123-169">Para más información, consulte [Autenticación y autorización de Service Bus](/azure/service-bus-messaging/service-bus-authentication-and-authorization).</span><span class="sxs-lookup"><span data-stu-id="74123-169">For more information, see [Service Bus authentication and authorization](/azure/service-bus-messaging/service-bus-authentication-and-authorization).</span></span>

<span data-ttu-id="74123-170">Si necesita exponer una cola de Service Bus como un punto de conexión de HTTP para, por ejemplo, publicar nuevos mensajes, use API Management para proteger la cola por delante del punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="74123-170">If you need to expose a Service Bus queue as an HTTP endpoint, for example, to post new messages, use API Management to secure the queue by fronting the endpoint.</span></span> <span data-ttu-id="74123-171">El punto de conexión se puede proteger con certificados o con autenticación de OAuth, según corresponda.</span><span class="sxs-lookup"><span data-stu-id="74123-171">You can then secure the endpoint with certificates or OAuth authentication as appropriate.</span></span> <span data-ttu-id="74123-172">La manera más sencilla de proteger un punto de conexión es mediante una aplicación lógica con un desencadenador HTTP de solicitud o respuesta como intermediario.</span><span class="sxs-lookup"><span data-stu-id="74123-172">The easiest way to secure an endpoint is using a logic app with an HTTP request/response trigger as an intermediary.</span></span>

<span data-ttu-id="74123-173">El servicio Event Grid protege la entrega de eventos con un código de validación.</span><span class="sxs-lookup"><span data-stu-id="74123-173">The Event Grid service secures event delivery through a validation code.</span></span> <span data-ttu-id="74123-174">Si usa Logic Apps para consumir el evento, la validación se realiza automáticamente.</span><span class="sxs-lookup"><span data-stu-id="74123-174">If you use Logic Apps to consume the event, validation is automatically performed.</span></span> <span data-ttu-id="74123-175">Para más información, vea [Event Grid security and authentication](/azure/event-grid/security-authentication) (Seguridad y autenticación de Event Grid).</span><span class="sxs-lookup"><span data-stu-id="74123-175">For more information, see [Event Grid security and authentication](/azure/event-grid/security-authentication).</span></span>


[apim]: /azure/api-management
[apim-sla]: https://azure.microsoft.com/support/legal/sla/api-management/
[event-grid]: /azure/event-grid/
[event-grid-sla]: https://azure.microsoft.com/support/legal/sla/event-grid
[logic-apps]: /azure/logic-apps/logic-apps-overview
[logic-apps-sla]: https://azure.microsoft.com/support/legal/sla/logic-apps
[sb-sla]: https://azure.microsoft.com/support/legal/sla/service-bus/
[service-bus]: /azure/service-bus-messaging/
[basic-enterprise-integration]: ./basic-enterprise-integration.md