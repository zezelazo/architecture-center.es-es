---
title: Conexión de una red local a Azure mediante ExpressRoute
titleSuffix: Azure Reference Architectures
description: Implementación de una arquitectura de red de sitio a sitio segura que extienda una red virtual de Azure y una red local conectada mediante Azure ExpressRoute.
author: telmosampaio
ms.date: 10/22/2017
ms.custom: seodec18
ms.openlocfilehash: 8e9de168fe2969159f62ce84a19f4b21fd1cb538
ms.sourcegitcommit: 88a68c7e9b6b772172b7faa4b9fd9c061a9f7e9d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/08/2018
ms.locfileid: "53120397"
---
# <a name="connect-an-on-premises-network-to-azure-using-expressroute"></a><span data-ttu-id="e8d73-103">Conexión de una red local a Azure mediante ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="e8d73-103">Connect an on-premises network to Azure using ExpressRoute</span></span>

<span data-ttu-id="e8d73-104">Esta arquitectura de referencia muestra cómo conectar una red local a las redes virtuales en Azure, mediante [Azure ExpressRoute][expressroute-introduction].</span><span class="sxs-lookup"><span data-stu-id="e8d73-104">This reference architecture shows how to connect an on-premises network to virtual networks on Azure, using [Azure ExpressRoute][expressroute-introduction].</span></span> <span data-ttu-id="e8d73-105">Las conexiones de ExpressRoute utilizan una conexión privada y dedicada a través de un proveedor de conectividad de terceros.</span><span class="sxs-lookup"><span data-stu-id="e8d73-105">ExpressRoute connections use a private, dedicated connection through a third-party connectivity provider.</span></span> <span data-ttu-id="e8d73-106">La conexión privada extiende la red local en Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-106">The private connection extends your on-premises network into Azure.</span></span> <span data-ttu-id="e8d73-107">[**Implemente esta solución**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="e8d73-107">[**Deploy this solution**](#deploy-the-solution).</span></span>

<span data-ttu-id="e8d73-108">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="e8d73-108">![[0]][0]</span></span>

<span data-ttu-id="e8d73-109">*Descargue un [archivo Visio][visio-download] de esta arquitectura.*</span><span class="sxs-lookup"><span data-stu-id="e8d73-109">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="e8d73-110">Arquitectura</span><span class="sxs-lookup"><span data-stu-id="e8d73-110">Architecture</span></span>

<span data-ttu-id="e8d73-111">La arquitectura consta de los siguientes componentes:</span><span class="sxs-lookup"><span data-stu-id="e8d73-111">The architecture consists of the following components.</span></span>

- <span data-ttu-id="e8d73-112">**Red corporativa local**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-112">**On-premises corporate network**.</span></span> <span data-ttu-id="e8d73-113">Una red de área local privada que se ejecuta dentro de una organización.</span><span class="sxs-lookup"><span data-stu-id="e8d73-113">A private local-area network running within an organization.</span></span>

- <span data-ttu-id="e8d73-114">**Circuito ExpressRoute**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-114">**ExpressRoute circuit**.</span></span> <span data-ttu-id="e8d73-115">Un circuito de capa 2 o capa 3 suministrado por el proveedor de conectividad que se une a la red local con Azure a través de los enrutadores perimetrales.</span><span class="sxs-lookup"><span data-stu-id="e8d73-115">A layer 2 or layer 3 circuit supplied by the connectivity provider that joins the on-premises network with Azure through the edge routers.</span></span> <span data-ttu-id="e8d73-116">El circuito usa la infraestructura de hardware administrada por el proveedor de conectividad.</span><span class="sxs-lookup"><span data-stu-id="e8d73-116">The circuit uses the hardware infrastructure managed by the connectivity provider.</span></span>

- <span data-ttu-id="e8d73-117">**Enrutadores perimetrales locales**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-117">**Local edge routers**.</span></span> <span data-ttu-id="e8d73-118">Enrutadores que conectan la red local al circuito administrado por el proveedor.</span><span class="sxs-lookup"><span data-stu-id="e8d73-118">Routers that connect the on-premises network to the circuit managed by the provider.</span></span> <span data-ttu-id="e8d73-119">En función de cómo se aprovisione la conexión, debe proporcionar las direcciones IP públicas utilizadas por los enrutadores.</span><span class="sxs-lookup"><span data-stu-id="e8d73-119">Depending on how your connection is provisioned, you may need to provide the public IP addresses used by the routers.</span></span>
- <span data-ttu-id="e8d73-120">**Enrutadores perimetrales de Microsoft**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-120">**Microsoft edge routers**.</span></span> <span data-ttu-id="e8d73-121">Dos enrutadores en una configuración de alta disponibilidad activa/activa.</span><span class="sxs-lookup"><span data-stu-id="e8d73-121">Two routers in an active-active highly available configuration.</span></span> <span data-ttu-id="e8d73-122">Estos enrutadores permiten a un proveedor de conectividad conectar sus circuitos directamente a su centro de datos.</span><span class="sxs-lookup"><span data-stu-id="e8d73-122">These routers enable a connectivity provider to connect their circuits directly to their datacenter.</span></span> <span data-ttu-id="e8d73-123">En función de cómo se aprovisione la conexión, debe proporcionar las direcciones IP públicas utilizadas por los enrutadores.</span><span class="sxs-lookup"><span data-stu-id="e8d73-123">Depending on how your connection is provisioned, you may need to provide the public IP addresses used by the routers.</span></span>

- <span data-ttu-id="e8d73-124">**Redes virtuales Azure (VNets)**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-124">**Azure virtual networks (VNets)**.</span></span> <span data-ttu-id="e8d73-125">Cada red virtual se encuentra en una sola región de Azure y puede hospedar varios niveles de aplicación.</span><span class="sxs-lookup"><span data-stu-id="e8d73-125">Each VNet resides in a single Azure region, and can host multiple application tiers.</span></span> <span data-ttu-id="e8d73-126">Los niveles de aplicación se pueden segmentar con subredes en cada red virtual.</span><span class="sxs-lookup"><span data-stu-id="e8d73-126">Application tiers can be segmented using subnets in each VNet.</span></span>

- <span data-ttu-id="e8d73-127">**Servicios públicos de Azure**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-127">**Azure public services**.</span></span> <span data-ttu-id="e8d73-128">Servicios de Azure que pueden usarse en una aplicación híbrida.</span><span class="sxs-lookup"><span data-stu-id="e8d73-128">Azure services that can be used within a hybrid application.</span></span> <span data-ttu-id="e8d73-129">Estos servicios también están disponibles a través de Internet, pero acceder a ellos mediante un circuito ExpressRoute proporciona baja latencia y un rendimiento más predecible, ya que el tráfico no pasa a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="e8d73-129">These services are also available over the Internet, but accessing them using an ExpressRoute circuit provides low latency and more predictable performance, because traffic does not go through the Internet.</span></span> <span data-ttu-id="e8d73-130">Las conexiones se realizan mediante [emparejamiento público][expressroute-peering], con direcciones que son propiedad de su organización o proporcionadas por el proveedor de conectividad.</span><span class="sxs-lookup"><span data-stu-id="e8d73-130">Connections are performed using [public peering][expressroute-peering], with addresses that are either owned by your organization or supplied by your connectivity provider.</span></span>

- <span data-ttu-id="e8d73-131">**Servicios de Office 365**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-131">**Office 365 services**.</span></span> <span data-ttu-id="e8d73-132">Aplicaciones y servicios de Office 365 disponibles públicamente y proporcionados por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e8d73-132">The publicly available Office 365 applications and services provided by Microsoft.</span></span> <span data-ttu-id="e8d73-133">Las conexiones se realizan mediante [emparejamiento de Microsoft][expressroute-peering], con direcciones que son propiedad de su organización o proporcionadas por el proveedor de conectividad.</span><span class="sxs-lookup"><span data-stu-id="e8d73-133">Connections are performed using [Microsoft peering][expressroute-peering], with addresses that are either owned by your organization or supplied by your connectivity provider.</span></span> <span data-ttu-id="e8d73-134">También puede conectarse directamente a Microsoft CRM Online a través del emparejamiento de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e8d73-134">You can also connect directly to Microsoft CRM Online through Microsoft peering.</span></span>

- <span data-ttu-id="e8d73-135">**Proveedores de conectividad** (no se muestran).</span><span class="sxs-lookup"><span data-stu-id="e8d73-135">**Connectivity providers** (not shown).</span></span> <span data-ttu-id="e8d73-136">Empresas que proporcionan una conexión a través de conectividad de nivel 2 o de nivel 3 entre el centro de datos y un centro de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-136">Companies that provide a connection either using layer 2 or layer 3 connectivity between your datacenter and an Azure datacenter.</span></span>

## <a name="recommendations"></a><span data-ttu-id="e8d73-137">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="e8d73-137">Recommendations</span></span>

<span data-ttu-id="e8d73-138">Las siguientes recomendaciones sirven para la mayoría de los escenarios.</span><span class="sxs-lookup"><span data-stu-id="e8d73-138">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="e8d73-139">Sígalas a menos que tenga un requisito concreto que las invalide.</span><span class="sxs-lookup"><span data-stu-id="e8d73-139">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="connectivity-providers"></a><span data-ttu-id="e8d73-140">Proveedores de conectividad</span><span class="sxs-lookup"><span data-stu-id="e8d73-140">Connectivity providers</span></span>

<span data-ttu-id="e8d73-141">Seleccione un proveedor de conectividad de ExpressRoute adecuado para su ubicación.</span><span class="sxs-lookup"><span data-stu-id="e8d73-141">Select a suitable ExpressRoute connectivity provider for your location.</span></span> <span data-ttu-id="e8d73-142">Para obtener una lista de los proveedores de conectividad disponibles en su ubicación, utilice el siguiente comando de Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="e8d73-142">To get a list of connectivity providers available at your location, use the following Azure PowerShell command:</span></span>

```powershell
Get-AzureRmExpressRouteServiceProvider
```

<span data-ttu-id="e8d73-143">Los proveedores de conectividad de ExpressRoute conectan el centro de datos a Microsoft de las maneras siguientes:</span><span class="sxs-lookup"><span data-stu-id="e8d73-143">ExpressRoute connectivity providers connect your datacenter to Microsoft in the following ways:</span></span>

- <span data-ttu-id="e8d73-144">**Ubicación compartida en un intercambio en la nube**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-144">**Co-located at a cloud exchange**.</span></span> <span data-ttu-id="e8d73-145">Si comparte la ubicación en la misma instalación con un intercambio en la nube, puede solicitar conexiones cruzadas virtuales a Azure a través del intercambio de Ethernet del proveedor de la ubicación compartida.</span><span class="sxs-lookup"><span data-stu-id="e8d73-145">If you're co-located in a facility with a cloud exchange, you can order virtual cross-connections to Azure through the co-location provider’s Ethernet exchange.</span></span> <span data-ttu-id="e8d73-146">Los proveedores de ubicación compartida pueden ofrecer conexiones cruzadas de nivel 2, o conexiones cruzadas de nivel 3 administradas entre la infraestructura en la instalación de ubicación compartida y Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-146">Co-location providers can offer either layer 2 cross-connections, or managed layer 3 cross-connections between your infrastructure in the co-location facility and Azure.</span></span>
- <span data-ttu-id="e8d73-147">**Conexiones Ethernet de punto a punto**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-147">**Point-to-point Ethernet connections**.</span></span> <span data-ttu-id="e8d73-148">Puede conectar los centros de datos u oficinas locales a Azure a través de vínculos de Ethernet de punto a punto.</span><span class="sxs-lookup"><span data-stu-id="e8d73-148">You can connect your on-premises datacenters/offices to Azure through point-to-point Ethernet links.</span></span> <span data-ttu-id="e8d73-149">Los proveedores de Ethernet de punto a punto pueden ofrecer conexiones de nivel 2 o de nivel 3 administradas entre el sitio y Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-149">Point-to-point Ethernet providers can offer layer 2 connections, or managed layer 3 connections between your site and Azure.</span></span>
- <span data-ttu-id="e8d73-150">**Redes de conexión universal (IPVPN)**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-150">**Any-to-any (IPVPN) networks**.</span></span> <span data-ttu-id="e8d73-151">Puede integrar la red de área extensa (WAN) con Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-151">You can integrate your wide area network (WAN) with Azure.</span></span> <span data-ttu-id="e8d73-152">Los proveedores de red privada virtual del protocolo de Internet (IPVPN), normalmente una VPN de conmutación de etiquetas multiprotocolo, ofrecen una conectividad universal entre los centros de datos y las sucursales.</span><span class="sxs-lookup"><span data-stu-id="e8d73-152">Internet protocol virtual private network (IPVPN) providers (typically a multiprotocol label switching VPN) offer any-to-any connectivity between your branch offices and datacenters.</span></span> <span data-ttu-id="e8d73-153">Azure puede estar conectada a la WAN de forma que parezca otra sucursal más.</span><span class="sxs-lookup"><span data-stu-id="e8d73-153">Azure can be interconnected to your WAN to make it look just like any other branch office.</span></span> <span data-ttu-id="e8d73-154">Los proveedores de WAN normalmente ofrecen una conectividad de nivel 3 administrada.</span><span class="sxs-lookup"><span data-stu-id="e8d73-154">WAN providers typically offer managed layer 3 connectivity.</span></span>

<span data-ttu-id="e8d73-155">Para obtener más información acerca de los proveedores de conectividad, consulte la [Introducción a ExpressRoute][expressroute-introduction].</span><span class="sxs-lookup"><span data-stu-id="e8d73-155">For more information about connectivity providers, see the [ExpressRoute introduction][expressroute-introduction].</span></span>

### <a name="expressroute-circuit"></a><span data-ttu-id="e8d73-156">Circuito ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="e8d73-156">ExpressRoute circuit</span></span>

<span data-ttu-id="e8d73-157">Compruebe que su organización cumple los [requisitos previos de ExpressRoute][expressroute-prereqs] para conectarse a Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-157">Ensure that your organization has met the [ExpressRoute prerequisite requirements][expressroute-prereqs] for connecting to Azure.</span></span>

<span data-ttu-id="e8d73-158">Si aún no lo ha hecho, agregue una subred con el nombre `GatewaySubnet` a la red virtual de Azure y cree una puerta de enlace de red virtual de ExpressRoute con el servicio de puerta de enlace de VPN de Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-158">If you haven't already done so, add a subnet named `GatewaySubnet` to your Azure VNet and create an ExpressRoute virtual network gateway using the Azure VPN gateway service.</span></span> <span data-ttu-id="e8d73-159">Para más información sobre este proceso, vea [Flujos de trabajo de ExpressRoute para aprovisionamiento de circuitos y estados de circuitos][ExpressRoute-provisioning].</span><span class="sxs-lookup"><span data-stu-id="e8d73-159">For more information about this process, see [ExpressRoute workflows for circuit provisioning and circuit states][ExpressRoute-provisioning].</span></span>

<span data-ttu-id="e8d73-160">Cree un circuito ExpressRoute como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="e8d73-160">Create an ExpressRoute circuit as follows:</span></span>

1. <span data-ttu-id="e8d73-161">Ejecute el siguiente comando de PowerShell:</span><span class="sxs-lookup"><span data-stu-id="e8d73-161">Run the following PowerShell command:</span></span>

    ```powershell
    New-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>> -Location <<location>> -SkuTier <<sku-tier>> -SkuFamily <<sku-family>> -ServiceProviderName <<service-provider-name>> -PeeringLocation <<peering-location>> -BandwidthInMbps <<bandwidth-in-mbps>>
    ```
2. <span data-ttu-id="e8d73-162">Envíe el valor de `ServiceKey` para el circuito nuevo al proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="e8d73-162">Send the `ServiceKey` for the new circuit to the service provider.</span></span>

3. <span data-ttu-id="e8d73-163">Espere a que el proveedor aprovisione el circuito.</span><span class="sxs-lookup"><span data-stu-id="e8d73-163">Wait for the provider to provision the circuit.</span></span> <span data-ttu-id="e8d73-164">Para comprobar el estado de aprovisionamiento de un circuito, ejecute el siguiente comando de PowerShell:</span><span class="sxs-lookup"><span data-stu-id="e8d73-164">To verify the provisioning state of a circuit, run the following PowerShell command:</span></span>

    ```powershell
    Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    ```

    <span data-ttu-id="e8d73-165">El campo `Provisioning state` de la sección `Service Provider` de la salida cambiará de `NotProvisioned` a `Provisioned` cuando el circuito esté listo.</span><span class="sxs-lookup"><span data-stu-id="e8d73-165">The `Provisioning state` field in the `Service Provider` section of the output will change from `NotProvisioned` to `Provisioned` when the circuit is ready.</span></span>

    > [!NOTE]
    > <span data-ttu-id="e8d73-166">Si usa una conexión de nivel 3, el proveedor debe configurar y administrar el enrutamiento en su lugar.</span><span class="sxs-lookup"><span data-stu-id="e8d73-166">If you're using a layer 3 connection, the provider should configure and manage routing for you.</span></span> <span data-ttu-id="e8d73-167">Proporcione la información necesaria para permitir que el proveedor implemente las rutas adecuadas.</span><span class="sxs-lookup"><span data-stu-id="e8d73-167">You provide the information necessary to enable the provider to implement the appropriate routes.</span></span>
    >
    >

4. <span data-ttu-id="e8d73-168">Si usa una conexión de nivel 2:</span><span class="sxs-lookup"><span data-stu-id="e8d73-168">If you're using a layer 2 connection:</span></span>

    1. <span data-ttu-id="e8d73-169">Reserve dos subredes /30 compuestas de direcciones IP públicas válidas para cada tipo de emparejamiento que desee implementar.</span><span class="sxs-lookup"><span data-stu-id="e8d73-169">Reserve two /30 subnets composed of valid public IP addresses for each type of peering you want to implement.</span></span> <span data-ttu-id="e8d73-170">Estas subredes /30 se usarán para proporcionar direcciones IP para los enrutadores utilizados para el circuito.</span><span class="sxs-lookup"><span data-stu-id="e8d73-170">These /30 subnets will be used to provide IP addresses for the routers used for the circuit.</span></span> <span data-ttu-id="e8d73-171">Si va a implementar el emparejamiento de Microsoft público o privado, necesitará seis subredes /30 con direcciones IP públicas válidas.</span><span class="sxs-lookup"><span data-stu-id="e8d73-171">If you are implementing private, public, and Microsoft peering, you'll need 6 /30 subnets with valid public IP addresses.</span></span>

    2. <span data-ttu-id="e8d73-172">Configure el enrutamiento para el circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="e8d73-172">Configure routing for the ExpressRoute circuit.</span></span> <span data-ttu-id="e8d73-173">Ejecute los siguientes comandos de PowerShell para cada tipo de emparejamiento que desee configurar (privado, público y Microsoft).</span><span class="sxs-lookup"><span data-stu-id="e8d73-173">Run the following PowerShell commands for each type of peering you want to configure (private, public, and Microsoft).</span></span> <span data-ttu-id="e8d73-174">Para más información, vea [Creación y modificación del enrutamiento de un circuito ExpressRoute][configure-expressroute-routing].</span><span class="sxs-lookup"><span data-stu-id="e8d73-174">For more information, see [Create and modify routing for an ExpressRoute circuit][configure-expressroute-routing].</span></span>

        ```powershell
        Set-AzureRmExpressRouteCircuitPeeringConfig -Name <<peering-name>> -Circuit <<circuit-name>> -PeeringType <<peering-type>> -PeerASN <<peer-asn>> -PrimaryPeerAddressPrefix <<primary-peer-address-prefix>> -SecondaryPeerAddressPrefix <<secondary-peer-address-prefix>> -VlanId <<vlan-id>>

        Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit <<circuit-name>>
        ```

    3. <span data-ttu-id="e8d73-175">Reserve otro grupo de direcciones IP públicas válidas para usarlas en la traducción de direcciones de red (NAT) para el emparejamiento público y de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e8d73-175">Reserve another pool of valid public IP addresses to use for network address translation (NAT) for public and Microsoft peering.</span></span> <span data-ttu-id="e8d73-176">Se recomienda tener un grupo diferente para cada emparejamiento.</span><span class="sxs-lookup"><span data-stu-id="e8d73-176">It is recommended to have a different pool for each peering.</span></span> <span data-ttu-id="e8d73-177">Especifique el grupo para el proveedor de conectividad, de modo que puedan configurar los anuncios del Protocolo de puerta de enlace fronteriza (BGP) para esos intervalos.</span><span class="sxs-lookup"><span data-stu-id="e8d73-177">Specify the pool to your connectivity provider, so they can configure border gateway protocol (BGP) advertisements for those ranges.</span></span>

5. <span data-ttu-id="e8d73-178">Ejecute los siguientes comandos de PowerShell para vincular sus redes virtuales privadas al circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="e8d73-178">Run the following PowerShell commands to link your private VNet(s) to the ExpressRoute circuit.</span></span> <span data-ttu-id="e8d73-179">Para más información, consulte el artículo [Vinculación de la red virtual a circuitos ExpressRoute][link-vnet-to-expressroute].</span><span class="sxs-lookup"><span data-stu-id="e8d73-179">For more information,see [Link a virtual network to an ExpressRoute circuit][link-vnet-to-expressroute].</span></span>

    ```powershell
    $circuit = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    $gw = Get-AzureRmVirtualNetworkGateway -Name <<gateway-name>> -ResourceGroupName <<resource-group>>
    New-AzureRmVirtualNetworkGatewayConnection -Name <<connection-name>> -ResourceGroupName <<resource-group>> -Location <<location> -VirtualNetworkGateway1 $gw -PeerId $circuit.Id -ConnectionType ExpressRoute
    ```

<span data-ttu-id="e8d73-180">Puede conectar varias redes virtuales que se encuentren en regiones diferentes al mismo circuito ExpressRoute, siempre y cuando todos ellos se encuentren en la misma región geopolítica.</span><span class="sxs-lookup"><span data-stu-id="e8d73-180">You can connect multiple VNets located in different regions to the same ExpressRoute circuit, as long as all VNets and the ExpressRoute circuit are located within the same geopolitical region.</span></span>

### <a name="troubleshooting"></a><span data-ttu-id="e8d73-181">solución de problemas</span><span class="sxs-lookup"><span data-stu-id="e8d73-181">Troubleshooting</span></span>

<span data-ttu-id="e8d73-182">Si un circuito de ExpressRoute que funcionaba ahora no se puede conectar, en ausencia de cambios de configuración local o dentro de la red virtual privada, debe ponerse en contacto con el proveedor de conectividad y colaborar para corregir el problema.</span><span class="sxs-lookup"><span data-stu-id="e8d73-182">If a previously functioning ExpressRoute circuit now fails to connect, in the absence of any configuration changes on-premises or within your private VNet, you may need to contact the connectivity provider and work with them to correct the issue.</span></span> <span data-ttu-id="e8d73-183">Use los siguientes comandos de Powershell para verificar que se haya aprovisionado el circuito de ExpressRoute:</span><span class="sxs-lookup"><span data-stu-id="e8d73-183">Use the following Powershell commands to verify that the ExpressRoute circuit has been provisioned:</span></span>

```powershell
Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

<span data-ttu-id="e8d73-184">El resultado de este comando muestra varias propiedades para el circuito, incluidas `ProvisioningState`, `CircuitProvisioningState` y `ServiceProviderProvisioningState`, tal y como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="e8d73-184">The output of this command shows several properties for your circuit, including `ProvisioningState`, `CircuitProvisioningState`, and `ServiceProviderProvisioningState` as shown below.</span></span>

```powershell
ProvisioningState                : Succeeded
Sku                              : {
                                     "Name": "Standard_MeteredData",
                                     "Tier": "Standard",
                                     "Family": "MeteredData"
                                   }
CircuitProvisioningState         : Enabled
ServiceProviderProvisioningState : NotProvisioned
```

<span data-ttu-id="e8d73-185">Si la propiedad `ProvisioningState` no está establecida en `Succeeded` después de intentar crear un nuevo circuito, quite el circuito mediante el comando siguiente e intente crearlo de nuevo.</span><span class="sxs-lookup"><span data-stu-id="e8d73-185">If the `ProvisioningState` is not set to `Succeeded` after you tried to create a new circuit, remove the circuit by using the command below and try to create it again.</span></span>

```powershell
Remove-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

<span data-ttu-id="e8d73-186">Si el proveedor ya tenía aprovisionado el circuito y la propiedad `ProvisioningState` ya está establecida en `Failed`, o la propiedad `CircuitProvisioningState` no es `Enabled`, póngase en contacto con su proveedor para obtener más ayuda.</span><span class="sxs-lookup"><span data-stu-id="e8d73-186">If your provider had already provisioned the circuit, and the `ProvisioningState` is set to `Failed`, or the `CircuitProvisioningState` is not `Enabled`, contact your provider for further assistance.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="e8d73-187">Consideraciones sobre escalabilidad</span><span class="sxs-lookup"><span data-stu-id="e8d73-187">Scalability considerations</span></span>

<span data-ttu-id="e8d73-188">Los circuitos de ExpressRoute proporcionan una ruta de acceso de gran ancho de banda entre redes.</span><span class="sxs-lookup"><span data-stu-id="e8d73-188">ExpressRoute circuits provide a high bandwidth path between networks.</span></span> <span data-ttu-id="e8d73-189">Por lo general, cuanto mayor sea el ancho de banda mayor será el costo.</span><span class="sxs-lookup"><span data-stu-id="e8d73-189">Generally, the higher the bandwidth the greater the cost.</span></span>

<span data-ttu-id="e8d73-190">ExpressRoute ofrece dos [planes de precios][expressroute-pricing] a los clientes, un plan de uso medido y un plan de servicio de datos ilimitado.</span><span class="sxs-lookup"><span data-stu-id="e8d73-190">ExpressRoute offers two [pricing plans][expressroute-pricing] to customers, a metered plan and an unlimited data plan.</span></span> <span data-ttu-id="e8d73-191">Los cargos pueden variar según el ancho de banda del circuito.</span><span class="sxs-lookup"><span data-stu-id="e8d73-191">Charges vary according to circuit bandwidth.</span></span> <span data-ttu-id="e8d73-192">Es probable que el ancho de banda disponible varíe de un proveedor a otro.</span><span class="sxs-lookup"><span data-stu-id="e8d73-192">Available bandwidth will likely vary from provider to provider.</span></span> <span data-ttu-id="e8d73-193">Use el cmdlet `Get-AzureRmExpressRouteServiceProvider` para ver los proveedores disponibles en su región y los anchos de banda que ofrecen.</span><span class="sxs-lookup"><span data-stu-id="e8d73-193">Use the `Get-AzureRmExpressRouteServiceProvider` cmdlet to see the providers available in your region and the bandwidths that they offer.</span></span>

<span data-ttu-id="e8d73-194">Un solo circuito ExpressRoute puede admitir un número determinado de emparejamientos y vínculos de red virtual.</span><span class="sxs-lookup"><span data-stu-id="e8d73-194">A single ExpressRoute circuit can support a certain number of peerings and VNet links.</span></span> <span data-ttu-id="e8d73-195">Para más información, consulte el artículo [Límites de ExpressRoute](/azure/azure-subscription-service-limits).</span><span class="sxs-lookup"><span data-stu-id="e8d73-195">See [ExpressRoute limits](/azure/azure-subscription-service-limits) for more information.</span></span>

<span data-ttu-id="e8d73-196">Por un costo adicional, el complemento Premium de ExpressRoute proporciona más capacidad:</span><span class="sxs-lookup"><span data-stu-id="e8d73-196">For an extra charge, the ExpressRoute Premium add-on provides some additional capability:</span></span>

- <span data-ttu-id="e8d73-197">Mayor límite de rutas para el emparejamiento público y privado.</span><span class="sxs-lookup"><span data-stu-id="e8d73-197">Increased route limits for public and private peering.</span></span>
- <span data-ttu-id="e8d73-198">Aumento del número de vínculos de red virtual por cada circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="e8d73-198">Increased number of VNet links per ExpressRoute circuit.</span></span>
- <span data-ttu-id="e8d73-199">Conectividad global para los servicios.</span><span class="sxs-lookup"><span data-stu-id="e8d73-199">Global connectivity for services.</span></span>

<span data-ttu-id="e8d73-200">Vea [Precios de ExpressRoute][expressroute-pricing] para conocer más detalles.</span><span class="sxs-lookup"><span data-stu-id="e8d73-200">See [ExpressRoute pricing][expressroute-pricing] for details.</span></span>

<span data-ttu-id="e8d73-201">Los circuitos ExpressRoute están diseñados para permitir hasta dos veces el límite de ancho de banda adquirido sin costo adicional.</span><span class="sxs-lookup"><span data-stu-id="e8d73-201">ExpressRoute circuits are designed to allow temporary network bursts up to two times the bandwidth limit that you procured for no additional cost.</span></span> <span data-ttu-id="e8d73-202">Esto se logra mediante el uso de vínculos redundantes.</span><span class="sxs-lookup"><span data-stu-id="e8d73-202">This is achieved by using redundant links.</span></span> <span data-ttu-id="e8d73-203">Sin embargo, no todos los proveedores de conectividad admiten esta característica.</span><span class="sxs-lookup"><span data-stu-id="e8d73-203">However, not all connectivity providers support this feature.</span></span> <span data-ttu-id="e8d73-204">Verifique que el proveedor de conectividad habilita esta característica antes de depender de ella.</span><span class="sxs-lookup"><span data-stu-id="e8d73-204">Verify that your connectivity provider enables this feature before depending on it.</span></span>

<span data-ttu-id="e8d73-205">Aunque algunos proveedores le permiten cambiar el ancho de banda, asegúrese de elegir uno inicial que sobrepase sus necesidades y proporcione espacio para el crecimiento.</span><span class="sxs-lookup"><span data-stu-id="e8d73-205">Although some providers allow you to change your bandwidth, make sure you pick an initial bandwidth that surpasses your needs and provides room for growth.</span></span> <span data-ttu-id="e8d73-206">Si necesita aumentar el ancho de banda en el futuro, le quedan dos opciones:</span><span class="sxs-lookup"><span data-stu-id="e8d73-206">If you need to increase bandwidth in the future, you are left with two options:</span></span>

- <span data-ttu-id="e8d73-207">Aumentar el ancho de banda.</span><span class="sxs-lookup"><span data-stu-id="e8d73-207">Increase the bandwidth.</span></span> <span data-ttu-id="e8d73-208">Debe evitar esta opción en la medida de lo posible; no todos los proveedores le permiten aumentar dinámicamente el ancho de banda.</span><span class="sxs-lookup"><span data-stu-id="e8d73-208">You should avoid this option as much as possible, and not all providers allow you to increase bandwidth dynamically.</span></span> <span data-ttu-id="e8d73-209">Pero, si se necesita aumentarlo, póngase en contacto con su proveedor para verificar que permite variar las propiedades de ancho de banda de ExpressRoute a través de comandos de Powershell.</span><span class="sxs-lookup"><span data-stu-id="e8d73-209">But if a bandwidth increase is needed, check with your provider to verify they support changing ExpressRoute bandwidth properties via Powershell commands.</span></span> <span data-ttu-id="e8d73-210">Si es así, ejecute los comandos siguientes.</span><span class="sxs-lookup"><span data-stu-id="e8d73-210">If they do, run the commands below.</span></span>

    ```powershell
    $ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    $ckt.ServiceProviderProperties.BandwidthInMbps = <<bandwidth-in-mbps>>
    Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
    ```

    <span data-ttu-id="e8d73-211">Puede aumentar el ancho de banda sin perder conectividad.</span><span class="sxs-lookup"><span data-stu-id="e8d73-211">You can increase the bandwidth without loss of connectivity.</span></span> <span data-ttu-id="e8d73-212">Degradar el ancho de banda provocará una interrupción en la conectividad, ya que debe eliminar el circuito y volver a crearlo con la nueva configuración.</span><span class="sxs-lookup"><span data-stu-id="e8d73-212">Downgrading the bandwidth will result in disruption in connectivity, because you must delete the circuit and recreate it with the new configuration.</span></span>

- <span data-ttu-id="e8d73-213">Cambiar el plan de precios o actualizar a Premium.</span><span class="sxs-lookup"><span data-stu-id="e8d73-213">Change your pricing plan and/or upgrade to Premium.</span></span> <span data-ttu-id="e8d73-214">Para ello, ejecute los siguientes comandos:</span><span class="sxs-lookup"><span data-stu-id="e8d73-214">To do so, run the following commands.</span></span> <span data-ttu-id="e8d73-215">La propiedad `Sku.Tier` puede ser `Standard` o `Premium`; la propiedad `Sku.Name` puede ser `MeteredData` o `UnlimitedData`.</span><span class="sxs-lookup"><span data-stu-id="e8d73-215">The `Sku.Tier` property can be `Standard` or `Premium`; the `Sku.Name` property can be `MeteredData` or `UnlimitedData`.</span></span>

    ```powershell
    $ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>

    $ckt.Sku.Tier = "Premium"
    $ckt.Sku.Family = "MeteredData"
    $ckt.Sku.Name = "Premium_MeteredData"

    Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
    ```

    > [!IMPORTANT]
    > <span data-ttu-id="e8d73-216">Asegúrese de que la propiedad `Sku.Name` concuerda con las propiedades `Sku.Tier` y `Sku.Family`.</span><span class="sxs-lookup"><span data-stu-id="e8d73-216">Make sure the `Sku.Name` property matches the `Sku.Tier` and `Sku.Family`.</span></span> <span data-ttu-id="e8d73-217">Si cambia la familia y el nivel, pero no el nombre, la conexión se deshabilitará.</span><span class="sxs-lookup"><span data-stu-id="e8d73-217">If you change the family and tier, but not the name, your connection will be disabled.</span></span>
    >
    >

    <span data-ttu-id="e8d73-218">Puede actualizar la SKU sin interrupciones, pero no se puede cambiar del plan de precios ilimitado al limitado.</span><span class="sxs-lookup"><span data-stu-id="e8d73-218">You can upgrade the SKU without disruption, but you cannot switch from the unlimited pricing plan to metered.</span></span> <span data-ttu-id="e8d73-219">Al degradar la SKU, el consumo de ancho de banda debe permanecer en el límite predeterminado de la SKU estándar.</span><span class="sxs-lookup"><span data-stu-id="e8d73-219">When downgrading the SKU, your bandwidth consumption must remain within the default limit of the standard SKU.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="e8d73-220">Consideraciones sobre disponibilidad</span><span class="sxs-lookup"><span data-stu-id="e8d73-220">Availability considerations</span></span>

<span data-ttu-id="e8d73-221">ExpressRoute no admite protocolos de redundancia de enrutador como el Protocolo de enrutamiento en espera activa (HSRP) y el Protocolo de redundancia de enrutador virtual (VRRP) para implementar la alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e8d73-221">ExpressRoute does not support router redundancy protocols such as hot standby routing protocol (HSRP) and virtual router redundancy protocol (VRRP) to implement high availability.</span></span> <span data-ttu-id="e8d73-222">En su lugar, utiliza un par redundante de sesiones BGP por emparejamiento.</span><span class="sxs-lookup"><span data-stu-id="e8d73-222">Instead, it uses a redundant pair of BGP sessions per peering.</span></span> <span data-ttu-id="e8d73-223">Para facilitar las conexiones de alta disponibilidad a la red, Azure proporciona dos puertos de redundancia en los dos enrutadores (parte de Microsoft Edge) en una configuración activa/activa.</span><span class="sxs-lookup"><span data-stu-id="e8d73-223">To facilitate highly-available connections to your network, Azure provisions you with two redundant ports on two routers (part of the Microsoft edge) in an active-active configuration.</span></span>

<span data-ttu-id="e8d73-224">De forma predeterminada, las sesiones BGP usan un valor de tiempo de espera de inactividad de 60 segundos.</span><span class="sxs-lookup"><span data-stu-id="e8d73-224">By default, BGP sessions use an idle timeout value of 60 seconds.</span></span> <span data-ttu-id="e8d73-225">Si una sesión agota el tiempo de espera tres veces (180 segundos en total), el enrutador se marca como no disponible y todo el tráfico se redirige al enrutador restante.</span><span class="sxs-lookup"><span data-stu-id="e8d73-225">If a session times out three times (180 seconds total), the router is marked as unavailable, and all traffic is redirected to the remaining router.</span></span> <span data-ttu-id="e8d73-226">Este tiempo de espera de 180 segundos puede ser demasiado largo para las aplicaciones críticas.</span><span class="sxs-lookup"><span data-stu-id="e8d73-226">This 180-second timeout might be too long for critical applications.</span></span> <span data-ttu-id="e8d73-227">Si es así, puede cambiar la configuración del tiempo de espera BGP en el enrutador local con un valor menor.</span><span class="sxs-lookup"><span data-stu-id="e8d73-227">If so, you can change your BGP time-out settings on the on-premises router to a smaller value.</span></span>

<span data-ttu-id="e8d73-228">Puede configurar la alta disponibilidad para la conexión de Azure de maneras diferentes, dependiendo del tipo de proveedor que utilice y del número de circuitos ExpressRoute y de conexiones de puerta de enlace de red virtual que esté dispuesto a configurar.</span><span class="sxs-lookup"><span data-stu-id="e8d73-228">You can configure high availability for your Azure connection in different ways, depending on the type of provider you use, and the number of ExpressRoute circuits and virtual network gateway connections you're willing to configure.</span></span> <span data-ttu-id="e8d73-229">A continuación se resumen las opciones de disponibilidad:</span><span class="sxs-lookup"><span data-stu-id="e8d73-229">The following summarizes your availability options:</span></span>

- <span data-ttu-id="e8d73-230">Si usa una conexión de nivel 2, implemente enrutadores redundantes en su red local en una configuración activa/activa.</span><span class="sxs-lookup"><span data-stu-id="e8d73-230">If you're using a layer 2 connection, deploy redundant routers in your on-premises network in an active-active configuration.</span></span> <span data-ttu-id="e8d73-231">Conecte el circuito principal a un enrutador y el circuito secundario al otro.</span><span class="sxs-lookup"><span data-stu-id="e8d73-231">Connect the primary circuit to one router, and the secondary circuit to the other.</span></span> <span data-ttu-id="e8d73-232">Esto le proporcionará una conexión de alta disponibilidad en ambos extremos de la conexión.</span><span class="sxs-lookup"><span data-stu-id="e8d73-232">This will give you a highly available connection at both ends of the connection.</span></span> <span data-ttu-id="e8d73-233">Esto es necesario si requiere el Acuerdo de Nivel de Servicio (SLA) de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="e8d73-233">This is necessary if you require the ExpressRoute service level agreement (SLA).</span></span> <span data-ttu-id="e8d73-234">Vea [SLA de Azure ExpressRoute][sla-for-expressroute] para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="e8d73-234">See [SLA for Azure ExpressRoute][sla-for-expressroute] for details.</span></span>

    <span data-ttu-id="e8d73-235">El siguiente diagrama muestra una configuración con enrutadores redundantes locales conectados a los circuitos principales y secundarios.</span><span class="sxs-lookup"><span data-stu-id="e8d73-235">The following diagram shows a configuration with redundant on-premises routers connected to the primary and secondary circuits.</span></span> <span data-ttu-id="e8d73-236">Cada circuito controla el tráfico de un emparejamiento público y de un emparejamiento privado (cada uno se designa con un par de espacios de direcciones /30, tal como se describe en la sección anterior).</span><span class="sxs-lookup"><span data-stu-id="e8d73-236">Each circuit handles the traffic for a public peering and a private peering (each peering is designated a pair of /30 address spaces, as described in the previous section).</span></span>

    <span data-ttu-id="e8d73-237">![[1]][1]</span><span class="sxs-lookup"><span data-stu-id="e8d73-237">![[1]][1]</span></span>

- <span data-ttu-id="e8d73-238">Si usa una conexión de nivel 3, verifique que proporciona sesiones BGP redundantes que controlan la disponibilidad en su lugar.</span><span class="sxs-lookup"><span data-stu-id="e8d73-238">If you're using a layer 3 connection, verify that it provides redundant BGP sessions that handle availability for you.</span></span>

- <span data-ttu-id="e8d73-239">Conecte la red virtual a varios circuitos ExpressRoute, proporcionados por otros proveedores de servicios.</span><span class="sxs-lookup"><span data-stu-id="e8d73-239">Connect the VNet to multiple ExpressRoute circuits, supplied by different service providers.</span></span> <span data-ttu-id="e8d73-240">Esta estrategia proporciona funcionalidades de recuperación ante desastres y alta disponibilidad adicional.</span><span class="sxs-lookup"><span data-stu-id="e8d73-240">This strategy provides additional high-availability and disaster recovery capabilities.</span></span>

- <span data-ttu-id="e8d73-241">Configure una VPN de sitio a sitio como una ruta de acceso de conmutación por error para ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="e8d73-241">Configure a site-to-site VPN as a failover path for ExpressRoute.</span></span> <span data-ttu-id="e8d73-242">Para más información sobre esta opción, vea [Conexión de una red local a Azure mediante ExpressRoute con conmutación por error de VPN][highly-available-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="e8d73-242">For more about this option, see [Connect an on-premises network to Azure using ExpressRoute with VPN failover][highly-available-network-architecture].</span></span>
 <span data-ttu-id="e8d73-243">Esta opción solo se aplica al emparejamiento privado.</span><span class="sxs-lookup"><span data-stu-id="e8d73-243">This option only applies to private peering.</span></span> <span data-ttu-id="e8d73-244">Para los servicios de Azure y Office 365, Internet es la única ruta de acceso para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e8d73-244">For Azure and Office 365 services, the Internet is the only failover path.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="e8d73-245">Consideraciones sobre la manejabilidad</span><span class="sxs-lookup"><span data-stu-id="e8d73-245">Manageability considerations</span></span>

<span data-ttu-id="e8d73-246">Puede usar [Azure Connectivity Toolkit (AzureCT)][azurect] para supervisar la conectividad entre el centro de datos local y Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d73-246">You can use the [Azure Connectivity Toolkit (AzureCT)][azurect] to monitor connectivity between your on-premises datacenter and Azure.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="e8d73-247">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="e8d73-247">Security considerations</span></span>

<span data-ttu-id="e8d73-248">Puede configurar las opciones de seguridad para la conexión de Azure de maneras diferentes, en función de las necesidades de cumplimiento de normas y de los problemas de seguridad.</span><span class="sxs-lookup"><span data-stu-id="e8d73-248">You can configure security options for your Azure connection in different ways, depending on your security concerns and compliance needs.</span></span>

<span data-ttu-id="e8d73-249">ExpressRoute funciona en el nivel 3.</span><span class="sxs-lookup"><span data-stu-id="e8d73-249">ExpressRoute operates in layer 3.</span></span> <span data-ttu-id="e8d73-250">Las amenazas del nivel de aplicación pueden evitarse mediante el uso de un dispositivo de seguridad de red que restrinja el tráfico a los recursos legítimos.</span><span class="sxs-lookup"><span data-stu-id="e8d73-250">Threats in the application layer can be prevented by using a network security appliance that restricts traffic to legitimate resources.</span></span> <span data-ttu-id="e8d73-251">Además, las conexiones de ExpressRoute con el emparejamiento público solo pueden iniciarse desde el entorno local.</span><span class="sxs-lookup"><span data-stu-id="e8d73-251">Additionally, ExpressRoute connections using public peering can only be initiated from on-premises.</span></span> <span data-ttu-id="e8d73-252">Así se evita que un servicio malicioso obtenga acceso y ponga en peligro los datos locales desde Internet.</span><span class="sxs-lookup"><span data-stu-id="e8d73-252">This prevents a rogue service from accessing and compromising on-premises data from the Internet.</span></span>

<span data-ttu-id="e8d73-253">Para maximizar la seguridad, agregue dispositivos de seguridad de red entre la red local y los enrutadores perimetrales del proveedor.</span><span class="sxs-lookup"><span data-stu-id="e8d73-253">To maximize security, add network security appliances between the on-premises network and the provider edge routers.</span></span> <span data-ttu-id="e8d73-254">Esto le ayudará a impedir el flujo de entrada de tráfico no autorizado de la red virtual:</span><span class="sxs-lookup"><span data-stu-id="e8d73-254">This will help to restrict the inflow of unauthorized traffic from the VNet:</span></span>

<span data-ttu-id="e8d73-255">![[2]][2]</span><span class="sxs-lookup"><span data-stu-id="e8d73-255">![[2]][2]</span></span>

<span data-ttu-id="e8d73-256">Para fines relacionados con la auditoría y el cumplimiento de normas, puede ser necesario prohibir el acceso directo a Internet de los componentes que se ejecutan en la red virtual e implementar la [tunelización forzada][forced-tuneling].</span><span class="sxs-lookup"><span data-stu-id="e8d73-256">For auditing or compliance purposes, it may be necessary to prohibit direct access from components running in the VNet to the Internet and implement [forced tunneling][forced-tuneling].</span></span> <span data-ttu-id="e8d73-257">En esta situación, se debe redirigir el tráfico de Internet a través de un proxy que se ejecute de forma local donde se pueda auditar.</span><span class="sxs-lookup"><span data-stu-id="e8d73-257">In this situation, Internet traffic should be redirected back through a proxy running  on-premises where it can be audited.</span></span> <span data-ttu-id="e8d73-258">El proxy puede configurarse para bloquear el tráfico no autorizado que fluya hacia fuera y filtrar el tráfico de entrada potencialmente malintencionado.</span><span class="sxs-lookup"><span data-stu-id="e8d73-258">The proxy can be configured to block unauthorized traffic flowing out, and filter potentially malicious inbound traffic.</span></span>

<span data-ttu-id="e8d73-259">![[3]][3]</span><span class="sxs-lookup"><span data-stu-id="e8d73-259">![[3]][3]</span></span>

<span data-ttu-id="e8d73-260">Para maximizar la seguridad, no habilite una dirección IP pública para las máquinas virtuales y utilice los grupos de seguridad de red para asegurarse de que estas máquinas virtuales no están accesibles públicamente.</span><span class="sxs-lookup"><span data-stu-id="e8d73-260">To maximize security, do not enable a public IP address for your VMs, and use NSGs to ensure that these VMs aren't publicly accessible.</span></span> <span data-ttu-id="e8d73-261">Las máquinas virtuales solo deben estar disponibles mediante la dirección IP interna.</span><span class="sxs-lookup"><span data-stu-id="e8d73-261">VMs should only be available using the internal IP address.</span></span> <span data-ttu-id="e8d73-262">Estas direcciones pueden hacerse accesibles a través de la red de ExpressRoute, permitiendo al personal de DevOps local para que realice la configuración o el mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="e8d73-262">These addresses can be made accessible through the ExpressRoute network, enabling on-premises DevOps staff to perform configuration or maintenance.</span></span>

<span data-ttu-id="e8d73-263">Si debe exponer los extremos de administración para las máquinas virtuales a una red externa, utilice grupos de seguridad de red o listas de control de acceso a fin de restringir la visibilidad de estos puertos a una lista de direcciones IP o redes permitidas.</span><span class="sxs-lookup"><span data-stu-id="e8d73-263">If you must expose management endpoints for VMs to an external network, use NSGs or access control lists to restrict the visibility of these ports to a whitelist of IP addresses or networks.</span></span>

> [!NOTE]
> <span data-ttu-id="e8d73-264">De forma predeterminada, las máquinas virtuales de Azure implementadas a través de Azure Portal incluyen una dirección IP pública que proporciona acceso de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="e8d73-264">By default, Azure VMs deployed through the Azure portal include a public IP address that provides login access.</span></span>
>

## <a name="deploy-the-solution"></a><span data-ttu-id="e8d73-265">Implementación de la solución</span><span class="sxs-lookup"><span data-stu-id="e8d73-265">Deploy the solution</span></span>

<span data-ttu-id="e8d73-266">**Requisitos previos**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-266">**Prerequisites**.</span></span> <span data-ttu-id="e8d73-267">Debe tener una infraestructura local existente ya configurada con un dispositivo de red adecuado.</span><span class="sxs-lookup"><span data-stu-id="e8d73-267">You must have an existing on-premises infrastructure already configured with a suitable network appliance.</span></span>

<span data-ttu-id="e8d73-268">Para implementar la solución, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="e8d73-268">To deploy the solution, perform the following steps.</span></span>

<!-- markdownlint-disable MD033 -->

1. <span data-ttu-id="e8d73-269">Haga clic en el botón a continuación:</span><span class="sxs-lookup"><span data-stu-id="e8d73-269">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fhybrid-networking%2Fexpressroute%2Fazuredeploy.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>

2. <span data-ttu-id="e8d73-270">Espere a que el vínculo abra Azure Portal y, a continuación, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="e8d73-270">Wait for the link to open in the Azure portal, then follow these steps:</span></span>
   - <span data-ttu-id="e8d73-271">El nombre del **Grupo de recursos** ya está definido en el archivo de parámetros, así que seleccione **Crear nuevo** y escriba `ra-hybrid-er-rg` en el cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="e8d73-271">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-hybrid-er-rg` in the text box.</span></span>
   - <span data-ttu-id="e8d73-272">Seleccione la región en el cuadro de lista desplegable **Ubicación**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-272">Select the region from the **Location** drop down box.</span></span>
   - <span data-ttu-id="e8d73-273">No modifique los cuadros de texto **URI raíz de plantilla** o **URI raíz de parámetro**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-273">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   - <span data-ttu-id="e8d73-274">Revise los términos y condiciones, y haga clic en la casilla **Acepto los términos y condiciones indicados anteriormente**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-274">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   - <span data-ttu-id="e8d73-275">Haga clic en el botón **Comprar**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-275">Click the **Purchase** button.</span></span>

3. <span data-ttu-id="e8d73-276">Espere a que la implementación se complete.</span><span class="sxs-lookup"><span data-stu-id="e8d73-276">Wait for the deployment to complete.</span></span>

4. <span data-ttu-id="e8d73-277">Haga clic en el botón a continuación:</span><span class="sxs-lookup"><span data-stu-id="e8d73-277">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fhybrid-networking%2Fexpressroute%2Fazuredeploy-expressRouteCircuit.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>

5. <span data-ttu-id="e8d73-278">Espere a que el vínculo abra Azure Portal y, a continuación, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="e8d73-278">Wait for the link to open in the Azure portal, then follow these steps:</span></span>
   - <span data-ttu-id="e8d73-279">Seleccione **Usar existente** en la sección **Grupo de recursos** y escriba `ra-hybrid-er-rg` en el cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="e8d73-279">Select **Use existing** in the **Resource group** section and enter `ra-hybrid-er-rg` in the text box.</span></span>
   - <span data-ttu-id="e8d73-280">Seleccione la región en el cuadro de lista desplegable **Ubicación**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-280">Select the region from the **Location** drop down box.</span></span>
   - <span data-ttu-id="e8d73-281">No modifique los cuadros de texto **URI raíz de plantilla** o **URI raíz de parámetro**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-281">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   - <span data-ttu-id="e8d73-282">Revise los términos y condiciones, y haga clic en la casilla **Acepto los términos y condiciones indicados anteriormente**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-282">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   - <span data-ttu-id="e8d73-283">Haga clic en el botón **Comprar**.</span><span class="sxs-lookup"><span data-stu-id="e8d73-283">Click the **Purchase** button.</span></span>

6. <span data-ttu-id="e8d73-284">Espere a que la implementación se complete.</span><span class="sxs-lookup"><span data-stu-id="e8d73-284">Wait for the deployment to complete.</span></span>

<!-- markdownlint-enable MD033 -->

<!-- links -->

[forced-tuneling]: ../dmz/secure-vnet-hybrid.md
[highly-available-network-architecture]: ./expressroute-vpn-failover.md

[expressroute-technical-overview]: /azure/expressroute/expressroute-introduction
[expressroute-prereqs]: /azure/expressroute/expressroute-prerequisites
[configure-expressroute-routing]: /azure/expressroute/expressroute-howto-routing-arm
[sla-for-expressroute]: https://azure.microsoft.com/support/legal/sla/expressroute
[link-vnet-to-expressroute]: /azure/expressroute/expressroute-howto-linkvnet-arm
[ExpressRoute-provisioning]: /azure/expressroute/expressroute-workflows
[expressroute-introduction]: /azure/expressroute/expressroute-introduction
[expressroute-peering]: /azure/expressroute/expressroute-circuit-peerings
[expressroute-pricing]: https://azure.microsoft.com/pricing/details/expressroute/
[expressroute-limits]: /azure/azure-subscription-service-limits#networking-limits
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[visio-download]: https://archcenter.blob.core.windows.net/cdn/hybrid-network-architectures.vsdx
[er-circuit-parameters]: https://github.com/mspnp/reference-architectures/tree/master/hybrid-networking/expressroute/parameters/expressRouteCircuit.parameters.json
[azure-powershell-download]: https://azure.microsoft.com/documentation/articles/powershell-install-configure/
[azure-cli]: https://azure.microsoft.com/documentation/articles/xplat-cli-install/

[0]: ./images/expressroute.png "Arquitectura de red híbrida con Azure ExpressRoute"
[1]: ../_images/guidance-hybrid-network-expressroute/figure2.png "Uso de enrutadores redundantes con circuitos ExpressRoute principales y secundarios"
[2]: ../_images/guidance-hybrid-network-expressroute/figure3.png "Incorporación de dispositivos de seguridad a la red local"
[3]: ../_images/guidance-hybrid-network-expressroute/figure4.png "Tunelización forzada para auditar el tráfico de Internet"
[4]: ../_images/guidance-hybrid-network-expressroute/figure5.png "Ubicación del valor de ServiceKey de un circuito ExpressRoute"
