---
title: Guía de implementación de API
titleSuffix: Best practices for cloud applications
description: Guía sobre cómo implementar una API.
author: dragon119
ms.date: 07/13/2016
ms.custom: seodec18
ms.openlocfilehash: edbb214c8b582e334a851da79370844da4762a76
ms.sourcegitcommit: 4ba3304eebaa8c493c3e5307bdd9d723cd90b655
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/12/2018
ms.locfileid: "53307408"
---
# <a name="api-implementation"></a><span data-ttu-id="c4bc9-103">Implementación de API</span><span class="sxs-lookup"><span data-stu-id="c4bc9-103">API implementation</span></span>

<span data-ttu-id="c4bc9-104">Una API web de RESTful diseñada cuidadosamente define los recursos, las relaciones y los esquemas de navegación a los que tienen acceso las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-104">A carefully-designed RESTful web API defines the resources, relationships, and navigation schemes that are accessible to client applications.</span></span> <span data-ttu-id="c4bc9-105">Al implementar una API web, debe considerar los requisitos físicos del entorno que hospeda la API web y la forma en que se construye la misma, en lugar de la estructura lógica de los datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-105">When you implement and deploy a web API, you should consider the physical requirements of the environment hosting the web API and the way in which the web API is constructed rather than the logical structure of the data.</span></span> <span data-ttu-id="c4bc9-106">Esta guía se centra en los procedimientos recomendados para implementar una API web y publicarla para que esté disponible para las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-106">This guidance focusses on best practices for implementing a web API and publishing it to make it available to client applications.</span></span> <span data-ttu-id="c4bc9-107">Para obtener información detallada sobre el diseño de API web, consulte [Guía de diseño de API](/azure/architecture/best-practices/api-design).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-107">For detailed information about web API design, see [API Design Guidance](/azure/architecture/best-practices/api-design).</span></span>

## <a name="processing-requests"></a><span data-ttu-id="c4bc9-108">Procesamiento de solicitudes</span><span class="sxs-lookup"><span data-stu-id="c4bc9-108">Processing requests</span></span>

<span data-ttu-id="c4bc9-109">Tenga en cuenta los puntos siguientes cuando implemente el código para administrar las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-109">Consider the following points when you implement the code to handle requests.</span></span>

### <a name="get-put-delete-head-and-patch-actions-should-be-idempotent"></a><span data-ttu-id="c4bc9-110">Las acciones GET, PUT, DELETE, HEAD y PATCH deben ser idempotentes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-110">GET, PUT, DELETE, HEAD, and PATCH actions should be idempotent</span></span>

<span data-ttu-id="c4bc9-111">El código que implementa estas solicitudes no debe imponer efectos secundarios.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-111">The code that implements these requests should not impose any side-effects.</span></span> <span data-ttu-id="c4bc9-112">La misma solicitud repetida en el mismo recurso debe dar como resultado el mismo estado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-112">The same request repeated over the same resource should result in the same state.</span></span> <span data-ttu-id="c4bc9-113">Por ejemplo, enviar varias solicitudes DELETE para el mismo URI debe tener el mismo efecto, aunque el código de estado HTTP en los mensajes de respuesta sea diferente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-113">For example, sending multiple DELETE requests to the same URI should have the same effect, although the HTTP status code in the response messages may be different.</span></span> <span data-ttu-id="c4bc9-114">La primera solicitud DELETE podría devolver el código de estado 204 (sin contenido), mientras que una solicitud DELETE posterior podría devolver el código de estado 404 (no encontrado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-114">The first DELETE request might return status code 204 (No Content), while a subsequent DELETE request might return status code 404 (Not Found).</span></span>

> [!NOTE]
> <span data-ttu-id="c4bc9-115">En el artículo [Idempotency Patterns](https://blog.jonathanoliver.com/idempotency-patterns/) del blog de Jonathan Oliver se ofrece una visión general de la idempotencia y cómo se relaciona con las operaciones de administración de datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-115">The article [Idempotency Patterns](https://blog.jonathanoliver.com/idempotency-patterns/) on Jonathan Oliver’s blog provides an overview of idempotency and how it relates to data management operations.</span></span>

### <a name="post-actions-that-create-new-resources-should-not-have-unrelated-side-effects"></a><span data-ttu-id="c4bc9-116">Las acciones POST que crean nuevos recursos no deben tener efectos secundarios no relacionados.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-116">POST actions that create new resources should not have unrelated side-effects</span></span>

<span data-ttu-id="c4bc9-117">Si el objetivo de una solicitud POST es crear un recurso nuevo, los efectos de la solicitud deben limitarse al nuevo recurso (y posiblemente cualquier recurso relacionado directamente si hay algún tipo de vinculación implicada). Por ejemplo, en un sistema de comercio electrónico, una solicitud POST que crea un nuevo pedido para un cliente podría también modificar los niveles del inventario y generar información de facturación, pero no debería modificar la información no relacionada directamente con el pedido o tener otros efectos secundarios en el estado general del sistema.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-117">If a POST request is intended to create a new resource, the effects of the request should be limited to the new resource (and possibly any directly related resources if there is some sort of linkage involved) For example, in an ecommerce system, a POST request that creates a new order for a customer might also amend inventory levels and generate billing information, but it should not modify information not directly related to the order or have any other side-effects on the overall state of the system.</span></span>

### <a name="avoid-implementing-chatty-post-put-and-delete-operations"></a><span data-ttu-id="c4bc9-118">Evite implementar operaciones POST, PUT y DELETE que generen mucha conversación.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-118">Avoid implementing chatty POST, PUT, and DELETE operations</span></span>

<span data-ttu-id="c4bc9-119">Admita las solicitudes POST, PUT y DELETE en las colecciones de recursos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-119">Support POST, PUT and DELETE requests over resource collections.</span></span> <span data-ttu-id="c4bc9-120">Una solicitud POST puede contener los detalles de varios recursos nuevos y agregarlos todos a la misma colección, una solicitud PUT puede reemplazar todo el conjunto de recursos de una colección y una solicitud DELETE puede eliminar una colección completa.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-120">A POST request can contain the details for multiple new resources and add them all to the same collection, a PUT request can replace the entire set of resources in a collection, and a DELETE request can remove an entire collection.</span></span>

<span data-ttu-id="c4bc9-121">La compatibilidad con OData que se incluye en API Web 2 de ASP.NET permite las solicitudes por lotes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-121">The OData support included in ASP.NET Web API 2 provides the ability to batch requests.</span></span> <span data-ttu-id="c4bc9-122">Una aplicación cliente puede empaquetar varias solicitudes de API web, enviarlas al servidor en una sola solicitud HTTP y recibir una respuesta HTTP única que contenga las respuestas a cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-122">A client application can package up several web API requests and send them to the server in a single HTTP request, and receive a single HTTP response that contains the replies to each request.</span></span> <span data-ttu-id="c4bc9-123">Para más información, consulte [Introducing Batch Support in Web API and Web API OData](https://blogs.msdn.microsoft.com/webdev/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata/) (Incorporación de compatibilidad para procesos por lotes en Web API Y Web API OData).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-123">For more information, [Introducing Batch Support in Web API and Web API OData](https://blogs.msdn.microsoft.com/webdev/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata/).</span></span>

### <a name="follow-the-http-specification-when-sending-a-response"></a><span data-ttu-id="c4bc9-124">Siga la especificación HTTP al enviar una respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-124">Follow the HTTP specification when sending a response</span></span>

<span data-ttu-id="c4bc9-125">Una API web debe devolver mensajes que contengan el código de estado HTTP correcto para que el cliente determine cómo quiere controlar el resultado, los encabezados HTTP adecuados para que el cliente entienda la naturaleza de los resultados y un cuerpo con el formato apropiado para que el cliente analice los resultados.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-125">A web API must return messages that contain the correct HTTP status code to enable the client to determine how to handle the result, the appropriate HTTP headers so that the client understands the nature of the result, and a suitably formatted body to enable the client to parse the result.</span></span>

<span data-ttu-id="c4bc9-126">Por ejemplo, una operación POST debe devolver el código de estado 201 (creado) y el mensaje de respuesta debe incluir el URI del recurso recién creado en el encabezado Location del mensaje de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-126">For example, a POST operation should return status code 201 (Created) and the response message should include the URI of the newly created resource in the Location header of the response message.</span></span>

### <a name="support-content-negotiation"></a><span data-ttu-id="c4bc9-127">Admita la negociación de contenido.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-127">Support content negotiation</span></span>

<span data-ttu-id="c4bc9-128">El cuerpo de un mensaje de respuesta puede contener datos en una variedad de formatos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-128">The body of a response message may contain data in a variety of formats.</span></span> <span data-ttu-id="c4bc9-129">Por ejemplo, una solicitud HTTP GET podría devolver datos en formato JSON o XML.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-129">For example, an HTTP GET request could return data in JSON, or XML format.</span></span> <span data-ttu-id="c4bc9-130">Cuando el cliente envía una solicitud, puede incluir un encabezado Accept que especifica los formatos de datos que puede controlar.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-130">When the client submits a request, it can include an Accept header that specifies the data formats that it can handle.</span></span> <span data-ttu-id="c4bc9-131">Estos formatos se especifican como tipos de medios.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-131">These formats are specified as media types.</span></span> <span data-ttu-id="c4bc9-132">Por ejemplo, un cliente que emite una solicitud GET para recuperar una imagen puede especificar un encabezado Accept que enumere los tipos de medios que el cliente puede administrar, como por ejemplo `image/jpeg, image/gif, image/png`.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-132">For example, a client that issues a GET request that retrieves an image can specify an Accept header that lists the media types that the client can handle, such as `image/jpeg, image/gif, image/png`.</span></span> <span data-ttu-id="c4bc9-133">Cuando la API web devuelve el resultado, debe dar formato a los datos con uno de estos tipos de medios y especificar el formato en el encabezado Content-Type de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-133">When the web API returns the result, it should format the data by using one of these media types and specify the format in the Content-Type header of the response.</span></span>

<span data-ttu-id="c4bc9-134">Si el cliente no especifica un encabezado Accept, use un formato predeterminado razonable para el cuerpo de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-134">If the client does not specify an Accept header, then use a sensible default format for the response body.</span></span> <span data-ttu-id="c4bc9-135">Por ejemplo, el tipo predeterminado del marco API Web de ASP.NET es JSON para datos basados en texto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-135">As an example, the ASP.NET Web API framework defaults to JSON for text-based data.</span></span>

### <a name="provide-links-to-support-hateoas-style-navigation-and-discovery-of-resources"></a><span data-ttu-id="c4bc9-136">Proporcione vínculos para admitir la navegación y la detección de recursos de estilo HATEOAS.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-136">Provide links to support HATEOAS-style navigation and discovery of resources</span></span>

<span data-ttu-id="c4bc9-137">El enfoque de HATEOAS permite que un cliente navegue y detecte recursos desde un punto de partida inicial.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-137">The HATEOAS approach enables a client to navigate and discover resources from an initial starting point.</span></span> <span data-ttu-id="c4bc9-138">Esto se logra mediante el uso de vínculos que contienen URI; Cuando un cliente emite una solicitud HTTP GET para obtener un recurso, la respuesta debe contener URI que permitan que una aplicación cliente localice rápidamente los recursos directamente relacionados.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-138">This is achieved by using links containing URIs; when a client issues an HTTP GET request to obtain a resource, the response should contain URIs that enable a client application to quickly locate any directly related resources.</span></span> <span data-ttu-id="c4bc9-139">Por ejemplo, en una API web que admita una solución de comercio electrónico, un cliente puede haber realizado muchos pedidos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-139">For example, in a web API that supports an e-commerce solution, a customer may have placed many orders.</span></span> <span data-ttu-id="c4bc9-140">Cuando una aplicación cliente recupera los detalles de un cliente, la respuesta debe incluir vínculos que permitan que la aplicación cliente envíe solicitudes HTTP GET que pueden recuperar esos pedidos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-140">When a client application retrieves the details for a customer, the response should include links that enable the client application to send HTTP GET requests that can retrieve these orders.</span></span> <span data-ttu-id="c4bc9-141">Además, los vínculos de estilo HATEOAS deben describir las demás operaciones (POST, PUT, DELETE, etc.) que admite cada recurso vinculado junto con el URI correspondiente para realizar cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-141">Additionally, HATEOAS-style links should describe the other operations (POST, PUT, DELETE, and so on) that each linked resource supports together with the corresponding URI to perform each request.</span></span> <span data-ttu-id="c4bc9-142">Este enfoque se describe con más detalle en [Diseño de API][api-design].</span><span class="sxs-lookup"><span data-stu-id="c4bc9-142">This approach is described in more detail in [API Design][api-design].</span></span>

<span data-ttu-id="c4bc9-143">Actualmente no hay estándares que rijan la implementación de HATEOAS, pero en el ejemplo siguiente se muestra un posible enfoque.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-143">Currently there are no standards that govern the implementation of HATEOAS, but the following example illustrates one possible approach.</span></span> <span data-ttu-id="c4bc9-144">En este ejemplo, una solicitud HTTP GET que encuentre los detalles de un cliente devuelve una respuesta que incluye vínculos de HATEOAS que hacen referencia a los pedidos de ese cliente:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-144">In this example, an HTTP GET request that finds the details for a customer returns a response that include HATEOAS links that reference the orders for that customer:</span></span>

```HTTP
GET https://adventure-works.com/customers/2 HTTP/1.1
Accept: text/json
...
```

```HTTP
HTTP/1.1 200 OK
...
Content-Type: application/json; charset=utf-8
...
Content-Length: ...
{"CustomerID":2,"CustomerName":"Bert","Links":[
    {"rel":"self",
    "href":"https://adventure-works.com/customers/2",
    "action":"GET",
    "types":["text/xml","application/json"]},
    {"rel":"self",
    "href":"https://adventure-works.com/customers/2",
    "action":"PUT",
    "types":["application/x-www-form-urlencoded"]},
    {"rel":"self",
    "href":"https://adventure-works.com/customers/2",
    "action":"DELETE",
    "types":[]},
    {"rel":"orders",
    "href":"https://adventure-works.com/customers/2/orders",
    "action":"GET",
    "types":["text/xml","application/json"]},
    {"rel":"orders",
    "href":"https://adventure-works.com/customers/2/orders",
    "action":"POST",
    "types":["application/x-www-form-urlencoded"]}
]}
```

<span data-ttu-id="c4bc9-145">En este ejemplo, los datos del cliente se representan mediante la clase `Customer` que se muestra en el siguiente fragmento de código.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-145">In this example, the customer data is represented by the `Customer` class shown in the following code snippet.</span></span> <span data-ttu-id="c4bc9-146">Los vínculos de HATEOAS se mantienen en la propiedad de la colección `Links` :</span><span class="sxs-lookup"><span data-stu-id="c4bc9-146">The HATEOAS links are held in the `Links` collection property:</span></span>

```csharp
public class Customer
{
    public int CustomerID { get; set; }
    public string CustomerName { get; set; }
    public List<Link> Links { get; set; }
    ...
}

public class Link
{
    public string Rel { get; set; }
    public string Href { get; set; }
    public string Action { get; set; }
    public string [] Types { get; set; }
}
```

<span data-ttu-id="c4bc9-147">La operación HTTP GET recupera los datos del cliente del almacenamiento, construye un objeto `Customer` y, después, rellena la colección `Links`.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-147">The HTTP GET operation retrieves the customer data from storage and constructs a `Customer` object, and then populates the `Links` collection.</span></span> <span data-ttu-id="c4bc9-148">El resultado tiene el formato de un mensaje de respuesta JSON.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-148">The result is formatted as a JSON response message.</span></span> <span data-ttu-id="c4bc9-149">Cada vínculo consta de los siguientes campos:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-149">Each link comprises the following fields:</span></span>

- <span data-ttu-id="c4bc9-150">La relación entre el objeto que se devuelve y el objeto que describe el vínculo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-150">The relationship between the object being returned and the object described by the link.</span></span> <span data-ttu-id="c4bc9-151">En este caso `self` indica que el vínculo es una referencia al propio objeto (similar a un puntero `this` en muchos lenguajes orientados a objetos) y `orders` es el nombre de una colección que contiene la información de pedido relacionada.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-151">In this case `self` indicates that the link is a reference back to the object itself (similar to a `this` pointer in many object-oriented languages), and `orders` is the name of a collection containing the related order information.</span></span>
- <span data-ttu-id="c4bc9-152">El hipervínculo (`Href`) del objeto que describe el vínculo tiene la forma de un URI.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-152">The hyperlink (`Href`) for the object being described by the link in the form of a URI.</span></span>
- <span data-ttu-id="c4bc9-153">El tipo de solicitud HTTP (`Action`) que se puede enviar a este URI.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-153">The type of HTTP request (`Action`) that can be sent to this URI.</span></span>
- <span data-ttu-id="c4bc9-154">El formato de los datos (`Types`) que deben facilitarse en la solicitud HTTP o que se pueden devolver en la respuesta, según el tipo de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-154">The format of any data (`Types`) that should be provided in the HTTP request or that can be returned in the response, depending on the type of the request.</span></span>

<span data-ttu-id="c4bc9-155">Los vínculos de HATEOAS que se muestran en la respuesta HTTP de ejemplo indican que una aplicación cliente puede realizar las siguientes operaciones:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-155">The HATEOAS links shown in the example HTTP response indicate that a client application can perform the following operations:</span></span>

- <span data-ttu-id="c4bc9-156">Una solicitud HTTP GET al URI `https://adventure-works.com/customers/2` para capturar los detalles del cliente (nuevamente).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-156">An HTTP GET request to the URI `https://adventure-works.com/customers/2` to fetch the details of the customer (again).</span></span> <span data-ttu-id="c4bc9-157">Los datos se pueden devolver como XML o JSON.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-157">The data can be returned as XML or JSON.</span></span>
- <span data-ttu-id="c4bc9-158">Una solicitud HTTP PUT al URI `https://adventure-works.com/customers/2` para modificar los detalles del cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-158">An HTTP PUT request to the URI `https://adventure-works.com/customers/2` to modify the details of the customer.</span></span> <span data-ttu-id="c4bc9-159">Los nuevos datos se deben facilitar en el mensaje de solicitud en formato x-www-form-urlencoded.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-159">The new data must be provided in the request message in x-www-form-urlencoded format.</span></span>
- <span data-ttu-id="c4bc9-160">Una solicitud HTTP DELETE al URI `https://adventure-works.com/customers/2` para eliminar el cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-160">An HTTP DELETE request to the URI `https://adventure-works.com/customers/2` to delete the customer.</span></span> <span data-ttu-id="c4bc9-161">La solicitud no espera ninguna información adicional ni datos devueltos en el cuerpo del mensaje de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-161">The request does not expect any additional information or return data in the response message body.</span></span>
- <span data-ttu-id="c4bc9-162">Una solicitud HTTP GET al URI `https://adventure-works.com/customers/2/orders` para buscar todos los pedidos del cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-162">An HTTP GET request to the URI `https://adventure-works.com/customers/2/orders` to find all the orders for the customer.</span></span> <span data-ttu-id="c4bc9-163">Los datos se pueden devolver como XML o JSON.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-163">The data can be returned as XML or JSON.</span></span>
- <span data-ttu-id="c4bc9-164">Una solicitud HTTP PUT al URI `https://adventure-works.com/customers/2/orders` para crear un nuevo pedido para este cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-164">An HTTP PUT request to the URI `https://adventure-works.com/customers/2/orders` to create a new order for this customer.</span></span> <span data-ttu-id="c4bc9-165">Los datos se deben facilitar en el mensaje de solicitud en formato x-www-form-urlencoded.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-165">The data must be provided in the request message in x-www-form-urlencoded format.</span></span>

## <a name="handling-exceptions"></a><span data-ttu-id="c4bc9-166">Control de excepciones</span><span class="sxs-lookup"><span data-stu-id="c4bc9-166">Handling exceptions</span></span>

<span data-ttu-id="c4bc9-167">Tenga en cuenta lo siguiente si una operación produce una excepción no detectada.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-167">Consider the following points if an operation throws an uncaught exception.</span></span>

### <a name="capture-exceptions-and-return-a-meaningful-response-to-clients"></a><span data-ttu-id="c4bc9-168">Capture las excepciones y devuelva una respuesta significativa a los clientes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-168">Capture exceptions and return a meaningful response to clients</span></span>

<span data-ttu-id="c4bc9-169">El código que implementa una operación HTTP debe proporcionar un control total de las excepciones en lugar de permitir que las excepciones no detectadas se propaguen al marco.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-169">The code that implements an HTTP operation should provide comprehensive exception handling rather than letting uncaught exceptions propagate to the framework.</span></span> <span data-ttu-id="c4bc9-170">Si una excepción impide que se complete correctamente la operación, puede devolver la excepción en el mensaje de respuesta, pero debe incluir una descripción significativa del error que provocó la excepción.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-170">If an exception makes it impossible to complete the operation successfully, the exception can be passed back in the response message, but it should include a meaningful description of the error that caused the exception.</span></span> <span data-ttu-id="c4bc9-171">La excepción también debe incluir el código de estado HTTP adecuado, en lugar de simplemente devolver el código de estado 500 para todas las situaciones.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-171">The exception should also include the appropriate HTTP status code rather than simply returning status code 500 for every situation.</span></span> <span data-ttu-id="c4bc9-172">Por ejemplo, si una solicitud de usuario provoca una actualización de la base de datos que infringe una restricción (por ejemplo, intenta eliminar un cliente que tiene pedidos pendientes), se debe devolver el código de estado 409 (conflicto) y un cuerpo de mensaje que indique el motivo del conflicto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-172">For example, if a user request causes a database update that violates a constraint (such as attempting to delete a customer that has outstanding orders), you should return status code 409 (Conflict) and a message body indicating the reason for the conflict.</span></span> <span data-ttu-id="c4bc9-173">Si alguna otra condición hace que la solicitud no se pueda procesar, puede devolver un código de estado 400 (solicitud incorrecta).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-173">If some other condition renders the request unachievable, you can return status code 400 (Bad Request).</span></span> <span data-ttu-id="c4bc9-174">Puede encontrar una lista completa de códigos de estado HTTP en la página [Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) del sitio web de W3C.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-174">You can find a full list of HTTP status codes on the [Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) page on the W3C website.</span></span>

<span data-ttu-id="c4bc9-175">El código de ejemplo intercepta diferentes condiciones y devuelve una respuesta adecuada.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-175">The code example traps different conditions and returns an appropriate response.</span></span>

```csharp
[HttpDelete]
[Route("customers/{id:int}")]
public IHttpActionResult DeleteCustomer(int id)
{
    try
    {
        // Find the customer to be deleted in the repository
        var customerToDelete = repository.GetCustomer(id);

        // If there is no such customer, return an error response
        // with status code 404 (Not Found)
        if (customerToDelete == null)
        {
                return NotFound();
        }

        // Remove the customer from the repository
        // The DeleteCustomer method returns true if the customer
        // was successfully deleted
        if (repository.DeleteCustomer(id))
        {
            // Return a response message with status code 204 (No Content)
            // To indicate that the operation was successful
            return StatusCode(HttpStatusCode.NoContent);
        }
        else
        {
            // Otherwise return a 400 (Bad Request) error response
            return BadRequest(Strings.CustomerNotDeleted);
        }
    }
    catch
    {
        // If an uncaught exception occurs, return an error response
        // with status code 500 (Internal Server Error)
        return InternalServerError();
    }
}
```

> [!TIP]
> <span data-ttu-id="c4bc9-176">No incluya información que pueda ser útil para un atacante que intenta entrar en su API.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-176">Do not include information that could be useful to an attacker attempting to penetrate your API.</span></span>
  
<span data-ttu-id="c4bc9-177">Muchos servidores web interceptan condiciones de error por sí mismos antes de que lleguen a la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-177">Many web servers trap error conditions themselves before they reach the web API.</span></span> <span data-ttu-id="c4bc9-178">Por ejemplo, si configura la autenticación de un sitio web y el usuario no proporciona la información de autenticación correcta, el servidor web debe responder con código de estado 401 (no autorizado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-178">For example, if you configure authentication for a web site and the user fails to provide the correct authentication information, the web server should respond with status code 401 (Unauthorized).</span></span> <span data-ttu-id="c4bc9-179">Cuando un cliente se ha autenticado, el código puede realizar sus propias comprobaciones para asegurarse de que el cliente puede obtener acceso al recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-179">Once a client has been authenticated, your code can perform its own checks to verify that the client should be able access the requested resource.</span></span> <span data-ttu-id="c4bc9-180">Si se produce un error en esta autorización, debe devolver un código de estado 403 (prohibido).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-180">If this authorization fails, you should return status code 403 (Forbidden).</span></span>

### <a name="handle-exceptions-consistently-and-log-information-about-errors"></a><span data-ttu-id="c4bc9-181">Controle las excepciones de una forma coherente y registre la información sobre los errores.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-181">Handle exceptions consistently and log information about errors</span></span>

<span data-ttu-id="c4bc9-182">Para controlar las excepciones de una manera coherente, considere la posibilidad de implementar una estrategia global de control de errores para toda la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-182">To handle exceptions in a consistent manner, consider implementing a global error handling strategy across the entire web API.</span></span> <span data-ttu-id="c4bc9-183">También debería incluir el registro de errores que captura los detalles completos de cada excepción; este registro de errores puede contener información detallada siempre y cuando los clientes a través de la web no tengan acceso a ella.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-183">You should also incorporate error logging which captures the full details of each exception; this error log can contain detailed information as long as it is not made accessible over the web to clients.</span></span>

### <a name="distinguish-between-client-side-errors-and-server-side-errors"></a><span data-ttu-id="c4bc9-184">Distinga entre los errores del lado cliente y del lado servidor.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-184">Distinguish between client-side errors and server-side errors</span></span>

<span data-ttu-id="c4bc9-185">El protocolo HTTP distingue entre los errores que se producen debido a la aplicación de cliente (los códigos de estado HTTP 4xx) y los errores causados por un problema en el servidor (los códigos de estado HTTP 5xx).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-185">The HTTP protocol distinguishes between errors that occur due to the client application (the HTTP 4xx status codes), and errors that are caused by a mishap on the server (the HTTP 5xx status codes).</span></span> <span data-ttu-id="c4bc9-186">Asegúrese de que respeta esta convención en los mensajes de error de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-186">Make sure that you respect this convention in any error response messages.</span></span>

## <a name="optimizing-client-side-data-access"></a><span data-ttu-id="c4bc9-187">Optimización del acceso a los datos en el lado cliente</span><span class="sxs-lookup"><span data-stu-id="c4bc9-187">Optimizing client-side data access</span></span>

<span data-ttu-id="c4bc9-188">En un entorno distribuido, como los que implican un servidor web y aplicaciones cliente, una de las principales fuentes de preocupación es la red.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-188">In a distributed environment such as that involving a web server and client applications, one of the primary sources of concern is the network.</span></span> <span data-ttu-id="c4bc9-189">Puede actuar como un considerable cuello de botella, especialmente si una aplicación cliente envía solicitudes o recibe datos con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-189">This can act as a considerable bottleneck, especially if a client application is frequently sending requests or receiving data.</span></span> <span data-ttu-id="c4bc9-190">Por lo tanto, se debe tratar de minimizar la cantidad de tráfico que fluye a través de la red.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-190">Therefore you should aim to minimize the amount of traffic that flows across the network.</span></span> <span data-ttu-id="c4bc9-191">Tenga en cuenta los puntos siguientes cuando implemente el código para recuperar y mantener datos:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-191">Consider the following points when you implement the code to retrieve and maintain data:</span></span>

### <a name="support-client-side-caching"></a><span data-ttu-id="c4bc9-192">Admita el almacenamiento en caché del lado cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-192">Support client-side caching</span></span>

<span data-ttu-id="c4bc9-193">El protocolo HTTP 1.1 admite el almacenamiento en caché de los clientes y servidores intermedios a través de los cuales se enruta una solicitud mediante el uso del encabezado Cache-Control.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-193">The HTTP 1.1 protocol supports caching in clients and intermediate servers through which a request is routed by the use of the Cache-Control header.</span></span> <span data-ttu-id="c4bc9-194">Cuando una aplicación cliente envía una solicitud HTTP GET a la API web, la respuesta puede incluir un encabezado Cache-Control que indique si los datos en el cuerpo de la respuesta pueden almacenarse en caché de forma segura por parte del cliente o un servidor intermedio a través del cual se ha enrutado la solicitud, y cuánto tiempo debe pasar antes de que expiren y se consideren caducados.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-194">When a client application sends an HTTP GET request to the web API, the response can include a Cache-Control header that indicates whether the data in the body of the response can be safely cached by the client or an intermediate server through which the request has been routed, and for how long before it should expire and be considered out-of-date.</span></span> <span data-ttu-id="c4bc9-195">En el ejemplo siguiente se muestra una solicitud HTTP GET y la respuesta correspondiente que incluye un encabezado Cache-Control:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-195">The following example shows an HTTP GET request and the corresponding response that includes a Cache-Control header:</span></span>

```HTTP
GET https://adventure-works.com/orders/2 HTTP/1.1
```

```HTTP
HTTP/1.1 200 OK
...
Cache-Control: max-age=600, private
Content-Type: text/json; charset=utf-8
Content-Length: ...
{"orderID":2,"productID":4,"quantity":2,"orderValue":10.00}
```

<span data-ttu-id="c4bc9-196">En este ejemplo, el encabezado Cache-Control especifica que los datos devueltos deben expirar a los 600 segundos, solo son adecuados para un solo cliente y no deben almacenarse en una memoria caché compartida que usen otros clientes (es *private*).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-196">In this example, the Cache-Control header specifies that the data returned should be expired after 600 seconds, and is only suitable for a single client and must not be stored in a shared cache used by other clients (it is *private*).</span></span> <span data-ttu-id="c4bc9-197">El encabezado Cache-Control podría especificar *public* en lugar de *private*, en cuyo caso los datos pueden almacenarse en una memoria caché compartida, o puede especificar *no-store*, en cuyo caso el cliente **no** debe almacenar los datos en memoria caché.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-197">The Cache-Control header could specify *public* rather than *private* in which case the data can be stored in a shared cache, or it could specify *no-store* in which case the data must **not** be cached by the client.</span></span> <span data-ttu-id="c4bc9-198">En el ejemplo de código siguiente se muestra cómo construir un encabezado Cache-Control en un mensaje de respuesta:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-198">The following code example shows how to construct a Cache-Control header in a response message:</span></span>

```csharp
public class OrdersController : ApiController
{
    ...
    [Route("api/orders/{id:int:min(0)}")]
    [HttpGet]
    public IHttpActionResult FindOrderByID(int id)
    {
        // Find the matching order
        Order order = ...;
        ...
        // Create a Cache-Control header for the response
        var cacheControlHeader = new CacheControlHeaderValue();
        cacheControlHeader.Private = true;
        cacheControlHeader.MaxAge = new TimeSpan(0, 10, 0);
        ...

        // Return a response message containing the order and the cache control header
        OkResultWithCaching<Order> response = new OkResultWithCaching<Order>(order, this)
        {
            CacheControlHeader = cacheControlHeader
        };
        return response;
    }
    ...
}
```

<span data-ttu-id="c4bc9-199">Este código usa una clase `IHttpActionResult` personalizada denominada `OkResultWithCaching`.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-199">This code makes use of a custom `IHttpActionResult` class named `OkResultWithCaching`.</span></span> <span data-ttu-id="c4bc9-200">Esta clase permite que el controlador establezca el contenido de encabezado de la memoria caché:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-200">This class enables the controller to set the cache header contents:</span></span>

```csharp
public class OkResultWithCaching<T> : OkNegotiatedContentResult<T>
{
    public OkResultWithCaching(T content, ApiController controller)
        : base(content, controller) { }

    public OkResultWithCaching(T content, IContentNegotiator contentNegotiator, HttpRequestMessage request, IEnumerable<MediaTypeFormatter> formatters)
        : base(content, contentNegotiator, request, formatters) { }

    public CacheControlHeaderValue CacheControlHeader { get; set; }
    public EntityTagHeaderValue ETag { get; set; }

    public override async Task<HttpResponseMessage> ExecuteAsync(CancellationToken cancellationToken)
    {
        HttpResponseMessage response;
        try
        {
            response = await base.ExecuteAsync(cancellationToken);
            response.Headers.CacheControl = this.CacheControlHeader;
            response.Headers.ETag = ETag;
        }
        catch (OperationCanceledException)
        {
            response = new HttpResponseMessage(HttpStatusCode.Conflict) {ReasonPhrase = "Operation was cancelled"};
        }
        return response;
    }
}
```

> [!NOTE]
> <span data-ttu-id="c4bc9-201">El protocolo HTTP también define la directiva *no-cache* para el encabezado Cache-Control.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-201">The HTTP protocol also defines the *no-cache* directive for the Cache-Control header.</span></span> <span data-ttu-id="c4bc9-202">De forma bastante confusa, esta directiva no significa "no almacenar en memoria caché", sino "volver a validar la información almacenada en caché con el servidor antes de devolverla"; los datos siguen pudiendo almacenarse en memoria caché, pero se comprueban cada vez que se usan para asegurar que sigan siendo actuales.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-202">Rather confusingly, this directive does not mean "do not cache" but rather "revalidate the cached information with the server before returning it"; the data can still be cached, but it is checked each time it is used to ensure that it is still current.</span></span>

<span data-ttu-id="c4bc9-203">La administración en memoria caché es responsabilidad de la aplicación cliente o el servidor intermedio, pero si se implementa correctamente, puede ahorrar ancho de banda y mejorar el rendimiento, eliminando la necesidad de capturar los datos que ya se ha recuperado recientemente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-203">Cache management is the responsibility of the client application or intermediate server, but if properly implemented it can save bandwidth and improve performance by removing the need to fetch data that has already been recently retrieved.</span></span>

<span data-ttu-id="c4bc9-204">El valor de *max-age* en el encabezado Cache-Control es solo una guía y no una garantía de que los datos correspondientes no cambiarán durante el tiempo especificado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-204">The *max-age* value in the Cache-Control header is only a guide and not a guarantee that the corresponding data won't change during the specified time.</span></span> <span data-ttu-id="c4bc9-205">La API web debe establecer max-age en un valor adecuado según la volatilidad esperada de los datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-205">The web API should set the max-age to a suitable value depending on the expected volatility of the data.</span></span> <span data-ttu-id="c4bc9-206">Cuando expire este período, el cliente debería descartar el objeto de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-206">When this period expires, the client should discard the object from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="c4bc9-207">La mayoría de los exploradores web modernos admiten el almacenamiento en memoria caché del lado cliente, agregando los encabezados cache-control adecuados a las solicitudes y examinando los encabezados de los resultados, como se describe.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-207">Most modern web browsers support client-side caching by adding the appropriate cache-control headers to requests and examining the headers of the results, as described.</span></span> <span data-ttu-id="c4bc9-208">Sin embargo, algunos exploradores más antiguos no almacenarán en memoria caché los valores devueltos desde una dirección URL que incluya una cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-208">However, some older browsers will not cache the values returned from a URL that includes a query string.</span></span> <span data-ttu-id="c4bc9-209">Normalmente, esto no es un problema para las aplicaciones de cliente personalizadas que implementan su propia estrategia de administración de la memoria caché basada en el protocolo que se trata aquí.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-209">This is not usually an issue for custom client applications which implement their own cache management strategy based on the protocol discussed here.</span></span>
>
> <span data-ttu-id="c4bc9-210">Algunos servidores proxy antiguos tienen el mismo comportamiento y podrían no almacenar en memoria caché las solicitudes basadas en direcciones URL con cadenas de consulta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-210">Some older proxies exhibit the same behavior and might not cache requests based on URLs with query strings.</span></span> <span data-ttu-id="c4bc9-211">Esto podría ser un problema para las aplicaciones cliente personalizadas que se conectan a un servidor web a través de un proxy de este tipo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-211">This could be an issue for custom client applications that connect to a web server through such a proxy.</span></span>

### <a name="provide-etags-to-optimize-query-processing"></a><span data-ttu-id="c4bc9-212">Proporcione ETags para optimizar el procesamiento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-212">Provide ETags to optimize query processing</span></span>

<span data-ttu-id="c4bc9-213">Cuando una aplicación cliente recupera un objeto, el mensaje de respuesta también puede incluir una *ETag* (etiqueta de entidad).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-213">When a client application retrieves an object, the response message can also include an *ETag* (Entity Tag).</span></span> <span data-ttu-id="c4bc9-214">Una ETag es una cadena opaca que indica la versión de un recurso; cada vez que un recurso cambia, también se modifica la Etag.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-214">An ETag is an opaque string that indicates the version of a resource; each time a resource changes the Etag is also modified.</span></span> <span data-ttu-id="c4bc9-215">Esta ETag debe almacenarse en memoria caché como parte de los datos de la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-215">This ETag should be cached as part of the data by the client application.</span></span> <span data-ttu-id="c4bc9-216">En el ejemplo de código siguiente se muestra cómo agregar una ETag como parte de la respuesta a una solicitud HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-216">The following code example shows how to add an ETag as part of the response to an HTTP GET request.</span></span> <span data-ttu-id="c4bc9-217">Este código usa el método `GetHashCode` de un objeto para generar un valor numérico que identifica el objeto (puede reemplazar este método si es necesario y generar su propio hash con un algoritmo como MD5):</span><span class="sxs-lookup"><span data-stu-id="c4bc9-217">This code uses the `GetHashCode` method of an object to generate a numeric value that identifies the object (you can override this method if necessary and generate your own hash using an algorithm such as MD5) :</span></span>

```csharp
public class OrdersController : ApiController
{
    ...
    public IHttpActionResult FindOrderByID(int id)
    {
        // Find the matching order
        Order order = ...;
        ...

        var hashedOrder = order.GetHashCode();
        string hashedOrderEtag = $"\"{hashedOrder}\"";
        var eTag = new EntityTagHeaderValue(hashedOrderEtag);

        // Return a response message containing the order and the cache control header
        OkResultWithCaching<Order> response = new OkResultWithCaching<Order>(order, this)
        {
            ...,
            ETag = eTag
        };
        return response;
    }
    ...
}
```

<span data-ttu-id="c4bc9-218">El mensaje de respuesta que publica la API web tiene este aspecto:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-218">The response message posted by the web API looks like this:</span></span>

```HTTP
HTTP/1.1 200 OK
...
Cache-Control: max-age=600, private
Content-Type: text/json; charset=utf-8
ETag: "2147483648"
Content-Length: ...
{"orderID":2,"productID":4,"quantity":2,"orderValue":10.00}
```

> [!TIP]
> <span data-ttu-id="c4bc9-219">Por motivos de seguridad, no permita que los datos confidenciales o los que se devuelvan a través de una conexión autenticada (HTTPS) se almacenen en memoria caché.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-219">For security reasons, do not allow sensitive data or data returned over an authenticated (HTTPS) connection to be cached.</span></span>

<span data-ttu-id="c4bc9-220">Una aplicación cliente puede emitir una solicitud GET posterior para recuperar el mismo recurso en cualquier momento y, si ha cambiado el recurso (tiene una ETag diferente), debe descartarse la versión en caché y agregarse la nueva versión a la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-220">A client application can issue a subsequent GET request to retrieve the same resource at any time, and if the resource has changed (it has a different ETag) the cached version should be discarded and the new version added to the cache.</span></span> <span data-ttu-id="c4bc9-221">Si un recurso es grande y requiere una gran cantidad de ancho de banda para transmitirse de vuelta al cliente, las solicitudes repetidas para capturar los mismos datos pueden resultar ineficaces.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-221">If a resource is large and requires a significant amount of bandwidth to transmit back to the client, repeated requests to fetch the same data can become inefficient.</span></span> <span data-ttu-id="c4bc9-222">Para combatir esta situación, el protocolo HTTP define el proceso siguiente para optimizar las solicitudes GET que se deben admitir en una API web:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-222">To combat this, the HTTP protocol defines the following process for optimizing GET requests that you should support in a web API:</span></span>

- <span data-ttu-id="c4bc9-223">El cliente crea una solicitud GET que contiene la ETag de la versión actualmente en caché del recurso al que hace referencia en un encabezado If-None-Match HTTP:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-223">The client constructs a GET request containing the ETag for the currently cached version of the resource referenced in an If-None-Match HTTP header:</span></span>

    ```HTTP
    GET https://adventure-works.com/orders/2 HTTP/1.1
    If-None-Match: "2147483648"
    ```

- <span data-ttu-id="c4bc9-224">La operación GET de la API web obtiene la ETag actual de los datos solicitados (el pedido 2 en el ejemplo anterior) y la compara con el valor del encabezado If-None-Match.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-224">The GET operation in the web API obtains the current ETag for the requested data (order 2 in the above example), and compares it to the value in the If-None-Match header.</span></span>

- <span data-ttu-id="c4bc9-225">Si la ETag actual de los datos solicitados coincide con la que proporciona la solicitud, el recurso no ha cambiado y la API web debe devolver una respuesta HTTP con un cuerpo de mensaje vacío y un código de estado 304 (no modificado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-225">If the current ETag for the requested data matches the ETag provided by the request, the resource has not changed and the web API should return an HTTP response with an empty message body and a status code of 304 (Not Modified).</span></span>

- <span data-ttu-id="c4bc9-226">Si la ETag actual de los datos solicitados no coincide con la que proporciona la solicitud, los datos han cambiado y la API web debe devolver una respuesta HTTP con los datos nuevos en el cuerpo del mensaje y un código de estado 200 (correcto).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-226">If the current ETag for the requested data does not match the ETag provided by the request, then the data has changed and the web API should return an HTTP response with the new data in the message body and a status code of 200 (OK).</span></span>

- <span data-ttu-id="c4bc9-227">Si los datos solicitados ya no existen, la API web debe devolver una respuesta HTTP con el código de estado 404 (no encontrado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-227">If the requested data no longer exists then the web API should return an HTTP response with the status code of 404 (Not Found).</span></span>

- <span data-ttu-id="c4bc9-228">El cliente usa el código de estado para mantener la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-228">The client uses the status code to maintain the cache.</span></span> <span data-ttu-id="c4bc9-229">Si los datos no ha cambiado (código de estado 304), el objeto puede permanecer en la memoria caché y la aplicación cliente debe seguir usando esta versión del objeto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-229">If the data has not changed (status code 304) then the object can remain cached and the client application should continue to use this version of the object.</span></span> <span data-ttu-id="c4bc9-230">Si los datos han cambiado (código de estado 200), debe descartarse el objeto almacenado en caché e insertarse uno nuevo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-230">If the data has changed (status code 200) then the cached object should be discarded and the new one inserted.</span></span> <span data-ttu-id="c4bc9-231">Si los datos ya no están disponibles (código de estado 404), el objeto debe quitarse de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-231">If the data is no longer available (status code 404) then the object should be removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="c4bc9-232">Si el encabezado de la respuesta contiene el encabezado Cache-Control no-store, el objeto debe quitarse siempre de la memoria caché sin tener en cuenta el código de estado HTTP.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-232">If the response header contains the Cache-Control header no-store then the object should always be removed from the cache regardless of the HTTP status code.</span></span>

<span data-ttu-id="c4bc9-233">El código siguiente muestra el método `FindOrderByID` extendido para admitir el encabezado If-None-Match.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-233">The code below shows the `FindOrderByID` method extended to support the If-None-Match header.</span></span> <span data-ttu-id="c4bc9-234">Tenga en cuenta que si se omite el encabezado If-None-Match, siempre se recupera el pedido especificado:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-234">Notice that if the If-None-Match header is omitted, the specified order is always retrieved:</span></span>

```csharp
public class OrdersController : ApiController
{
    [Route("api/orders/{id:int:min(0)}")]
    [HttpGet]
    public IHttpActionResult FindOrderByID(int id)
    {
        try
        {
            // Find the matching order
            Order order = ...;

            // If there is no such order then return NotFound
            if (order == null)
            {
                return NotFound();
            }

            // Generate the ETag for the order
            var hashedOrder = order.GetHashCode();
            string hashedOrderEtag = $"\"{hashedOrder}\"";

            // Create the Cache-Control and ETag headers for the response
            IHttpActionResult response;
            var cacheControlHeader = new CacheControlHeaderValue();
            cacheControlHeader.Public = true;
            cacheControlHeader.MaxAge = new TimeSpan(0, 10, 0);
            var eTag = new EntityTagHeaderValue(hashedOrderEtag);

            // Retrieve the If-None-Match header from the request (if it exists)
            var nonMatchEtags = Request.Headers.IfNoneMatch;

            // If there is an ETag in the If-None-Match header and
            // this ETag matches that of the order just retrieved,
            // then create a Not Modified response message
            if (nonMatchEtags.Count > 0 &&
                String.CompareOrdinal(nonMatchEtags.First().Tag, hashedOrderEtag) == 0)
            {
                response = new EmptyResultWithCaching()
                {
                    StatusCode = HttpStatusCode.NotModified,
                    CacheControlHeader = cacheControlHeader,
                    ETag = eTag
                };
            }
            // Otherwise create a response message that contains the order details
            else
            {
                response = new OkResultWithCaching<Order>(order, this)
                {
                    CacheControlHeader = cacheControlHeader,
                    ETag = eTag
                };
            }

            return response;
        }
        catch
        {
            return InternalServerError();
        }
    }
...
}
```

<span data-ttu-id="c4bc9-235">Este ejemplo incorpora una clase `IHttpActionResult` personalizada adicional denominada `EmptyResultWithCaching`.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-235">This example incorporates an additional custom `IHttpActionResult` class named `EmptyResultWithCaching`.</span></span> <span data-ttu-id="c4bc9-236">Esta clase solo actúa como un contenedor alrededor de un objeto `HttpResponseMessage` que no contiene un cuerpo de respuesta:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-236">This class simply acts as a wrapper around an `HttpResponseMessage` object that does not contain a response body:</span></span>

```csharp
public class EmptyResultWithCaching : IHttpActionResult
{
    public CacheControlHeaderValue CacheControlHeader { get; set; }
    public EntityTagHeaderValue ETag { get; set; }
    public HttpStatusCode StatusCode { get; set; }
    public Uri Location { get; set; }

    public async Task<HttpResponseMessage> ExecuteAsync(CancellationToken cancellationToken)
    {
        HttpResponseMessage response = new HttpResponseMessage(StatusCode);
        response.Headers.CacheControl = this.CacheControlHeader;
        response.Headers.ETag = this.ETag;
        response.Headers.Location = this.Location;
        return response;
    }
}
```

> [!TIP]
> <span data-ttu-id="c4bc9-237">En este ejemplo, la ETag para los datos se genera mediante la aplicación de un algoritmo hash a los datos recuperados del origen de datos subyacente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-237">In this example, the ETag for the data is generated by hashing the data retrieved from the underlying data source.</span></span> <span data-ttu-id="c4bc9-238">Si la ETag se puede calcular de alguna otra manera, es posible optimizar aún más el proceso y los datos solo deben capturarse desde el origen de datos si han cambiado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-238">If the ETag can be computed in some other way, then the process can be optimized further and the data only needs to be fetched from the data source if it has changed.</span></span> <span data-ttu-id="c4bc9-239">Este enfoque es especialmente útil si los datos son grandes o el acceso al origen de datos puede provocar una latencia significativa (por ejemplo, si el origen de datos es una base de datos remota).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-239">This approach is especially useful if the data is large or accessing the data source can result in significant latency (for example, if the data source is a remote database).</span></span>

### <a name="use-etags-to-support-optimistic-concurrency"></a><span data-ttu-id="c4bc9-240">Use ETags para admitir la simultaneidad optimista.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-240">Use ETags to Support Optimistic Concurrency</span></span>

<span data-ttu-id="c4bc9-241">Para habilitar las actualizaciones en datos anteriormente almacenados en caché, el protocolo HTTP admite una estrategia de simultaneidad optimista.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-241">To enable updates over previously cached data, the HTTP protocol supports an optimistic concurrency strategy.</span></span> <span data-ttu-id="c4bc9-242">Si, después de capturar y almacenar en caché un recurso, la aplicación cliente envía posteriormente una solicitud PUT o DELETE para cambiar o quitar el recurso, debe incluir un encabezado If-Match que haga referencia a la ETag.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-242">If, after fetching and caching a resource, the client application subsequently sends a PUT or DELETE request to change or remove the resource, it should include in If-Match header that references the ETag.</span></span> <span data-ttu-id="c4bc9-243">La API web puede entonces usar esta información para determinar si otro usuario ha cambiado ya el recurso desde que se recuperó y enviar una respuesta adecuada de vuelta a la aplicación cliente, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-243">The web API can then use this information to determine whether the resource has already been changed by another user since it was retrieved and send an appropriate response back to the client application as follows:</span></span>

- <span data-ttu-id="c4bc9-244">El cliente crea una solicitud PUT que contiene los nuevos detalles para el recurso y la ETag de la versión actualmente en caché del recurso al que hace referencia en un encabezado If-Match HTTP:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-244">The client constructs a PUT request containing the new details for the resource and the ETag for the currently cached version of the resource referenced in an If-Match HTTP header.</span></span> <span data-ttu-id="c4bc9-245">En el ejemplo siguiente se muestra una solicitud PUT que actualiza un pedido:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-245">The following example shows a PUT request that updates an order:</span></span>

    ```HTTP
    PUT https://adventure-works.com/orders/1 HTTP/1.1
    If-Match: "2282343857"
    Content-Type: application/x-www-form-urlencoded
    Content-Length: ...
    productID=3&quantity=5&orderValue=250
    ```

- <span data-ttu-id="c4bc9-246">La operación PUT de la API web obtiene la ETag actual de los datos solicitados (el pedido 1 en el ejemplo anterior) y la compara con el valor del encabezado If-Match.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-246">The PUT operation in the web API obtains the current ETag for the requested data (order 1 in the above example), and compares it to the value in the If-Match header.</span></span>

- <span data-ttu-id="c4bc9-247">Si la ETag actual de los datos solicitados coincide con la que proporciona la solicitud, el recurso no ha cambiado y la API web debe realizar la actualización y devolver un mensaje con el código de estado HTTP 204 (sin contenido).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-247">If the current ETag for the requested data matches the ETag provided by the request, the resource has not changed and the web API should perform the update, returning a message with HTTP status code 204 (No Content) if it is successful.</span></span> <span data-ttu-id="c4bc9-248">La respuesta puede incluir los encabezados Cache-Control y ETag de la versión actualizada del recurso.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-248">The response can include Cache-Control and ETag headers for the updated version of the resource.</span></span> <span data-ttu-id="c4bc9-249">La respuesta siempre debe incluir el encabezado Location que hace referencia al URI del recurso recién actualizado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-249">The response should always include the Location header that references the URI of the newly updated resource.</span></span>

- <span data-ttu-id="c4bc9-250">Si la ETag actual de los datos solicitados no coincide con la que proporciona la solicitud, otro usuario ha cambiado los datos desde que se capturaron y la API web debe devolver una respuesta HTTP con un cuerpo de mensaje vacío y un código de estado 412 (error de condición previa).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-250">If the current ETag for the requested data does not match the ETag provided by the request, then the data has been changed by another user since it was fetched and the web API should return an HTTP response with an empty message body and a status code of 412 (Precondition Failed).</span></span>

- <span data-ttu-id="c4bc9-251">Si el recurso que se va a actualizar ya no existe, la API web debe devolver una respuesta HTTP con el código de estado 404 (no encontrado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-251">If the resource to be updated no longer exists then the web API should return an HTTP response with the status code of 404 (Not Found).</span></span>

- <span data-ttu-id="c4bc9-252">El cliente usa el código de estado y los encabezados de las respuestas para mantener la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-252">The client uses the status code and response headers to maintain the cache.</span></span> <span data-ttu-id="c4bc9-253">Si los datos se han actualizado (código de estado 204), el objeto puede permanecer en la memoria caché (siempre y cuando el encabezado Cache-Control no especifique no-store), pero debe actualizarse la ETag.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-253">If the data has been updated (status code 204) then the object can remain cached (as long as the Cache-Control header does not specify no-store) but the ETag should be updated.</span></span> <span data-ttu-id="c4bc9-254">Si otro usuario ha cambiado los datos (código de estado 412) o no se encuentran (código de estado 404), el objeto en caché debe descartarse.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-254">If the data was changed by another user changed (status code 412) or not found (status code 404) then the cached object should be discarded.</span></span>

<span data-ttu-id="c4bc9-255">En el ejemplo de código siguiente se muestra una implementación de la operación PUT para el controlador Orders:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-255">The next code example shows an implementation of the PUT operation for the Orders controller:</span></span>

```csharp
public class OrdersController : ApiController
{
    [HttpPut]
    [Route("api/orders/{id:int}")]
    public IHttpActionResult UpdateExistingOrder(int id, DTOOrder order)
    {
        try
        {
            var baseUri = Constants.GetUriFromConfig();
            var orderToUpdate = this.ordersRepository.GetOrder(id);
            if (orderToUpdate == null)
            {
                return NotFound();
            }

            var hashedOrder = orderToUpdate.GetHashCode();
            string hashedOrderEtag = $"\"{hashedOrder}\"";

            // Retrieve the If-Match header from the request (if it exists)
            var matchEtags = Request.Headers.IfMatch;

            // If there is an Etag in the If-Match header and
            // this etag matches that of the order just retrieved,
            // or if there is no etag, then update the Order
            if (((matchEtags.Count > 0 &&
                String.CompareOrdinal(matchEtags.First().Tag, hashedOrderEtag) == 0)) ||
                matchEtags.Count == 0)
            {
                // Modify the order
                orderToUpdate.OrderValue = order.OrderValue;
                orderToUpdate.ProductID = order.ProductID;
                orderToUpdate.Quantity = order.Quantity;

                // Save the order back to the data store
                // ...

                // Create the No Content response with Cache-Control, ETag, and Location headers
                var cacheControlHeader = new CacheControlHeaderValue();
                cacheControlHeader.Private = true;
                cacheControlHeader.MaxAge = new TimeSpan(0, 10, 0);

                hashedOrder = order.GetHashCode();
                hashedOrderEtag = $"\"{hashedOrder}\"";
                var eTag = new EntityTagHeaderValue(hashedOrderEtag);

                var location = new Uri($"{baseUri}/{Constants.ORDERS}/{id}");
                var response = new EmptyResultWithCaching()
                {
                    StatusCode = HttpStatusCode.NoContent,
                    CacheControlHeader = cacheControlHeader,
                    ETag = eTag,
                    Location = location
                };

                return response;
            }

            // Otherwise return a Precondition Failed response
            return StatusCode(HttpStatusCode.PreconditionFailed);
        }
        catch
        {
            return InternalServerError();
        }
    }
    ...
}
```

> [!TIP]
> <span data-ttu-id="c4bc9-256">El uso del encabezado If-Match es totalmente opcional y, si se omite, la API web siempre intentará actualizar el pedido especificado, posiblemente sobrescribiendo ciegamente una actualización que otro usuario haya realizado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-256">Use of the If-Match header is entirely optional, and if it is omitted the web API will always attempt to update the specified order, possibly blindly overwriting an update made by another user.</span></span> <span data-ttu-id="c4bc9-257">Para evitar problemas debidos a actualizaciones perdidas, facilite siempre un encabezado If-Match.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-257">To avoid problems due to lost updates, always provide an If-Match header.</span></span>

## <a name="handling-large-requests-and-responses"></a><span data-ttu-id="c4bc9-258">Administración de respuestas y solicitudes de gran tamaño</span><span class="sxs-lookup"><span data-stu-id="c4bc9-258">Handling large requests and responses</span></span>

<span data-ttu-id="c4bc9-259">Puede haber ocasiones en que una aplicación cliente necesite emitir solicitudes que envíen o reciban datos que pueden tener un tamaño de varios megabytes (o mayor).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-259">There may be occasions when a client application needs to issue requests that send or receive data that may be several megabytes (or bigger) in size.</span></span> <span data-ttu-id="c4bc9-260">Si se espera mientras se transmite esa cantidad de datos, podría provocar que la aplicación cliente deje de responder.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-260">Waiting while this amount of data is transmitted could cause the client application to become unresponsive.</span></span> <span data-ttu-id="c4bc9-261">Tenga en cuenta los siguientes puntos cuando necesite controlar las solicitudes que incluyen grandes cantidades de datos:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-261">Consider the following points when you need to handle requests that include significant amounts of data:</span></span>

### <a name="optimize-requests-and-responses-that-involve-large-objects"></a><span data-ttu-id="c4bc9-262">Optimice las solicitudes y respuestas que impliquen objetos grandes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-262">Optimize requests and responses that involve large objects</span></span>

<span data-ttu-id="c4bc9-263">Algunos recursos pueden ser objetos grandes o incluir campos de gran tamaño, como imágenes gráficas u otros tipos de datos binarios.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-263">Some resources may be large objects or include large fields, such as graphics images or other types of binary data.</span></span> <span data-ttu-id="c4bc9-264">Una API web debe admitir streaming para habilitar la carga y descarga optimizadas de estos recursos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-264">A web API should support streaming to enable optimized uploading and downloading of these resources.</span></span>

<span data-ttu-id="c4bc9-265">El protocolo HTTP ofrece el mecanismo de codificación de transferencia fragmentada para hacer streaming de objetos de datos de gran tamaño a un cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-265">The HTTP protocol provides the chunked transfer encoding mechanism to stream large data objects back to a client.</span></span> <span data-ttu-id="c4bc9-266">Cuando el cliente envía una solicitud HTTP GET para un objeto grande, la API web puede enviar de vuelta la respuesta por *fragmentos* de forma gradual a través de una conexión HTTP.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-266">When the client sends an HTTP GET request for a large object, the web API can send the reply back in piecemeal *chunks* over an HTTP connection.</span></span> <span data-ttu-id="c4bc9-267">Es posible que la longitud de los datos de la respuesta no se conozca inicialmente (se puede generar), por lo que el servidor que hospeda la API web debe enviar un mensaje de respuesta con cada fragmento que especifique el encabezado Transfer-Encoding: Chunked en lugar de Content-Length.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-267">The length of the data in the reply may not be known initially (it might be generated), so the server hosting the web API should send a response message with each chunk that specifies the Transfer-Encoding: Chunked header rather than a Content-Length header.</span></span> <span data-ttu-id="c4bc9-268">La aplicación cliente puede a su vez recibir cada fragmento para construir la respuesta completa.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-268">The client application can receive each chunk in turn to build up the complete response.</span></span> <span data-ttu-id="c4bc9-269">La transferencia de datos se completa cuando el servidor devuelve un fragmento final con tamaño cero.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-269">The data transfer completes when the server sends back a final chunk with zero size.</span></span>

<span data-ttu-id="c4bc9-270">Una única solicitud podrían producir un objeto masivo que consume gran cantidad de recursos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-270">A single request could conceivably result in a massive object that consumes considerable resources.</span></span> <span data-ttu-id="c4bc9-271">Si durante el proceso de streaming la API web determina que la cantidad de datos de una solicitud ha superado algunos límites aceptables, puede anular la operación y devolver un mensaje de respuesta con el código de estado 413 (entidad solicitada demasiado grande).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-271">If, during the streaming process, the web API determines that the amount of data in a request has exceeded some acceptable bounds, it can abort the operation and return a response message with status code 413 (Request Entity Too Large).</span></span>

<span data-ttu-id="c4bc9-272">Puede minimizar el tamaño de los objetos grandes transmitidos por la red con la compresión HTTP.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-272">You can minimize the size of large objects transmitted over the network by using HTTP compression.</span></span> <span data-ttu-id="c4bc9-273">Este enfoque ayuda a reducir la cantidad de tráfico de red y la latencia de red asociada, pero a costa de requerir un procesamiento adicional en el cliente y en el servidor que hospeda la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-273">This approach helps to reduce the amount of network traffic and the associated network latency, but at the cost of requiring additional processing at the client and the server hosting the web API.</span></span> <span data-ttu-id="c4bc9-274">Por ejemplo, una aplicación cliente que espera recibir datos comprimidos puede incluir un encabezado de solicitud Accept-Encoding: gzip (también se pueden especificar otros algoritmos de compresión de datos).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-274">For example, a client application that expects to receive compressed data can include an Accept-Encoding: gzip request header (other data compression algorithms can also be specified).</span></span> <span data-ttu-id="c4bc9-275">Si el servidor admite la compresión, debe responder con el contenido almacenado en formato gzip en el cuerpo del mensaje y el encabezado de respuesta Content-Encoding: gzip.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-275">If the server supports compression it should respond with the content held in gzip format in the message body and the Content-Encoding: gzip response header.</span></span>

<span data-ttu-id="c4bc9-276">Puede combinar la compresión codificada con streaming; comprima los datos antes de hacer streaming y especifique la codificación de contenido gzip y la codificación de transferencia fragmentada en los encabezados de los mensajes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-276">You can combine encoded compression with streaming; compress the data first before streaming it, and specify the gzip content encoding and chunked transfer encoding in the message headers.</span></span> <span data-ttu-id="c4bc9-277">Tenga en cuenta también que algunos servidores web (por ejemplo, Internet Information Server) pueden configurarse para comprimir automáticamente las respuestas HTTP sin tener en cuenta si la API web comprime los datos o no.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-277">Also note that some web servers (such as Internet Information Server) can be configured to automatically compress HTTP responses regardless of whether the web API compresses the data or not.</span></span>

### <a name="implement-partial-responses-for-clients-that-do-not-support-asynchronous-operations"></a><span data-ttu-id="c4bc9-278">Implemente respuestas parciales para los clientes que no admitan operaciones asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-278">Implement partial responses for clients that do not support asynchronous operations</span></span>

<span data-ttu-id="c4bc9-279">Como alternativa al streaming asincrónico, una aplicación cliente puede solicitar explícitamente los datos de objetos grandes en fragmentos, que se conocen como respuestas parciales.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-279">As an alternative to asynchronous streaming, a client application can explicitly request data for large objects in chunks, known as partial responses.</span></span> <span data-ttu-id="c4bc9-280">La aplicación cliente envía una solicitud HTTP HEAD para obtener información sobre el objeto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-280">The client application sends an HTTP HEAD request to obtain information about the object.</span></span> <span data-ttu-id="c4bc9-281">Si la API web admite respuestas parciales, debe responder a la solicitud HEAD con un mensaje de respuesta que contenga un encabezado Accept-Ranges y un encabezado Content-Length que indique el tamaño total del objeto, pero el cuerpo del mensaje debe estar vacío.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-281">If the web API supports partial responses if should respond to the HEAD request with a response message that contains an Accept-Ranges header and a Content-Length header that indicates the total size of the object, but the body of the message should be empty.</span></span> <span data-ttu-id="c4bc9-282">La aplicación cliente puede usar esta información para construir una serie de solicitudes GET que especifiquen un intervalo de bytes que se recibirán.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-282">The client application can use this information to construct a series of GET requests that specify a range of bytes to receive.</span></span> <span data-ttu-id="c4bc9-283">La API web debería devolver un mensaje de respuesta con el código de estado HTTP 206 (contenido parcial), un encabezado Content-Length que especifique la cantidad de datos incluidos en el cuerpo del mensaje de respuesta y un encabezado Content-Range que indique la parte (por ejemplo, los bytes del 4000 al 8000) del objeto que representan esos datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-283">The web API should return a response message with HTTP status 206 (Partial Content), a Content-Length header that specifies the actual amount of data included in the body of the response message, and a Content-Range header that indicates which part (such as bytes 4000 to 8000) of the object this data represents.</span></span>

<span data-ttu-id="c4bc9-284">Las respuestas parciales y solicitudes HTTP HEAD se describen con más detalle en [Diseño de API][api-design].</span><span class="sxs-lookup"><span data-stu-id="c4bc9-284">HTTP HEAD requests and partial responses are described in more detail in [API Design][api-design].</span></span>

### <a name="avoid-sending-unnecessary-100-continue-status-messages-in-client-applications"></a><span data-ttu-id="c4bc9-285">Evite enviar mensajes de estado 100-Continuar innecesarios en las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-285">Avoid sending unnecessary 100-Continue status messages in client applications</span></span>

<span data-ttu-id="c4bc9-286">Una aplicación de cliente que vaya a enviar una gran cantidad de datos a un servidor puede determinar primero si el servidor está realmente dispuesto a aceptar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-286">A client application that is about to send a large amount of data to a server may determine first whether the server is actually willing to accept the request.</span></span> <span data-ttu-id="c4bc9-287">Antes de enviar los datos, la aplicación cliente puede enviar una solicitud HTTP con un encabezado Expect: 100-Continue, un encabezado Content-Length que indique el tamaño de los datos, pero un cuerpo de mensaje vacío.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-287">Prior to sending the data, the client application can submit an HTTP request with an Expect: 100-Continue header, a Content-Length header that indicates the size of the data, but an empty message body.</span></span> <span data-ttu-id="c4bc9-288">Si el servidor está dispuesto a atender la solicitud, debe responder con un mensaje que especifique el código de estado HTTP 100 (continuar).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-288">If the server is willing to handle the request, it should respond with a message that specifies the HTTP status 100 (Continue).</span></span> <span data-ttu-id="c4bc9-289">La aplicación cliente puede entonces continuar y enviar la solicitud completa, incluidos los datos en el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-289">The client application can then proceed and send the complete request including the data in the message body.</span></span>

<span data-ttu-id="c4bc9-290">Si hospeda un servicio mediante IIS, el controlador HTTP.sys detecta y controla automáticamente los encabezados Expect: 100-Continue antes de pasar las solicitudes a la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-290">If you are hosting a service by using IIS, the HTTP.sys driver automatically detects and handles Expect: 100-Continue headers before passing requests to your web application.</span></span> <span data-ttu-id="c4bc9-291">Esto significa que no es probable que vea estos encabezados en el código de la aplicación y se puede suponer que IIS ya ha filtrado los mensajes que considera como no aptos o demasiado grandes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-291">This means that you are unlikely to see these headers in your application code, and you can assume that IIS has already filtered any messages that it deems to be unfit or too large.</span></span>

<span data-ttu-id="c4bc9-292">Si está creando aplicaciones cliente mediante .NET Framework, todos los mensajes POST y PUT enviarán primero mensajes con encabezados Expect: 100-Continue de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-292">If you are building client applications by using the .NET Framework, then all POST and PUT messages will first send messages with Expect: 100-Continue headers by default.</span></span> <span data-ttu-id="c4bc9-293">Al igual que con el lado servidor, el proceso lo controla de forma transparente .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-293">As with the server-side, the process is handled transparently by the .NET Framework.</span></span> <span data-ttu-id="c4bc9-294">Sin embargo, este proceso hace que cada solicitud POST y PUT necesite dos envíos de ida y vuelta al servidor, incluso para las solicitudes pequeñas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-294">However, this process results in each POST and PUT request causing two round-trips to the server, even for small requests.</span></span> <span data-ttu-id="c4bc9-295">Si la aplicación no envía solicitudes con grandes cantidades de datos, puede deshabilitar esta característica mediante la clase `ServicePointManager` para crear objetos `ServicePoint` en la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-295">If your application is not sending requests with large amounts of data, you can disable this feature by using the `ServicePointManager` class to create `ServicePoint` objects in the client application.</span></span> <span data-ttu-id="c4bc9-296">Un objeto `ServicePoint` controla las conexiones que el cliente realiza en un servidor basado en el esquema y los fragmentos de host de los URI que identifican recursos en el servidor.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-296">A `ServicePoint` object handles the connections that the client makes to a server based on the scheme and host fragments of URIs that identify resources on the server.</span></span> <span data-ttu-id="c4bc9-297">Después, puede establecer la propiedad `Expect100Continue` del objeto `ServicePoint` en false.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-297">You can then set the `Expect100Continue` property of the `ServicePoint` object to false.</span></span> <span data-ttu-id="c4bc9-298">Todas las solicitudes POST y PUT posteriores que realice el cliente mediante un URI que coincida con el esquema y los fragmentos de host del objeto `ServicePoint` se enviarán sin encabezados Expect: 100-Continue.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-298">All subsequent POST and PUT requests made by the client through a URI that matches the scheme and host fragments of the `ServicePoint` object will be sent without Expect: 100-Continue headers.</span></span> <span data-ttu-id="c4bc9-299">El código siguiente muestra cómo configurar un objeto `ServicePoint` que configura todas las solicitudes enviadas a los URI con un esquema de `http` y un host de `www.contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-299">The following code shows how to configure a `ServicePoint` object that configures all requests sent to URIs with a scheme of `http` and a host of `www.contoso.com`.</span></span>

```csharp
Uri uri = new Uri("https://www.contoso.com/");
ServicePoint sp = ServicePointManager.FindServicePoint(uri);
sp.Expect100Continue = false;
```

<span data-ttu-id="c4bc9-300">También puede establecer la propiedad estática `Expect100Continue` de la clase `ServicePointManager` para especificar el valor predeterminado de esta propiedad para todos los objetos [ServicePoint]](/dotnet/api/system.net.servicepoint) creados posteriormente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-300">You can also set the static `Expect100Continue` property of the `ServicePointManager` class to specify the default value of this property for all subsequently created [ServicePoint]](/dotnet/api/system.net.servicepoint) objects.</span></span>

### <a name="support-pagination-for-requests-that-may-return-large-numbers-of-objects"></a><span data-ttu-id="c4bc9-301">Admita la paginación de las solicitudes que pueden devolver grandes cantidades de objetos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-301">Support pagination for requests that may return large numbers of objects</span></span>

<span data-ttu-id="c4bc9-302">Si una colección contiene un gran número de recursos, al emitir una solicitud GET en el URI correspondiente podría producirse un procesamiento importante en el servidor que hospeda la API web, que afectaría al rendimiento y generaría una cantidad significativa de tráfico de red, lo que provocaría una mayor latencia.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-302">If a collection contains a large number of resources, issuing a GET request to the corresponding URI could result in significant processing on the server hosting the web API affecting performance, and generate a significant amount of network traffic resulting in increased latency.</span></span>

<span data-ttu-id="c4bc9-303">Para controlar estos casos, la API web debe admitir las cadenas de consulta que permiten que la aplicación cliente refina las solicitudes o capture los datos en bloques (o páginas) discretos más fáciles de administrar.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-303">To handle these cases, the web API should support query strings that enable the client application to refine requests or fetch data in more manageable, discrete blocks (or pages).</span></span> <span data-ttu-id="c4bc9-304">El código siguiente muestra el método `GetAllOrders` en el controlador `Orders`.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-304">The code below shows the `GetAllOrders` method in the `Orders` controller.</span></span> <span data-ttu-id="c4bc9-305">Este método recupera los detalles de los pedidos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-305">This method retrieves the details of orders.</span></span> <span data-ttu-id="c4bc9-306">Si este método no tenía restricciones, posiblemente podría devolver una gran cantidad de datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-306">If this method was unconstrained, it could conceivably return a large amount of data.</span></span> <span data-ttu-id="c4bc9-307">Los parámetros `limit` y `offset` están diseñados para reducir el volumen de datos a un subconjunto más pequeño, en este caso solo los 10 primeros pedidos de forma predeterminada:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-307">The `limit` and `offset` parameters are intended to reduce the volume of data to a smaller subset, in this case only the first 10 orders by default:</span></span>

```csharp
public class OrdersController : ApiController
{
    ...
    [Route("api/orders")]
    [HttpGet]
    public IEnumerable<Order> GetAllOrders(int limit=10, int offset=0)
    {
        // Find the number of orders specified by the limit parameter
        // starting with the order specified by the offset parameter
        var orders = ...
        return orders;
    }
    ...
}
```

<span data-ttu-id="c4bc9-308">Una aplicación cliente puede emitir una solicitud para recuperar 30 pedidos empezando con un desplazamiento de 50 mediante el URI `https://www.adventure-works.com/api/orders?limit=30&offset=50`.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-308">A client application can issue a request to retrieve 30 orders starting at offset 50 by using the URI `https://www.adventure-works.com/api/orders?limit=30&offset=50`.</span></span>

> [!TIP]
> <span data-ttu-id="c4bc9-309">Evite permitir que las aplicaciones de cliente especifiquen las cadenas de consulta que resultan en un URI que tenga más de 2000 caracteres.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-309">Avoid enabling client applications to specify query strings that result in a URI that is more than 2000 characters long.</span></span> <span data-ttu-id="c4bc9-310">Muchos servidores y clientes web no pueden controlar los URI así de largos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-310">Many web clients and servers cannot handle URIs that are this long.</span></span>

## <a name="maintaining-responsiveness-scalability-and-availability"></a><span data-ttu-id="c4bc9-311">Mantenimiento de la capacidad de respuesta, la escalabilidad y la disponibilidad</span><span class="sxs-lookup"><span data-stu-id="c4bc9-311">Maintaining responsiveness, scalability, and availability</span></span>

<span data-ttu-id="c4bc9-312">La misma API web pueden usarla muchas aplicaciones cliente que se ejecuten en cualquier lugar del mundo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-312">The same web API might be utilized by many client applications running anywhere in the world.</span></span> <span data-ttu-id="c4bc9-313">Es importante asegurarse de que la API web se implementa para mantener la capacidad de respuesta bajo cargas intensas, para que se pueda escalar a fin de admitir una carga de trabajo que varíe mucho y para garantizar la disponibilidad para los clientes que realizan operaciones esenciales para el negocio.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-313">It is important to ensure that the web API is implemented to maintain responsiveness under a heavy load, to be scalable to support a highly varying workload, and to guarantee availability for clients that perform business-critical operations.</span></span> <span data-ttu-id="c4bc9-314">Tenga en cuenta los puntos siguientes al determinar cómo cumplir estos requisitos:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-314">Consider the following points when determining how to meet these requirements:</span></span>

### <a name="provide-asynchronous-support-for-long-running-requests"></a><span data-ttu-id="c4bc9-315">Ofrezca compatibilidad asincrónica para las solicitudes de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-315">Provide asynchronous support for long-running requests</span></span>

<span data-ttu-id="c4bc9-316">Una solicitud que podría tardar mucho tiempo en procesarse debe realizarse sin bloquear al cliente que la envió.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-316">A request that might take a long time to process should be performed without blocking the client that submitted the request.</span></span> <span data-ttu-id="c4bc9-317">La API web puede realizar ciertas comprobaciones iniciales para validar la solicitud, iniciar una tarea independiente para realizar el trabajo y, después, devolver un mensaje de respuesta con el código HTTP 202 (aceptado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-317">The web API can perform some initial checking to validate the request, initiate a separate task to perform the work, and then return a response message with HTTP code 202 (Accepted).</span></span> <span data-ttu-id="c4bc9-318">La tarea puede ejecutarse de forma asincrónica como parte del procesamiento de la API, o puede descargarse en una tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-318">The task could run asynchronously as part of the web API processing, or it could be offloaded to a background task.</span></span>

<span data-ttu-id="c4bc9-319">La API web también debe proporcionar un mecanismo para devolver los resultados del procesamiento a la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-319">The web API should also provide a mechanism to return the results of the processing to the client application.</span></span> <span data-ttu-id="c4bc9-320">Puede lograr esto si proporciona un mecanismo de sondeo de aplicaciones cliente para consultar periódicamente si ha finalizado el procesamiento y se ha obtenido el resultado o si habilita la API para que envíe una notificación cuando la operación se haya completado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-320">You can achieve this by providing a polling mechanism for client applications to periodically query whether the processing has finished and obtain the result, or enabling the web API to send a notification when the operation has completed.</span></span>

<span data-ttu-id="c4bc9-321">Puede implementar un mecanismo de sondeo sencillo si ofrece una URI *polling* que actúe como un recurso virtual con el siguiente enfoque:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-321">You can implement a simple polling mechanism by providing a *polling* URI that acts as a virtual resource using the following approach:</span></span>

1. <span data-ttu-id="c4bc9-322">La aplicación cliente envía la solicitud inicial a la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-322">The client application sends the initial request to the web API.</span></span>
2. <span data-ttu-id="c4bc9-323">La API web almacena información sobre la solicitud en una tabla que se conserva en Table Storage o en Microsoft Azure Cache y genera una clave única para esta entrada, posiblemente en forma de un GUID.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-323">The web API stores information about the request in a table held in table storage or Microsoft Azure Cache, and generates a unique key for this entry, possibly in the form of a GUID.</span></span>
3. <span data-ttu-id="c4bc9-324">La API web inicia el procesamiento como una tarea independiente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-324">The web API initiates the processing as a separate task.</span></span> <span data-ttu-id="c4bc9-325">La API web registra el estado de la tarea en la tabla como *Running*.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-325">The web API records the state of the task in the table as *Running*.</span></span>
4. <span data-ttu-id="c4bc9-326">La API web devuelve un mensaje de respuesta con el código de estado HTTP 202 (aceptado) y el GUID de la entrada de la tabla en el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-326">The web API returns a response message with HTTP status code 202 (Accepted), and the GUID of the table entry in the body of the message.</span></span>
5. <span data-ttu-id="c4bc9-327">Cuando se completa la tarea, la API web almacena los resultados en la tabla y establece el estado de la tarea en *Complete*.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-327">When the task has completed, the web API stores the results in the table, and sets the state of the task to *Complete*.</span></span> <span data-ttu-id="c4bc9-328">Tenga en cuenta que si se produce un error en la tarea, la API web también podría almacenar información sobre el error y establecer el estado en *Failed*.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-328">Note that if the task fails, the web API could also store information about the failure and set the status to *Failed*.</span></span>
6. <span data-ttu-id="c4bc9-329">Mientras se ejecuta la tarea, el cliente puede continuar realizando su propio procesamiento.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-329">While the task is running, the client can continue performing its own processing.</span></span> <span data-ttu-id="c4bc9-330">Puede enviar periódicamente una solicitud al URI */polling/{guid}* donde *{guid}* es el GUID devuelto en el mensaje de respuesta 202 de la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-330">It can periodically send a request to the URI */polling/{guid}* where *{guid}* is the GUID returned in the 202 response message by the web API.</span></span>
7. <span data-ttu-id="c4bc9-331">La API web en el URI */polling/{guid}* consulta el estado de la tarea correspondiente en la tabla y devuelve un mensaje de respuesta con el código de estado HTTP 200 (correcto) que contiene este estado (*Running*, *Complete* o *Failed*).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-331">The web API at the */polling/{guid}* URI queries the state of the corresponding task in the table and returns a response message with HTTP status code 200 (OK) containing this state (*Running*, *Complete*, or *Failed*).</span></span> <span data-ttu-id="c4bc9-332">Si la tarea se ha completado o ha producido un error, el mensaje de respuesta también puede incluir los resultados del procesamiento o la información disponible sobre el motivo del error.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-332">If the task has completed or failed, the response message can also include the results of the processing or any information available about the reason for the failure.</span></span>

<span data-ttu-id="c4bc9-333">Algunas opciones para implementar notificaciones son:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-333">Options for implementing notifications include:</span></span>

- <span data-ttu-id="c4bc9-334">El uso de un Centro de notificaciones de Azure para insertar respuestas asíncronas en las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-334">Using an Azure Notification Hub to push asynchronous responses to client applications.</span></span> <span data-ttu-id="c4bc9-335">Para más información, consulte [Azure Notification Hubs notifica a los usuarios](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-335">For more information, see [Azure Notification Hubs Notify Users](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/).</span></span>
- <span data-ttu-id="c4bc9-336">El uso del modelo Comet para conservar una conexión de red persistente entre el cliente y el servidor que hospeda la API web y el uso de esta conexión para insertar mensajes desde el servidor de nuevo en el cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-336">Using the Comet model to retain a persistent network connection between the client and the server hosting the web API, and using this connection to push messages from the server back to the client.</span></span> <span data-ttu-id="c4bc9-337">El artículo de MSDN magazine [Creación de una aplicación Comet sencilla en Microsoft .NET Framework](https://msdn.microsoft.com/magazine/jj891053.aspx) describe una solución de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-337">The MSDN magazine article [Building a Simple Comet Application in the Microsoft .NET Framework](https://msdn.microsoft.com/magazine/jj891053.aspx) describes an example solution.</span></span>
- <span data-ttu-id="c4bc9-338">El uso de SignalR para insertar datos en tiempo real desde el servidor web en el cliente a través de una conexión de red persistente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-338">Using SignalR to push data in real-time from the web server to the client over a persistent network connection.</span></span> <span data-ttu-id="c4bc9-339">SignalR está disponible para las aplicaciones web de ASP.NET como un paquete de NuGet.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-339">SignalR is available for ASP.NET web applications as a NuGet package.</span></span> <span data-ttu-id="c4bc9-340">Puede encontrar más información en el sitio web de [ASP.NET SignalR](https://www.asp.net/signalr) .</span><span class="sxs-lookup"><span data-stu-id="c4bc9-340">You can find more information on the [ASP.NET SignalR](https://www.asp.net/signalr) website.</span></span>

### <a name="ensure-that-each-request-is-stateless"></a><span data-ttu-id="c4bc9-341">Asegúrese de que ninguna de las solicitudes tenga estado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-341">Ensure that each request is stateless</span></span>

<span data-ttu-id="c4bc9-342">Cada solicitud debe considerarse atómica.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-342">Each request should be considered atomic.</span></span> <span data-ttu-id="c4bc9-343">No debería haber dependencias entre una solicitud que realiza una aplicación de cliente y las siguientes solicitudes que envía el mismo cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-343">There should be no dependencies between one request made by a client application and any subsequent requests submitted by the same client.</span></span> <span data-ttu-id="c4bc9-344">Este enfoque ayuda a la escalabilidad; las instancias del servicio web se pueden implementar en varios servidores.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-344">This approach assists in scalability; instances of the web service can be deployed on a number of servers.</span></span> <span data-ttu-id="c4bc9-345">Las solicitudes de cliente se pueden dirigir a cualquiera de estas instancias y los resultados siempre deben ser los mismos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-345">Client requests can be directed at any of these instances and the results should always be the same.</span></span> <span data-ttu-id="c4bc9-346">También mejora la disponibilidad por un motivo similar; si se produce un error en un servidor web, las solicitudes se pueden enrutar a otra instancia (mediante el Administrador de tráfico de Azure) mientras se reinicia el servidor, sin que se produzcan efectos negativos en las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-346">It also improves availability for a similar reason; if a web server fails requests can be routed to another instance (by using Azure Traffic Manager) while the server is restarted with no ill effects on client applications.</span></span>

### <a name="track-clients-and-implement-throttling-to-reduce-the-chances-of-dos-attacks"></a><span data-ttu-id="c4bc9-347">Realice un seguimiento de los clientes e implemente la limitación para reducir las posibilidades de ataques de denegación de servicio.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-347">Track clients and implement throttling to reduce the chances of DOS attacks</span></span>

<span data-ttu-id="c4bc9-348">Si un cliente específico realiza un gran número de solicitudes en un período determinado de tiempo, podría monopolizar el servicio y afectar al rendimiento de otros clientes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-348">If a specific client makes a large number of requests within a given period of time it might monopolize the service and affect the performance of other clients.</span></span> <span data-ttu-id="c4bc9-349">Para mitigar este problema, una API web puede supervisar las llamadas de las aplicaciones de cliente mediante el seguimiento de la dirección IP de todas las solicitudes entrantes o mediante el registro de cada acceso autenticado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-349">To mitigate this issue, a web API can monitor calls from client applications either by tracking the IP address of all incoming requests or by logging each authenticated access.</span></span> <span data-ttu-id="c4bc9-350">Puede usar esta información para limitar el acceso a los recursos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-350">You can use this information to limit resource access.</span></span> <span data-ttu-id="c4bc9-351">Si un cliente supera un límite definido, la API web puede devolver un mensaje de respuesta con el estado 503 (servicio no disponible) e incluir un encabezado Retry-After que especifique cuándo puede enviar el cliente la siguiente solicitud sin que se rechace.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-351">If a client exceeds a defined limit, the web API can return a response message with status 503 (Service Unavailable) and include a Retry-After header that specifies when the client can send the next request without it being declined.</span></span> <span data-ttu-id="c4bc9-352">Esta estrategia puede ayudarle a reducir las posibilidades de un ataque de denegación de servicio (DOS) de un conjunto de clientes que quieran detener el sistema.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-352">This strategy can help to reduce the chances of a Denial Of Service (DOS) attack from a set of clients stalling the system.</span></span>

### <a name="manage-persistent-http-connections-carefully"></a><span data-ttu-id="c4bc9-353">Administre con cuidado las conexiones HTTP persistentes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-353">Manage persistent HTTP connections carefully</span></span>

<span data-ttu-id="c4bc9-354">El protocolo HTTP admite conexiones HTTP persistentes si están disponibles.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-354">The HTTP protocol supports persistent HTTP connections where they are available.</span></span> <span data-ttu-id="c4bc9-355">La especificación HTTP 1.0 agrega el encabezado Connection:Keep-Alive, que permite que una aplicación cliente indique al servidor que puede usar la misma conexión para enviar solicitudes posteriores, en lugar de abrir nuevas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-355">The HTTP 1.0 specificiation added the Connection:Keep-Alive header that enables a client application to indicate to the server that it can use the same connection to send subsequent requests rather than opening new ones.</span></span> <span data-ttu-id="c4bc9-356">La conexión se cierra automáticamente si el cliente no vuelve a utilizarla en un período definido por el host.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-356">The connection closes automatically if the client does not reuse the connection within a period defined by the host.</span></span> <span data-ttu-id="c4bc9-357">Este comportamiento es el predeterminado en HTTP 1.1 como lo usan los servicios de Azure, por lo que no es necesario incluir encabezados Keep-Alive en los mensajes.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-357">This behavior is the default in HTTP 1.1 as used by Azure services, so there is no need to include Keep-Alive headers in messages.</span></span>

<span data-ttu-id="c4bc9-358">Si se mantiene abierta una conexión, puede ayudar a mejorar la capacidad de respuesta al reducir la latencia y la congestión de la red, pero puede ser perjudicial para la escalabilidad porque se mantienen conexiones innecesarias abiertas durante más tiempo del necesario, lo que limita la capacidad de conexión de otros clientes simultáneos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-358">Keeping a connection open can help to improve responsiveness by reducing latency and network congestion, but it can be detrimental to scalability by keeping unnecessary connections open for longer than required, limiting the ability of other concurrent clients to connect.</span></span> <span data-ttu-id="c4bc9-359">También puede afectar a la duración de la batería si la aplicación cliente se ejecuta en un dispositivo móvil; si la aplicación solo realiza solicitudes ocasionales al servidor, mantener abierta una conexión puede hacer que la batería se gaste con mayor rapidez.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-359">It can also affect battery life if the client application is running on a mobile device; if the application only makes occasional requests to the server, maintaining an open connection can cause the battery to drain more quickly.</span></span> <span data-ttu-id="c4bc9-360">Para asegurarse de que una conexión no se hace persistente con HTTP 1.1, el cliente puede incluir un encabezado Connection:Close con los mensajes para reemplazar el comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-360">To ensure that a connection is not made persistent with HTTP 1.1, the client can include a Connection:Close header with messages to override the default behavior.</span></span> <span data-ttu-id="c4bc9-361">De forma similar, si un servidor está controlando un gran número de clientes, puede incluir un encabezado Connection:Close en los mensajes de respuesta, lo que debería cerrar la conexión y ahorrar recursos del servidor.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-361">Similarly, if a server is handling a very large number of clients it can include a Connection:Close header in response messages which should close the connection and save server resources.</span></span>

> [!NOTE]
> <span data-ttu-id="c4bc9-362">Las conexiones HTTP persistentes son una característica puramente opcional para reducir la sobrecarga de la red asociada al restablecimiento repetido de un canal de comunicaciones.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-362">Persistent HTTP connections are a purely optional feature to reduce the network overhead associated with repeatedly establishing a communications channel.</span></span> <span data-ttu-id="c4bc9-363">Ni la API web ni la aplicación cliente deben depender de que haya una conexión HTTP persistente disponible.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-363">Neither the web API nor the client application should depend on a persistent HTTP connection being available.</span></span> <span data-ttu-id="c4bc9-364">No use conexiones HTTP persistentes para implementar sistemas de notificación de estilo Comet; en su lugar, debería usar sockets (o websockets si están disponible) en la capa TCP.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-364">Do not use persistent HTTP connections to implement Comet-style notification systems; instead you should utilize sockets (or websockets if available) at the TCP layer.</span></span> <span data-ttu-id="c4bc9-365">Por último, tenga en cuenta que los encabezados Keep-Alive son de uso limitado si una aplicación cliente se comunica con un servidor mediante un proxy; solo la conexión con el cliente y el proxy será persistente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-365">Finally, note Keep-Alive headers are of limited use if a client application communicates with a server via a proxy; only the connection with the client and the proxy will be persistent.</span></span>

## <a name="publishing-and-managing-a-web-api"></a><span data-ttu-id="c4bc9-366">Publicación y administración de una API web</span><span class="sxs-lookup"><span data-stu-id="c4bc9-366">Publishing and managing a web API</span></span>

<span data-ttu-id="c4bc9-367">Para que una API web esté disponible para las aplicaciones cliente, la API web debe implementarse en un entorno de host.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-367">To make a web API available for client applications, the web API must be deployed to a host environment.</span></span> <span data-ttu-id="c4bc9-368">Normalmente este entorno es un servidor web, aunque puede ser otro tipo de proceso de host.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-368">This environment is typically a web server, although it may be some other type of host process.</span></span> <span data-ttu-id="c4bc9-369">Debe considerar los siguientes puntos cuando publique una API web:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-369">You should consider the following points when publishing a web API:</span></span>

- <span data-ttu-id="c4bc9-370">Todas las solicitudes deben autenticarse y autorizarse, y debe aplicarse el nivel de control de acceso adecuado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-370">All requests must be authenticated and authorized, and the appropriate level of access control must be enforced.</span></span>
- <span data-ttu-id="c4bc9-371">Una API web comercial puede estar sujeta a diversas garantías de calidad relativas a los tiempos de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-371">A commercial web API might be subject to various quality guarantees concerning response times.</span></span> <span data-ttu-id="c4bc9-372">Es importante asegurarse de que ese entorno de host es escalable si la carga puede variar considerablemente con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-372">It is important to ensure that host environment is scalable if the load can vary significantly over time.</span></span>
- <span data-ttu-id="c4bc9-373">Puede ser necesario realizar mediciones de las solicitudes para fines de monetización.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-373">It may be necessary to meter requests for monetization purposes.</span></span>
- <span data-ttu-id="c4bc9-374">Es posible que sea necesario regular el flujo de tráfico a la API web e implementar la limitación para clientes concretos que hayan agotado sus cuotas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-374">It might be necessary to regulate the flow of traffic to the web API, and implement throttling for specific clients that have exhausted their quotas.</span></span>
- <span data-ttu-id="c4bc9-375">Los requisitos normativos podrían requerir un registro y una auditoría de todas las solicitudes y respuestas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-375">Regulatory requirements might mandate logging and auditing of all requests and responses.</span></span>
- <span data-ttu-id="c4bc9-376">Para garantizar la disponibilidad, puede ser necesario supervisar el estado del servidor que hospeda la API web y reiniciarlo si hiciera falta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-376">To ensure availability, it may be necessary to monitor the health of the server hosting the web API and restart it if necessary.</span></span>

<span data-ttu-id="c4bc9-377">Es útil poder separar estos problemas de los problemas técnicos relativos a la implementación de la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-377">It is useful to be able to decouple these issues from the technical issues concerning the implementation of the web API.</span></span> <span data-ttu-id="c4bc9-378">Por este motivo, considere la creación de una [fachada](https://en.wikipedia.org/wiki/Facade_pattern),que se ejecute como un proceso independiente y que enrute las solicitudes a la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-378">For this reason, consider creating a [façade](https://en.wikipedia.org/wiki/Facade_pattern), running as a separate process and that routes requests to the web API.</span></span> <span data-ttu-id="c4bc9-379">La fachada puede proporcionar las operaciones de administración y redirigir las solicitudes validadas a la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-379">The façade can provide the management operations and forward validated requests to the web API.</span></span> <span data-ttu-id="c4bc9-380">El uso de una fachada también puede aportar muchas ventajas funcionales, entre las que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-380">Using a façade can also bring many functional advantages, including:</span></span>

- <span data-ttu-id="c4bc9-381">Actuar como un punto de integración para varias API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-381">Acting as an integration point for multiple web APIs.</span></span>
- <span data-ttu-id="c4bc9-382">Transformar los mensajes y traducir protocolos de comunicaciones de los clientes creados mediante tecnologías distintas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-382">Transforming messages and translating communications protocols for clients built by using varying technologies.</span></span>
- <span data-ttu-id="c4bc9-383">Almacenar en caché solicitudes y respuestas para reducir la carga en el servidor que hospeda la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-383">Caching requests and responses to reduce load on the server hosting the web API.</span></span>

## <a name="testing-a-web-api"></a><span data-ttu-id="c4bc9-384">Prueba de una API web</span><span class="sxs-lookup"><span data-stu-id="c4bc9-384">Testing a web API</span></span>

<span data-ttu-id="c4bc9-385">Una API web debe probarse tan exhaustivamente como cualquier otro producto de software.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-385">A web API should be tested as thoroughly as any other piece of software.</span></span> <span data-ttu-id="c4bc9-386">Considere la creación de pruebas unitarias para validar la funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-386">You should consider creating unit tests to validate the functionality.</span></span>

<span data-ttu-id="c4bc9-387">La naturaleza de una API web incorpora sus propios requisitos adicionales para comprobar que funciona correctamente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-387">The nature of a web API brings its own additional requirements to verify that it operates correctly.</span></span> <span data-ttu-id="c4bc9-388">Debe prestar especial atención a los siguientes aspectos:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-388">You should pay particular attention to the following aspects:</span></span>

- <span data-ttu-id="c4bc9-389">Pruebe todas las rutas para comprobar que invocan las operaciones correctas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-389">Test all routes to verify that they invoke the correct operations.</span></span> <span data-ttu-id="c4bc9-390">Preste especial atención al código de estado HTTP 405 (método no permitido) que se devuelven de forma inesperada, ya que esto puede indicar una desigualdad entre una ruta y los métodos HTTP (GET, POST, PUT, DELETE) que se pueden enviar a esa ruta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-390">Be especially aware of HTTP status code 405 (Method Not Allowed) being returned unexpectedly as this can indicate a mismatch between a route and the HTTP methods (GET, POST, PUT, DELETE) that can be dispatched to that route.</span></span>

    <span data-ttu-id="c4bc9-391">Envíe solicitudes HTTP a las rutas que no las admitan, como el envío de una solicitud POST a un recurso concreto (las solicitudes POST solo se pueden enviar a las colecciones de recursos).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-391">Send HTTP requests to routes that do not support them, such as submitting a POST request to a specific resource (POST requests should only be sent to resource collections).</span></span> <span data-ttu-id="c4bc9-392">En estos casos, la única respuesta válida *debería* ser el código de estado 405 (no permitido).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-392">In these cases, the only valid response *should* be status code 405 (Not Allowed).</span></span>

- <span data-ttu-id="c4bc9-393">Compruebe que todas las rutas estén protegidas correctamente y que estén sujetas a las comprobaciones de autenticación y autorización apropiadas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-393">Verify that all routes are protected properly and are subject to the appropriate authentication and authorization checks.</span></span>

  > [!NOTE]
  > <span data-ttu-id="c4bc9-394">Algunos aspectos de seguridad, como la autenticación de los usuarios, tienen más probabilidades de ser responsabilidad del entorno de host y no de la API web, pero sigue siendo necesario incluir las pruebas de seguridad como parte del proceso de implementación.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-394">Some aspects of security such as user authentication are most likely to be the responsibility of the host environment rather than the web API, but it is still necessary to include security tests as part of the deployment process.</span></span>
  >
  >

- <span data-ttu-id="c4bc9-395">Pruebe el control de excepciones que realiza cada operación y compruebe que se pasa una respuesta HTTP adecuada y significativa de vuelta a la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-395">Test the exception handling performed by each operation and verify that an appropriate and meaningful HTTP response is passed back to the client application.</span></span>

- <span data-ttu-id="c4bc9-396">Compruebe que los mensajes de solicitud y respuesta están formados correctamente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-396">Verify that request and response messages are well-formed.</span></span> <span data-ttu-id="c4bc9-397">Por ejemplo, si una solicitud HTTP POST contiene los datos de un recurso nuevo en formato x-www-form-urlencoded, confirme que la operación correspondiente analiza correctamente los datos, crea los recursos y devuelve una respuesta que contiene los detalles del nuevo recurso, incluido el encabezado Location correcto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-397">For example, if an HTTP POST request contains the data for a new resource in x-www-form-urlencoded format, confirm that the corresponding operation correctly parses the data, creates the resources, and returns a response containing the details of the new resource, including the correct Location header.</span></span>

- <span data-ttu-id="c4bc9-398">Compruebe todos los vínculos y los URI de los mensajes de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-398">Verify all links and URIs in response messages.</span></span> <span data-ttu-id="c4bc9-399">Por ejemplo, un mensaje HTTP POST debe devolver el URI del recurso recién creado.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-399">For example, an HTTP POST message should return the URI of the newly-created resource.</span></span> <span data-ttu-id="c4bc9-400">Todos los vínculos HATEOAS deben ser válidos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-400">All HATEOAS links should be valid.</span></span>

- <span data-ttu-id="c4bc9-401">Asegúrese de que cada operación devuelve los códigos de estado correctos para diferentes combinaciones de entradas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-401">Ensure that each operation returns the correct status codes for different combinations of input.</span></span> <span data-ttu-id="c4bc9-402">Por ejemplo: </span><span class="sxs-lookup"><span data-stu-id="c4bc9-402">For example:</span></span>

  - <span data-ttu-id="c4bc9-403">Si una consulta es correcta, debe devolver el código de estado 200 (correcto).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-403">If a query is successful, it should return status code 200 (OK)</span></span>
  - <span data-ttu-id="c4bc9-404">Si no se encuentra un recurso, la operación debe devolver el código de estado HTTP 404 (no encontrado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-404">If a resource is not found, the operation should return HTTP status code 404 (Not Found).</span></span>
  - <span data-ttu-id="c4bc9-405">Si el cliente envía una solicitud que elimina correctamente un recurso, el código de estado debe ser 204 (sin contenido).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-405">If the client sends a request that successfully deletes a resource, the status code should be 204 (No Content).</span></span>
  - <span data-ttu-id="c4bc9-406">Si el cliente envía una solicitud que crea un nuevo recurso, el código de estado debe ser 201 (creado).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-406">If the client sends a request that creates a new resource, the status code should be 201 (Created).</span></span>

<span data-ttu-id="c4bc9-407">Tenga cuidado con los códigos de estado de respuestas inesperados en el intervalo 5xx.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-407">Watch out for unexpected response status codes in the 5xx range.</span></span> <span data-ttu-id="c4bc9-408">Normalmente, el servidor host informa de estos mensajes para indicar que no pudo completar una solicitud válida.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-408">These messages are usually reported by the host server to indicate that it was unable to fulfill a valid request.</span></span>

- <span data-ttu-id="c4bc9-409">Pruebe las distintas combinaciones de encabezados de solicitud que una aplicación cliente puede especificar y asegúrese de que la API web devuelve la información esperada en los mensajes de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-409">Test the different request header combinations that a client application can specify and ensure that the web API returns the expected information in response messages.</span></span>

- <span data-ttu-id="c4bc9-410">Pruebe las cadenas de consultas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-410">Test query strings.</span></span> <span data-ttu-id="c4bc9-411">Si una operación puede tomar parámetros opcionales (por ejemplo, las solicitudes de paginación), pruebe las diferentes combinaciones y ordenaciones de los parámetros.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-411">If an operation can take optional parameters (such as pagination requests), test the different combinations and order of parameters.</span></span>

- <span data-ttu-id="c4bc9-412">Compruebe que las operaciones asincrónicas se completan correctamente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-412">Verify that asynchronous operations complete successfully.</span></span> <span data-ttu-id="c4bc9-413">Si la API web admite streaming para las solicitudes que devuelven objetos binarios de gran tamaño (como vídeo o audio), asegúrese de que las solicitudes de cliente no se bloquean mientras se transmiten los datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-413">If the web API supports streaming for requests that return large binary objects (such as video or audio), ensure that client requests are not blocked while the data is streamed.</span></span> <span data-ttu-id="c4bc9-414">Si la API web implementa sondeo para las operaciones de modificación de datos de ejecución prolongada, compruebe que las operaciones informan de su estado a medida que se procesan.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-414">If the web API implements polling for long-running data modification operations, verify that that the operations report their status correctly as they proceed.</span></span>

<span data-ttu-id="c4bc9-415">También debería crear y ejecutar pruebas de rendimiento para comprobar que la API web funciona satisfactoriamente bajo presión.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-415">You should also create and run performance tests to check that the web API operates satisfactorily under duress.</span></span> <span data-ttu-id="c4bc9-416">Puede crear un proyecto de pruebas de carga y rendimiento web con Visual Studio Ultimate.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-416">You can build a web performance and load test project by using Visual Studio Ultimate.</span></span> <span data-ttu-id="c4bc9-417">Para más información, consulte [Ejecutar pruebas de rendimiento en la aplicación](https://msdn.microsoft.com/library/dn250793.aspx).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-417">For more information, see [Run performance tests on an application before a release](https://msdn.microsoft.com/library/dn250793.aspx).</span></span>

## <a name="using-azure-api-management"></a><span data-ttu-id="c4bc9-418">Uso de Azure API Management</span><span class="sxs-lookup"><span data-stu-id="c4bc9-418">Using Azure API Management</span></span>

<span data-ttu-id="c4bc9-419">En Azure, considere la posibilidad de usar [Azue API Management](/azure/api-management//services/api-management/) para publicar y administrar una API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-419">On Azure, consider using [Azue API Management](/azure/api-management//services/api-management/) to publish and manage a web API.</span></span> <span data-ttu-id="c4bc9-420">Con esta utilidad, puede generar un servicio que actúe como una fachada para una o varias API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-420">Using this facility, you can generate a service that acts as a façade for one or more web APIs.</span></span> <span data-ttu-id="c4bc9-421">El servicio es en sí mismo un servicio web escalable que puede crear y configurar mediante el Portal de administración de Azure.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-421">The service is itself a scalable web service that you can create and configure by using the Azure Management portal.</span></span> <span data-ttu-id="c4bc9-422">Puede utilizar este servicio para publicar y administrar una API web como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-422">You can use this service to publish and manage a web API as follows:</span></span>

1. <span data-ttu-id="c4bc9-423">Implemente la API web en un sitio web, un servicio en la nube de Azure o una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-423">Deploy the web API to a website, Azure cloud service, or Azure virtual machine.</span></span>

2. <span data-ttu-id="c4bc9-424">Conecte el servicio de administración de API a la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-424">Connect the API management service to the web API.</span></span> <span data-ttu-id="c4bc9-425">Las solicitudes enviadas a la dirección URL de la API de administración se asignan a URI de la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-425">Requests sent to the URL of the management API are mapped to URIs in the web API.</span></span> <span data-ttu-id="c4bc9-426">El mismo servicio de administración de API puede enrutar las solicitudes a más de una API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-426">The same API management service can route requests to more than one web API.</span></span> <span data-ttu-id="c4bc9-427">Esto le permite agregar varias API web en un servicio de administración único.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-427">This enables you to aggregate multiple web APIs into a single management service.</span></span> <span data-ttu-id="c4bc9-428">De forma similar, es posible hacer referencia a la misma API web desde más de un servicio de administración de API si necesita restringir o hacer particiones de la funcionalidad disponible para distintas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-428">Similarly, the same web API can be referenced from more than one API management service if you need to restrict or partition the functionality available to different applications.</span></span>

     > [!NOTE]
     > <span data-ttu-id="c4bc9-429">Los URI de vínculos HATEOAS generados como parte de la respuesta de solicitudes HTTP GET deben hacer referencia a la dirección URL del servicio de administración de API y no al servidor web que hospeda la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-429">The URIs in HATEOAS links generated as part of the response for HTTP GET requests should reference the URL of the API management service and not the web server hosting the web API.</span></span>

3. <span data-ttu-id="c4bc9-430">Para cada API web, especifique las operaciones HTTP que expone la API web junto con los parámetros opcionales que una operación puede tomar como entrada.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-430">For each web API, specify the HTTP operations that the web API exposes together with any optional parameters that an operation can take as input.</span></span> <span data-ttu-id="c4bc9-431">También puede configurar si el servicio de administración de API debe almacenar en caché la respuesta recibida de la API web para optimizar las solicitudes repetidas para los mismos datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-431">You can also configure whether the API management service should cache the response received from the web API to optimize repeated requests for the same data.</span></span> <span data-ttu-id="c4bc9-432">Registre los detalles de las respuestas HTTP que puede generar cada operación.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-432">Record the details of the HTTP responses that each operation can generate.</span></span> <span data-ttu-id="c4bc9-433">Esta información se usa para generar la documentación para desarrolladores, por lo que es importante que sea precisa y completa.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-433">This information is used to generate documentation for developers, so it is important that it is accurate and complete.</span></span>

    <span data-ttu-id="c4bc9-434">Puede definir operaciones manualmente mediante los asistentes que se ofrecen en el Portal de administración de Azure o puede importarlas desde un archivo que contenga las definiciones en formato WADL o Swagger.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-434">You can either define operations manually using the wizards provided by the Azure Management portal, or you can import them from a file containing the definitions in WADL or Swagger format.</span></span>

4. <span data-ttu-id="c4bc9-435">Establezca la configuración de seguridad para las comunicaciones entre el servicio de administración de API y el servidor web que hospeda la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-435">Configure the security settings for communications between the API management service and the web server hosting the web API.</span></span> <span data-ttu-id="c4bc9-436">El servicio de administración de API actualmente admite la autenticación básica y mutua mediante certificados y la autorización de usuario de OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-436">The API management service currently supports Basic authentication and mutual authentication using certificates, and OAuth 2.0 user authorization.</span></span>

5. <span data-ttu-id="c4bc9-437">Cree un producto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-437">Create a product.</span></span> <span data-ttu-id="c4bc9-438">Un producto es la unidad de publicación; agregue las API web que había conectado previamente al servicio de administración al producto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-438">A product is the unit of publication; you add the web APIs that you previously connected to the management service to the product.</span></span> <span data-ttu-id="c4bc9-439">Cuando se publica el producto, las API web están disponibles para los desarrolladores.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-439">When the product is published, the web APIs become available to developers.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c4bc9-440">Antes de publicar un producto, también puede definir grupos de usuarios que pueden tener acceso al producto y agregar usuarios a esos grupos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-440">Prior to publishing a product, you can also define user-groups that can access the product and add users to these groups.</span></span> <span data-ttu-id="c4bc9-441">Esto le da control sobre los desarrolladores y las aplicaciones que puede usar la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-441">This gives you control over the developers and applications that can use the web API.</span></span> <span data-ttu-id="c4bc9-442">Si una API web está sujeta a aprobación, antes de poder tener acceso a ella, un desarrollador debe enviar una solicitud al administrador del producto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-442">If a web API is subject to approval, prior to being able to access it a developer must send a request to the product administrator.</span></span> <span data-ttu-id="c4bc9-443">El administrador puede conceder o denegar el acceso al desarrollador.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-443">The administrator can grant or deny access to the developer.</span></span> <span data-ttu-id="c4bc9-444">Los desarrolladores existentes también se pueden bloquear si cambian las circunstancias.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-444">Existing developers can also be blocked if circumstances change.</span></span>

6. <span data-ttu-id="c4bc9-445">Configure directivas para cada API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-445">Configure policies for each web API.</span></span> <span data-ttu-id="c4bc9-446">Las directivas rigen aspectos como si se deben permitir las llamadas entre dominios, cómo autenticar los clientes, si se debe hacer una conversión entre los formatos de datos XML y JSON de forma transparente, si se quieren restringir las llamadas de un determinado intervalo de IP, las cuotas de uso y si se quiere limitar la tasa de llamadas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-446">Policies govern aspects such as whether cross-domain calls should be allowed, how to authenticate clients, whether to convert between XML and JSON data formats transparently, whether to restrict calls from a given IP range, usage quotas, and whether to limit the call rate.</span></span> <span data-ttu-id="c4bc9-447">Las directivas pueden aplicarse globalmente a todo el producto, a una API web única de un producto o a operaciones individuales de una API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-447">Policies can be applied globally across the entire product, for a single web API in a product, or for individual operations in a web API.</span></span>

<span data-ttu-id="c4bc9-448">Para más información, consulte la [documentación de API Management](/azure/api-management/).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-448">For more information, see the [API Management Documentation](/azure/api-management/).</span></span>

> [!TIP]
> <span data-ttu-id="c4bc9-449">Azure ofrece el Administrador de tráfico de Azure que le permite implementar la conmutación por error y equilibrio de carga y reducir la latencia en varias instancias de un sitio web hospedado en distintas ubicaciones geográficas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-449">Azure provides the Azure Traffic Manager which enables you to implement failover and load-balancing, and reduce latency across multiple instances of a web site hosted in different geographic locations.</span></span> <span data-ttu-id="c4bc9-450">Puede usar el Administrador de tráfico de Azure junto con el servicio de administración de API, que puede enrutar solicitudes a instancias de un sitio web a través del Administrador de tráfico de Azure.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-450">You can use Azure Traffic Manager in conjunction with the API Management Service; the API Management Service can route requests to instances of a web site through Azure Traffic Manager.</span></span> <span data-ttu-id="c4bc9-451">Para más información, consulte [Métodos de enrutamiento de Traffic Manager](/azure/traffic-manager/traffic-manager-routing-methods/).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-451">For more information, see [Traffic Manager routing Methods](/azure/traffic-manager/traffic-manager-routing-methods/).</span></span>
>
> <span data-ttu-id="c4bc9-452">En esta estructura, si está utilizando nombres DNS personalizados para sus sitios web, debe configurar el registro CNAME adecuado para que cada sitio web apunte al nombre DNS del sitio web del Administrador de tráfico de Azure.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-452">In this structure, if you are using custom DNS names for your web sites, you should configure the appropriate CNAME record for each web site to point to the DNS name of the Azure Traffic Manager web site.</span></span>

## <a name="supporting-client-side-developers"></a><span data-ttu-id="c4bc9-453">Compatibilidad con desarrolladores en el lado cliente</span><span class="sxs-lookup"><span data-stu-id="c4bc9-453">Supporting client-side developers</span></span>

<span data-ttu-id="c4bc9-454">Los desarrolladores que crean aplicaciones cliente normalmente necesitan información sobre cómo obtener acceso a la API web y a la documentación relativa a los parámetros, los tipos de datos, los tipos de valores devueltos y los códigos de retorno que describen las distintas solicitudes y respuestas entre el servicio web y la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-454">Developers constructing client applications typically require information on how to access the web API, and documentation concerning the parameters, data types, return types, and return codes that describe the different requests and responses between the web service and the client application.</span></span>

### <a name="document-the-rest-operations-for-a-web-api"></a><span data-ttu-id="c4bc9-455">Documentación de las operaciones REST para una API web</span><span class="sxs-lookup"><span data-stu-id="c4bc9-455">Document the REST operations for a web API</span></span>

<span data-ttu-id="c4bc9-456">El servicio de administración de API de Azure incluye un portal para desarrolladores que describe las operaciones REST que expone una API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-456">The Azure API Management Service includes a developer portal that describes the REST operations exposed by a web API.</span></span> <span data-ttu-id="c4bc9-457">Cuando un producto se ha publicado, aparece en este portal.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-457">When a product has been published it appears on this portal.</span></span> <span data-ttu-id="c4bc9-458">Los desarrolladores pueden usar este portal para registrarse y obtener acceso; el administrador puede después aprobar o denegar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-458">Developers can use this portal to sign up for access; the administrator can then approve or deny the request.</span></span> <span data-ttu-id="c4bc9-459">Si se aprueba el desarrollador, se le asigna una clave de suscripción que se usa para autenticar las llamadas de las aplicaciones cliente que desarrolla.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-459">If the developer is approved, they are assigned a subscription key that is used to authenticate calls from the client applications that they develop.</span></span> <span data-ttu-id="c4bc9-460">Esta clave debe facilitarse con cada llamada de API web; en caso contrario, se rechazará.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-460">This key must be provided with each web API call otherwise it will be rejected.</span></span>

<span data-ttu-id="c4bc9-461">Este portal también ofrece:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-461">This portal also provides:</span></span>

- <span data-ttu-id="c4bc9-462">Documentación del producto, donde se enumeran las operaciones que expone, los parámetros necesarios y las distintas respuestas que se pueden devolver.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-462">Documentation for the product, listing the operations that it exposes, the parameters required, and the different responses that can be returned.</span></span> <span data-ttu-id="c4bc9-463">Tenga en cuenta que esta información se genera a partir de los detalles proporcionados en el paso 3 de la lista en la sección Publicación de una API web mediante el servicio de Microsoft Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-463">Note that this information is generated from the details provided in step 3 in the list in the Publishing a web API by using the Microsoft Azure API Management Service section.</span></span>
- <span data-ttu-id="c4bc9-464">Fragmentos de código que muestran cómo invocar operaciones de varios lenguajes, incluidos JavaScript, C#, Java, Ruby, Python y PHP.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-464">Code snippets that show how to invoke operations from several languages, including JavaScript, C#, Java, Ruby, Python, and PHP.</span></span>
- <span data-ttu-id="c4bc9-465">Una consola para desarrolladores que permite que un desarrollador envíe una solicitud HTTP para probar cada una de las operaciones del producto y ver los resultados.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-465">A developers' console that enables a developer to send an HTTP request to test each operation in the product and view the results.</span></span>
- <span data-ttu-id="c4bc9-466">Una página donde el desarrollador puede informar de los problemas encontrados.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-466">A page where the developer can report any issues or problems found.</span></span>

<span data-ttu-id="c4bc9-467">El Portal de administración de Azure le permite personalizar el portal para desarrolladores para cambiar el estilo y el diseño, de forma que coincida con la marca de su organización.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-467">The Azure Management portal enables you to customize the developer portal to change the styling and layout to match the branding of your organization.</span></span>

### <a name="implement-a-client-sdk"></a><span data-ttu-id="c4bc9-468">Implementación de un SDK de cliente</span><span class="sxs-lookup"><span data-stu-id="c4bc9-468">Implement a client SDK</span></span>

<span data-ttu-id="c4bc9-469">La creación de una aplicación cliente que invoque solicitudes REST para tener acceso a una API web requiere que se escriba una cantidad significativa de código para construir cada solicitud y se le dé el formato adecuado, que se envié la solicitud al servidor que hospeda el servicio web y se analice la respuesta para determinar si la solicitud se realizó correctamente o no y que se extraigan los datos devueltos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-469">Building a client application that invokes REST requests to access a web API requires writing a significant amount of code to construct each request and format it appropriately, send the request to the server hosting the web service, and parse the response to work out whether the request succeeded or failed and extract any data returned.</span></span> <span data-ttu-id="c4bc9-470">Para aislar la aplicación cliente de estas cuestiones, puede proporcionar un SDK que encapsule la interfaz REST y abstraiga estos detalles de bajo nivel dentro de un conjunto de métodos más funcional.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-470">To insulate the client application from these concerns, you can provide an SDK that wraps the REST interface and abstracts these low-level details inside a more functional set of methods.</span></span> <span data-ttu-id="c4bc9-471">Una aplicación cliente usa estos métodos, que convierten las llamadas en solicitudes REST de forma transparente y, luego, vuelve a convertir las respuestas a los valores que el método ha devuelto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-471">A client application uses these methods, which transparently convert calls into REST requests and then convert the responses back into method return values.</span></span> <span data-ttu-id="c4bc9-472">Se trata de una técnica común que se implementa en muchos servicios, incluidos el SDK de Azure.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-472">This is a common technique that is implemented by many services, including the Azure SDK.</span></span>

<span data-ttu-id="c4bc9-473">La creación de un SDK del lado cliente es una tarea de una envergadura considerable, ya que debe implementarse de forma coherente y probarse cuidadosamente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-473">Creating a client-side SDK is a considerable undertaking as it has to be implemented consistently and tested carefully.</span></span> <span data-ttu-id="c4bc9-474">Sin embargo, gran parte de este proceso se puede realizar de forma mecánica y muchos proveedores ofrecen herramientas que pueden automatizar muchas de estas tareas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-474">However, much of this process can be made mechanical, and many vendors supply tools that can automate many of these tasks.</span></span>

## <a name="monitoring-a-web-api"></a><span data-ttu-id="c4bc9-475">Supervisión de una API web</span><span class="sxs-lookup"><span data-stu-id="c4bc9-475">Monitoring a web API</span></span>

<span data-ttu-id="c4bc9-476">Según cómo haya publicado e implementado la API web, podrá supervisar la API web directamente o podrá recopilar información del uso y del estado, mediante un análisis del tráfico que pasa a través del servicio de administración de API.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-476">Depending on how you have published and deployed your web API you can monitor the web API directly, or you can gather usage and health information by analyzing the traffic that passes through the API Management service.</span></span>

### <a name="monitoring-a-web-api-directly"></a><span data-ttu-id="c4bc9-477">Supervisión de una API web directamente</span><span class="sxs-lookup"><span data-stu-id="c4bc9-477">Monitoring a web API directly</span></span>

<span data-ttu-id="c4bc9-478">Si ha implementado la API web mediante la plantilla de API Web de ASP.NET (ya sea como un proyecto de API Web o como un rol web en un servicio en la nube de Azure) y Visual Studio 2013, puede recopilar datos de uso, rendimiento y disponibilidad con Application Insights de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-478">If you have implemented your web API by using the ASP.NET Web API template (either as a Web API project or as a Web role in an Azure cloud service) and Visual Studio 2013, you can gather availability, performance, and usage data by using ASP.NET Application Insights.</span></span> <span data-ttu-id="c4bc9-479">Application Insights es un paquete que, de forma transparente, realiza un seguimiento y registra información sobre las solicitudes y respuestas cuando se implementa la API web en la nube; cuando el paquete está instalado y configurado, no es necesario modificar nada del código en la API web para usarlo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-479">Application Insights is a package that transparently tracks and records information about requests and responses when the web API is deployed to the cloud; once the package is installed and configured, you don't need to amend any code in your web API to use it.</span></span> <span data-ttu-id="c4bc9-480">Cuando implementa la API web en un sitio web de Azure, se examina todo el tráfico y se recopilan las estadísticas siguientes:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-480">When you deploy the web API to an Azure web site, all traffic is examined and the following statistics are gathered:</span></span>

- <span data-ttu-id="c4bc9-481">El tiempo de respuesta del servidor.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-481">Server response time.</span></span>
- <span data-ttu-id="c4bc9-482">El número de solicitudes del servidor y los detalles de cada una.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-482">Number of server requests and the details of each request.</span></span>
- <span data-ttu-id="c4bc9-483">Las solicitudes más lentas en cuanto al tiempo de respuesta medio.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-483">The top slowest requests in terms of average response time.</span></span>
- <span data-ttu-id="c4bc9-484">Los detalles de las solicitudes con errores.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-484">The details of any failed requests.</span></span>
- <span data-ttu-id="c4bc9-485">El número de sesiones que han iniciado otros exploradores y agentes de usuario.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-485">The number of sessions initiated by different browsers and user agents.</span></span>
- <span data-ttu-id="c4bc9-486">Las páginas visitadas con más frecuencia (lo que es útil principalmente para las aplicaciones web en lugar de las API web).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-486">The most frequently viewed pages (primarily useful for web applications rather than web APIs).</span></span>
- <span data-ttu-id="c4bc9-487">Los distintos roles de usuario que obtienen acceso a la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-487">The different user roles accessing the web API.</span></span>

<span data-ttu-id="c4bc9-488">Puede ver estos datos en tiempo real desde el Portal de administración de Azure.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-488">You can view this data in real time from the Azure Management portal.</span></span> <span data-ttu-id="c4bc9-489">También puede crear pruebas web que supervisen el estado de la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-489">You can also create webtests that monitor the health of the web API.</span></span> <span data-ttu-id="c4bc9-490">Una prueba web envía una solicitud periódica a un URI especificado en la API web y captura la respuesta.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-490">A webtest sends a periodic request to a specified URI in the web API and captures the response.</span></span> <span data-ttu-id="c4bc9-491">Puede especificar la definición de una respuesta correcta (por ejemplo, el código de estado HTTP 200) y, si la solicitud no devuelve esta respuesta, puede establecer que se envíe una alerta a un administrador.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-491">You can specify the definition of a successful response (such as HTTP status code 200), and if the request does not return this response you can arrange for an alert to be sent to an administrator.</span></span> <span data-ttu-id="c4bc9-492">Si es necesario, el administrador puede reiniciar el servidor que hospeda la API web en caso de que se haya producido un error.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-492">If necessary, the administrator can restart the server hosting the web API if it has failed.</span></span>

<span data-ttu-id="c4bc9-493">Para más información, consulte [Configurar Application Insights para ASP.NET](/azure/application-insights/app-insights-asp-net/).</span><span class="sxs-lookup"><span data-stu-id="c4bc9-493">For more information, see [Application Insights - Get started with ASP.NET](/azure/application-insights/app-insights-asp-net/).</span></span>

### <a name="monitoring-a-web-api-through-the-api-management-service"></a><span data-ttu-id="c4bc9-494">Supervisión de una API web a través del servicio de administración de API</span><span class="sxs-lookup"><span data-stu-id="c4bc9-494">Monitoring a web API through the API Management Service</span></span>

<span data-ttu-id="c4bc9-495">Si ha publicado la API web mediante el servicio de administración de API, la página de administración de API del Portal de administración de Azure contiene un panel que le permite ver el rendimiento general del servicio.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-495">If you have published your web API by using the API Management service, the API Management page on the Azure Management portal contains a dashboard that enables you to view the overall performance of the service.</span></span> <span data-ttu-id="c4bc9-496">La página de análisis le permite profundizar en los detalles de cómo se usa el producto.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-496">The Analytics page enables you to drill down into the details of how the product is being used.</span></span> <span data-ttu-id="c4bc9-497">Esta página contiene los siguientes campos:</span><span class="sxs-lookup"><span data-stu-id="c4bc9-497">This page contains the following tabs:</span></span>

- <span data-ttu-id="c4bc9-498">**Uso**.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-498">**Usage**.</span></span> <span data-ttu-id="c4bc9-499">Esta pestaña proporciona información sobre el número de llamadas API realizadas y el ancho de banda que se ha usado para controlar esas llamadas en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-499">This tab provides information about the number of API calls made and the bandwidth used to handle these calls over time.</span></span> <span data-ttu-id="c4bc9-500">Puede filtrar los detalles de uso por producto, API y operación.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-500">You can filter usage details by product, API, and operation.</span></span>
- <span data-ttu-id="c4bc9-501">**Estado**.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-501">**Health**.</span></span> <span data-ttu-id="c4bc9-502">Esta pestaña permite ver el resultado de las solicitudes de API (los códigos de estado HTTP devueltos), la eficacia de la directiva de almacenamiento en caché, el tiempo de respuesta de las API y el tiempo de respuesta del servicio.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-502">This tab enables you to view the outcome of API requests (the HTTP status codes returned), the effectiveness of the caching policy, the API response time, and the service response time.</span></span> <span data-ttu-id="c4bc9-503">De nuevo, puede filtrar los datos del estado por producto, API y operación.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-503">Again, you can filter health data by product, API, and operation.</span></span>
- <span data-ttu-id="c4bc9-504">**Actividad**.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-504">**Activity**.</span></span> <span data-ttu-id="c4bc9-505">Esta pestaña ofrece un resumen de texto de los números de llamadas correctas, erróneas y bloqueadas, el tiempo medio de respuesta y los tiempos de respuesta de cada producto, API web y operación.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-505">This tab provides a text summary of the numbers of successful calls, failed calls, blocked calls, average response time, and response times for each product, web API, and operation.</span></span> <span data-ttu-id="c4bc9-506">Esta página también muestra el número de llamadas que ha realizado cada desarrollador.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-506">This page also lists the number of calls made by each developer.</span></span>
- <span data-ttu-id="c4bc9-507">**En un vistazo**.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-507">**At a glance**.</span></span> <span data-ttu-id="c4bc9-508">Esta pestaña muestra un resumen de los datos de rendimiento, incluidos los desarrolladores responsables de realizar la mayoría de las llamadas a API y los productos, API web y operaciones que recibieron estas llamadas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-508">This tab displays a summary of the performance data, including the developers responsible for making the most API calls, and the products, web APIs, and operations that received these calls.</span></span>

<span data-ttu-id="c4bc9-509">Puede usar esta información para determinar si una operación o API web determinadas están causando un cuello de botella y si es necesario escalar el entorno de host y agregar más servidores.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-509">You can use this information to determine whether a particular web API or operation is causing a bottleneck, and if necessary scale the host environment and add more servers.</span></span> <span data-ttu-id="c4bc9-510">También puede determinar si una o varias aplicaciones usan un volumen de recursos desproporcionado y aplican las directivas adecuadas para establecer las cuotas y limitar las tasas de llamadas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-510">You can also ascertain whether one or more applications are using a disproportionate volume of resources and apply the appropriate policies to set quotas and limit call rates.</span></span>

> [!NOTE]
> <span data-ttu-id="c4bc9-511">Puede cambiar los detalles de un producto publicado y los cambios se aplicarán inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-511">You can change the details for a published product, and the changes are applied immediately.</span></span> <span data-ttu-id="c4bc9-512">Por ejemplo, puede agregar o quitar una operación de una API web sin necesidad de volver a publicar el producto que contenga la API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-512">For example, you can add or remove an operation from a web API without requiring that you republish the product that contains the web API.</span></span>

## <a name="more-information"></a><span data-ttu-id="c4bc9-513">Más información</span><span class="sxs-lookup"><span data-stu-id="c4bc9-513">More information</span></span>

- <span data-ttu-id="c4bc9-514">[ASP.NET Web API OData](https://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api) contiene ejemplos e información adicional sobre la implementación de una API web de OData mediante ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-514">[ASP.NET Web API OData](https://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api) contains examples and further information on implementing an OData web API by using ASP.NET.</span></span>
- <span data-ttu-id="c4bc9-515">[Introducing batch support in Web API and Web API OData](https://blogs.msdn.microsoft.com/webdev/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata/) (Incorporación de compatibilidad con procesos por lotes en API web y OData de Api web) describe cómo implementar operaciones por lotes en una API web mediante OData.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-515">[Introducing batch support in Web API and Web API OData](https://blogs.msdn.microsoft.com/webdev/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata/) describes how to implement batch operations in a web API by using OData.</span></span>
- <span data-ttu-id="c4bc9-516">En los [patrones de idempotencia](https://blog.jonathanoliver.com/idempotency-patterns/) del blog de Jonathan Oliver se ofrece una visión general de la idempotencia y cómo se relaciona con las operaciones de administración de datos.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-516">[Idempotency patterns](https://blog.jonathanoliver.com/idempotency-patterns/) on Jonathan Oliver’s blog provides an overview of idempotency and how it relates to data management operations.</span></span>
- <span data-ttu-id="c4bc9-517">La página [Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) del sitio web de W3C contiene una lista completa de códigos de estado HTTP y sus descripciones.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-517">[Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) on the W3C website contains a full list of HTTP status codes and their descriptions.</span></span>
- <span data-ttu-id="c4bc9-518">En la página [Ejecutar tareas en segundo plano con WebJobs](/azure/app-service-web/web-sites-create-web-jobs/) se ofrece información y ejemplos sobre el uso de WebJobs para realizar operaciones en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-518">[Run background tasks with WebJobs](/azure/app-service-web/web-sites-create-web-jobs/) provides information and examples on using WebJobs to perform background operations.</span></span>
- <span data-ttu-id="c4bc9-519">En la página [Notificación a los usuarios con Azure Notification Hubs](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/) se muestra cómo usar un centro de notificaciones de Azure para insertar respuestas asincrónicas en las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-519">[Azure Notification Hubs notify users](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/) shows how to use an Azure Notification Hub to push asynchronous responses to client applications.</span></span>
- <span data-ttu-id="c4bc9-520">En la página [API Management](https://azure.microsoft.com/services/api-management/) se describe cómo publicar un producto que ofrezca un acceso seguro y controlado a una API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-520">[API Management](https://azure.microsoft.com/services/api-management/) describes how to publish a product that provides controlled and secure access to a web API.</span></span>
- <span data-ttu-id="c4bc9-521">En la [referencia de la API REST de Azure API Management](https://msdn.microsoft.com/library/azure/dn776326.aspx) se describe cómo usar la API REST de API Management para crear aplicaciones de administración personalizadas.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-521">[Azure API Management REST API reference](https://msdn.microsoft.com/library/azure/dn776326.aspx) describes how to use the API Management REST API to build custom management applications.</span></span>
- <span data-ttu-id="c4bc9-522">En la página [Métodos de enrutamiento de Traffic Manager](/azure/traffic-manager/traffic-manager-routing-methods/) se resume cómo se puede usar Azure Traffic Manager para realizar un equilibrio de carga de las solicitudes entre varias instancias de un sitio web que hospeda una API web.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-522">[Traffic Manager routing methods](/azure/traffic-manager/traffic-manager-routing-methods/) summarizes how Azure Traffic Manager can be used to load-balance requests across multiple instances of a website hosting a web API.</span></span>
- <span data-ttu-id="c4bc9-523">En la página [Configurar Application Insights para ASP.NET](/azure/application-insights/app-insights-asp-net/) se ofrece información detallada sobre la instalación y configuración de Application Insights en un proyecto ASP.NET Web API.</span><span class="sxs-lookup"><span data-stu-id="c4bc9-523">[Application Insights - Get started with ASP.NET](/azure/application-insights/app-insights-asp-net/) provides detailed information on installing and configuring Application Insights in an ASP.NET Web API project.</span></span>

<!-- links -->

[api-design]: ./api-design.md
