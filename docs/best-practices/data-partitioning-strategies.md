---
title: Estrategias de creación de particiones de datos
titleSuffix: Best practices for cloud applications
description: Orientaciones sobre cómo separar las particiones de datos para administrarlas y tener acceso a ellas por separado.
author: dragon119
ms.date: 11/04/2018
ms.custom: seodec18
ms.openlocfilehash: 609da490537c20c1ea5e3fd739233d51435c689a
ms.sourcegitcommit: 4ba3304eebaa8c493c3e5307bdd9d723cd90b655
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/12/2018
ms.locfileid: "53307306"
---
# <a name="data-partitioning-strategies"></a><span data-ttu-id="49464-103">Estrategias de creación de particiones de datos</span><span class="sxs-lookup"><span data-stu-id="49464-103">Data partitioning strategies</span></span>

<span data-ttu-id="49464-104">En este artículo se describen algunas estrategias para crear particiones de datos en varios almacenes de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="49464-104">This article describes some strategies for partitioning data in various Azure data stores.</span></span> <span data-ttu-id="49464-105">Para obtener instrucciones generales acerca de cuándo crear particiones de datos y los procedimientos recomendados para hacerlo, consulte [Creación de particiones de datos](./data-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="49464-105">For general guidance about when to partition data and best practices, see [Data partitioning](./data-partitioning.md)</span></span>

## <a name="partitioning-azure-sql-database"></a><span data-ttu-id="49464-106">Creación de particiones en Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="49464-106">Partitioning Azure SQL Database</span></span>

<span data-ttu-id="49464-107">Una única base de datos SQL puede contener un volumen de datos limitado.</span><span class="sxs-lookup"><span data-stu-id="49464-107">A single SQL database has a limit to the volume of data that it can contain.</span></span> <span data-ttu-id="49464-108">El rendimiento está restringido por factores arquitectónicos y el número de conexiones simultáneas que admite.</span><span class="sxs-lookup"><span data-stu-id="49464-108">Throughput is constrained by architectural factors and the number of concurrent connections that it supports.</span></span>

<span data-ttu-id="49464-109">Los [grupos de bases de datos elásticas](/azure/sql-database/sql-database-elastic-pool) admiten el escalado horizontal de las bases de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="49464-109">[Elastic pools](/azure/sql-database/sql-database-elastic-pool) support horizontal scaling for a SQL database.</span></span> <span data-ttu-id="49464-110">Mediante los grupos de bases de datos elásticas se pueden crear particiones de datos que se reparten en varias bases de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="49464-110">Using elastic pools, you can partition your data into shards that are spread across multiple SQL databases.</span></span> <span data-ttu-id="49464-111">También puede agregar o quitar particiones a medida que crezca y disminuya el volumen de datos que necesita administrar.</span><span class="sxs-lookup"><span data-stu-id="49464-111">You can also add or remove shards as the volume of data that you need to handle grows and shrinks.</span></span> <span data-ttu-id="49464-112">Los grupos de bases de datos elásticas también pueden ayudar a reducir la contención, ya que distribuyen la carga entre las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-112">Elastic pools can also help reduce contention by distributing the load across databases.</span></span>

<span data-ttu-id="49464-113">Cada partición se implementa como una base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="49464-113">Each shard is implemented as a SQL database.</span></span> <span data-ttu-id="49464-114">Una partición puede contener más de un conjunto de datos (denominado *shardlet*).</span><span class="sxs-lookup"><span data-stu-id="49464-114">A shard can hold more than one dataset (called a *shardlet*).</span></span> <span data-ttu-id="49464-115">Cada base de datos mantiene metadatos que describen los shardlets que contiene.</span><span class="sxs-lookup"><span data-stu-id="49464-115">Each database maintains metadata that describes the shardlets that it contains.</span></span> <span data-ttu-id="49464-116">Un shardlet puede ser un único elemento de datos o un grupo de elementos que comparten la misma clave de shardlet.</span><span class="sxs-lookup"><span data-stu-id="49464-116">A shardlet can be a single data item, or a group of items that share the same shardlet key.</span></span> <span data-ttu-id="49464-117">Por ejemplo, en una aplicación de varios inquilinos, la clave de shardlet puede ser el identificador del inquilino y todos los datos de un inquilino se pueden mantener en el mismo shardlet.</span><span class="sxs-lookup"><span data-stu-id="49464-117">For example, in a multitenant application, the shardlet key can be the tenant ID, and all data for a tenant can be held in the same shardlet.</span></span>

<span data-ttu-id="49464-118">Las aplicaciones cliente son responsables de la asociación de un conjunto de datos con una clave de shardlet.</span><span class="sxs-lookup"><span data-stu-id="49464-118">Client applications are responsible for associating a dataset with a shardlet key.</span></span> <span data-ttu-id="49464-119">Una base de datos SQL independiente actúa como administrador global de mapas de particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-119">A separate SQL database acts as a global shard map manager.</span></span> <span data-ttu-id="49464-120">Esta base de datos tiene una lista de todas las particiones y shardlets del sistema.</span><span class="sxs-lookup"><span data-stu-id="49464-120">This database has a list of all the shards and shardlets in the system.</span></span> <span data-ttu-id="49464-121">La aplicación se conecta a la base de datos del administrador del mapa de particiones para obtener una copia de este.</span><span class="sxs-lookup"><span data-stu-id="49464-121">The application connects to the shard map manager database to obtain a copy of the shard map.</span></span> <span data-ttu-id="49464-122">Almacena en caché localmente el mapa de particiones y utiliza dicho mapa para enrutar las solicitudes de datos a la partición apropiada.</span><span class="sxs-lookup"><span data-stu-id="49464-122">It caches the shard map locally, and uses the map to route data requests to the appropriate shard.</span></span> <span data-ttu-id="49464-123">Esta funcionalidad se oculta detrás de una serie de API que se encuentran en la [biblioteca de cliente de Elastic Database](/azure/sql-database/sql-database-elastic-database-client-library), que está disponible para Java y .NET.</span><span class="sxs-lookup"><span data-stu-id="49464-123">This functionality is hidden behind a series of APIs that are contained in the [Elastic Database client library](/azure/sql-database/sql-database-elastic-database-client-library), which is available for Java and .NET.</span></span>

<span data-ttu-id="49464-124">Para más información acerca de los grupos de bases de datos elásticas, consulte [Escalado horizontal con Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction).</span><span class="sxs-lookup"><span data-stu-id="49464-124">For more information about elastic pools, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction).</span></span>

<span data-ttu-id="49464-125">Para reducir la latencia y mejorar la disponibilidad, puede replicar la base de datos de administrador global del mapa de particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-125">To reduce latency and improve availability, you can replicate the global shard map manager database.</span></span> <span data-ttu-id="49464-126">Con los planes de tarifa Premium, puede configurar la replicación geográfica activa para copiar continuamente datos a bases de datos de diferentes regiones.</span><span class="sxs-lookup"><span data-stu-id="49464-126">With the Premium pricing tiers, you can configure active geo-replication to continuously copy data to databases in different regions.</span></span>

<span data-ttu-id="49464-127">Como alternativa, use [Azure SQL Data Sync](/azure/sql-database/sql-database-sync-data) o [Azure Data Factory](/azure/data-factory/) para replicar la base de datos del administrador del mapa de particiones entre regiones.</span><span class="sxs-lookup"><span data-stu-id="49464-127">Alternatively, use [Azure SQL Data Sync](/azure/sql-database/sql-database-sync-data) or [Azure Data Factory](/azure/data-factory/) to replicate the shard map manager database across regions.</span></span> <span data-ttu-id="49464-128">Esta forma de replicación se ejecuta periódicamente y es más adecuada si el mapa de particiones no cambia con frecuencia y no requiere el nivel Premium.</span><span class="sxs-lookup"><span data-stu-id="49464-128">This form of replication runs periodically and is more suitable if the shard map changes infrequently, and does not require Premium tier.</span></span>

<span data-ttu-id="49464-129">Elastic Database proporciona dos esquemas para asignar datos a shardlets y para almacenarlos en particiones:</span><span class="sxs-lookup"><span data-stu-id="49464-129">Elastic Database provides two schemes for mapping data to shardlets and storing them in shards:</span></span>

- <span data-ttu-id="49464-130">Un **mapa de particiones de lista** asocia una clave única a un shardlet.</span><span class="sxs-lookup"><span data-stu-id="49464-130">A **list shard map** associates a single key to a shardlet.</span></span> <span data-ttu-id="49464-131">Por ejemplo, en un sistema de varios inquilinos, los datos de cada inquilino podrían asociarse a una clave única y almacenarse en su propio shardlet.</span><span class="sxs-lookup"><span data-stu-id="49464-131">For example, in a multitenant system, the data for each tenant can be associated with a unique key and stored in its own shardlet.</span></span> <span data-ttu-id="49464-132">Para garantizar el aislamiento, cada shardlet puede mantenerse dentro de su propia partición.</span><span class="sxs-lookup"><span data-stu-id="49464-132">To guarantee isolation, each shardlet can be held within its own shard.</span></span>

    ![Uso de un mapa de particiones de lista para almacenar datos de inquilino en particiones independientes](./images/data-partitioning/PointShardlet.png)

- <span data-ttu-id="49464-134">Un **mapa de particiones de intervalos** asocia un conjunto de valores de clave contiguos a un shardlet.</span><span class="sxs-lookup"><span data-stu-id="49464-134">A **range shard map** associates a set of contiguous key values to a shardlet.</span></span> <span data-ttu-id="49464-135">Por ejemplo, puede agrupar los datos de un conjunto de inquilinos (cada uno de ellos con su propia clave) en el mismo shardlet.</span><span class="sxs-lookup"><span data-stu-id="49464-135">For example, you can group the data for a set of tenants (each with their own key) within the same shardlet.</span></span> <span data-ttu-id="49464-136">Este esquema es más barato que el primero, ya que los inquilinos comparten el almacenamiento de datos, pero su aislamiento es menor.</span><span class="sxs-lookup"><span data-stu-id="49464-136">This scheme is less expensive than the first, because tenants share data storage, but has less isolation.</span></span>

    ![Uso de un mapa de particiones de intervalo para almacenar los datos de un intervalo de inquilinos de una partición](./images/data-partitioning/RangeShardlet.png)

<span data-ttu-id="49464-138">Una partición individual puede contener los datos de varios shardlets.</span><span class="sxs-lookup"><span data-stu-id="49464-138">A single shard can contain the data for several shardlets.</span></span> <span data-ttu-id="49464-139">Por ejemplo, puede utilizar shardlets de lista para almacenar datos de varios inquilinos no contiguos en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-139">For example, you can use list shardlets to store data for different non-contiguous tenants in the same shard.</span></span> <span data-ttu-id="49464-140">También puede mezclar shardlets de intervalo y de lista en la misma partición, aunque se tratarán a través de diferentes mapas.</span><span class="sxs-lookup"><span data-stu-id="49464-140">You can also mix range shardlets and list shardlets in the same shard, although they will be addressed through different maps.</span></span> <span data-ttu-id="49464-141">En el siguiente diagrama se ilustra este enfoque:</span><span class="sxs-lookup"><span data-stu-id="49464-141">The following diagram shows this approach:</span></span>

![Implementación de varios mapas de particiones](./images/data-partitioning/MultipleShardMaps.png)

<span data-ttu-id="49464-143">Los grupo de bases de datos elásticas permiten agregar y quitar particiones cuando el volumen de datos disminuye o crece.</span><span class="sxs-lookup"><span data-stu-id="49464-143">Elastic pools makes it possible to add and remove shards as the volume of data shrinks and grows.</span></span> <span data-ttu-id="49464-144">Las aplicaciones cliente pueden crear y eliminar particiones dinámicamente y actualizar el administrador del mapa de particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-144">Client applications can create and delete shards dynamically, and transparently update the shard map manager.</span></span> <span data-ttu-id="49464-145">sin embargo, eliminar una partición es una operación destructiva que también requiere la eliminación de todos los datos de esa partición.</span><span class="sxs-lookup"><span data-stu-id="49464-145">However, removing a shard is a destructive operation that also requires deleting all the data in that shard.</span></span>

<span data-ttu-id="49464-146">Si una aplicación necesita dividir una partición en dos particiones independientes o combinar particiones, use la [herramienta de división y combinación](/azure/sql-database/sql-database-elastic-scale-overview-split-and-merge).</span><span class="sxs-lookup"><span data-stu-id="49464-146">If an application needs to split a shard into two separate shards or combine shards, use the [split-merge tool](/azure/sql-database/sql-database-elastic-scale-overview-split-and-merge).</span></span> <span data-ttu-id="49464-147">Esta herramienta se ejecuta como un servicio web de Azure y migra los datos entre particiones de forma segura.</span><span class="sxs-lookup"><span data-stu-id="49464-147">This tool runs as an Azure web service, and migrates data safely between shards.</span></span>

<span data-ttu-id="49464-148">El esquema de particiones puede afectar considerablemente al rendimiento del sistema.</span><span class="sxs-lookup"><span data-stu-id="49464-148">The partitioning scheme can significantly impact the performance of your system.</span></span> <span data-ttu-id="49464-149">También puede afectar a la frecuencia con que deben agregarse o quitarse particiones, o con que se deben volver a crear particiones de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-149">It can also affect the rate at which shards have to be added or removed, or that data must be repartitioned across shards.</span></span> <span data-ttu-id="49464-150">Considere los siguientes puntos:</span><span class="sxs-lookup"><span data-stu-id="49464-150">Consider the following points:</span></span>

- <span data-ttu-id="49464-151">Agrupe los datos que se utilizan conjuntamente en la misma partición y evite operaciones que accedan a datos de varias particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-151">Group data that is used together in the same shard, and avoid operations that access data from multiple shards.</span></span> <span data-ttu-id="49464-152">Una partición es una base de datos SQL por derecho propio y las combinaciones entre bases de datos se deben realizar en el cliente.</span><span class="sxs-lookup"><span data-stu-id="49464-152">A shard is a SQL database in its own right, and cross-database joins must be performed on the client side.</span></span>

    <span data-ttu-id="49464-153">Aunque SQL Database no admite combinaciones entre bases de datos, puede usar las herramientas de Elastic Database para realizar [consultas en varias particiones](/azure/sql-database/sql-database-elastic-scale-multishard-querying).</span><span class="sxs-lookup"><span data-stu-id="49464-153">Although SQL Database does not support cross-database joins, you can use the Elastic Database tools to perform [mutli-shard queries](/azure/sql-database/sql-database-elastic-scale-multishard-querying).</span></span> <span data-ttu-id="49464-154">Una consulta en varias particiones envía consultas individuales a cada base de datos y combina los resultados.</span><span class="sxs-lookup"><span data-stu-id="49464-154">A multi-shard query sends individual queries to each database and merges the results.</span></span>

- <span data-ttu-id="49464-155">No diseñe un sistema que tenga dependencias entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-155">Don't design a system that has dependencies between shards.</span></span> <span data-ttu-id="49464-156">Las restricciones de integridad referencial, los desencadenadores y los procedimientos almacenados de una base de datos no pueden hacer referencia a otra.</span><span class="sxs-lookup"><span data-stu-id="49464-156">Referential integrity constraints, triggers, and stored procedures in one database cannot reference objects in another.</span></span>

- <span data-ttu-id="49464-157">Si tiene datos de referencia que las consultas usen con frecuencia, considere la posibilidad de replicar dichos datos entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-157">If you have reference data that is frequently used by queries, consider replicating this data across shards.</span></span> <span data-ttu-id="49464-158">Este enfoque puede eliminar la necesidad de combinar datos en las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-158">This approach can remove the need to join data across databases.</span></span> <span data-ttu-id="49464-159">Lo ideal es que dichos datos sean estáticos o lentos para minimizar el esfuerzo de replicación y reducir las posibilidades de que se vuelvan obsoletos.</span><span class="sxs-lookup"><span data-stu-id="49464-159">Ideally, such data should be static or slow-moving, to minimize the replication effort and reduce the chances of it becoming stale.</span></span>

- <span data-ttu-id="49464-160">Los shardlets que pertenecen al mismo mapa de particiones deben tener el mismo esquema.</span><span class="sxs-lookup"><span data-stu-id="49464-160">Shardlets that belong to the same shard map should have the same schema.</span></span> <span data-ttu-id="49464-161">Esta regla no se aplica mediante SQL Database, pero la administración y consulta de datos se vuelven muy complejas si cada shardlet tiene un esquema diferente.</span><span class="sxs-lookup"><span data-stu-id="49464-161">This rule is not enforced by SQL Database, but data management and querying becomes very complex if each shardlet has a different schema.</span></span> <span data-ttu-id="49464-162">En su lugar, cree mapas de particiones independientes para cada esquema.</span><span class="sxs-lookup"><span data-stu-id="49464-162">Instead, create separate shard maps for each schema.</span></span> <span data-ttu-id="49464-163">Recuerde que los datos que pertenecen a diferentes shardlets pueden almacenarse en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-163">Remember that data belonging to different shardlets can be stored in the same shard.</span></span>

- <span data-ttu-id="49464-164">Las operaciones transaccionales solo se admiten para los datos que se encuentren en una partición, no entre particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-164">Transactional operations are only supported for data within a shard, and not across shards.</span></span> <span data-ttu-id="49464-165">Las transacciones pueden abarcar shardlets siempre que formen parte de la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-165">Transactions can span shardlets as long as they are part of the same shard.</span></span> <span data-ttu-id="49464-166">Por consiguiente, si la lógica de negocios debe realizar transacciones, almacene los datos en la misma partición o implemente la coherencia eventual.</span><span class="sxs-lookup"><span data-stu-id="49464-166">Therefore, if your business logic needs to perform transactions, either store the data in the same shard or implement eventual consistency.</span></span>

- <span data-ttu-id="49464-167">Coloque las particiones cerca de los usuarios que acceden a los datos de dichas particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-167">Place shards close to the users that access the data in those shards.</span></span> <span data-ttu-id="49464-168">Esta estrategia ayuda a reducir la latencia.</span><span class="sxs-lookup"><span data-stu-id="49464-168">This strategy helps reduce latency.</span></span>

- <span data-ttu-id="49464-169">Evite tener una mezcla de particiones muy activas y relativamente inactivas.</span><span class="sxs-lookup"><span data-stu-id="49464-169">Avoid having a mixture of highly active and relatively inactive shards.</span></span> <span data-ttu-id="49464-170">Pruebe a distribuir la carga uniformemente entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-170">Try to spread the load evenly across shards.</span></span> <span data-ttu-id="49464-171">Esto puede requerir la aplicación de algoritmos hash a las claves de particionamiento.</span><span class="sxs-lookup"><span data-stu-id="49464-171">This might require hashing the sharding keys.</span></span> <span data-ttu-id="49464-172">Si está geolocalizando las particiones, asegúrese de que las claves hash se asignan a shardlets de particiones almacenadas cerca de los usuarios que tienen acceso a esos datos.</span><span class="sxs-lookup"><span data-stu-id="49464-172">If you are geo-locating shards, make sure that the hashed keys map to shardlets held in shards stored close to the users that access that data.</span></span>

### <a name="partitioning-azure-table-storage"></a><span data-ttu-id="49464-173">Creación de particiones en el almacenamiento de tablas de Azure</span><span class="sxs-lookup"><span data-stu-id="49464-173">Partitioning Azure table storage</span></span>

<span data-ttu-id="49464-174">El Almacenamiento de tablas de Azure es un almacén del par clave-valor diseñado en torno a la creación de particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-174">Azure table storage is a key-value store that's designed around partitioning.</span></span> <span data-ttu-id="49464-175">Todas las entidades se almacenan en una partición y las particiones son administradas internamente por el almacenamiento de tablas de Azure.</span><span class="sxs-lookup"><span data-stu-id="49464-175">All entities are stored in a partition, and partitions are managed internally by Azure table storage.</span></span> <span data-ttu-id="49464-176">Cada entidad almacenada en una tabla debe proporcionar una clave de dos partes que incluye:</span><span class="sxs-lookup"><span data-stu-id="49464-176">Each entity stored in a table must provide a two-part key that includes:</span></span>

- <span data-ttu-id="49464-177">**La clave de la partición**.</span><span class="sxs-lookup"><span data-stu-id="49464-177">**The partition key**.</span></span> <span data-ttu-id="49464-178">Se trata de un valor de cadena que determina la partición en que Almacenamiento de tablas de Azure colocará la entidad.</span><span class="sxs-lookup"><span data-stu-id="49464-178">This is a string value that determines the partition where Azure table storage will place the entity.</span></span> <span data-ttu-id="49464-179">Todas las entidades con la misma clave de partición se almacenan en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-179">All entities with the same partition key are stored in the same partition.</span></span>

- <span data-ttu-id="49464-180">**La clave de la fila**.</span><span class="sxs-lookup"><span data-stu-id="49464-180">**The row key**.</span></span> <span data-ttu-id="49464-181">Es un valor de cadena que identifica la entidad dentro de la partición.</span><span class="sxs-lookup"><span data-stu-id="49464-181">This is a string value that identifies the entity within the partition.</span></span> <span data-ttu-id="49464-182">Todas las entidades dentro de una partición se ordenan léxicamente, en orden ascendente, por parte de esta clave.</span><span class="sxs-lookup"><span data-stu-id="49464-182">All entities within a partition are sorted lexically, in ascending order, by this key.</span></span> <span data-ttu-id="49464-183">La combinación de clave de fila/partición debe ser única para cada entidad y no puede superar 1 KB de longitud.</span><span class="sxs-lookup"><span data-stu-id="49464-183">The partition key/row key combination must be unique for each entity and cannot exceed 1 KB in length.</span></span>

<span data-ttu-id="49464-184">Si se agrega una entidad a una tabla con una clave de partición no usada anteriormente, Almacenamiento de tablas de Azure crea una nueva partición para esta entidad.</span><span class="sxs-lookup"><span data-stu-id="49464-184">If an entity is added to a table with a previously unused partition key, Azure table storage creates a new partition for this entity.</span></span> <span data-ttu-id="49464-185">Otras entidades con la misma clave de partición se almacenarán en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-185">Other entities with the same partition key will be stored in the same partition.</span></span>

<span data-ttu-id="49464-186">Este mecanismo implementa de forma efectiva una estrategia de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="49464-186">This mechanism effectively implements an automatic scale-out strategy.</span></span> <span data-ttu-id="49464-187">Cada partición se almacena en el mismo servidor de un centro de datos de Azure para ayudar a garantizar que las consultas que recuperan datos de una sola partición se ejecutan rápidamente.</span><span class="sxs-lookup"><span data-stu-id="49464-187">Each partition is stored on the same server in an Azure datacenter to help ensure that queries that retrieve data from a single partition run quickly.</span></span>

<span data-ttu-id="49464-188">Microsoft ha publicado los [objetivos de escalabilidad] de Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="49464-188">Microsoft has published [scalability targets] for Azure Storage.</span></span> <span data-ttu-id="49464-189">Si es probable que su sistema supere estos límites, considere la posibilidad de dividir las entidades en varias tablas.</span><span class="sxs-lookup"><span data-stu-id="49464-189">If your system is likely to exceed these limits, consider splitting entities into multiple tables.</span></span> <span data-ttu-id="49464-190">Utilice particiones verticales para dividir los campos en los grupos a los que se vaya a acceder en conjunto con mayor probabilidad.</span><span class="sxs-lookup"><span data-stu-id="49464-190">Use vertical partitioning to divide the fields into the groups that are most likely to be accessed together.</span></span>

<span data-ttu-id="49464-191">El diagrama siguiente muestra la estructura lógica de una cuenta de almacenamiento de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="49464-191">The following diagram shows the logical structure of an example storage account.</span></span> <span data-ttu-id="49464-192">La cuenta de almacenamiento contiene tres tablas: Información del cliente, Información del producto e Información del pedido.</span><span class="sxs-lookup"><span data-stu-id="49464-192">The storage account contains three tables: Customer Info, Product Info, and Order Info.</span></span>

![Las tablas y las particiones de una cuenta de almacenamiento de ejemplo](./images/data-partitioning/TableStorage.png)

<span data-ttu-id="49464-194">Cada tabla tiene varias particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-194">Each table has multiple partitions.</span></span>

- <span data-ttu-id="49464-195">En la tabla Información del cliente, los datos se particionan según la ciudad en la que está ubicado el cliente.</span><span class="sxs-lookup"><span data-stu-id="49464-195">In the Customer Info table, the data is partitioned according to the city where the customer is located.</span></span> <span data-ttu-id="49464-196">La clave de fila contiene el Id. de cliente.</span><span class="sxs-lookup"><span data-stu-id="49464-196">The row key contains the customer ID.</span></span>
- <span data-ttu-id="49464-197">En la tabla Información del producto, los productos se particionan por categoría de producto y la clave de fila contiene el número de producto.</span><span class="sxs-lookup"><span data-stu-id="49464-197">In the Product Info table, products are partitioned by product category, and the row key contains the product number.</span></span>
- <span data-ttu-id="49464-198">En la tabla Order Info (Información del pedido), los pedidos se particionan por fecha de pedido y la clave de fila especifica el momento en que recibió el pedido.</span><span class="sxs-lookup"><span data-stu-id="49464-198">In the Order Info table, the orders are partitioned by order date, and the row key specifies the time the order was received.</span></span> <span data-ttu-id="49464-199">Tenga en cuenta que todos los datos se ordenan por la clave de fila de cada partición.</span><span class="sxs-lookup"><span data-stu-id="49464-199">Note that all data is ordered by the row key in each partition.</span></span>

<span data-ttu-id="49464-200">Considere los siguientes puntos cuando diseñe las entidades para el almacenamiento de tablas de Azure:</span><span class="sxs-lookup"><span data-stu-id="49464-200">Consider the following points when you design your entities for Azure table storage:</span></span>

- <span data-ttu-id="49464-201">Seleccione una clave de partición y clave de fila por la forma en que se accede a los datos.</span><span class="sxs-lookup"><span data-stu-id="49464-201">Select a partition key and row key by how the data is accessed.</span></span> <span data-ttu-id="49464-202">Elija una combinación de claves de partición y fila que admita la mayoría de las consultas.</span><span class="sxs-lookup"><span data-stu-id="49464-202">Choose a partition key/row key combination that supports the majority of your queries.</span></span> <span data-ttu-id="49464-203">Las consultas más eficaces recuperan los datos especificando la clave de partición y la clave de fila.</span><span class="sxs-lookup"><span data-stu-id="49464-203">The most efficient queries retrieve data by specifying the partition key and the row key.</span></span> <span data-ttu-id="49464-204">Las consultas que especifican una clave de partición y un intervalo de claves de fila pueden completarse mediante el análisis de una sola partición.</span><span class="sxs-lookup"><span data-stu-id="49464-204">Queries that specify a partition key and a range of row keys can be completed by scanning a single partition.</span></span> <span data-ttu-id="49464-205">Esto es relativamente rápido porque los datos se mantienen en el orden de la clave de fila.</span><span class="sxs-lookup"><span data-stu-id="49464-205">This is relatively fast because the data is held in row key order.</span></span> <span data-ttu-id="49464-206">Si las consultas no especifican la partición que se va a examinar, se deben examinar todas.</span><span class="sxs-lookup"><span data-stu-id="49464-206">If queries don't specify which partition to scan, every partition must be scanned.</span></span>

- <span data-ttu-id="49464-207">Si una entidad tiene una clave natural, a continuación, úsela como clave de partición y especifique una cadena vacía como clave de fila.</span><span class="sxs-lookup"><span data-stu-id="49464-207">If an entity has one natural key, then use it as the partition key and specify an empty string as the row key.</span></span> <span data-ttu-id="49464-208">Si una entidad tiene una clave compuesta que conste de dos propiedades, seleccione la propiedad que cambie más despacio como clave de partición y la otra como clave de fila.</span><span class="sxs-lookup"><span data-stu-id="49464-208">If an entity has a composite key consisting of two properties, select the slowest changing property as the partition key and the other as the row key.</span></span> <span data-ttu-id="49464-209">Si una entidad tiene más de dos propiedades de clave, use una concatenación de propiedades para proporcionar las claves de partición y fila.</span><span class="sxs-lookup"><span data-stu-id="49464-209">If an entity has more than two key properties, use a concatenation of properties to provide the partition and row keys.</span></span>

- <span data-ttu-id="49464-210">Si realiza regularmente consultas que buscan datos con campos que no sean las claves de partición y fila, considere la posibilidad de implementar el [patrón de tabla de índice](../patterns/index-table.md) o de usar otro almacén de datos que admita la indexación, como Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="49464-210">If you regularly perform queries that look up data by using fields other than the partition and row keys, consider implementing the [Index Table pattern](../patterns/index-table.md), or consider using a different data store that supports indexing, such as Cosmos DB.</span></span>

- <span data-ttu-id="49464-211">Si genera claves de partición mediante una secuencia monotónica (como, "0001", "0002" y "0003") y cada partición solo contiene una cantidad limitada de datos, es posible que el Almacenamiento de tablas de Azure agrupe físicamente estas particiones en el mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="49464-211">If you generate partition keys by using a monotonic sequence (such as "0001", "0002", "0003") and each partition only contains a limited amount of data, Azure table storage can physically group these partitions together on the same server.</span></span> <span data-ttu-id="49464-212">Azure Storage supone que es muy probable que la aplicación realice consultas en un intervalo contiguo de particiones (consultas por rango) y está optimizada para este caso.</span><span class="sxs-lookup"><span data-stu-id="49464-212">Azure Storage assumes that the application is most likely to perform queries across a contiguous range of partitions (range queries) and is optimized for this case.</span></span> <span data-ttu-id="49464-213">Sin embargo, este enfoque puede provocar la aparición de puntos con mucho tráfico, ya que es probable que todas las inserciones de nuevas entidades se concentren en uno de los extremos del rango contiguo.</span><span class="sxs-lookup"><span data-stu-id="49464-213">However, this approach can lead to hotspots, because all insertions of new entities are likely to be concentrated at one end the contiguous range.</span></span> <span data-ttu-id="49464-214">También puede reducir la escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="49464-214">It can also reduce scalability.</span></span> <span data-ttu-id="49464-215">Para distribuir la carga más uniformemente, considere la posibilidad de crear un algoritmo hash de la clave de partición.</span><span class="sxs-lookup"><span data-stu-id="49464-215">To spread the load more evenly, consider hashing the partition key.</span></span>

- <span data-ttu-id="49464-216">El almacenamiento de tablas de Azure admite operaciones transaccionales para entidades que pertenecen a la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-216">Azure table storage supports transactional operations for entities that belong to the same partition.</span></span> <span data-ttu-id="49464-217">Una aplicación puede realizar varias operaciones de inserción, actualización, eliminación, sustitución o combinación como una unidad atómica, siempre que la transacción no incluya más de cien entidades y que la carga de la solicitud no supere los 4 MB.</span><span class="sxs-lookup"><span data-stu-id="49464-217">An application can perform multiple insert, update, delete, replace, or merge operations as an atomic unit, as long as the transaction doesn't include more than 100 entities and the payload of the request doesn't exceed 4 MB.</span></span> <span data-ttu-id="49464-218">Las operaciones que abarcan varias particiones no son transaccionales y pueden requerir la implementación de la coherencia eventual.</span><span class="sxs-lookup"><span data-stu-id="49464-218">Operations that span multiple partitions are not transactional, and might require you to implement eventual consistency.</span></span> <span data-ttu-id="49464-219">Para más información acerca del almacenamiento de tablas y las transacciones, consulte [Performing entity group transactions] (Realización de transacciones en el grupo de entidades).</span><span class="sxs-lookup"><span data-stu-id="49464-219">For more information about table storage and transactions, see [Performing entity group transactions].</span></span>

- <span data-ttu-id="49464-220">Tenga en cuenta la granularidad de la clave de partición:</span><span class="sxs-lookup"><span data-stu-id="49464-220">Consider the granularity of the partition key:</span></span>

  - <span data-ttu-id="49464-221">El uso de la misma clave de partición en todas las entidades genera una única partición que se mantiene en un servidor.</span><span class="sxs-lookup"><span data-stu-id="49464-221">Using the same partition key for every entity results in a single partition that's held on one server.</span></span> <span data-ttu-id="49464-222">Esto impide el escalado horizontal de la partición y centra la carga en un único servidor.</span><span class="sxs-lookup"><span data-stu-id="49464-222">This prevents the partition from scaling out and focuses the load on a single server.</span></span> <span data-ttu-id="49464-223">Como resultado, este enfoque solo es adecuado para almacenar un pequeño número de entidades.</span><span class="sxs-lookup"><span data-stu-id="49464-223">As a result, this approach is only suitable for storing a small number of entities.</span></span> <span data-ttu-id="49464-224">Sin embargo, garantiza que todas las entidades puedan participar en transacciones del grupo de entidades.</span><span class="sxs-lookup"><span data-stu-id="49464-224">However, it does ensure that all entities can participate in entity group transactions.</span></span>

  - <span data-ttu-id="49464-225">El uso de una clave de partición única para cada entidad provoca que el servicio Table Storage cree una partición independiente para cada entidad, lo cual puede dar lugar a un número elevado de particiones pequeñas.</span><span class="sxs-lookup"><span data-stu-id="49464-225">Using a unique partition key for every entity causes the table storage service to create a separate partition for each entity, possibly resulting in a large number of small partitions.</span></span> <span data-ttu-id="49464-226">Este enfoque es más escalable que el uso de una clave de partición única, pero no es posible realizar transacciones de grupo de entidad.</span><span class="sxs-lookup"><span data-stu-id="49464-226">This approach is more scalable than using a single partition key, but entity group transactions are not possible.</span></span> <span data-ttu-id="49464-227">Además, las consultas que capturan más de una entidad podrían implicar lecturas desde más de un servidor.</span><span class="sxs-lookup"><span data-stu-id="49464-227">Also, queries that fetch more than one entity might involve reading from more than one server.</span></span> <span data-ttu-id="49464-228">Sin embargo, si la aplicación realiza consultas por rango, el uso de una secuencia monotónica para las claves de partición puede ayudar a optimizar dichas consultas.</span><span class="sxs-lookup"><span data-stu-id="49464-228">However, if the application performs range queries, then using a monotonic sequence for the partition keys might help to optimize these queries.</span></span>

  - <span data-ttu-id="49464-229">Compartir la clave de partición en un subconjunto de entidades permite agrupar las entidades relacionadas de la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-229">Sharing the partition key across a subset of entities makes it possible to group related entities in the same partition.</span></span> <span data-ttu-id="49464-230">Se pueden realizar operaciones que implican entidades relacionadas con transacciones de grupo de entidades, y es posible dar respuesta a las consultas que capturan un conjunto de entidades relacionadas mediante el acceso a un único servidor.</span><span class="sxs-lookup"><span data-stu-id="49464-230">Operations that involve related entities can be performed by using entity group transactions, and queries that fetch a set of related entities can be satisfied by accessing a single server.</span></span>

<span data-ttu-id="49464-231">Para más información, consulte [Guía de diseño de Table Storage].</span><span class="sxs-lookup"><span data-stu-id="49464-231">For more information, see [Azure storage table design guide].</span></span>

## <a name="partitioning-azure-blob-storage"></a><span data-ttu-id="49464-232">Creación de particiones en el almacenamiento de blobs de Azure</span><span class="sxs-lookup"><span data-stu-id="49464-232">Partitioning Azure blob storage</span></span>

<span data-ttu-id="49464-233">Azure Blob Storage permite almacenar objetos binarios grandes.</span><span class="sxs-lookup"><span data-stu-id="49464-233">Azure blob storage makes it possible to hold large binary objects.</span></span> <span data-ttu-id="49464-234">Use blobs en bloques cuando sea necesario cargar o descargar grandes volúmenes de datos rápidamente.</span><span class="sxs-lookup"><span data-stu-id="49464-234">Use block blobs in scenarios when you need to upload or download large volumes of data quickly.</span></span> <span data-ttu-id="49464-235">Use blobs en páginas para aplicaciones que requieran acceso aleatorio en lugar de acceso de serie a partes de los datos.</span><span class="sxs-lookup"><span data-stu-id="49464-235">Use page blobs for applications that require random rather than serial access to parts of the data.</span></span>

<span data-ttu-id="49464-236">Cada blob (en bloque o en página) se mantiene en un contenedor de una cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="49464-236">Each blob (either block or page) is held in a container in an Azure storage account.</span></span> <span data-ttu-id="49464-237">Puede usar contenedores para agrupar los blobs relacionados que tengan los mismos requisitos de seguridad.</span><span class="sxs-lookup"><span data-stu-id="49464-237">You can use containers to group related blobs that have the same security requirements.</span></span> <span data-ttu-id="49464-238">Esta agrupación es más lógica que física.</span><span class="sxs-lookup"><span data-stu-id="49464-238">This grouping is logical rather than physical.</span></span> <span data-ttu-id="49464-239">Dentro de un contenedor, cada blob tiene un nombre único.</span><span class="sxs-lookup"><span data-stu-id="49464-239">Inside a container, each blob has a unique name.</span></span>

<span data-ttu-id="49464-240">La clave de partición de un blob es el nombre de la cuenta más el nombre del contenedor y el nombre del blob.</span><span class="sxs-lookup"><span data-stu-id="49464-240">The partition key for a blob is account name + container name + blob name.</span></span> <span data-ttu-id="49464-241">La clave de partición se usa para particionar datos en intervalos con una carga equilibrada en el sistema.</span><span class="sxs-lookup"><span data-stu-id="49464-241">The partition key is used to partition data into ranges and these ranges are load-balanced across the system.</span></span> <span data-ttu-id="49464-242">Los blobs se pueden distribuir en varios servidores para escalar horizontalmente el acceso a ellos, pero los blobs únicos solo pueden proporcionarse mediante servidores únicos.</span><span class="sxs-lookup"><span data-stu-id="49464-242">Blobs can be distributed across many servers in order to scale out access to them, but a single blob can only be served by a single server.</span></span>

<span data-ttu-id="49464-243">Si su esquema de nombre usa marcas de tiempo o identificadores numéricos, puede provocar que vaya demasiado tráfico a una partición, lo que limita el eficaz equilibrio de carga del sistema.</span><span class="sxs-lookup"><span data-stu-id="49464-243">If your naming scheme uses timestamps or numerical identifiers, it can lead to excessive traffic going to one partition, limiting the system from effectively load balancing.</span></span> <span data-ttu-id="49464-244">Por ejemplo, si tiene operaciones diarias que usan un objeto blob con una marca de tiempo como *aaaa-mm-dd*, todo el tráfico de dichas operaciones irían a un solo servidor de particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-244">For instance, if you have daily operations that use a blob object with a timestamp such as *yyyy-mm-dd*, all the traffic for that operation would go to a single partition server.</span></span> <span data-ttu-id="49464-245">En su lugar, considere la posibilidad de colocar un hash de 3 dígitos delante del nombre.</span><span class="sxs-lookup"><span data-stu-id="49464-245">Instead, consider prefixing the name with a 3-digit hash.</span></span> <span data-ttu-id="49464-246">Para más información, consulte [Convención de nomenclatura de particiones](/azure/storage/common/storage-performance-checklist#subheading47)</span><span class="sxs-lookup"><span data-stu-id="49464-246">For more information, see [Partition Naming Convention](/azure/storage/common/storage-performance-checklist#subheading47)</span></span>

<span data-ttu-id="49464-247">Las acciones de escribir un solo bloque o página son atómicas, pero las operaciones que abarcan bloques, páginas o blobs no lo son.</span><span class="sxs-lookup"><span data-stu-id="49464-247">The actions of writing a single block or page are atomic, but operations that span blocks, pages, or blobs are not.</span></span> <span data-ttu-id="49464-248">Si necesita asegurar la coherencia cuando se realizan operaciones de escritura en bloques, páginas y blobs, realice un bloqueo de escritura mediante el uso de una concesión de blob.</span><span class="sxs-lookup"><span data-stu-id="49464-248">If you need to ensure consistency when performing write operations across blocks, pages, and blobs, take out a write lock by using a blob lease.</span></span>

## <a name="partitioning-azure-storage-queues"></a><span data-ttu-id="49464-249">Creación de particiones en colas de almacenamiento de Azure</span><span class="sxs-lookup"><span data-stu-id="49464-249">Partitioning Azure storage queues</span></span>

<span data-ttu-id="49464-250">Las colas de almacenamiento de Azure le permiten implementar mensajería asincrónica entre procesos.</span><span class="sxs-lookup"><span data-stu-id="49464-250">Azure storage queues enable you to implement asynchronous messaging between processes.</span></span> <span data-ttu-id="49464-251">Una cuenta de almacenamiento de Azure puede contener cualquier número de colas y cada una de ellas puede contener cualquier número de mensajes.</span><span class="sxs-lookup"><span data-stu-id="49464-251">An Azure storage account can contain any number of queues, and each queue can contain any number of messages.</span></span> <span data-ttu-id="49464-252">La única limitación es el espacio disponible en la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="49464-252">The only limitation is the space that's available in the storage account.</span></span> <span data-ttu-id="49464-253">El tamaño máximo de un mensaje individual es de 64 KB.</span><span class="sxs-lookup"><span data-stu-id="49464-253">The maximum size of an individual message is 64 KB.</span></span> <span data-ttu-id="49464-254">Si necesita mensajes de mayor tamaño, considere la posibilidad de usar colas de Azure Service Bus en su lugar.</span><span class="sxs-lookup"><span data-stu-id="49464-254">If you require messages bigger than this, then consider using Azure Service Bus queues instead.</span></span>

<span data-ttu-id="49464-255">Cada cola de almacenamiento tiene un nombre único dentro de la cuenta de almacenamiento en la que se encuentra.</span><span class="sxs-lookup"><span data-stu-id="49464-255">Each storage queue has a unique name within the storage account that contains it.</span></span> <span data-ttu-id="49464-256">Azure crea colas de particiones basadas en el nombre.</span><span class="sxs-lookup"><span data-stu-id="49464-256">Azure partitions queues based on the name.</span></span> <span data-ttu-id="49464-257">Todos los mensajes de la misma cola se almacenan en la misma partición, que se controla mediante un solo servidor.</span><span class="sxs-lookup"><span data-stu-id="49464-257">All messages for the same queue are stored in the same partition, which is controlled by a single server.</span></span> <span data-ttu-id="49464-258">Distintas colas pueden ser administradas por distintos servidores para ayudar a equilibrar la carga.</span><span class="sxs-lookup"><span data-stu-id="49464-258">Different queues can be managed by different servers to help balance the load.</span></span> <span data-ttu-id="49464-259">La asignación de colas a servidores es transparente para las aplicaciones y usuarios.</span><span class="sxs-lookup"><span data-stu-id="49464-259">The allocation of queues to servers is transparent to applications and users.</span></span>

<span data-ttu-id="49464-260">En una aplicación a gran escala, no utilice la misma cola de almacenamiento para todas las instancias de la aplicación porque esto puede provocar que el servidor que hospeda la cola soporte una carga excesiva.</span><span class="sxs-lookup"><span data-stu-id="49464-260">In a large-scale application, don't use the same storage queue for all instances of the application because this approach might cause the server that's hosting the queue to become a hotspot.</span></span> <span data-ttu-id="49464-261">En su lugar, use colas diferentes para distintas áreas funcionales de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="49464-261">Instead, use different queues for different functional areas of the application.</span></span> <span data-ttu-id="49464-262">Las colas de almacenamiento de Azure no admiten transacciones, por lo que dirigir los mensajes a distintas colas debería tener poco impacto en la coherencia de los mensajes.</span><span class="sxs-lookup"><span data-stu-id="49464-262">Azure storage queues do not support transactions, so directing messages to different queues should have little impact on messaging consistency.</span></span>

<span data-ttu-id="49464-263">Una cola de almacenamiento de Azure puede controlar hasta 2000 mensajes por segundo.</span><span class="sxs-lookup"><span data-stu-id="49464-263">An Azure storage queue can handle up to 2,000 messages per second.</span></span> <span data-ttu-id="49464-264">Si necesita procesar los mensajes a una velocidad mayor, puede crear varias colas.</span><span class="sxs-lookup"><span data-stu-id="49464-264">If you need to process messages at a greater rate than this, consider creating multiple queues.</span></span> <span data-ttu-id="49464-265">Por ejemplo, en una aplicación global, cree colas de almacenamiento independientes en cuentas de almacenamiento separadas para controlar las instancias de aplicación que se ejecutan en cada región.</span><span class="sxs-lookup"><span data-stu-id="49464-265">For example, in a global application, create separate storage queues in separate storage accounts to handle application instances that are running in each region.</span></span>

## <a name="partitioning-azure-service-bus"></a><span data-ttu-id="49464-266">Creación de particiones en Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="49464-266">Partitioning Azure Service Bus</span></span>

<span data-ttu-id="49464-267">Azure Service Bus usa un agente de mensajes para controlar los mensajes enviados a una cola o un tema de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="49464-267">Azure Service Bus uses a message broker to handle messages that are sent to a Service Bus queue or topic.</span></span> <span data-ttu-id="49464-268">De forma predeterminada, todos los mensajes enviados a una cola o tema se controlan mediante el mismo proceso de agente de mensaje.</span><span class="sxs-lookup"><span data-stu-id="49464-268">By default, all messages that are sent to a queue or topic are handled by the same message broker process.</span></span> <span data-ttu-id="49464-269">Esta arquitectura puede colocar una limitación en el rendimiento general de la cola de mensajes.</span><span class="sxs-lookup"><span data-stu-id="49464-269">This architecture can place a limitation on the overall throughput of the message queue.</span></span> <span data-ttu-id="49464-270">Sin embargo, también puede dividir una cola o tema cuando se crea.</span><span class="sxs-lookup"><span data-stu-id="49464-270">However, you can also partition a queue or topic when it is created.</span></span> <span data-ttu-id="49464-271">Para ello, establezca la propiedad *EnablePartitioning* de la descripción de la cola o el tema en *true*.</span><span class="sxs-lookup"><span data-stu-id="49464-271">You do this by setting the *EnablePartitioning* property of the queue or topic description to *true*.</span></span>

<span data-ttu-id="49464-272">Una cola o tema con particiones se divide en varios fragmentos, cada uno de ellos respaldado por un almacén de mensajes y un agente de mensajes independientes.</span><span class="sxs-lookup"><span data-stu-id="49464-272">A partitioned queue or topic is divided into multiple fragments, each of which is backed by a separate message store and message broker.</span></span> <span data-ttu-id="49464-273">Service Bus asume la responsabilidad de crear y administrar estos fragmentos.</span><span class="sxs-lookup"><span data-stu-id="49464-273">Service Bus takes responsibility for creating and managing these fragments.</span></span> <span data-ttu-id="49464-274">Cuando una aplicación envía un mensaje a una cola o tema particionado, Service Bus asigna el mensaje a un fragmento de esa cola o tema.</span><span class="sxs-lookup"><span data-stu-id="49464-274">When an application posts a message to a partitioned queue or topic, Service Bus assigns the message to a fragment for that queue or topic.</span></span> <span data-ttu-id="49464-275">Cuando una aplicación recibe un mensaje de una cola o suscripción, Service Bus comprueba cada fragmento para detectar el siguiente mensaje disponible y, a continuación, lo pasa a la aplicación para su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="49464-275">When an application receives a message from a queue or subscription, Service Bus checks each fragment for the next available message and then passes it to the application for processing.</span></span>

<span data-ttu-id="49464-276">Esta estructura le ayuda a distribuir la carga entre los agentes de mensajes y los almacenes de mensajes, aumentando la escalabilidad y mejorando la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49464-276">This structure helps distribute the load across message brokers and message stores, increasing scalability and improving availability.</span></span> <span data-ttu-id="49464-277">Si el almacén de mensajes o el agente de mensajes de un fragmento no está disponible temporalmente, Service Bus puede recuperar mensajes de uno de los demás fragmentos disponibles.</span><span class="sxs-lookup"><span data-stu-id="49464-277">If the message broker or message store for one fragment is temporarily unavailable, Service Bus can retrieve messages from one of the remaining available fragments.</span></span>

<span data-ttu-id="49464-278">Service Bus asigna un mensaje a un fragmento de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="49464-278">Service Bus assigns a message to a fragment as follows:</span></span>

- <span data-ttu-id="49464-279">Si el mensaje pertenece a una sesión, se envían todos los mensajes con el mismo valor para la propiedad *SessionId* al mismo fragmento.</span><span class="sxs-lookup"><span data-stu-id="49464-279">If the message belongs to a session, all messages with the same value for the *SessionId*  property are sent to the same fragment.</span></span>

- <span data-ttu-id="49464-280">Si el mensaje no pertenece a una sesión pero el remitente ha especificado un valor para la propiedad *PartitionKey*, todos los mensajes con el mismo valor *PartitionKey* se enviarán al mismo fragmento.</span><span class="sxs-lookup"><span data-stu-id="49464-280">If the message does not belong to a session, but the sender has specified a value for the *PartitionKey* property, then all messages with the same *PartitionKey* value are sent to the same fragment.</span></span>

  > [!NOTE]
  > <span data-ttu-id="49464-281">Si se especifican las propiedades *SessionId* y *PartitionKey*, se deben establecer en el mismo valor; de lo contrario, se rechazará el mensaje.</span><span class="sxs-lookup"><span data-stu-id="49464-281">If the *SessionId* and *PartitionKey* properties are both specified, then they must be set to the same value or the message will be rejected.</span></span>

- <span data-ttu-id="49464-282">Si las propiedades *SessionId* y *PartitionKey* de un mensaje no se han especificado pero se habilita la detección de duplicados, se usará la propiedad *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="49464-282">If the *SessionId* and *PartitionKey* properties for a message are not specified, but duplicate detection is enabled, the *MessageId* property will be used.</span></span> <span data-ttu-id="49464-283">Todos los mensajes con el mismo *MessageId* se dirigirán al mismo fragmento.</span><span class="sxs-lookup"><span data-stu-id="49464-283">All messages with the same *MessageId* will be directed to the same fragment.</span></span>

- <span data-ttu-id="49464-284">Si los mensajes no incluyen una propiedad *SessionId, PartitionKey,* o *MessageId*, Service Bus asigna los mensajes a los fragmentos de manera secuencial.</span><span class="sxs-lookup"><span data-stu-id="49464-284">If messages do not include a *SessionId, PartitionKey,* or *MessageId* property, then Service Bus assigns messages to fragments sequentially.</span></span> <span data-ttu-id="49464-285">Si un fragmento no está disponible, Service Bus pasará al siguiente.</span><span class="sxs-lookup"><span data-stu-id="49464-285">If a fragment is unavailable, Service Bus will move on to the next.</span></span> <span data-ttu-id="49464-286">Esto significa que un error temporal de la infraestructura de mensajería no provoca un error en la operación de envío de mensajes.</span><span class="sxs-lookup"><span data-stu-id="49464-286">This means that a temporary fault in the messaging infrastructure does not cause the message-send operation to fail.</span></span>

<span data-ttu-id="49464-287">Debe tener en cuenta los siguientes puntos cuando decida si crear una partición en un tema o una cola de mensajes de Service Bus o un tema, y cómo realizarla:</span><span class="sxs-lookup"><span data-stu-id="49464-287">Consider the following points when deciding if or how to partition a Service Bus message queue or topic:</span></span>

- <span data-ttu-id="49464-288">Los temas y colas de Service Bus se crean dentro del ámbito de un espacio de nombres de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="49464-288">Service Bus queues and topics are created within the scope of a Service Bus namespace.</span></span> <span data-ttu-id="49464-289">Actualmente Service Bus permite hasta 100 colas o temas particionados por espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="49464-289">Service Bus currently allows up to 100 partitioned queues or topics per namespace.</span></span>

- <span data-ttu-id="49464-290">Cada espacio de nombres de Service Bus impone cuotas en los recursos disponibles, como el número de suscripciones por tema, el número de solicitudes de envío y recepción simultáneas por segundo y el número máximo de conexiones simultáneas que pueden establecerse.</span><span class="sxs-lookup"><span data-stu-id="49464-290">Each Service Bus namespace imposes quotas on the available resources, such as the number of subscriptions per topic, the number of concurrent send and receive requests per second, and the maximum number of concurrent connections that can be established.</span></span> <span data-ttu-id="49464-291">Estas cuotas se documentan en [Cuotas de Service Bus].</span><span class="sxs-lookup"><span data-stu-id="49464-291">These quotas are documented in [Service Bus quotas].</span></span> <span data-ttu-id="49464-292">Si espera que superar estos valores, cree espacios de nombres adicionales con sus propios temas y colas y distribuya el trabajo en estos espacios de nombres.</span><span class="sxs-lookup"><span data-stu-id="49464-292">If you expect to exceed these values, then create additional namespaces with their own queues and topics, and spread the work across these namespaces.</span></span> <span data-ttu-id="49464-293">Por ejemplo, en una aplicación global, cree espacios de nombres independientes en cada región y configure instancias de la aplicación para usar las colas y temas en el espacio de nombres más cercano.</span><span class="sxs-lookup"><span data-stu-id="49464-293">For example, in a global application, create separate namespaces in each region and configure application instances to use the queues and topics in the nearest namespace.</span></span>

- <span data-ttu-id="49464-294">Los mensajes que se envían como parte de una transacción deben especificar una clave de partición.</span><span class="sxs-lookup"><span data-stu-id="49464-294">Messages that are sent as part of a transaction must specify a partition key.</span></span> <span data-ttu-id="49464-295">Esta puede ser una propiedad *SessionId*, *PartitionKey* o *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="49464-295">This can be a *SessionId*, *PartitionKey*, or *MessageId* property.</span></span> <span data-ttu-id="49464-296">Todos los mensajes que se envían como parte de la misma transacción deben especificar la misma clave de partición porque deben tratarse mediante el mismo proceso de agente de mensaje.</span><span class="sxs-lookup"><span data-stu-id="49464-296">All messages that are sent as part of the same transaction must specify the same partition key because they must be handled by the same message broker process.</span></span> <span data-ttu-id="49464-297">No se pueden enviar mensajes a diferentes colas o temas de dentro de la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="49464-297">You cannot send messages to different queues or topics within the same transaction.</span></span>

- <span data-ttu-id="49464-298">Temas y colas con particiones no pueden configurarse para eliminarse automáticamente cuando se queden inactivas.</span><span class="sxs-lookup"><span data-stu-id="49464-298">Partitioned queues and topics can't be configured to be automatically deleted when they become idle.</span></span>

- <span data-ttu-id="49464-299">Si está creando soluciones multiplataforma o híbridas, en este momento no podrá utilizar colas o temas con particiones con el protocolo Advanced Message Queuing Protocol (AMQP).</span><span class="sxs-lookup"><span data-stu-id="49464-299">Partitioned queues and topics can't currently be used with the Advanced Message Queuing Protocol (AMQP) if you are building cross-platform or hybrid solutions.</span></span>

## <a name="partitioning-cosmos-db"></a><span data-ttu-id="49464-300">Creación de particiones en Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="49464-300">Partitioning Cosmos DB</span></span>

<span data-ttu-id="49464-301">Azure Cosmos DB es una base de datos NoSQL que puede almacenar documentos JSON mediante la [API de SQL de Azure Cosmos DB][cosmosdb-sql-api].</span><span class="sxs-lookup"><span data-stu-id="49464-301">Azure Cosmos DB is a NoSQL database that can store JSON documents using the [Azure Cosmos DB SQL API][cosmosdb-sql-api].</span></span> <span data-ttu-id="49464-302">En una base de datos de Cosmos DB, un documento es una representación serializada de un objeto o de otro elemento de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-302">A document in a Cosmos DB database is a JSON-serialized representation of an object or other piece of data.</span></span> <span data-ttu-id="49464-303">No se aplican esquemas fijos, excepto que cada documento debe contener un identificador único.</span><span class="sxs-lookup"><span data-stu-id="49464-303">No fixed schemas are enforced except that every document must contain a unique ID.</span></span>

<span data-ttu-id="49464-304">Los documentos se organizan en colecciones.</span><span class="sxs-lookup"><span data-stu-id="49464-304">Documents are organized into collections.</span></span> <span data-ttu-id="49464-305">Puede agrupar documentos relacionados entre sí en una colección.</span><span class="sxs-lookup"><span data-stu-id="49464-305">You can group related documents together in a collection.</span></span> <span data-ttu-id="49464-306">Por ejemplo, en un sistema que mantiene las entradas de un blog, puede almacenar el contenido de cada entrada como un documento de una colección.</span><span class="sxs-lookup"><span data-stu-id="49464-306">For example, in a system that maintains blog postings, you can store the contents of each blog post as a document in a collection.</span></span> <span data-ttu-id="49464-307">También puede crear colecciones para cada tipo de asunto.</span><span class="sxs-lookup"><span data-stu-id="49464-307">You can also create collections for each subject type.</span></span> <span data-ttu-id="49464-308">O bien, en una aplicación para varios inquilinos, como un sistema donde diferentes autores controlan y administran sus propias publicaciones de blog, podría crear particiones en los blogs por autor y crear una colección independiente para cada autor.</span><span class="sxs-lookup"><span data-stu-id="49464-308">Alternatively, in a multitenant application, such as a system where different authors control and manage their own blog posts, you can partition blogs by author and create separate collections for each author.</span></span> <span data-ttu-id="49464-309">El espacio de almacenamiento asignado a las colecciones es elástico y puede reducirse o ampliarse según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="49464-309">The storage space that's allocated to collections is elastic and can shrink or grow as needed.</span></span>

<span data-ttu-id="49464-310">Cosmos DB admite la creación automática de particiones de datos basadas en una clave de partición definida por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="49464-310">Cosmos DB supports automatic partitioning of data based on an application-defined partition key.</span></span> <span data-ttu-id="49464-311">Una *partición lógica* es una partición que almacena todos los datos de un valor de clave de partición única.</span><span class="sxs-lookup"><span data-stu-id="49464-311">A *logical partition* is a partition that stores all the data for a single partition key value.</span></span> <span data-ttu-id="49464-312">Todos los documentos que comparten el mismo valor de la clave de partición se colocan dentro de la misma partición lógica.</span><span class="sxs-lookup"><span data-stu-id="49464-312">All documents that share the same value for the partition key are placed within the same logical partition.</span></span> <span data-ttu-id="49464-313">Cosmos DB distribuye los valores según el código hash de la clave de partición.</span><span class="sxs-lookup"><span data-stu-id="49464-313">Cosmos DB distributes values according to hash of the partition key.</span></span> <span data-ttu-id="49464-314">Una partición lógica tiene un tamaño máximo de 10 GB.</span><span class="sxs-lookup"><span data-stu-id="49464-314">A logical partition has a maximum size of 10 GB.</span></span> <span data-ttu-id="49464-315">Por tanto, la elección de la clave de partición es una decisión importante que debe realizarse en el momento del diseño.</span><span class="sxs-lookup"><span data-stu-id="49464-315">Therefore, the choice of the partition key is an important decision at design time.</span></span> <span data-ttu-id="49464-316">Elija una propiedad con una amplia gama de valores e incluso patrones de acceso.</span><span class="sxs-lookup"><span data-stu-id="49464-316">Choose a property with a wide range of values and even access patterns.</span></span> <span data-ttu-id="49464-317">Para más información, consulte [Partición y escalado en Azure Cosmos DB](/azure/cosmos-db/partition-data).</span><span class="sxs-lookup"><span data-stu-id="49464-317">For more information, see [Partition and scale in Azure Cosmos DB](/azure/cosmos-db/partition-data).</span></span>

> [!NOTE]
> <span data-ttu-id="49464-318">Cada base de datos de Cosmos DB tiene un *nivel de rendimiento* que determina la cantidad de recursos que obtiene.</span><span class="sxs-lookup"><span data-stu-id="49464-318">Each Cosmos DB database has a *performance level* that determines the amount of resources it gets.</span></span> <span data-ttu-id="49464-319">Los niveles de rendimiento están asociados a un límite de velocidad de *unidad de solicitud*.</span><span class="sxs-lookup"><span data-stu-id="49464-319">A performance level is associated with a *request unit* (RU) rate limit.</span></span> <span data-ttu-id="49464-320">El límite de velocidad de unidad de solicitud especifica el volumen de los recursos reservados y disponibles para el uso exclusivo de esa colección.</span><span class="sxs-lookup"><span data-stu-id="49464-320">The RU rate limit specifies the volume of resources that's reserved and available for exclusive use by that collection.</span></span> <span data-ttu-id="49464-321">El costo de una colección depende del nivel de rendimiento seleccionado para esa colección.</span><span class="sxs-lookup"><span data-stu-id="49464-321">The cost of a collection depends on the performance level that's selected for that collection.</span></span> <span data-ttu-id="49464-322">Cuanto mayor sea el nivel re rendimiento (y el límite de velocidad de la unidad de solicitud), mayor será el costo.</span><span class="sxs-lookup"><span data-stu-id="49464-322">The higher the performance level (and RU rate limit) the higher the charge.</span></span> <span data-ttu-id="49464-323">Puede ajustar el nivel de rendimiento de una colección mediante el Portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="49464-323">You can adjust the performance level of a collection by using the Azure portal.</span></span> <span data-ttu-id="49464-324">Para más información, consulte [Unidades de solicitud en Azure Cosmos DB][cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="49464-324">For more information, see [Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span>

<span data-ttu-id="49464-325">Si el mecanismo de creación de particiones que proporciona Cosmos DB no es suficiente, puede que necesite particionar los datos en el nivel de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="49464-325">If the partitioning mechanism that Cosmos DB provides is not sufficient, you may need to shard the data at the application level.</span></span> <span data-ttu-id="49464-326">Las colecciones de documentos proporcionan un mecanismo natural para dividir los datos de una base de datos única.</span><span class="sxs-lookup"><span data-stu-id="49464-326">Document collections provide a natural mechanism for partitioning data within a single database.</span></span> <span data-ttu-id="49464-327">La manera más sencilla de implementar las particiones es crear una colección para cada partición.</span><span class="sxs-lookup"><span data-stu-id="49464-327">The simplest way to implement sharding is to create a collection for each shard.</span></span> <span data-ttu-id="49464-328">Los contenedores son recursos lógicos y pueden abarcar uno o varios servidores.</span><span class="sxs-lookup"><span data-stu-id="49464-328">Containers are logical resources and can span one or more servers.</span></span> <span data-ttu-id="49464-329">Los contenedores de tamaño fijo tienen un límite máximo de 10 GB y un rendimiento de 10 000 RU/s.</span><span class="sxs-lookup"><span data-stu-id="49464-329">Fixed-size containers have a maximum limit of 10 GB and 10,000 RU/s throughput.</span></span> <span data-ttu-id="49464-330">Un número ilimitado de contenedores no tienen un tamaño máximo de almacenamiento, pero deben especificar una clave de partición.</span><span class="sxs-lookup"><span data-stu-id="49464-330">Unlimited containers do not have a maximum storage size, but must specify a partition key.</span></span> <span data-ttu-id="49464-331">Con el particionamiento de la aplicación, la aplicación cliente debe dirigir las solicitudes a la partición apropiada, normalmente mediante la implementación de su propio mecanismo de asignación en función de algunos atributos de los datos que definen la clave de partición.</span><span class="sxs-lookup"><span data-stu-id="49464-331">With application sharding, the client application must direct requests to the appropriate shard, usually by implementing its own mapping mechanism based on some attributes of the data that define the shard key.</span></span>

<span data-ttu-id="49464-332">Todas las bases de datos se crean en el contexto de una cuenta de base de datos de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="49464-332">All databases are created in the context of a Cosmos DB database account.</span></span> <span data-ttu-id="49464-333">Una sola cuenta puede contener varias bases de datos, y especifica en qué regiones se crean las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-333">A single account can contain several databases, and it specifies in which regions the databases are created.</span></span> <span data-ttu-id="49464-334">Cada cuenta también impone su propio control de acceso.</span><span class="sxs-lookup"><span data-stu-id="49464-334">Each account also enforces its own access control.</span></span> <span data-ttu-id="49464-335">Puede utilizar cuentas de Cosmos DB para localizar geográficamente particiones (colecciones dentro de bases de datos) cerca de los usuarios que necesitan tener acceso a ellas y aplicar restricciones de modo que solo esos usuarios puedan conectarse.</span><span class="sxs-lookup"><span data-stu-id="49464-335">You can use Cosmos DB accounts to geo-locate shards (collections within databases) close to the users who need to access them, and enforce restrictions so that only those users can connect to them.</span></span>

<span data-ttu-id="49464-336">A la hora de decidir cómo particionar los datos con la API de SQL de Cosmos DB, tenga en cuenta los siguientes puntos:</span><span class="sxs-lookup"><span data-stu-id="49464-336">Consider the following points when deciding how to partition data with the Cosmos DB SQL API:</span></span>

- <span data-ttu-id="49464-337">**Los recursos disponibles para una base de datos de Cosmos DB están sujetos a las limitaciones de cuota de la cuenta**.</span><span class="sxs-lookup"><span data-stu-id="49464-337">**The resources available to a Cosmos DB database are subject to the quota limitations of the account**.</span></span> <span data-ttu-id="49464-338">Cada base de datos puede contener un número de colecciones y cada colección está asociada a un nivel de rendimiento que rige el límite de velocidad de RU (rendimiento reservado) para esa colección.</span><span class="sxs-lookup"><span data-stu-id="49464-338">Each database can hold a number of collections, and each collection is associated with a performance level that governs the RU rate limit (reserved throughput) for that collection.</span></span> <span data-ttu-id="49464-339">Para más información, consulte [Límites, cuotas y restricciones de suscripción y servicios de Microsoft Azure][azure-limits].</span><span class="sxs-lookup"><span data-stu-id="49464-339">For more information, see [Azure subscription and service limits, quotas, and constraints][azure-limits].</span></span>

- <span data-ttu-id="49464-340">**Cada documento debe tener un atributo que pueda usarse para identificar de manera única dicho documento dentro de la colección en la que se encuentra**.</span><span class="sxs-lookup"><span data-stu-id="49464-340">**Each document must have an attribute that can be used to uniquely identify that document within the collection in which it is held**.</span></span> <span data-ttu-id="49464-341">Este atributo es diferente de la clave de partición, que define en qué colección se encuentra el documento.</span><span class="sxs-lookup"><span data-stu-id="49464-341">This attribute is different from the shard key, which defines which collection holds the document.</span></span> <span data-ttu-id="49464-342">Una colección puede contener un gran número de documentos.</span><span class="sxs-lookup"><span data-stu-id="49464-342">A collection can contain a large number of documents.</span></span> <span data-ttu-id="49464-343">En teoría, solo está limitada por la longitud máxima del identificador del documento.</span><span class="sxs-lookup"><span data-stu-id="49464-343">In theory, it's limited only by the maximum length of the document ID.</span></span> <span data-ttu-id="49464-344">El identificador del documento puede contener hasta 255 caracteres.</span><span class="sxs-lookup"><span data-stu-id="49464-344">The document ID can be up to 255 characters.</span></span>

- <span data-ttu-id="49464-345">**Todas las operaciones de un documento se realizan en el contexto de una transacción. Las transacciones se limitan a la colección que contiene el documento.**</span><span class="sxs-lookup"><span data-stu-id="49464-345">**All operations against a document are performed within the context of a transaction. Transactions are scoped to the collection in which the document is contained.**</span></span> <span data-ttu-id="49464-346">Si se produce un error en una operación, se revierte el trabajo que ha realizado.</span><span class="sxs-lookup"><span data-stu-id="49464-346">If an operation fails, the work that it has performed is rolled back.</span></span> <span data-ttu-id="49464-347">Mientras se realiza una operación sobre un documento, los cambios realizados están sujetos a aislamiento a nivel de instantánea.</span><span class="sxs-lookup"><span data-stu-id="49464-347">While a document is subject to an operation, any changes that are made are subject to snapshot-level isolation.</span></span> <span data-ttu-id="49464-348">Este mecanismo garantiza que si, por ejemplo, se produce un error en una solicitud para crear un nuevo documento, otro usuario que consulte la base de datos al mismo tiempo no verá un documento parcial que luego se elimine.</span><span class="sxs-lookup"><span data-stu-id="49464-348">This mechanism guarantees that if, for example, a request to create a new document fails, another user who's querying the database simultaneously will not see a partial document that is then removed.</span></span>

- <span data-ttu-id="49464-349">**Las consultas de base de datos también se limitan al nivel de colección**.</span><span class="sxs-lookup"><span data-stu-id="49464-349">**Database queries are also scoped to the collection level**.</span></span> <span data-ttu-id="49464-350">Una sola consulta solo puede recuperar datos de una colección.</span><span class="sxs-lookup"><span data-stu-id="49464-350">A single query can retrieve data from only one collection.</span></span> <span data-ttu-id="49464-351">Si necesita recuperar datos de varias colecciones, debe consultar cada colección individualmente y combinar los resultados en el código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="49464-351">If you need to retrieve data from multiple collections, you must query each collection individually and merge the results in your application code.</span></span>

- <span data-ttu-id="49464-352">**Las bases de datos de Cosmos DB admiten elementos programables que pueden almacenarse en una colección junto con los documentos**.</span><span class="sxs-lookup"><span data-stu-id="49464-352">**Cosmos DB supports programmable items that can all be stored in a collection alongside documents**.</span></span> <span data-ttu-id="49464-353">Estos incluyen procedimientos almacenados, funciones definidas por el usuario y desencadenadores (escritos en JavaScript).</span><span class="sxs-lookup"><span data-stu-id="49464-353">These include stored procedures, user-defined functions, and triggers (written in JavaScript).</span></span> <span data-ttu-id="49464-354">Estos elementos pueden tener acceso a cualquier documento en la misma colección.</span><span class="sxs-lookup"><span data-stu-id="49464-354">These items can access any document within the same collection.</span></span> <span data-ttu-id="49464-355">Además, estos elementos se ejecutan dentro del ámbito de la transacción de ambiente (en el caso de un desencadenador que se activa como resultado de una operación de crear, eliminar o reemplazar realizada en un documento), o iniciando una nueva transacción (en el caso de un procedimiento almacenado que se ejecuta como resultado de una solicitud de cliente explícita).</span><span class="sxs-lookup"><span data-stu-id="49464-355">Furthermore, these items run either inside the scope of the ambient transaction (in the case of a trigger that fires as the result of a create, delete, or replace operation performed against a document), or by starting a new transaction (in the case of a stored procedure that is run as the result of an explicit client request).</span></span> <span data-ttu-id="49464-356">Si el código de un elemento programable produce una excepción, la transacción se revierte.</span><span class="sxs-lookup"><span data-stu-id="49464-356">If the code in a programmable item throws an exception, the transaction is rolled back.</span></span> <span data-ttu-id="49464-357">Puede usar procedimientos almacenados y desencadenadores para mantener la integridad y la coherencia entre los documentos, pero estos documentos deben formar parte de la misma colección.</span><span class="sxs-lookup"><span data-stu-id="49464-357">You can use stored procedures and triggers to maintain integrity and consistency between documents, but these documents must all be part of the same collection.</span></span>

- <span data-ttu-id="49464-358">**Debe procurar que las colecciones que desea almacenar en las bases de datos no superen los límites de rendimiento definidos por los niveles de rendimiento de las colecciones**.</span><span class="sxs-lookup"><span data-stu-id="49464-358">**The collections that you intend to hold in the databases should be unlikely to exceed the throughput limits defined by the performance levels of the collections**.</span></span> <span data-ttu-id="49464-359">Para más información, consulte [Unidades de solicitud en Azure Cosmos DB][cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="49464-359">For more information, see [Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span> <span data-ttu-id="49464-360">Si prevé alcanzar estos límites, considere la posibilidad de dividir las colecciones entre bases de datos en diferentes cuentas para reducir la carga de cada colección.</span><span class="sxs-lookup"><span data-stu-id="49464-360">If you anticipate reaching these limits, consider splitting collections across databases in different accounts to reduce the load per collection.</span></span>

## <a name="partitioning-azure-search"></a><span data-ttu-id="49464-361">Creación de particiones en Azure Search</span><span class="sxs-lookup"><span data-stu-id="49464-361">Partitioning Azure Search</span></span>

<span data-ttu-id="49464-362">La función de búsqueda de datos suele ser el método principal de navegación y exploración proporcionado por muchas aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="49464-362">The ability to search for data is often the primary method of navigation and exploration that's provided by many web applications.</span></span> <span data-ttu-id="49464-363">Permite a los usuarios encontrar recursos rápidamente (por ejemplo, los productos de una aplicación de comercio electrónico) según determinadas combinaciones de criterios de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="49464-363">It helps users find resources quickly (for example, products in an e-commerce application) based on combinations of search criteria.</span></span> <span data-ttu-id="49464-364">El servicio Azure Search proporciona capacidades de búsqueda de texto completo a través de contenido web e incluye características como las consultas sugeridas de escritura anticipada basadas en coincidencias cercanas y en la navegación por facetas.</span><span class="sxs-lookup"><span data-stu-id="49464-364">The Azure Search service provides full-text search capabilities over web content, and includes features such as type-ahead, suggested queries based on near matches, and faceted navigation.</span></span> <span data-ttu-id="49464-365">Para más información, consulte [¿Qué es Azure Search?]</span><span class="sxs-lookup"><span data-stu-id="49464-365">For more information, see [What is Azure Search?].</span></span>

<span data-ttu-id="49464-366">Azure Search almacena contenido en el que es posible realizar búsquedas como documentos JSON en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-366">Azure Search stores searchable content as JSON documents in a database.</span></span> <span data-ttu-id="49464-367">El usuario es quien define los índices que especifican los campos de búsqueda de estos documentos y proporciona estas definiciones al servicio Azure Search.</span><span class="sxs-lookup"><span data-stu-id="49464-367">You define indexes that specify the searchable fields in these documents and provide these definitions to Azure Search.</span></span> <span data-ttu-id="49464-368">Cuando se emite una solicitud de búsqueda, Azure Search usa los índices adecuados para buscar los elementos coincidentes.</span><span class="sxs-lookup"><span data-stu-id="49464-368">When a user submits a search request, Azure Search uses the appropriate indexes to find matching items.</span></span>

<span data-ttu-id="49464-369">Para reducir la contención, es posible dividir el almacenamiento utilizado por Azure Search en 1, 2, 3, 4, 6 o 12 particiones, y cada partición se puede replicar hasta 6 veces.</span><span class="sxs-lookup"><span data-stu-id="49464-369">To reduce contention, the storage that's used by Azure Search can be divided into 1, 2, 3, 4, 6, or 12 partitions, and each partition can be replicated up to 6 times.</span></span> <span data-ttu-id="49464-370">El producto del número de particiones multiplicado por el número de réplicas se denomina *unidad de búsqueda*.</span><span class="sxs-lookup"><span data-stu-id="49464-370">The product of the number of partitions multiplied by the number of replicas is called the *search unit* (SU).</span></span> <span data-ttu-id="49464-371">Una única instancia de Azure Search puede contener un máximo de 36 unidades de búsqueda (una base de datos con 12 particiones solo admite un máximo de 3 réplicas).</span><span class="sxs-lookup"><span data-stu-id="49464-371">A single instance of Azure Search can contain a maximum of 36 SUs (a database with 12 partitions only supports a maximum of 3 replicas).</span></span>

<span data-ttu-id="49464-372">Se le facturará cada SU que se asigne a su servicio.</span><span class="sxs-lookup"><span data-stu-id="49464-372">You are billed for each SU that is allocated to your service.</span></span> <span data-ttu-id="49464-373">A medida que crezca el volumen de contenido sobre el que es posible realizar búsquedas o la tasa de solicitudes de búsqueda, puede agregar unidades de búsqueda a una instancia existente de Azure Search para administrar la carga adicional.</span><span class="sxs-lookup"><span data-stu-id="49464-373">As the volume of searchable content increases or the rate of search requests grows, you can add SUs to an existing instance of Azure Search to handle the extra load.</span></span> <span data-ttu-id="49464-374">El propio servicio Azure Search distribuye los documentos uniformemente entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-374">Azure Search itself distributes the documents evenly across the partitions.</span></span> <span data-ttu-id="49464-375">Actualmente no se admite la aplicación de ninguna estrategia de partición manual.</span><span class="sxs-lookup"><span data-stu-id="49464-375">No manual partitioning strategies are currently supported.</span></span>

<span data-ttu-id="49464-376">Cada partición puede contener un máximo de 15 millones de documentos u ocupar 300 GB de espacio de almacenamiento (lo que sea menor).</span><span class="sxs-lookup"><span data-stu-id="49464-376">Each partition can contain a maximum of 15 million documents or occupy 300 GB of storage space (whichever is smaller).</span></span> <span data-ttu-id="49464-377">Puede crear hasta 50 índices.</span><span class="sxs-lookup"><span data-stu-id="49464-377">You can create up to 50 indexes.</span></span> <span data-ttu-id="49464-378">El rendimiento del servicio varía y depende de la complejidad de los documentos, los índices disponibles y los efectos de la latencia de la red.</span><span class="sxs-lookup"><span data-stu-id="49464-378">The performance of the service varies and depends on the complexity of the documents, the available indexes, and the effects of network latency.</span></span> <span data-ttu-id="49464-379">De media, una única réplica (1 unidad de búsqueda) debe ser capaz de administrar 15 consultas por segundo, aunque es recomendable realizar pruebas comparativas realizadas con sus propios datos para obtener una medida más precisa del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="49464-379">On average, a single replica (1 SU) should be able to handle 15 queries per second (QPS), although we recommend performing benchmarking with your own data to obtain a more precise measure of throughput.</span></span> <span data-ttu-id="49464-380">Para más información, consulte [Límites de servicio en Azure Search].</span><span class="sxs-lookup"><span data-stu-id="49464-380">For more information, see [Service limits in Azure Search].</span></span>

> [!NOTE]
> <span data-ttu-id="49464-381">Puede almacenar un conjunto limitado de tipos de datos en documentos que se pueden buscar, incluidas cadenas, valores booleanos, datos numéricos, datos de fecha y hora y algunos datos geográficos.</span><span class="sxs-lookup"><span data-stu-id="49464-381">You can store a limited set of data types in searchable documents, including strings, Booleans, numeric data, datetime data, and some geographical data.</span></span> <span data-ttu-id="49464-382">Para obtener más detalles, consulte la página [Tipos de datos admitidos (Azure Search)] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="49464-382">For more details, see the page [Supported data types (Azure Search)] on the Microsoft website.</span></span>

<span data-ttu-id="49464-383">Tiene control limitado sobre cómo divide en particiones el servicio Azure Search los datos de cada instancia del servicio.</span><span class="sxs-lookup"><span data-stu-id="49464-383">You have limited control over how Azure Search partitions data for each instance of the service.</span></span> <span data-ttu-id="49464-384">Sin embargo, en un entorno global puede mejorar el rendimiento y reducir la latencia y la contención aún más mediante la partición del propio servicio; para ello, aplique alguna de las estrategias siguientes:</span><span class="sxs-lookup"><span data-stu-id="49464-384">However, in a global environment you might be able to improve performance and reduce latency and contention further by partitioning the service itself using either of the following strategies:</span></span>

- <span data-ttu-id="49464-385">Cree una instancia de Azure Search en cada región geográfica y asegúrese de que las aplicaciones cliente se dirigen hacia la instancia disponible más cercana.</span><span class="sxs-lookup"><span data-stu-id="49464-385">Create an instance of Azure Search in each geographic region, and ensure that client applications are directed towards the nearest available instance.</span></span> <span data-ttu-id="49464-386">Esta estrategia requiere la replicación de las actualizaciones de contenido de búsqueda de manera oportuna en todas las instancias del servicio.</span><span class="sxs-lookup"><span data-stu-id="49464-386">This strategy requires that any updates to searchable content are replicated in a timely manner across all instances of the service.</span></span>

- <span data-ttu-id="49464-387">Cree dos niveles en Azure Search:</span><span class="sxs-lookup"><span data-stu-id="49464-387">Create two tiers of Azure Search:</span></span>

  - <span data-ttu-id="49464-388">Un servicio local en cada región que contenga los datos a los que se accede con mayor frecuencia por parte de los usuarios de esa región.</span><span class="sxs-lookup"><span data-stu-id="49464-388">A local service in each region that contains the data that's most frequently accessed by users in that region.</span></span> <span data-ttu-id="49464-389">Los usuarios podrá dirigir solicitudes aquí para obtener resultados rápidos pero limitados.</span><span class="sxs-lookup"><span data-stu-id="49464-389">Users can direct requests here for fast but limited results.</span></span>
  - <span data-ttu-id="49464-390">Un servicio global que abarque todos los datos.</span><span class="sxs-lookup"><span data-stu-id="49464-390">A global service that encompasses all the data.</span></span> <span data-ttu-id="49464-391">Los usuarios podrán dirigir solicitudes aquí para obtener resultados más lentos pero más completos.</span><span class="sxs-lookup"><span data-stu-id="49464-391">Users can direct requests here for slower but more complete results.</span></span>

<span data-ttu-id="49464-392">Este enfoque es más adecuado cuando existe una variación regional considerable en los datos que se están buscando.</span><span class="sxs-lookup"><span data-stu-id="49464-392">This approach is most suitable when there is a significant regional variation in the data that's being searched.</span></span>

## <a name="partitioning-azure-redis-cache"></a><span data-ttu-id="49464-393">Creación de particiones en Azure Redis Cache</span><span class="sxs-lookup"><span data-stu-id="49464-393">Partitioning Azure Redis Cache</span></span>

<span data-ttu-id="49464-394">Azure Redis Cache proporciona un servicio de almacenamiento en caché compartido en la nube que se basa en el almacén de datos de clave-valor de Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-394">Azure Redis Cache provides a shared caching service in the cloud that's based on the Redis key-value data store.</span></span> <span data-ttu-id="49464-395">Como su nombre implica, el servicio Azure Redis Cache está concebido como una solución de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="49464-395">As its name implies, Azure Redis Cache is intended as a caching solution.</span></span> <span data-ttu-id="49464-396">Úselo solo para almacenar datos provisionales y no como un almacén de datos permanentes.</span><span class="sxs-lookup"><span data-stu-id="49464-396">Use it only for holding transient data and not as a permanent data store.</span></span> <span data-ttu-id="49464-397">Las aplicaciones que usan Azure Redis Cache podrán seguir funcionando si la caché no está disponible.</span><span class="sxs-lookup"><span data-stu-id="49464-397">Applications that utilize Azure Redis Cache should be able to continue functioning if the cache is unavailable.</span></span> <span data-ttu-id="49464-398">Azure Redis Cache admite la replicación principal y secundaria para proporcionar alta disponibilidad, pero actualmente limita el tamaño de caché máximo a 53 GB.</span><span class="sxs-lookup"><span data-stu-id="49464-398">Azure Redis Cache supports primary/secondary replication to provide high availability, but currently limits the maximum cache size to 53 GB.</span></span> <span data-ttu-id="49464-399">Si necesita más espacio que este, deberá crear cachés adicionales.</span><span class="sxs-lookup"><span data-stu-id="49464-399">If you need more space than this, you must create additional caches.</span></span> <span data-ttu-id="49464-400">Para más información, consulte [Azure Redis Cache].</span><span class="sxs-lookup"><span data-stu-id="49464-400">For more information, see [Azure Redis Cache].</span></span>

<span data-ttu-id="49464-401">Crear particiones en un almacén de datos Redis implica dividir los datos entre instancias del servicio Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-401">Partitioning a Redis data store involves splitting the data across instances of the Redis service.</span></span> <span data-ttu-id="49464-402">Cada instancia constituye una sola partición.</span><span class="sxs-lookup"><span data-stu-id="49464-402">Each instance constitutes a single partition.</span></span> <span data-ttu-id="49464-403">Azure Redis Cache abstrae los servicios de Redis detrás de una fachada y no los expone directamente.</span><span class="sxs-lookup"><span data-stu-id="49464-403">Azure Redis Cache abstracts the Redis services behind a façade and does not expose them directly.</span></span> <span data-ttu-id="49464-404">La manera más sencilla de implementar la creación de particiones es crear varias instancias de Azure Redis Cache y repartir los datos entre ellas.</span><span class="sxs-lookup"><span data-stu-id="49464-404">The simplest way to implement partitioning is to create multiple Azure Redis Cache instances and spread the data across them.</span></span>

<span data-ttu-id="49464-405">Puede asociar cada uno de los elementos de datos con un identificador (una clave de partición) que especifica en qué caché se almacenan.</span><span class="sxs-lookup"><span data-stu-id="49464-405">You can associate each data item with an identifier (a partition key) that specifies which cache stores the data item.</span></span> <span data-ttu-id="49464-406">La lógica de la aplicación cliente puede usar luego este identificador para enrutar las solicitudes a la partición apropiada.</span><span class="sxs-lookup"><span data-stu-id="49464-406">The client application logic can then use this identifier to route requests to the appropriate partition.</span></span> <span data-ttu-id="49464-407">Este esquema es muy sencillo, pero si cambia el esquema de creación de particiones (por ejemplo, si se crean instancias de Azure Redis Cache adicionales), es posible que las aplicaciones cliente deban volver a configurarse.</span><span class="sxs-lookup"><span data-stu-id="49464-407">This scheme is very simple, but if the partitioning scheme changes (for example, if additional Azure Redis Cache instances are created), client applications might need to be reconfigured.</span></span>

<span data-ttu-id="49464-408">Redis nativo (no Azure Redis Cache) admite particiones de servidor basadas en la agrupación en clústeres de Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-408">Native Redis (not Azure Redis Cache) supports server-side partitioning based on Redis clustering.</span></span> <span data-ttu-id="49464-409">En este enfoque, los datos se dividen uniformemente entre servidores mediante un mecanismo hash.</span><span class="sxs-lookup"><span data-stu-id="49464-409">In this approach, you can divide the data evenly across servers by using a hashing mechanism.</span></span> <span data-ttu-id="49464-410">Cada servidor Redis almacena metadatos que describen el intervalo de claves hash que contiene la partición, y también contiene información acerca de qué claves hash se encuentran en las particiones de otros servidores.</span><span class="sxs-lookup"><span data-stu-id="49464-410">Each Redis server stores metadata that describes the range of hash keys that the partition holds, and also contains information about which hash keys are located in the partitions on other servers.</span></span>

<span data-ttu-id="49464-411">Las aplicaciones cliente simplemente envían solicitudes a cualquiera de los servidores Redis participantes (probablemente el más cercano).</span><span class="sxs-lookup"><span data-stu-id="49464-411">Client applications simply send requests to any of the participating Redis servers (probably the closest one).</span></span> <span data-ttu-id="49464-412">El servidor Redis examina la solicitud del cliente.</span><span class="sxs-lookup"><span data-stu-id="49464-412">The Redis server examines the client request.</span></span> <span data-ttu-id="49464-413">Si se puede resolver localmente, este realiza la operación solicitada.</span><span class="sxs-lookup"><span data-stu-id="49464-413">If it can be resolved locally, it performs the requested operation.</span></span> <span data-ttu-id="49464-414">De lo contrario, reenvía la solicitud al servidor apropiado.</span><span class="sxs-lookup"><span data-stu-id="49464-414">Otherwise it forwards the request on to the appropriate server.</span></span>

<span data-ttu-id="49464-415">Este modelo se implementa mediante el uso de clústeres de Redis y se describe con más detalle en la página [Tutorial de clúster Redis] en el sitio web de Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-415">This model is implemented by using Redis clustering, and is described in more detail on the [Redis cluster tutorial] page on the Redis website.</span></span> <span data-ttu-id="49464-416">La agrupación en clústeres de Redis es transparente para las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="49464-416">Redis clustering is transparent to client applications.</span></span> <span data-ttu-id="49464-417">Es posible agregar servidores Redis adicionales al clúster (y es posible volver a crear particiones en los datos) sin necesidad de volver a configurar los clientes.</span><span class="sxs-lookup"><span data-stu-id="49464-417">Additional Redis servers can be added to the cluster (and the data can be re-partitioned) without requiring that you reconfigure the clients.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="49464-418">Actualmente Azure Redis Cache no admite la agrupación en clústeres Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-418">Azure Redis Cache does not currently support Redis clustering.</span></span> <span data-ttu-id="49464-419">Si desea implementar este enfoque con Azure, deberá implementar entonces sus propios servidores Redis instalando Redis en un conjunto de máquinas virtuales de Azure y configurándolas manualmente.</span><span class="sxs-lookup"><span data-stu-id="49464-419">If you want to implement this approach with Azure, then you must implement your own Redis servers by installing Redis on a set of Azure virtual machines and configuring them manually.</span></span> <span data-ttu-id="49464-420">La página [Running Redis on a CentOS Linux VM in Windows Azure] (Ejecución de Redis en una máquina virtual Linux de CentOS en Azure) le guía a través de un ejemplo que muestra cómo crear y configurar un nodo Redis que se ejecuta como una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="49464-420">The page [Running Redis on a CentOS Linux VM in Azure] walks through an example that shows you how to build and configure a Redis node running as an Azure VM.</span></span>

<span data-ttu-id="49464-421">La página [Partitioning: how to split data among multiple Redis instances] (Creación de particiones: cómo dividir los datos entre varias instancias de Redis) del sitio web de Redis ofrece más información acerca de cómo implementar la creación de particiones con Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-421">The page [Partitioning: how to split data among multiple Redis instances] on the Redis website provides more information about implementing partitioning with Redis.</span></span> <span data-ttu-id="49464-422">En el resto de esta sección se supone que se está implementando las particiones del lado cliente o asistidas por el proxy.</span><span class="sxs-lookup"><span data-stu-id="49464-422">The remainder of this section assumes that you are implementing client-side or proxy-assisted partitioning.</span></span>

<span data-ttu-id="49464-423">Deberá tener en cuenta los siguientes puntos a la hora de decidir cómo crear particiones en los datos con Azure Redis Cache:</span><span class="sxs-lookup"><span data-stu-id="49464-423">Consider the following points when deciding how to partition data with Azure Redis Cache:</span></span>

- <span data-ttu-id="49464-424">El servicio Azure Redis Cache no está pensado para actuar como un almacén de datos permanentes, por lo que, independientemente del esquema de particiones que implemente, el código de la aplicación debe estar preparado para recuperar datos desde una ubicación distinta de la caché.</span><span class="sxs-lookup"><span data-stu-id="49464-424">Azure Redis Cache is not intended to act as a permanent data store, so whatever partitioning scheme you implement, your application code must be able to retrieve data from a location that's not the cache.</span></span>

- <span data-ttu-id="49464-425">Los datos a los que se suele acceder en conjunto deben mantenerse en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="49464-425">Data that is frequently accessed together should be kept in the same partition.</span></span> <span data-ttu-id="49464-426">Redis es un eficaz almacén de clave-valor que proporciona varios mecanismos enormemente optimizados para estructurar los datos.</span><span class="sxs-lookup"><span data-stu-id="49464-426">Redis is a powerful key-value store that provides several highly optimized mechanisms for structuring data.</span></span> <span data-ttu-id="49464-427">Estos mecanismos pueden ser uno de los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="49464-427">These mechanisms can be one of the following:</span></span>
  - <span data-ttu-id="49464-428">Cadenas simples (datos binarios de hasta 512 MB)</span><span class="sxs-lookup"><span data-stu-id="49464-428">Simple strings (binary data up to 512 MB in length)</span></span>
  - <span data-ttu-id="49464-429">Tipos de agregado como listas (que pueden actuar como colas y pilas)</span><span class="sxs-lookup"><span data-stu-id="49464-429">Aggregate types such as lists (which can act as queues and stacks)</span></span>
  - <span data-ttu-id="49464-430">Conjuntos (ordenados y desordenados)</span><span class="sxs-lookup"><span data-stu-id="49464-430">Sets (ordered and unordered)</span></span>
  - <span data-ttu-id="49464-431">Algoritmos hash (que pueden agrupar campos relacionados, como los elementos que representan los campos de un objeto)</span><span class="sxs-lookup"><span data-stu-id="49464-431">Hashes (which can group related fields together, such as the items that represent the fields in an object)</span></span>

- <span data-ttu-id="49464-432">Los tipos de agregado permiten asociar muchos valores relacionados con la misma clave.</span><span class="sxs-lookup"><span data-stu-id="49464-432">The aggregate types enable you to associate many related values with the same key.</span></span> <span data-ttu-id="49464-433">Una clave de Redis identifica una lista, un conjunto o un valor hash en lugar de los elementos de datos que contiene.</span><span class="sxs-lookup"><span data-stu-id="49464-433">A Redis key identifies a list, set, or hash rather than the data items that it contains.</span></span> <span data-ttu-id="49464-434">Estos tipos están disponibles con Azure Redis Cache y se describen en la página [Tipo de datos] (Tipos de datos) del sitio web de Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-434">These types are all available with Azure Redis Cache and are described by the [Data types] page on the Redis website.</span></span> <span data-ttu-id="49464-435">Por ejemplo, en la parte de un sistema de comercio electrónico que realiza el seguimiento de los pedidos realizados por los clientes, los detalles de cada cliente podrían almacenarse en un hash de Redis con clave utilizando el identificador de cliente.</span><span class="sxs-lookup"><span data-stu-id="49464-435">For example, in part of an e-commerce system that tracks the orders that are placed by customers, the details of each customer can be stored in a Redis hash that is keyed by using the customer ID.</span></span> <span data-ttu-id="49464-436">Cada valor hash puede contener una colección de identificadores de pedido para el cliente.</span><span class="sxs-lookup"><span data-stu-id="49464-436">Each hash can hold a collection of order IDs for the customer.</span></span> <span data-ttu-id="49464-437">Un conjunto Redis independiente podría contener los pedidos, estructurados como algoritmos hash y codificados por medio del identificador de pedido.</span><span class="sxs-lookup"><span data-stu-id="49464-437">A separate Redis set can hold the orders, again structured as hashes, and keyed by using the order ID.</span></span> <span data-ttu-id="49464-438">La figura 8 muestra esta estructura.</span><span class="sxs-lookup"><span data-stu-id="49464-438">Figure 8 shows this structure.</span></span> <span data-ttu-id="49464-439">Tenga en cuenta que Redis no implementa ningún tipo de integridad referencial, por lo que es responsabilidad del desarrollador mantener las relaciones entre clientes y pedidos.</span><span class="sxs-lookup"><span data-stu-id="49464-439">Note that Redis does not implement any form of referential integrity, so it is the developer's responsibility to maintain the relationships between customers and orders.</span></span>

![Estructura sugerida en el almacenamiento de Redis para registrar los pedidos de clientes y sus detalles](./images/data-partitioning/RedisCustomersandOrders.png)

<span data-ttu-id="49464-441">*Ilustración 8. Estructura sugerida en el almacenamiento de Redis para registrar los pedidos de clientes y sus detalles.*</span><span class="sxs-lookup"><span data-stu-id="49464-441">*Figure 8. Suggested structure in Redis storage for recording customer orders and their details.*</span></span>

> [!NOTE]
> <span data-ttu-id="49464-442">En Redis, todas las claves son valores de datos binarios (como cadenas Redis) y pueden contener hasta 512 MB de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-442">In Redis, all keys are binary data values (like Redis strings) and can contain up to 512 MB of data.</span></span> <span data-ttu-id="49464-443">En teoría, una clave puede contener casi cualquier información.</span><span class="sxs-lookup"><span data-stu-id="49464-443">In theory, a key can contain almost any information.</span></span> <span data-ttu-id="49464-444">No obstante, debe adoptar una convención de nomenclatura coherente para las claves que sea descriptiva del tipo de datos y que identifique la entidad, pero que no sea demasiado larga.</span><span class="sxs-lookup"><span data-stu-id="49464-444">However, we recommend adopting a consistent naming convention for keys that is descriptive of the type of data and that identifies the entity, but is not excessively long.</span></span> <span data-ttu-id="49464-445">Es habitual utilizar claves con el formato "tipo_entidad: ID".</span><span class="sxs-lookup"><span data-stu-id="49464-445">A common approach is to use keys of the form "entity_type:ID".</span></span> <span data-ttu-id="49464-446">Por ejemplo, puede usar "cliente: 99" para indicar la clave de un cliente con el identificador 99.</span><span class="sxs-lookup"><span data-stu-id="49464-446">For example, you can use "customer:99" to indicate the key for a customer with the ID 99.</span></span>

- <span data-ttu-id="49464-447">Puede implementar las particiones verticales almacenando información relacionada en agregaciones diferentes en la misma base de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-447">You can implement vertical partitioning by storing related information in different aggregations in the same database.</span></span> <span data-ttu-id="49464-448">Por ejemplo, en una aplicación de comercio electrónico podría almacenar información a la que accede frecuentemente acerca de los productos en un hash de Redis y la información detallada usada con menos frecuencia en otro.</span><span class="sxs-lookup"><span data-stu-id="49464-448">For example, in an e-commerce application, you can store commonly accessed information about products in one Redis hash and less frequently used detailed information in another.</span></span> <span data-ttu-id="49464-449">Ambos valores hash pueden utilizar el mismo identificador de producto como parte de la clave.</span><span class="sxs-lookup"><span data-stu-id="49464-449">Both hashes can use the same product ID as part of the key.</span></span> <span data-ttu-id="49464-450">Por ejemplo, puede utilizar "producto: *nn*" (donde *nn* es el identificador del producto) para la información del producto y "detalles_producto: *nn*" para los datos detallados.</span><span class="sxs-lookup"><span data-stu-id="49464-450">For example, you can use "product: *nn*" (where *nn* is the product ID) for the product information and "product_details: *nn*" for the detailed data.</span></span> <span data-ttu-id="49464-451">Esta estrategia puede ayudar a reducir el volumen de datos que es probable que recuperen la mayoría de las consultas.</span><span class="sxs-lookup"><span data-stu-id="49464-451">This strategy can help reduce the volume of data that most queries are likely to retrieve.</span></span>

- <span data-ttu-id="49464-452">Puede volver a particionar un almacén de datos de Redis, pero tenga en cuenta que es una tarea compleja y lenta.</span><span class="sxs-lookup"><span data-stu-id="49464-452">You can repartition a Redis data store, but keep in mind that it's a complex and time-consuming task.</span></span> <span data-ttu-id="49464-453">La agrupación en clústeres de Redis puede volver a crear particiones de datos automáticamente, pero esta función no está disponible con Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="49464-453">Redis clustering can repartition data automatically, but this capability is not available with Azure Redis Cache.</span></span> <span data-ttu-id="49464-454">Por lo tanto, al diseñar el esquema de partición, deje suficiente espacio libre en cada partición para permitir el crecimiento de datos que se espera con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="49464-454">Therefore, when you design your partitioning scheme, try to leave sufficient free space in each partition to allow for expected data growth over time.</span></span> <span data-ttu-id="49464-455">Sin embargo, recuerde que Azure Redis Cache está diseñado para almacenar datos en la caché temporalmente y que los datos que se mantienen en la memoria caché pueden tener una duración limitada especificada como valor de período de vida (TTL).</span><span class="sxs-lookup"><span data-stu-id="49464-455">However, remember that Azure Redis Cache is intended to cache data temporarily, and that data held in the cache can have a limited lifetime specified as a time-to-live (TTL) value.</span></span> <span data-ttu-id="49464-456">En el caso de los datos relativamente volátiles, el período de vida debe ser corto; sin embargo, para datos estáticos, el período de vida puede ser mucho más largo.</span><span class="sxs-lookup"><span data-stu-id="49464-456">For relatively volatile data, the TTL can be short, but for static data the TTL can be a lot longer.</span></span> <span data-ttu-id="49464-457">Evite almacenar grandes cantidades de datos de larga duración en la caché si el volumen de estos datos es probable que llene la caché.</span><span class="sxs-lookup"><span data-stu-id="49464-457">Avoid storing large amounts of long-lived data in the cache if the volume of this data is likely to fill the cache.</span></span> <span data-ttu-id="49464-458">Puede especificar una directiva de expulsión que provoque que Azure Redis Cache elimine datos si el espacio es crítico.</span><span class="sxs-lookup"><span data-stu-id="49464-458">You can specify an eviction policy that causes Azure Redis Cache to remove data if space is at a premium.</span></span>

  > [!NOTE]
  > <span data-ttu-id="49464-459">Cuando utiliza Caché en Redis de Azure, puede especificar el tamaño máximo de caché (de 250 MB a 53 GB) seleccionando el plan de tarifa adecuado.</span><span class="sxs-lookup"><span data-stu-id="49464-459">When you use Azure Redis cache, you specify the maximum size of the cache (from 250 MB to 53 GB) by selecting the appropriate pricing tier.</span></span> <span data-ttu-id="49464-460">Sin embargo, una vez que se ha creado Azure Redis Cache, no podrá aumentar (ni reducir) su tamaño.</span><span class="sxs-lookup"><span data-stu-id="49464-460">However, after an Azure Redis Cache has been created, you cannot increase (or decrease) its size.</span></span>

- <span data-ttu-id="49464-461">Los lotes y las transacciones de Redis no pueden abarcar varias conexiones, por lo que todos los datos afectados por un lote o transacción deben permanecer en la misma base de datos (partición).</span><span class="sxs-lookup"><span data-stu-id="49464-461">Redis batches and transactions cannot span multiple connections, so all data that is affected by a batch or transaction should be held in the same database (shard).</span></span>

  > [!NOTE]
  > <span data-ttu-id="49464-462">Una secuencia de operaciones en una transacción Redis no es necesariamente atómica.</span><span class="sxs-lookup"><span data-stu-id="49464-462">A sequence of operations in a Redis transaction is not necessarily atomic.</span></span> <span data-ttu-id="49464-463">Los comandos que componen una transacción se comprueban y se ponen en cola antes de ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="49464-463">The commands that compose a transaction are verified and queued before they run.</span></span> <span data-ttu-id="49464-464">Si se produce un error durante esta fase, se descarta toda la cola.</span><span class="sxs-lookup"><span data-stu-id="49464-464">If an error occurs during this phase, the entire queue is discarded.</span></span> <span data-ttu-id="49464-465">Sin embargo, una vez que la transacción se haya enviado correctamente, se ejecutarán los comandos en cola en secuencia.</span><span class="sxs-lookup"><span data-stu-id="49464-465">However, after the transaction has been successfully submitted, the queued commands run in sequence.</span></span> <span data-ttu-id="49464-466">Si se produce un error en algún comando, únicamente ese comando deja de ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="49464-466">If any command fails, only that command stops running.</span></span> <span data-ttu-id="49464-467">Se ejecutarán todos los comandos situados delante y detrás en la cola.</span><span class="sxs-lookup"><span data-stu-id="49464-467">All previous and subsequent commands in the queue are performed.</span></span> <span data-ttu-id="49464-468">Para obtener más información, visite la página [Transactions] (Transacciones) en el sitio web de Redis.</span><span class="sxs-lookup"><span data-stu-id="49464-468">For more information, go to the [Transactions] page on the Redis website.</span></span>

- <span data-ttu-id="49464-469">Redis admite un número limitado de operaciones atómicas.</span><span class="sxs-lookup"><span data-stu-id="49464-469">Redis supports a limited number of atomic operations.</span></span> <span data-ttu-id="49464-470">Las únicas operaciones de este tipo que admiten varias claves y valores son operaciones MGET y MSET.</span><span class="sxs-lookup"><span data-stu-id="49464-470">The only operations of this type that support multiple keys and values are MGET and MSET operations.</span></span> <span data-ttu-id="49464-471">Las operaciones MGET devuelven una colección de valores para una lista especificada de claves, y las operaciones MSET almacenan una colección de valores para una lista especificada de claves.</span><span class="sxs-lookup"><span data-stu-id="49464-471">MGET operations return a collection of values for a specified list of keys, and MSET operations store a collection of values for a specified list of keys.</span></span> <span data-ttu-id="49464-472">Si necesita usar estas operaciones, los pares clave-valor a los que hacen referencia los comandos MSET y MGET deben almacenarse en la misma base de datos.</span><span class="sxs-lookup"><span data-stu-id="49464-472">If you need to use these operations, the key-value pairs that are referenced by the MSET and MGET commands must be stored within the same database.</span></span>

## <a name="partitioning-azure-service-fabric"></a><span data-ttu-id="49464-473">Creación de particiones en Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="49464-473">Partitioning Azure Service Fabric</span></span>

<span data-ttu-id="49464-474">Azure Service Fabric es una plataforma de microservicios que proporciona un sistema de tiempo de ejecución para las aplicaciones distribuidas en la nube.</span><span class="sxs-lookup"><span data-stu-id="49464-474">Azure Service Fabric is a microservices platform that provides a runtime for distributed applications in the cloud.</span></span> <span data-ttu-id="49464-475">Service Fabric admite archivos ejecutables de invitado de .NET, servicios con y sin estado, y contenedores.</span><span class="sxs-lookup"><span data-stu-id="49464-475">Service Fabric supports .Net guest executables, stateful and stateless services, and containers.</span></span> <span data-ttu-id="49464-476">Los servicios con estado proporcionan una [colección confiable] [ service-fabric-reliable-collections] para almacenar datos de forma persistente en una colección de pares clave-valor en el clúster de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="49464-476">Stateful services provide a [reliable collection][service-fabric-reliable-collections] to persistently store data in a key-value collection within the Service Fabric cluster.</span></span> <span data-ttu-id="49464-477">Para más información acerca de las estrategias de las claves de creación de particiones en una colección de confianza, consulte [Directrices y recomendaciones de las colecciones confiables en Azure Service Fabric].</span><span class="sxs-lookup"><span data-stu-id="49464-477">For more information about strategies for partitioning keys in a reliable collection, see [guidelines and recommendations for reliable collections in Azure Service Fabric].</span></span>

### <a name="more-information"></a><span data-ttu-id="49464-478">Más información</span><span class="sxs-lookup"><span data-stu-id="49464-478">More information</span></span>

- <span data-ttu-id="49464-479">[Información general de Azure Service Fabric] es una introducción a Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="49464-479">[Overview of Azure Service Fabric] is an introduction to Azure Service Fabric.</span></span>

- <span data-ttu-id="49464-480">[Partición de los servicios confiables de Service Fabric] proporciona más información acerca de los servicios confiables en Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="49464-480">[Partition Service Fabric reliable services] provides more information about reliable services in Azure Service Fabric.</span></span>

## <a name="partitioning-azure-event-hubs"></a><span data-ttu-id="49464-481">Creación de particiones en Azure Event Hubs</span><span class="sxs-lookup"><span data-stu-id="49464-481">Partitioning Azure Event Hubs</span></span>

<span data-ttu-id="49464-482">[Azure Event Hubs][event-hubs] está diseñado para la trasmisión de datos a escala masiva, y la creación de particiones está integrada en el servicio para habilitar el escalado horizontal.</span><span class="sxs-lookup"><span data-stu-id="49464-482">[Azure Event Hubs][event-hubs] is designed for data streaming at massive scale, and partitioning is built into the service to enable horizontal scaling.</span></span> <span data-ttu-id="49464-483">Cada consumidor lee únicamente una partición específica del flujo de mensajes.</span><span class="sxs-lookup"><span data-stu-id="49464-483">Each consumer only reads a specific partition of the message stream.</span></span>

<span data-ttu-id="49464-484">El publicador de eventos solo conoce su clave de partición, no la partición en la que se publican los eventos.</span><span class="sxs-lookup"><span data-stu-id="49464-484">The event publisher is only aware of its partition key, not the partition to which the events are published.</span></span> <span data-ttu-id="49464-485">Este desacoplamiento de la clave y la partición evita al remitente la necesidad de conocer demasiado sobre el procesamiento de bajada.</span><span class="sxs-lookup"><span data-stu-id="49464-485">This decoupling of key and partition insulates the sender from needing to know too much about the downstream processing.</span></span> <span data-ttu-id="49464-486">(También se puede enviar eventos directamente a una partición determinada, pero generalmente no se recomienda).</span><span class="sxs-lookup"><span data-stu-id="49464-486">(It's also possible send events directly to a given partition, but generally that's not recommended.)</span></span>  

<span data-ttu-id="49464-487">Considere la posibilidad de escalar a largo plazo cuando seleccione el número de particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-487">Consider long-term scale when you select the partition count.</span></span> <span data-ttu-id="49464-488">Después de crear un centro de eventos, no se puede cambiar el número de particiones.</span><span class="sxs-lookup"><span data-stu-id="49464-488">After an event hub is created, you can't change the number of partitions.</span></span>

<span data-ttu-id="49464-489">Para más información sobre el uso de particiones en Event Hubs, consulte [¿Qué es Event Hubs?].</span><span class="sxs-lookup"><span data-stu-id="49464-489">For more information about using partitions in Event Hubs, see [What is Event Hubs?].</span></span>

<span data-ttu-id="49464-490">Para ver otras consideraciones sobre el equilibrio entre la disponibilidad y la coherencia, consulte [Disponibilidad y coherencia en Event Hubs].</span><span class="sxs-lookup"><span data-stu-id="49464-490">For considerations about trade-offs between availability and consistency, see [Availability and consistency in Event Hubs].</span></span>

[Disponibilidad y coherencia en Event Hubs]: /azure/event-hubs/event-hubs-availability-and-consistency
[Availability and consistency in Event Hubs]: /azure/event-hubs/event-hubs-availability-and-consistency
[azure-limits]: /azure/azure-subscription-service-limits
[Azure Content Delivery Network]: /azure/cdn/cdn-overview
[Azure Redis Cache]: https://azure.microsoft.com/services/cache/
[Azure Storage Scalability and Performance Targets]: /azure/storage/storage-scalability-targets
[Guía de diseño de Table Storage]: /azure/storage/storage-table-design-guide
[Azure Storage Table Design Guide]: /azure/storage/storage-table-design-guide
[Building a Polyglot Solution]: https://msdn.microsoft.com/library/dn313279.aspx
[cosmos-db-ru]: /azure/cosmos-db/request-units
[Data Access for Highly-Scalable Solutions: Using SQL, NoSQL, and Polyglot Persistence]: https://msdn.microsoft.com/library/dn271399.aspx
[Data consistency primer]: https://aka.ms/Data-Consistency-Primer
[Data Partitioning Guidance]: https://msdn.microsoft.com/library/dn589795.aspx
[Tipo de datos]: https://redis.io/topics/data-types
[Data Types]: https://redis.io/topics/data-types
[cosmosdb-sql-api]: /azure/cosmos-db/sql-api-introduction
[Elastic Database features overview]: /azure/sql-database/sql-database-elastic-scale-introduction
[event-hubs]: /azure/event-hubs
[Federations Migration Utility]: https://code.msdn.microsoft.com/vstudio/Federations-Migration-ce61e9c1
[Directrices y recomendaciones de las colecciones confiables en Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[guidelines and recommendations for reliable collections in Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[Multi-shard querying]: /azure/sql-database/sql-database-elastic-scale-multishard-querying
[Información general de Azure Service Fabric]: /azure/service-fabric/service-fabric-overview
[Overview of Azure Service Fabric]: /azure/service-fabric/service-fabric-overview
[Partición de los servicios confiables de Service Fabric]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partition Service Fabric reliable services]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partitioning: how to split data among multiple Redis instances]: https://redis.io/topics/partitioning
[Performing Entity Group Transactions]: /rest/api/storageservices/Performing-Entity-Group-Transactions
[Tutorial de clúster Redis]: https://redis.io/topics/cluster-tutorial
[Redis cluster tutorial]: https://redis.io/topics/cluster-tutorial
[Running Redis on a CentOS Linux VM in Windows Azure]: https://blogs.msdn.microsoft.com/tconte/2012/06/08/running-redis-on-a-centos-linux-vm-in-windows-azure/
[Running Redis on a CentOS Linux VM in Azure]: https://blogs.msdn.microsoft.com/tconte/2012/06/08/running-redis-on-a-centos-linux-vm-in-windows-azure/
[Scaling using the Elastic Database split-merge tool]: /azure/sql-database/sql-database-elastic-scale-overview-split-and-merge
[Using Azure Content Delivery Network]: /azure/cdn/cdn-create-new-endpoint
[Cuotas de Service Bus]: /azure/service-bus-messaging/service-bus-quotas
[Service Bus quotas]: /azure/service-bus-messaging/service-bus-quotas
[service-fabric-reliable-collections]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections
[Límites de servicio en Azure Search]:  /azure/search/search-limits-quotas-capacity
[Service limits in Azure Search]:  /azure/search/search-limits-quotas-capacity
[Sharding pattern]: ../patterns/sharding.md
[Tipos de datos admitidos (Azure Search)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Supported Data Types (Azure Search)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Transactions]: https://redis.io/topics/transactions
[¿Qué es Event Hubs?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[What is Event Hubs?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[¿Qué es Azure Search?]: /azure/search/search-what-is-azure-search
[What is Azure Search?]: /azure/search/search-what-is-azure-search
[What is Azure SQL Database?]: /azure/sql-database/sql-database-technical-overview
[Objetivos de escalabilidad]: /azure/storage/common/storage-scalability-targets
[scalability targets]: /azure/storage/common/storage-scalability-targets
