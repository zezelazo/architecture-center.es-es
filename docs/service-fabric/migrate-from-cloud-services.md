---
title: "Migrar una aplicación de Azure Cloud Services a Azure Service Fabric"
description: "Cómo migrar una aplicación de Azure Cloud Services a Azure Service Fabric."
author: MikeWasson
ms.date: 04/27/2017
ms.openlocfilehash: ce9c138a6b093fb7f0329c619c75bd4f4aacc2e7
ms.sourcegitcommit: 3d9ee03e2dda23753661a80c7106d1789f5223bb
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/23/2018
---
# <a name="migrate-an-azure-cloud-services-application-to-azure-service-fabric"></a><span data-ttu-id="a3872-103">Migrar una aplicación de Azure Cloud Services a Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a3872-103">Migrate an Azure Cloud Services application to Azure Service Fabric</span></span> 

<span data-ttu-id="a3872-104">[![GitHub](../_images/github.png) Código de ejemplo][sample-code]</span><span class="sxs-lookup"><span data-stu-id="a3872-104">[![GitHub](../_images/github.png) Sample code][sample-code]</span></span>

<span data-ttu-id="a3872-105">En este artículo se explica cómo migrar una aplicación de Azure Cloud Services a Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-105">This article describes migrating an application from Azure Cloud Services to Azure Service Fabric.</span></span> <span data-ttu-id="a3872-106">Se centra en las decisiones arquitectónicas y los procedimientos recomendados.</span><span class="sxs-lookup"><span data-stu-id="a3872-106">It focuses on architectural decisions and recommended practices.</span></span> 

<span data-ttu-id="a3872-107">Para este proyecto, empezamos con una aplicación de Cloud Services denominada Surveys y lo migramos a Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-107">For this project, we started with a Cloud Services application called Surveys and ported it to Service Fabric.</span></span> <span data-ttu-id="a3872-108">El objetivo era migrar la aplicación con el menor número de cambios posible.</span><span class="sxs-lookup"><span data-stu-id="a3872-108">The goal was to migrate the application with as few changes as possible.</span></span> <span data-ttu-id="a3872-109">En un artículo posterior, optimizaremos la aplicación para Service Fabric mediante la adopción de una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="a3872-109">In a later article, we will optimize the application for Service Fabric by adopting a microservices architecture.</span></span>

<span data-ttu-id="a3872-110">Antes de leer este artículo, le resultará útil comprender los conceptos básicos de Service Fabric y de las arquitecturas de microservicios en general.</span><span class="sxs-lookup"><span data-stu-id="a3872-110">Before reading this article, it will be useful to understand the basics of Service Fabric and microservices architectures in general.</span></span> <span data-ttu-id="a3872-111">Consulte los artículos siguientes:</span><span class="sxs-lookup"><span data-stu-id="a3872-111">See the following articles:</span></span>

- <span data-ttu-id="a3872-112">[Información general de Azure Service Fabric][sf-overview]</span><span class="sxs-lookup"><span data-stu-id="a3872-112">[Overview of Azure Service Fabric][sf-overview]</span></span>
- <span data-ttu-id="a3872-113">[¿Por qué usar un enfoque de microservicios para crear aplicaciones?][sf-why-microservices]</span><span class="sxs-lookup"><span data-stu-id="a3872-113">[Why a microservices approach to building applications?][sf-why-microservices]</span></span>


## <a name="about-the-surveys-application"></a><span data-ttu-id="a3872-114">Acerca de la aplicación Surveys</span><span class="sxs-lookup"><span data-stu-id="a3872-114">About the Surveys application</span></span>

<span data-ttu-id="a3872-115">En 2012, el grupo de modelos y prácticas crea una aplicación denominada encuestas, para un libro denominado [desarrollar aplicaciones de varios inquilinos para la nube][tailspin-book].</span><span class="sxs-lookup"><span data-stu-id="a3872-115">In 2012, the patterns & practices group created an application called Surveys, for a book called [Developing Multi-tenant Applications for the Cloud][tailspin-book].</span></span> <span data-ttu-id="a3872-116">En el libro se describe una compañía ficticia denominada Tailspin que diseña e implementa la aplicación Surveys.</span><span class="sxs-lookup"><span data-stu-id="a3872-116">The book describes a fictitious company named Tailspin that designs and implements the Surveys application.</span></span>

<span data-ttu-id="a3872-117">Surveys es una aplicación multiinquilino que permite a los clientes crear encuestas.</span><span class="sxs-lookup"><span data-stu-id="a3872-117">Surveys is a multitenant application that allows customers to create surveys.</span></span> <span data-ttu-id="a3872-118">Cuando un cliente se registra en la aplicación, los miembros de la organización del cliente pueden crear y publicar encuestas, así como recopilar los resultados para el análisis.</span><span class="sxs-lookup"><span data-stu-id="a3872-118">After a customer signs up for the application,  members of the customer's organization can create and publish surveys, and collect the results for analysis.</span></span> <span data-ttu-id="a3872-119">La aplicación incluye un sitio web público de donde los usuarios pueden extraer una encuesta.</span><span class="sxs-lookup"><span data-stu-id="a3872-119">The application includes a public website where people can take a survey.</span></span> <span data-ttu-id="a3872-120">Obtenga más información sobre el escenario de Tailspin original [aquí][tailspin-scenario].</span><span class="sxs-lookup"><span data-stu-id="a3872-120">Read more about the original Tailspin scenario [here][tailspin-scenario].</span></span>

<span data-ttu-id="a3872-121">Ahora Tailspin quiere mover la aplicación Surveys a una arquitectura de microservicios, con Service Fabric ejecutándose en Azure.</span><span class="sxs-lookup"><span data-stu-id="a3872-121">Now Tailspin wants to move the Surveys application to a microservices architecture, using Service Fabric running on Azure.</span></span> <span data-ttu-id="a3872-122">Dado que la aplicación ya está implementada como una aplicación de Cloud Services, Tailspin adopta un enfoque de varias fases:</span><span class="sxs-lookup"><span data-stu-id="a3872-122">Because the application is already deployed as a Cloud Services application, Tailspin adopts a multi-phase approach:</span></span>

1.  <span data-ttu-id="a3872-123">Migre los servicios en la nube a Service Fabric y minimice los cambios en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a3872-123">Port the cloud services to Service Fabric, while minimizing changes to the application.</span></span>
2.  <span data-ttu-id="a3872-124">Optimice la aplicación para Service Fabric mediante el cambio a una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="a3872-124">Optimize the application for Service Fabric, by moving to a microservices architecture.</span></span>

<span data-ttu-id="a3872-125">En este artículo se describe la primera fase.</span><span class="sxs-lookup"><span data-stu-id="a3872-125">This article describes the first phase.</span></span> <span data-ttu-id="a3872-126">En un artículo posterior describiré la segunda fase.</span><span class="sxs-lookup"><span data-stu-id="a3872-126">A later article will describe the second phase.</span></span> <span data-ttu-id="a3872-127">En un proyecto real, es probable que ambas fases se superpongan.</span><span class="sxs-lookup"><span data-stu-id="a3872-127">In a real-world project, it's likely that both stages would overlap.</span></span> <span data-ttu-id="a3872-128">Al realizar la migración a Service Fabric, también empezaría a rediseñar la aplicación en microservicios.</span><span class="sxs-lookup"><span data-stu-id="a3872-128">While porting to Service Fabric, you would also start to re-architect the application into micro-services.</span></span> <span data-ttu-id="a3872-129">Más adelante puede refinar aún más la arquitectura, quizás mediante la división de servicios generales en servicios más pequeños.</span><span class="sxs-lookup"><span data-stu-id="a3872-129">Later you might refine the architecture further, perhaps dividing coarse-grained services into smaller services.</span></span>  

<span data-ttu-id="a3872-130">El código de la aplicación está disponible en [GitHub][sample-code].</span><span class="sxs-lookup"><span data-stu-id="a3872-130">The application code is available on [GitHub][sample-code].</span></span> <span data-ttu-id="a3872-131">Este repositorio contiene la aplicación Cloud Services y la versión de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-131">This repo contains both the Cloud Services application and the Service Fabric version.</span></span> 

> <span data-ttu-id="a3872-132">Cloud Service es una versión actualizada de la aplicación original del libro *Developing Multi-tenant Applications* (Desarrollo de aplicaciones multiinquilino).</span><span class="sxs-lookup"><span data-stu-id="a3872-132">The cloud service is an updated version of the original application from the *Developing Multi-tenant Applications* book.</span></span>

## <a name="why-microservices"></a><span data-ttu-id="a3872-133">¿Por qué microservicios?</span><span class="sxs-lookup"><span data-stu-id="a3872-133">Why Microservices?</span></span>

<span data-ttu-id="a3872-134">No se incluye una explicación detallada de los microservicios en este artículo, pero estas son algunas de las ventajas que Tailspin espera obtener con el cambio a una arquitectura de microservicios:</span><span class="sxs-lookup"><span data-stu-id="a3872-134">An in-depth discussion of microservices is beyond scope of this article, but here are some of the benefits that Tailspin hopes to get by moving to a microservices architecture:</span></span>

- <span data-ttu-id="a3872-135">**Actualizaciones de aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="a3872-135">**Application upgrades**.</span></span> <span data-ttu-id="a3872-136">Los servicios se pueden implementar de manera independiente, por lo que puede seguir un enfoque incremental para actualizar una aplicación.</span><span class="sxs-lookup"><span data-stu-id="a3872-136">Services can be deployed independently, so you can take an incremental approach to upgrading an application.</span></span>
- <span data-ttu-id="a3872-137">**Resistencia y aislamiento de errores**.</span><span class="sxs-lookup"><span data-stu-id="a3872-137">**Resiliency and fault isolation**.</span></span> <span data-ttu-id="a3872-138">Si se produce un error en un servicio, otros servicios se siguen ejecutando.</span><span class="sxs-lookup"><span data-stu-id="a3872-138">If a service fails, other services continue to run.</span></span>
- <span data-ttu-id="a3872-139">**Escalabilidad**.</span><span class="sxs-lookup"><span data-stu-id="a3872-139">**Scalability**.</span></span> <span data-ttu-id="a3872-140">Los servicios pueden escalarse de manera independiente.</span><span class="sxs-lookup"><span data-stu-id="a3872-140">Services can be scaled independently.</span></span>
- <span data-ttu-id="a3872-141">**Flexibilidad**.</span><span class="sxs-lookup"><span data-stu-id="a3872-141">**Flexibility**.</span></span> <span data-ttu-id="a3872-142">Los servicios están diseñados alrededor de escenarios empresariales, no pilas de tecnología, lo que facilita la migración de servicios a nuevos almacenes de datos, marcos o tecnologías.</span><span class="sxs-lookup"><span data-stu-id="a3872-142">Services are designed around business scenarios, not technology stacks, making it easier to migrate services to new technologies, frameworks, or data stores.</span></span>
- <span data-ttu-id="a3872-143">**Desarrollo ágil**.</span><span class="sxs-lookup"><span data-stu-id="a3872-143">**Agile development**.</span></span> <span data-ttu-id="a3872-144">Los servicios individuales tienen menos código que una aplicación monolítica, lo que hace que la base de código sea más fácil de comprender, razonar y probar.</span><span class="sxs-lookup"><span data-stu-id="a3872-144">Individual services have less code than a monolithic application, making the code base easier to understand, reason about, and test.</span></span>
- <span data-ttu-id="a3872-145">**Equipos pequeños y centrados**.</span><span class="sxs-lookup"><span data-stu-id="a3872-145">**Small, focused teams**.</span></span> <span data-ttu-id="a3872-146">Dado que la aplicación se desglosa en muchos servicios pequeños, cada servicio puede estar formado por un pequeño equipo centrado.</span><span class="sxs-lookup"><span data-stu-id="a3872-146">Because the application is broken down into many small services, each service can be built by a small focused team.</span></span>

## <a name="why-service-fabric"></a><span data-ttu-id="a3872-147">¿Por qué Service Fabric?</span><span class="sxs-lookup"><span data-stu-id="a3872-147">Why Service Fabric?</span></span>
      
<span data-ttu-id="a3872-148">Service Fabric es una buena opción para una arquitectura de microservicios, ya que la mayoría de las características necesarias en un sistema distribuido está integrada en Service Fabric, como:</span><span class="sxs-lookup"><span data-stu-id="a3872-148">Service Fabric is a good fit for a microservices architecture, because most of the features needed in a distributed system are built into Service Fabric, including:</span></span>

- <span data-ttu-id="a3872-149">**Administración de clústeres**.</span><span class="sxs-lookup"><span data-stu-id="a3872-149">**Cluster management**.</span></span> <span data-ttu-id="a3872-150">Service Fabric controla automáticamente la conmutación por error de nodo, el seguimiento de estado y otras funciones de administración del clúster.</span><span class="sxs-lookup"><span data-stu-id="a3872-150">Service Fabric automatically handles node failover, health monitoring, and other cluster management functions.</span></span>
- <span data-ttu-id="a3872-151">**Escalado horizontal**.</span><span class="sxs-lookup"><span data-stu-id="a3872-151">**Horizontal scaling**.</span></span> <span data-ttu-id="a3872-152">Al agregar nodos a un clúster de Service Fabric, la aplicación se escala automáticamente, a medida que los servicios se distribuyen entre los nuevos nodos.</span><span class="sxs-lookup"><span data-stu-id="a3872-152">When you add nodes to a Service Fabric cluster, the application automatically scales, as services are distributed across the new nodes.</span></span>
- <span data-ttu-id="a3872-153">**Detección de servicios**.</span><span class="sxs-lookup"><span data-stu-id="a3872-153">**Service discovery**.</span></span> <span data-ttu-id="a3872-154">Service Fabric proporciona un servicio de detección que puede resolver el punto de conexión para un servicio con nombre.</span><span class="sxs-lookup"><span data-stu-id="a3872-154">Service Fabric provides a discovery service that can resolve the endpoint for a named service.</span></span>
- <span data-ttu-id="a3872-155">**Servicios sin estado y con estado**.</span><span class="sxs-lookup"><span data-stu-id="a3872-155">**Stateless and stateful services**.</span></span> <span data-ttu-id="a3872-156">Los servicios con estado usan [colecciones confiables][sf-reliable-collections], que pueden ocupar el lugar de una memoria caché o una cola y pueden particionarse.</span><span class="sxs-lookup"><span data-stu-id="a3872-156">Stateful services use [reliable collections][sf-reliable-collections], which can take the place of a cache or queue, and can be partitioned.</span></span>
- <span data-ttu-id="a3872-157">**Administración del ciclo de vida de las aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="a3872-157">**Application lifecycle management**.</span></span> <span data-ttu-id="a3872-158">Los servicios se pueden actualizar por separado y sin tiempo de inactividad de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="a3872-158">Services can be upgraded independently and without application downtime.</span></span>
- <span data-ttu-id="a3872-159">**Orquestación del servicio** en un clúster de máquinas.</span><span class="sxs-lookup"><span data-stu-id="a3872-159">**Service orchestration** across a cluster of machines.</span></span>
- <span data-ttu-id="a3872-160">**Mayor densidad** para la optimización del consumo de recursos.</span><span class="sxs-lookup"><span data-stu-id="a3872-160">**Higher density** for optimizing resource consumption.</span></span> <span data-ttu-id="a3872-161">Un solo nodo puede hospedar varios servicios.</span><span class="sxs-lookup"><span data-stu-id="a3872-161">A single node can host multiple services.</span></span>

<span data-ttu-id="a3872-162">Service Fabric usa varios servicios de Microsoft, incluidos Azure SQL Database, Cosmos DB, Azure Event Hubs, etc., que forman una plataforma probada para la compilación de aplicaciones en la nube distribuidas.</span><span class="sxs-lookup"><span data-stu-id="a3872-162">Service Fabric is used by various Microsoft services, including Azure SQL Database, Cosmos DB, Azure Event Hubs, and others, making it a proven platform for building distributed cloud applications.</span></span> 

## <a name="comparing-cloud-services-with-service-fabric"></a><span data-ttu-id="a3872-163">Comparación de Cloud Services con Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a3872-163">Comparing Cloud Services with Service Fabric</span></span>

<span data-ttu-id="a3872-164">En la tabla siguiente se resumen algunas de las principales diferencias entre las aplicaciones Cloud Services y Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-164">The following table summarizes some of the important differences between Cloud Services and Service Fabric applications.</span></span> <span data-ttu-id="a3872-165">Para ver una discusión más detallada, consulte [Obtenga información acerca de las diferencias entre Cloud Services y Service Fabric antes de migrar las aplicaciones][sf-compare-cloud-services].</span><span class="sxs-lookup"><span data-stu-id="a3872-165">For a more in-depth discussion, see [Learn about the differences between Cloud Services and Service Fabric before migrating applications][sf-compare-cloud-services].</span></span>

|        | <span data-ttu-id="a3872-166">Cloud Services</span><span class="sxs-lookup"><span data-stu-id="a3872-166">Cloud Services</span></span> | <span data-ttu-id="a3872-167">Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a3872-167">Service Fabric</span></span> |
|--------|---------------|----------------|
| <span data-ttu-id="a3872-168">Composición de la aplicación</span><span class="sxs-lookup"><span data-stu-id="a3872-168">Application composition</span></span> | <span data-ttu-id="a3872-169">Roles</span><span class="sxs-lookup"><span data-stu-id="a3872-169">Roles</span></span>| <span data-ttu-id="a3872-170">Services</span><span class="sxs-lookup"><span data-stu-id="a3872-170">Services</span></span> |
| <span data-ttu-id="a3872-171">Densidad</span><span class="sxs-lookup"><span data-stu-id="a3872-171">Density</span></span> |<span data-ttu-id="a3872-172">Una instancia de rol por VM</span><span class="sxs-lookup"><span data-stu-id="a3872-172">One role instance per VM</span></span> | <span data-ttu-id="a3872-173">Varios servicios en un solo nodo</span><span class="sxs-lookup"><span data-stu-id="a3872-173">Multiple services in a single node</span></span> |
| <span data-ttu-id="a3872-174">Número mínimo de nodos</span><span class="sxs-lookup"><span data-stu-id="a3872-174">Minimum number of nodes</span></span> | <span data-ttu-id="a3872-175">2 por rol</span><span class="sxs-lookup"><span data-stu-id="a3872-175">2 per role</span></span> | <span data-ttu-id="a3872-176">5 por clúster, para implementaciones de producción</span><span class="sxs-lookup"><span data-stu-id="a3872-176">5 per cluster, for production deployments</span></span> |
| <span data-ttu-id="a3872-177">Administración de estados</span><span class="sxs-lookup"><span data-stu-id="a3872-177">State management</span></span> | <span data-ttu-id="a3872-178">Sin estado</span><span class="sxs-lookup"><span data-stu-id="a3872-178">Stateless</span></span> | <span data-ttu-id="a3872-179">Con o sin estado\*</span><span class="sxs-lookup"><span data-stu-id="a3872-179">Stateless or stateful\*</span></span> |
| <span data-ttu-id="a3872-180">Hospedaje</span><span class="sxs-lookup"><span data-stu-id="a3872-180">Hosting</span></span> | <span data-ttu-id="a3872-181">Azure</span><span class="sxs-lookup"><span data-stu-id="a3872-181">Azure</span></span> | <span data-ttu-id="a3872-182">En la nube o local</span><span class="sxs-lookup"><span data-stu-id="a3872-182">Cloud or on-premises</span></span> |
| <span data-ttu-id="a3872-183">Hospedaje web</span><span class="sxs-lookup"><span data-stu-id="a3872-183">Web hosting</span></span> | <span data-ttu-id="a3872-184">IIS**</span><span class="sxs-lookup"><span data-stu-id="a3872-184">IIS**</span></span> | <span data-ttu-id="a3872-185">Autohospedaje</span><span class="sxs-lookup"><span data-stu-id="a3872-185">Self-hosting</span></span> |
| <span data-ttu-id="a3872-186">Modelo de implementación</span><span class="sxs-lookup"><span data-stu-id="a3872-186">Deployment model</span></span> | <span data-ttu-id="a3872-187">[Modelo de implementación clásica][azure-deployment-models]</span><span class="sxs-lookup"><span data-stu-id="a3872-187">[Classic deployment model][azure-deployment-models]</span></span> | <span data-ttu-id="a3872-188">[Resource Manager][azure-deployment-models]</span><span class="sxs-lookup"><span data-stu-id="a3872-188">[Resource Manager][azure-deployment-models]</span></span>  |
| <span data-ttu-id="a3872-189">Packaging</span><span class="sxs-lookup"><span data-stu-id="a3872-189">Packaging</span></span> | <span data-ttu-id="a3872-190">Archivos de paquete de servicios en la nube (.cspkg)</span><span class="sxs-lookup"><span data-stu-id="a3872-190">Cloud service package files (.cspkg)</span></span> | <span data-ttu-id="a3872-191">Paquetes de aplicaciones y servicios</span><span class="sxs-lookup"><span data-stu-id="a3872-191">Application and service packages</span></span> |
| <span data-ttu-id="a3872-192">Actualización de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="a3872-192">Application update</span></span> | <span data-ttu-id="a3872-193">Intercambio de VIP o actualización gradual</span><span class="sxs-lookup"><span data-stu-id="a3872-193">VIP swap or rolling update</span></span> | <span data-ttu-id="a3872-194">Actualización gradual</span><span class="sxs-lookup"><span data-stu-id="a3872-194">Rolling update</span></span> |
| <span data-ttu-id="a3872-195">Escalado automático</span><span class="sxs-lookup"><span data-stu-id="a3872-195">Auto-scaling</span></span> | <span data-ttu-id="a3872-196">[Servicio integrado][cloud-service-autoscale]</span><span class="sxs-lookup"><span data-stu-id="a3872-196">[Built-in service][cloud-service-autoscale]</span></span> | <span data-ttu-id="a3872-197">Conjuntos de escalado de máquinas virtuales para la escalabilidad horizontal automática</span><span class="sxs-lookup"><span data-stu-id="a3872-197">VM Scale Sets for auto scale out</span></span> |
| <span data-ttu-id="a3872-198">Depuración</span><span class="sxs-lookup"><span data-stu-id="a3872-198">Debugging</span></span> | <span data-ttu-id="a3872-199">Emulador local</span><span class="sxs-lookup"><span data-stu-id="a3872-199">Local emulator</span></span> | <span data-ttu-id="a3872-200">Clúster local</span><span class="sxs-lookup"><span data-stu-id="a3872-200">Local cluster</span></span> |


<span data-ttu-id="a3872-201">\* Los servicios con estado usan [colecciones confiables][sf-reliable-collections] para almacenar el estado entre réplicas, de modo que todas las lecturas sean locales para los nodos del clúster.</span><span class="sxs-lookup"><span data-stu-id="a3872-201">\* Stateful services use [reliable collections][sf-reliable-collections] to store state across replicas, so that all reads are local to the nodes in the cluster.</span></span> <span data-ttu-id="a3872-202">Las escrituras se replican entre los nodos para mejorar la confiabilidad.</span><span class="sxs-lookup"><span data-stu-id="a3872-202">Writes are replicated across nodes for reliability.</span></span> <span data-ttu-id="a3872-203">Los servicios sin estado pueden tener un estado externo, bien con una base de datos u otro almacenamiento externo.</span><span class="sxs-lookup"><span data-stu-id="a3872-203">Stateless services can have external state, using a database or other external storage.</span></span>

<span data-ttu-id="a3872-204">** Los roles de trabajo también pueden autohospedar ASP.NET Web API mediante OWIN.</span><span class="sxs-lookup"><span data-stu-id="a3872-204">** Worker roles can also self-host ASP.NET Web API using OWIN.</span></span>

## <a name="the-surveys-application-on-cloud-services"></a><span data-ttu-id="a3872-205">Aplicación Surveys en Cloud Services</span><span class="sxs-lookup"><span data-stu-id="a3872-205">The Surveys application on Cloud Services</span></span>

<span data-ttu-id="a3872-206">El siguiente diagrama muestra la arquitectura de la aplicación Surveys que se ejecuta en Cloud Services.</span><span class="sxs-lookup"><span data-stu-id="a3872-206">The following diagram shows the architecture of the Surveys application running on Cloud Services.</span></span> 

![](./images/tailspin01.png)

<span data-ttu-id="a3872-207">La aplicación consta de dos roles web y un rol de trabajo.</span><span class="sxs-lookup"><span data-stu-id="a3872-207">The application consists of two web roles and a worker role.</span></span>

- <span data-ttu-id="a3872-208">El rol web **Tailspin.Web** hospeda un sitio web de ASP.NET que los clientes de Tailspin usan para crear y administrar encuestas.</span><span class="sxs-lookup"><span data-stu-id="a3872-208">The **Tailspin.Web** web role hosts an ASP.NET website that Tailspin customers use to create and manage surveys.</span></span> <span data-ttu-id="a3872-209">Los clientes también usan este sitio web para registrarse en la aplicación y administrar sus suscripciones.</span><span class="sxs-lookup"><span data-stu-id="a3872-209">Customers also use this website to sign up for the application and manage their subscriptions.</span></span> <span data-ttu-id="a3872-210">Por último, los administradores de Tailspin pueden usarlo para ver la lista de los inquilinos y administrar sus datos.</span><span class="sxs-lookup"><span data-stu-id="a3872-210">Finally, Tailspin administrators can use it to see the list of tenants and manage tenant data.</span></span> 

- <span data-ttu-id="a3872-211">El rol web **Tailspin.Web.Survey.Public** hospeda un sitio web de ASP.NET de donde los usuarios pueden extraer las encuestas que publican los clientes de Tailspin.</span><span class="sxs-lookup"><span data-stu-id="a3872-211">The **Tailspin.Web.Survey.Public** web role hosts an ASP.NET website where people can take the surveys that Tailspin customers publish.</span></span> 

- <span data-ttu-id="a3872-212">El rol de trabajo **Tailspin.Workers.Survey** realiza el procesamiento en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="a3872-212">The **Tailspin.Workers.Survey** worker role does background processing.</span></span> <span data-ttu-id="a3872-213">Los roles web colocan los elementos de trabajo en una cola y el rol de trabajo procesa los elementos.</span><span class="sxs-lookup"><span data-stu-id="a3872-213">The web roles put work items onto a queue, and the worker role processes the items.</span></span> <span data-ttu-id="a3872-214">Se definen dos tareas en segundo plano: exportación de las respuestas de las encuestas a Azure SQL Database y cálculo de las estadísticas de las respuestas de las encuestas.</span><span class="sxs-lookup"><span data-stu-id="a3872-214">Two background tasks are defined: Exporting survey answers to Azure SQL Database, and calculating statistics for survey answers.</span></span>

<span data-ttu-id="a3872-215">Además de Cloud Services, la aplicación Surveys usa otros servicios de Azure:</span><span class="sxs-lookup"><span data-stu-id="a3872-215">In addition to Cloud Services, the Surveys application uses some other Azure services:</span></span>

- <span data-ttu-id="a3872-216">**Azure Storage** para almacenar encuestas, respuestas de encuestas e información de los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="a3872-216">**Azure Storage** to store surveys, surveys answers, and tenant information.</span></span>

- <span data-ttu-id="a3872-217">**Azure Redis Cache** para almacenar en caché algunos de los datos que se almacenan en Azure Storage, a fin de acelerar el acceso de lectura.</span><span class="sxs-lookup"><span data-stu-id="a3872-217">**Azure Redis Cache** to cache some of the data that is stored in Azure Storage, for faster read access.</span></span> 

- <span data-ttu-id="a3872-218">**Azure Active Directory** (Azure AD) para autenticar clientes y administradores de Tailspin.</span><span class="sxs-lookup"><span data-stu-id="a3872-218">**Azure Active Directory** (Azure AD) to authenticate customers and Tailspin administrators.</span></span>

- <span data-ttu-id="a3872-219">**Azure SQL Database** para almacenar las respuestas de las encuestas para el análisis.</span><span class="sxs-lookup"><span data-stu-id="a3872-219">**Azure SQL Database** to store the survey answers for analysis.</span></span> 

## <a name="moving-to-service-fabric"></a><span data-ttu-id="a3872-220">Migración a Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a3872-220">Moving to Service Fabric</span></span>

<span data-ttu-id="a3872-221">Como ya mencioné, el objetivo de esta fase era la migración a Service Fabric con los mínimos cambios necesarios.</span><span class="sxs-lookup"><span data-stu-id="a3872-221">As mentioned, the goal of this phase was migrating to Service Fabric with the minimum necessary changes.</span></span> <span data-ttu-id="a3872-222">Con ese fin, creamos servicios sin estado correspondientes a cada rol de servicio en la nube en la aplicación original:</span><span class="sxs-lookup"><span data-stu-id="a3872-222">To that end, we created stateless services corresponding to each cloud service role in the original application:</span></span>

![](./images/tailspin02.png)

<span data-ttu-id="a3872-223">De forma intencionada, esta arquitectura es muy similar a la aplicación original.</span><span class="sxs-lookup"><span data-stu-id="a3872-223">Intentionally, this architecture is very similar to the original application.</span></span> <span data-ttu-id="a3872-224">Sin embargo, el diagrama oculta algunas diferencias importantes.</span><span class="sxs-lookup"><span data-stu-id="a3872-224">However, the diagram hides some important differences.</span></span> <span data-ttu-id="a3872-225">En el resto de este artículo, exploraremos esas diferencias.</span><span class="sxs-lookup"><span data-stu-id="a3872-225">In the rest of this article, we'll explore those differences.</span></span> 


## <a name="converting-the-cloud-service-roles-to-services"></a><span data-ttu-id="a3872-226">Conversión de roles de servicio en la nube en servicios</span><span class="sxs-lookup"><span data-stu-id="a3872-226">Converting the cloud service roles to services</span></span>

<span data-ttu-id="a3872-227">Como ya mencioné, migramos cada uno de los roles de servicio en la nube a un servicio de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-227">As mentioned, we migrated each cloud service role to a Service Fabric service.</span></span> <span data-ttu-id="a3872-228">Dado que los roles de servicio en la nube no tienen estado, para esta fase tenía sentido crear servicios sin estado en Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-228">Because cloud service roles are stateless, for this phase it made sense to create stateless services in Service Fabric.</span></span> 

<span data-ttu-id="a3872-229">Para la migración, seguimos los pasos descritos en [Guía de conversión de roles web y de trabajo a servicios sin estado de Service Fabric][sf-migration].</span><span class="sxs-lookup"><span data-stu-id="a3872-229">For the migration, we followed the steps outlined in [Guide to converting Web and Worker Roles to Service Fabric stateless services][sf-migration].</span></span> 

### <a name="creating-the-web-front-end-services"></a><span data-ttu-id="a3872-230">Creación de servicios front-end web</span><span class="sxs-lookup"><span data-stu-id="a3872-230">Creating the web front-end services</span></span>

<span data-ttu-id="a3872-231">En Service Fabric, un servicio se ejecuta dentro de un proceso creado por el tiempo de ejecución de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-231">In Service Fabric, a service runs inside a process created by the Service Fabric runtime.</span></span> <span data-ttu-id="a3872-232">Para un front-end web, eso significa que el servicio no se está ejecutando en IIS.</span><span class="sxs-lookup"><span data-stu-id="a3872-232">For a web front end, that means the service is not running inside IIS.</span></span> <span data-ttu-id="a3872-233">En su lugar, el servicio debe hospedar un servidor web.</span><span class="sxs-lookup"><span data-stu-id="a3872-233">Instead, the service must host a web server.</span></span> <span data-ttu-id="a3872-234">Este enfoque se denomina *autohospedaje*, porque el código que se ejecuta en el proceso actúa como el host del servidor web.</span><span class="sxs-lookup"><span data-stu-id="a3872-234">This approach is called *self-hosting*, because the code that runs inside the process acts as the web server host.</span></span> 

<span data-ttu-id="a3872-235">El requisito de autohospedaje significa que un servicio de Service Fabric no puede usar ASP.NET MVC ni Web Forms de ASP.NET, porque esos marcos requieren IIS y no admiten el autohospedaje.</span><span class="sxs-lookup"><span data-stu-id="a3872-235">The requirement to self-host means that a Service Fabric service can't use ASP.NET MVC or ASP.NET Web Forms, because those frameworks require IIS and do not support self-hosting.</span></span> <span data-ttu-id="a3872-236">Las opciones de autohospedaje incluyen:</span><span class="sxs-lookup"><span data-stu-id="a3872-236">Options for self-hosting include:</span></span>

- <span data-ttu-id="a3872-237">[ASP.NET Core][aspnet-core], autohospedado mediante el servidor web [Kestrel][kestrel].</span><span class="sxs-lookup"><span data-stu-id="a3872-237">[ASP.NET Core][aspnet-core], self-hosted using the [Kestrel][kestrel] web server.</span></span> 
- <span data-ttu-id="a3872-238">[ASP.NET Web API][aspnet-webapi], autohospedado mediante [OWIN][owin].</span><span class="sxs-lookup"><span data-stu-id="a3872-238">[ASP.NET Web API][aspnet-webapi], self-hosted using [OWIN][owin].</span></span>
- <span data-ttu-id="a3872-239">Marcos de terceros, como [Nancy](http://nancyfx.org/).</span><span class="sxs-lookup"><span data-stu-id="a3872-239">Third-party frameworks such as [Nancy](http://nancyfx.org/).</span></span>

<span data-ttu-id="a3872-240">La aplicación Surveys original usa ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="a3872-240">The original Surveys application uses ASP.NET MVC.</span></span> <span data-ttu-id="a3872-241">Dado que ASP.NET MVC no se puede autohospedar en Service Fabric, consideramos las siguientes opciones de migración:</span><span class="sxs-lookup"><span data-stu-id="a3872-241">Because ASP.NET MVC cannot be self-hosted in Service Fabric, we considered the following migration options:</span></span>

- <span data-ttu-id="a3872-242">Migre los roles web a ASP.NET Core, que puede autohospedarse.</span><span class="sxs-lookup"><span data-stu-id="a3872-242">Port the web roles to ASP.NET Core, which can be self-hosted.</span></span>
- <span data-ttu-id="a3872-243">Convierta el sitio web en una aplicación de una sola página (SPA) que llame a una API web implementada mediante ASP.NET Web API.</span><span class="sxs-lookup"><span data-stu-id="a3872-243">Convert the web site into a single-page application (SPA) that calls a web API implemented using ASP.NET Web API.</span></span> <span data-ttu-id="a3872-244">Esto habría requerido volver a diseñar completamente el front-end web.</span><span class="sxs-lookup"><span data-stu-id="a3872-244">This would have required a complete redesign of the web front end.</span></span>
- <span data-ttu-id="a3872-245">Mantenga el código existente de ASP.NET MVC e implemente IIS en un contenedor de Windows Server para Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-245">Keep the existing ASP.NET MVC code and deploy IIS in a Windows Server container to Service Fabric.</span></span> <span data-ttu-id="a3872-246">Este enfoque requeriría pocos cambios en el código o ninguno.</span><span class="sxs-lookup"><span data-stu-id="a3872-246">This approach would require little or no code change.</span></span> <span data-ttu-id="a3872-247">Sin embargo, la [compatibilidad con contenedores][sf-containers] de Service Fabric está todavía en versión preliminar.</span><span class="sxs-lookup"><span data-stu-id="a3872-247">However, [container support][sf-containers] in Service Fabric is currently still in preview.</span></span>

<span data-ttu-id="a3872-248">En función de estas consideraciones, seleccionamos la primera opción, migrar a ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="a3872-248">Based on these considerations, we selected the first option, porting to ASP.NET Core.</span></span> <span data-ttu-id="a3872-249">Para ello, seguimos los pasos descritos en [Migrating From ASP.NET MVC to ASP.NET Core MVC][aspnet-migration] (Migración de ASP.NET MVC a ASP.NET Core MVC).</span><span class="sxs-lookup"><span data-stu-id="a3872-249">To do so, we followed the steps described in [Migrating From ASP.NET MVC to ASP.NET Core MVC][aspnet-migration].</span></span> 

> [!NOTE]
> <span data-ttu-id="a3872-250">Por motivos de seguridad, al usar ASP.NET Core con Kestrel, debe colocar a un proxy inverso delante de Kestrel para controlar el tráfico de Internet.</span><span class="sxs-lookup"><span data-stu-id="a3872-250">When using ASP.NET Core with Kestrel, you should place a reverse proxy in front of Kestrel to handle traffic from the Internet, for security reasons.</span></span> <span data-ttu-id="a3872-251">Para obtener más información, consulte [Kestrel web server implementation in ASP.NET Core][kestrel] (Implementación del servidor web Kestrel en ASP.NET Core).</span><span class="sxs-lookup"><span data-stu-id="a3872-251">For more information, see [Kestrel web server implementation in ASP.NET Core][kestrel].</span></span> <span data-ttu-id="a3872-252">En la sección [Implementación de la aplicación](#deploying-the-application) se describe una implementación de Azure recomendada.</span><span class="sxs-lookup"><span data-stu-id="a3872-252">The section [Deploying the application](#deploying-the-application) describes a recommended Azure deployment.</span></span>

### <a name="http-listeners"></a><span data-ttu-id="a3872-253">Agentes de escucha HTTP</span><span class="sxs-lookup"><span data-stu-id="a3872-253">HTTP listeners</span></span>

<span data-ttu-id="a3872-254">En Cloud Services, un rol web o de trabajo declara un punto de conexión HTTP en el [archivo de definición de servicio][cloud-service-endpoints] para su exposición.</span><span class="sxs-lookup"><span data-stu-id="a3872-254">In Cloud Services, a web or worker role exposes an HTTP endpoint by declaring it in the [service definition file][cloud-service-endpoints].</span></span> <span data-ttu-id="a3872-255">El rol web de tener, al menos, un punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="a3872-255">A web role must have at least one endpoint.</span></span>

```xml
<!-- Cloud service endpoint -->
<Endpoints>
    <InputEndpoint name="HttpIn" protocol="http" port="80" />
</Endpoints>
```

<span data-ttu-id="a3872-256">De igual forma, los puntos de conexión de Service Fabric se declaran en un manifiesto de servicio:</span><span class="sxs-lookup"><span data-stu-id="a3872-256">Similarly, Service Fabric endpoints are declared in a service manifest:</span></span> 

```xml
<!-- Service Fabric endpoint -->
<Endpoints>
    <Endpoint Protocol="http" Name="ServiceEndpoint" Type="Input" Port="8002" />
</Endpoints>
```

<span data-ttu-id="a3872-257">Sin embargo, a diferencia de un rol de servicio en la nube, los servicios de Service Fabric pueden colocarse en el mismo nodo.</span><span class="sxs-lookup"><span data-stu-id="a3872-257">Unlike a cloud service role, however, Service Fabric services can be co-located within the same node.</span></span> <span data-ttu-id="a3872-258">Por lo tanto, cada servicio debe escuchar en un puerto distinto.</span><span class="sxs-lookup"><span data-stu-id="a3872-258">Therefore, every service must listen on a distinct port.</span></span> <span data-ttu-id="a3872-259">Más adelante en este artículo, analizaremos cómo se enrutan las solicitudes de cliente en el puerto 80 o el puerto 443 al puerto correcto del servicio.</span><span class="sxs-lookup"><span data-stu-id="a3872-259">Later in this article, we'll discuss how client requests on port 80 or port 443 get routed to the correct port for the service.</span></span>

<span data-ttu-id="a3872-260">Un servicio debe crear explícitamente los agentes de escucha para cada punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="a3872-260">A service must explicitly create listeners for each endpoint.</span></span> <span data-ttu-id="a3872-261">La razón es que Service Fabric es agnóstico en cuanto a las pilas de comunicación.</span><span class="sxs-lookup"><span data-stu-id="a3872-261">The reason is that Service Fabric is agnostic about communication stacks.</span></span> <span data-ttu-id="a3872-262">Para obtener más información, consulte [Creación de un front-end de servicio web para una aplicación mediante ASP.NET Core][sf-aspnet-core].</span><span class="sxs-lookup"><span data-stu-id="a3872-262">For more information, see [Build a web service front end for your application using ASP.NET Core][sf-aspnet-core].</span></span>

## <a name="packaging-and-configuration"></a><span data-ttu-id="a3872-263">Empaquetado y configuración</span><span class="sxs-lookup"><span data-stu-id="a3872-263">Packaging and configuration</span></span>

 <span data-ttu-id="a3872-264">Un servicio en la nube contiene los archivos de paquete y de configuración siguientes:</span><span class="sxs-lookup"><span data-stu-id="a3872-264">A cloud service contains the following configuration and package files:</span></span>

| <span data-ttu-id="a3872-265">Archivo</span><span class="sxs-lookup"><span data-stu-id="a3872-265">File</span></span> | <span data-ttu-id="a3872-266">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="a3872-266">Description</span></span> |
|------|-------------|
| <span data-ttu-id="a3872-267">Definición de servicio (.csdef)</span><span class="sxs-lookup"><span data-stu-id="a3872-267">Service definition (.csdef)</span></span> | <span data-ttu-id="a3872-268">Configuración que usa Azure para configurar el servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="a3872-268">Settings used by Azure to configure the cloud service.</span></span> <span data-ttu-id="a3872-269">Define los roles, los puntos de conexión, las tareas de inicio y los nombres de los valores de configuración.</span><span class="sxs-lookup"><span data-stu-id="a3872-269">Defines the roles, endpoints, startup tasks, and the names of configuration settings.</span></span> |
| <span data-ttu-id="a3872-270">Configuración del servicio (.cscfg)</span><span class="sxs-lookup"><span data-stu-id="a3872-270">Service configuration (.cscfg)</span></span> | <span data-ttu-id="a3872-271">Configuración por implementación, incluido el número de instancias de rol, los números de puerto de los puntos de conexión y los valores de configuración.</span><span class="sxs-lookup"><span data-stu-id="a3872-271">Per-deployment settings, including the number of role instances, endpoint port numbers, and the values of configuration settings.</span></span> 
| <span data-ttu-id="a3872-272">Paquete de servicio (.cspkg)</span><span class="sxs-lookup"><span data-stu-id="a3872-272">Service package (.cspkg)</span></span> | <span data-ttu-id="a3872-273">Contiene el código y las configuraciones de la aplicación, así como el archivo de definición de servicio.</span><span class="sxs-lookup"><span data-stu-id="a3872-273">Contains the application code and configurations, and the service definition file.</span></span>  |

<span data-ttu-id="a3872-274">Hay un archivo .csdef para toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a3872-274">There is one .csdef file for the entire application.</span></span> <span data-ttu-id="a3872-275">Puede tener varios archivos .cscfg para diferentes entornos, como local, de prueba y de producción.</span><span class="sxs-lookup"><span data-stu-id="a3872-275">You can have multiple .cscfg files for different environments, such as local, test, or production.</span></span> <span data-ttu-id="a3872-276">Cuando el servicio se está ejecutando, puede actualizar el archivo .cscfg, pero no el archivo .csdef.</span><span class="sxs-lookup"><span data-stu-id="a3872-276">When the service is running, you can update the .cscfg but not the .csdef.</span></span> <span data-ttu-id="a3872-277">Para obtener más información, consulte [¿Qué es el modelo de servicio en la nube y cómo se empaqueta?][cloud-service-config]</span><span class="sxs-lookup"><span data-stu-id="a3872-277">For more information, see [What is the Cloud Service model and how do I package it?][cloud-service-config]</span></span>

<span data-ttu-id="a3872-278">Service Fabric tiene una división similar entre la *definición* de servicio y la *configuración* de servicio, pero la estructura más granular.</span><span class="sxs-lookup"><span data-stu-id="a3872-278">Service Fabric has a similar division between a service *definition* and service *settings*, but the structure is more granular.</span></span> <span data-ttu-id="a3872-279">Para entender el modelo de configuración de Service Fabric, resulta útil comprender cómo se empaqueta una aplicación de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-279">To understand Service Fabric's configuration model, it helps to understand how a Service Fabric application is packaged.</span></span> <span data-ttu-id="a3872-280">La estructura es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="a3872-280">Here is the structure:</span></span>

```
Application package
  - Service packages
    - Code package
    - Configuration package
    - Data package (optional)
```

<span data-ttu-id="a3872-281">El paquete de aplicación es lo que se implementa.</span><span class="sxs-lookup"><span data-stu-id="a3872-281">The application package is what you deploy.</span></span> <span data-ttu-id="a3872-282">Contiene uno o varios paquetes de servicio.</span><span class="sxs-lookup"><span data-stu-id="a3872-282">It contains one or more service packages.</span></span> <span data-ttu-id="a3872-283">Un paquete de servicio contiene paquetes de código, configuración y datos.</span><span class="sxs-lookup"><span data-stu-id="a3872-283">A service package contains code, configuration, and data packages.</span></span> <span data-ttu-id="a3872-284">El paquete de código contiene los archivos binarios de los servicios y el paquete de configuración contiene las opciones de configuración.</span><span class="sxs-lookup"><span data-stu-id="a3872-284">The code package contains the binaries for the services, and the configuration package contains configuration settings.</span></span> <span data-ttu-id="a3872-285">Este modelo permite actualizar servicios individuales sin tener que volver a implementar toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a3872-285">This model allows you to upgrade individual services without redeploying the entire application.</span></span> <span data-ttu-id="a3872-286">También permite actualizar solo los valores de configuración, sin tener que volver a implementar el código o reiniciar el servicio.</span><span class="sxs-lookup"><span data-stu-id="a3872-286">It also lets you update just the configuration settings, without redeploying the code or restarting the service.</span></span>

<span data-ttu-id="a3872-287">Una aplicación de Service Fabric contiene los archivos de configuración siguientes:</span><span class="sxs-lookup"><span data-stu-id="a3872-287">A Service Fabric application contains the following configuration files:</span></span>

| <span data-ttu-id="a3872-288">Archivo</span><span class="sxs-lookup"><span data-stu-id="a3872-288">File</span></span> | <span data-ttu-id="a3872-289">La ubicación</span><span class="sxs-lookup"><span data-stu-id="a3872-289">Location</span></span> | <span data-ttu-id="a3872-290">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="a3872-290">Description</span></span> |
|------|----------|-------------|
| <span data-ttu-id="a3872-291">ApplicationManifest.xml</span><span class="sxs-lookup"><span data-stu-id="a3872-291">ApplicationManifest.xml</span></span> | <span data-ttu-id="a3872-292">Paquete de aplicación</span><span class="sxs-lookup"><span data-stu-id="a3872-292">Application package</span></span> | <span data-ttu-id="a3872-293">Define los servicios que componen la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a3872-293">Defines the services that compose the application.</span></span> |
| <span data-ttu-id="a3872-294">ServiceManifest.xml</span><span class="sxs-lookup"><span data-stu-id="a3872-294">ServiceManifest.xml</span></span> | <span data-ttu-id="a3872-295">Paquete de servicio</span><span class="sxs-lookup"><span data-stu-id="a3872-295">Service package</span></span>| <span data-ttu-id="a3872-296">Describe uno o varios servicios.</span><span class="sxs-lookup"><span data-stu-id="a3872-296">Describes one or more services.</span></span> |
| <span data-ttu-id="a3872-297">Settings.xml</span><span class="sxs-lookup"><span data-stu-id="a3872-297">Settings.xml</span></span> | <span data-ttu-id="a3872-298">Paquete de configuración</span><span class="sxs-lookup"><span data-stu-id="a3872-298">Configuration package</span></span> | <span data-ttu-id="a3872-299">Contiene los valores de configuración de los servicios definidos en el paquete de servicio.</span><span class="sxs-lookup"><span data-stu-id="a3872-299">Contains configuration settings for the services defined in the service package.</span></span> |

<span data-ttu-id="a3872-300">Para más información, consulte [Modelar una aplicación en Service Fabric][sf-application-model].</span><span class="sxs-lookup"><span data-stu-id="a3872-300">For more information, see [Model an application in Service Fabric][sf-application-model].</span></span>

<span data-ttu-id="a3872-301">Para admitir distintas opciones de configuración para varios entornos, emplee el siguiente enfoque, que se describe en [Administración de los parámetros de la aplicación en varios entornos][sf-multiple-environments]:</span><span class="sxs-lookup"><span data-stu-id="a3872-301">To support different configuration settings for multiple environments, use the following approach, described in [Manage application parameters for multiple environments][sf-multiple-environments]:</span></span>

1. <span data-ttu-id="a3872-302">Defina el valor de configuración en el archivo Setting.xml del servicio.</span><span class="sxs-lookup"><span data-stu-id="a3872-302">Define the setting in the Setting.xml file for the service.</span></span>
2. <span data-ttu-id="a3872-303">En el manifiesto de la aplicación, defina una invalidación para el valor de configuración.</span><span class="sxs-lookup"><span data-stu-id="a3872-303">In the application manifest, define an override for the setting.</span></span>
3. <span data-ttu-id="a3872-304">Coloque los valores de configuración específicos del entorno en archivos de parámetros de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a3872-304">Put environment-specific settings into application parameter files.</span></span>


## <a name="deploying-the-application"></a><span data-ttu-id="a3872-305">Implementación de la aplicación</span><span class="sxs-lookup"><span data-stu-id="a3872-305">Deploying the application</span></span>

<span data-ttu-id="a3872-306">Mientras que Azure Cloud Services es un servicio administrado, Service Fabric es un motor en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="a3872-306">Whereas Azure Cloud Services is a managed service, Service Fabric is a runtime.</span></span> <span data-ttu-id="a3872-307">Puede crear clústeres de Service Fabric en muchos entornos, incluido Azure y entornos locales.</span><span class="sxs-lookup"><span data-stu-id="a3872-307">You can create Service Fabric clusters in many environments, including Azure and on premises.</span></span> <span data-ttu-id="a3872-308">En este artículo, nos centramos en la implementación en Azure.</span><span class="sxs-lookup"><span data-stu-id="a3872-308">In this article, we focus on deploying to Azure.</span></span> 

<span data-ttu-id="a3872-309">En el diagrama siguiente se muestra una implementación recomendada:</span><span class="sxs-lookup"><span data-stu-id="a3872-309">The following diagram shows a recommended deployment:</span></span>

![](./images/tailspin-cluster.png)

<span data-ttu-id="a3872-310">El clúster de Service Fabric se implementa en un [conjunto de escalado de máquinas virtuales][vm-scale-sets].</span><span class="sxs-lookup"><span data-stu-id="a3872-310">The Service Fabric cluster is deployed to a [VM scale set][vm-scale-sets].</span></span> <span data-ttu-id="a3872-311">Los conjuntos de escalado de máquinas virtuales son un recurso de Azure Compute que se usa para implementar y administrar un conjunto de máquinas virtuales idénticas.</span><span class="sxs-lookup"><span data-stu-id="a3872-311">Scale sets are an Azure Compute resource that can be used to deploy and manage a set of identical VMs.</span></span> 

<span data-ttu-id="a3872-312">Como ya mencioné, el servidor web Kestrel requiere a un proxy inverso por motivos de seguridad.</span><span class="sxs-lookup"><span data-stu-id="a3872-312">As mentioned, the Kestrel web server requires a reverse proxy for security reasons.</span></span> <span data-ttu-id="a3872-313">Este diagrama muestra [Azure Application Gateway][application-gateway], que es un servicio de Azure que ofrece distintas funcionalidades de equilibrio de carga de capa 7.</span><span class="sxs-lookup"><span data-stu-id="a3872-313">This diagram shows [Azure Application Gateway][application-gateway], which is an Azure service that offers various layer 7 load balancing capabilities.</span></span> <span data-ttu-id="a3872-314">Actúa como un servicio de proxy inverso, que termina la conexión de cliente y reenvía las solicitudes de vuelta a los puntos de conexión de back-end.</span><span class="sxs-lookup"><span data-stu-id="a3872-314">It acts as a reverse-proxy service, terminating the client connection and forwarding requests to back-end endpoints.</span></span> <span data-ttu-id="a3872-315">Puede usar una solución de proxy inverso diferente, como nginx.</span><span class="sxs-lookup"><span data-stu-id="a3872-315">You might use a different reverse proxy solution, such as nginx.</span></span>  

### <a name="layer-7-routing"></a><span data-ttu-id="a3872-316">Enrutamiento de capa 7</span><span class="sxs-lookup"><span data-stu-id="a3872-316">Layer 7 routing</span></span>

<span data-ttu-id="a3872-317">En la [aplicación Surveys original](https://msdn.microsoft.com/library/hh534477.aspx#sec21), un rol web escuchaba en el puerto 80 y el otro, en el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="a3872-317">In the [original Surveys application](https://msdn.microsoft.com/library/hh534477.aspx#sec21), one web role listened on port 80, and the other web role listened on port 443.</span></span> 

| <span data-ttu-id="a3872-318">Sitio público</span><span class="sxs-lookup"><span data-stu-id="a3872-318">Public site</span></span> | <span data-ttu-id="a3872-319">Sitio de administración de encuestas</span><span class="sxs-lookup"><span data-stu-id="a3872-319">Survey management site</span></span> |
|-------------|------------------------|
| `http://tailspin.cloudapp.net` | `https://tailspin.cloudapp.net` |

<span data-ttu-id="a3872-320">Otra opción es usar el enrutamiento de capa 7.</span><span class="sxs-lookup"><span data-stu-id="a3872-320">Another option is to use layer 7 routing.</span></span> <span data-ttu-id="a3872-321">En este enfoque, las distintas rutas de dirección URL se enrutan a números de puerto diferentes en el back-end.</span><span class="sxs-lookup"><span data-stu-id="a3872-321">In this approach, different URL paths get routed to different port numbers on the back end.</span></span> <span data-ttu-id="a3872-322">Por ejemplo, el sitio público podría usar rutas de dirección URL que empiecen por `/public/`.</span><span class="sxs-lookup"><span data-stu-id="a3872-322">For example, the public site might use URL paths starting with `/public/`.</span></span> 

<span data-ttu-id="a3872-323">Las opciones para el enrutamiento de capa 7 incluyen:</span><span class="sxs-lookup"><span data-stu-id="a3872-323">Options for layer 7 routing include:</span></span>

- <span data-ttu-id="a3872-324">Usar Application Gateway.</span><span class="sxs-lookup"><span data-stu-id="a3872-324">Use Application Gateway.</span></span> 

- <span data-ttu-id="a3872-325">Usar un dispositivo virtual de red (NVA), como nginx.</span><span class="sxs-lookup"><span data-stu-id="a3872-325">Use a network virtual appliance (NVA), such as nginx.</span></span>

- <span data-ttu-id="a3872-326">Escribir una puerta de enlace personalizada como un servicio sin estado.</span><span class="sxs-lookup"><span data-stu-id="a3872-326">Write a custom gateway as a stateless service.</span></span>

<span data-ttu-id="a3872-327">Tenga en cuenta este enfoque si tiene dos o más servicios con puntos de conexión HTTP públicos, pero quiere que aparezcan como un sitio con un nombre de dominio único.</span><span class="sxs-lookup"><span data-stu-id="a3872-327">Consider this approach if you have two or more services with public HTTP endpoints, but want them to appear as one site with a single domain name.</span></span>

> <span data-ttu-id="a3872-328">Un enfoque que *no* se recomienda es permitir que los clientes externos envíen solicitudes a través del [proxy inverso][sf-reverse-proxy] de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-328">One approach that we *don't* recommend is allowing external clients to send requests through the Service Fabric [reverse proxy][sf-reverse-proxy].</span></span> <span data-ttu-id="a3872-329">Aunque esto es posible, el proxy inverso está destinado a la comunicación entre servicios.</span><span class="sxs-lookup"><span data-stu-id="a3872-329">Although this is possible, the reverse proxy is intended for service-to-service communication.</span></span> <span data-ttu-id="a3872-330">Abrirlo a clientes externos expondría *cualquier* servicio que se ejecute en el clúster con un punto de conexión HTTP.</span><span class="sxs-lookup"><span data-stu-id="a3872-330">Opening it to external clients exposes *any* service running in the cluster that has an HTTP endpoint.</span></span>

### <a name="node-types-and-placement-constraints"></a><span data-ttu-id="a3872-331">Restricciones de colocación y tipos de nodo</span><span class="sxs-lookup"><span data-stu-id="a3872-331">Node types and placement constraints</span></span>

<span data-ttu-id="a3872-332">En la implementación anterior, todos los servicios se ejecutan en todos los nodos.</span><span class="sxs-lookup"><span data-stu-id="a3872-332">In the deployment shown above, all the services run on all the nodes.</span></span> <span data-ttu-id="a3872-333">Sin embargo, también puede agrupar los servicios, para que determinados servicios se ejecuten solo en determinados nodos en el clúster.</span><span class="sxs-lookup"><span data-stu-id="a3872-333">However, you can also group services, so that certain services run only on particular nodes within the cluster.</span></span> <span data-ttu-id="a3872-334">Los motivos para usar este enfoque incluyen:</span><span class="sxs-lookup"><span data-stu-id="a3872-334">Reasons to use this approach include:</span></span>

- <span data-ttu-id="a3872-335">Ejecutar algunos servicios en distintos tipos de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a3872-335">Run some services on different VM types.</span></span> <span data-ttu-id="a3872-336">Por ejemplo, algunos servicios podrían ejecutar procesos intensivos o requerir unidades GPU.</span><span class="sxs-lookup"><span data-stu-id="a3872-336">For example, some services might be compute-intensive or require GPUs.</span></span> <span data-ttu-id="a3872-337">Puede tener una combinación de tipos de máquinas virtuales en el clúster de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-337">You can have a mix of VM types in your Service Fabric cluster.</span></span>
- <span data-ttu-id="a3872-338">Aislar servicios front-end de servicios back-end por motivos de seguridad.</span><span class="sxs-lookup"><span data-stu-id="a3872-338">Isolate front-end services from back-end services, for security reasons.</span></span> <span data-ttu-id="a3872-339">Todos los servicios front-end se ejecutarán en un conjunto de nodos y los servicios back-end se ejecutarán en nodos diferentes del mismo clúster.</span><span class="sxs-lookup"><span data-stu-id="a3872-339">All the front-end services will run on one set of nodes, and the back-end services will run on different nodes in the same cluster.</span></span>
- <span data-ttu-id="a3872-340">Requisitos de escala diferentes.</span><span class="sxs-lookup"><span data-stu-id="a3872-340">Different scale requirements.</span></span> <span data-ttu-id="a3872-341">Es posible que algunos servicios tengan que ejecutarse en más nodos que otros.</span><span class="sxs-lookup"><span data-stu-id="a3872-341">Some services might need to run on more nodes than other services.</span></span> <span data-ttu-id="a3872-342">Por ejemplo, si define nodos front-end y nodos back-end, cada conjunto se puede escalar de manera independiente.</span><span class="sxs-lookup"><span data-stu-id="a3872-342">For example, if you define front-end nodes and back-end nodes, each set can be scaled independently.</span></span>

<span data-ttu-id="a3872-343">El siguiente diagrama muestra un clúster que separa los servicios front-end y back-end:</span><span class="sxs-lookup"><span data-stu-id="a3872-343">The following diagram shows a cluster that separates front-end and back-end services:</span></span>

![](././images/node-placement.png)

<span data-ttu-id="a3872-344">Para implementar este enfoque:</span><span class="sxs-lookup"><span data-stu-id="a3872-344">To implement this approach:</span></span>

1.  <span data-ttu-id="a3872-345">Al crear el clúster, defina dos o más tipos de nodo.</span><span class="sxs-lookup"><span data-stu-id="a3872-345">When you create the cluster, define two or more node types.</span></span> 
2.  <span data-ttu-id="a3872-346">Para cada servicio, use [restricciones de colocación][sf-placement-constraints] para asignar el servicio a un tipo de nodo.</span><span class="sxs-lookup"><span data-stu-id="a3872-346">For each service, use [placement constraints][sf-placement-constraints] to assign the service to a node type.</span></span>

<span data-ttu-id="a3872-347">Al realizar la implementación en Azure, cada tipo de nodo se implementa en un conjunto de escalado de máquinas virtuales independiente.</span><span class="sxs-lookup"><span data-stu-id="a3872-347">When you deploy to Azure, each node type is deployed to a separate VM scale set.</span></span> <span data-ttu-id="a3872-348">El clúster de Service Fabric abarca todos los tipos de nodo.</span><span class="sxs-lookup"><span data-stu-id="a3872-348">The Service Fabric cluster spans all node types.</span></span> <span data-ttu-id="a3872-349">Para obtener más información, consulte [Relación entre los tipos de nodos de Service Fabric y los conjuntos de escalado de máquinas virtuales][sf-node-types].</span><span class="sxs-lookup"><span data-stu-id="a3872-349">For more information, see [The relationship between Service Fabric node types and Virtual Machine Scale Sets][sf-node-types].</span></span>

> <span data-ttu-id="a3872-350">Si un clúster tiene varios tipos de nodo, un tipo de nodo se designa como el tipo de nodo *principal*.</span><span class="sxs-lookup"><span data-stu-id="a3872-350">If a cluster has multiple node types, one node type is designated as the *primary* node type.</span></span> <span data-ttu-id="a3872-351">Los servicios de tiempo de ejecución de Service Fabric, como el servicio de administración del clúster, se ejecutan en el tipo de nodo principal.</span><span class="sxs-lookup"><span data-stu-id="a3872-351">Service Fabric runtime services, such as the Cluster Management Service, run on the primary node type.</span></span> <span data-ttu-id="a3872-352">Aprovisione al menos 5 nodos para el tipo de nodo principal en un entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="a3872-352">Provision at least 5 nodes for the primary node type in a production environment.</span></span> <span data-ttu-id="a3872-353">El otro tipo de nodo debe tener al menos 2 nodos.</span><span class="sxs-lookup"><span data-stu-id="a3872-353">The other node type should have at least 2 nodes.</span></span>

## <a name="configuring-and-managing-the-cluster"></a><span data-ttu-id="a3872-354">Configuración y administración del clúster</span><span class="sxs-lookup"><span data-stu-id="a3872-354">Configuring and managing the cluster</span></span>

<span data-ttu-id="a3872-355">Para evitar que usuarios no autorizados se conecten a su clúster, los clústeres deben protegerse.</span><span class="sxs-lookup"><span data-stu-id="a3872-355">Clusters must be secured to prevent unauthorized users from connecting to your cluster.</span></span> <span data-ttu-id="a3872-356">Se recomienda usar Azure AD para autenticar clientes y certificados X.509 para la seguridad entre nodos.</span><span class="sxs-lookup"><span data-stu-id="a3872-356">It is recommended to use Azure AD to authenticate clients, and X.509 certificates for node-to-node security.</span></span> <span data-ttu-id="a3872-357">Para más información, consulte [Escenarios de seguridad de los clústeres de Service Fabric][sf-security].</span><span class="sxs-lookup"><span data-stu-id="a3872-357">For more information, see [Service Fabric cluster security scenarios][sf-security].</span></span>

<span data-ttu-id="a3872-358">Para configurar un punto de conexión HTTPS público, consulte [Especificación de recursos en un manifiesto de servicio][sf-manifest-resources].</span><span class="sxs-lookup"><span data-stu-id="a3872-358">To configure a public HTTPS endpoint, see [Specify resources in a service manifest][sf-manifest-resources].</span></span>

<span data-ttu-id="a3872-359">Puede escalar horizontalmente la aplicación mediante la adición de máquinas virtuales al clúster.</span><span class="sxs-lookup"><span data-stu-id="a3872-359">You can scale out the application by adding VMs to the cluster.</span></span> <span data-ttu-id="a3872-360">Los conjuntos de escalado de máquinas virtuales admiten el escalado automático mediante la aplicación de reglas de escalado automático basadas en contadores de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="a3872-360">VM scale sets support auto-scaling using auto-scale rules based on performance counters.</span></span> <span data-ttu-id="a3872-361">Para más información, consulte [Escalado o reducción horizontal de un clúster de Service Fabric usando reglas de escalado automático][sf-auto-scale].</span><span class="sxs-lookup"><span data-stu-id="a3872-361">For more information, see [Scale a Service Fabric cluster in or out using auto-scale rules][sf-auto-scale].</span></span>

<span data-ttu-id="a3872-362">Mientras el clúster se está ejecutando, debe recopilar registros de todos los nodos en una ubicación central.</span><span class="sxs-lookup"><span data-stu-id="a3872-362">While the cluster is running, you should collect logs from all the nodes in a central location.</span></span> <span data-ttu-id="a3872-363">Para más información, consulte [Collect logs by using Azure Diagnostics][sf-logs] (Recopilar registros con Azure Diagnostics).</span><span class="sxs-lookup"><span data-stu-id="a3872-363">For more information, see [Collect logs by using Azure Diagnostics][sf-logs].</span></span>   


## <a name="conclusion"></a><span data-ttu-id="a3872-364">Conclusión</span><span class="sxs-lookup"><span data-stu-id="a3872-364">Conclusion</span></span>

<span data-ttu-id="a3872-365">La migración de la aplicación Surveys a Service Fabric era un proceso bastante sencillo.</span><span class="sxs-lookup"><span data-stu-id="a3872-365">Porting the Surveys application to Service Fabric was fairly straightforward.</span></span> <span data-ttu-id="a3872-366">En resumen, hicimos lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="a3872-366">To summarize, we did the following:</span></span>

- <span data-ttu-id="a3872-367">Convertimos los roles en servicios sin estado.</span><span class="sxs-lookup"><span data-stu-id="a3872-367">Converted the roles to stateless services.</span></span>
- <span data-ttu-id="a3872-368">Convertimos los servidores front-end web a ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="a3872-368">Converted the web front ends to ASP.NET Core.</span></span>
- <span data-ttu-id="a3872-369">Cambiamos los archivos de empaquetado y configuración al modelo de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a3872-369">Changed the packaging and configuration files to the Service Fabric model.</span></span>

<span data-ttu-id="a3872-370">Además, la implementación cambió de Cloud Services a un clúster de Service Fabric que se ejecutaba en un conjunto de escalado de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="a3872-370">In addition, the deployment changed from Cloud Services to a Service Fabric cluster running in a VM Scale Set.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a3872-371">pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="a3872-371">Next steps</span></span>

<span data-ttu-id="a3872-372">Una vez portada correctamente la aplicación Surveys, Tailspin desea aprovechar las características de Service Fabric, como el control de versiones y la implementación de servicios independientes.</span><span class="sxs-lookup"><span data-stu-id="a3872-372">Now that the Surveys application has been successfully ported, Tailspin wants to take advantage of Service Fabric features such as independent service deployment and versioning.</span></span> <span data-ttu-id="a3872-373">Vea cómo Tailspin ha descompuesto estos servicios en una arquitectura más pormenorizada para aprovechar estas características de Service Fabric en [Refactorización de una aplicación de Azure Service Fabric migrada de Azure Cloud Services][refactor-surveys].</span><span class="sxs-lookup"><span data-stu-id="a3872-373">Learn how Tailspin decomposed these services to a more granular architecture to take advantage of these Service Fabric features in [Refactor an Azure Service Fabric Application migrated from Azure Cloud Services][refactor-surveys]</span></span>

<!-- links -->

[application-gateway]: /azure/application-gateway/
[aspnet-core]: /aspnet/core/
[aspnet-webapi]: https://www.asp.net/web-api
[aspnet-migration]: /aspnet/core/migration/mvc
[aspnet-hosting]: /aspnet/core/fundamentals/hosting
[aspnet-webapi]: https://www.asp.net/web-api
[azure-deployment-models]: /azure/azure-resource-manager/resource-manager-deployment-model
[cloud-service-autoscale]: /azure/cloud-services/cloud-services-how-to-scale-portal
[cloud-service-config]: /azure/cloud-services/cloud-services-model-and-package
[cloud-service-endpoints]: /azure/cloud-services/cloud-services-enable-communication-role-instances#worker-roles-vs-web-roles
[kestrel]: https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel
[lb-probes]: /azure/load-balancer/load-balancer-custom-probe-overview
[owin]: https://www.asp.net/aspnet/overview/owin-and-katana
[refactor-surveys]: refactor-migrated-app.md
[sample-code]: https://github.com/mspnp/cloud-services-to-service-fabric
[sf-application-model]: /azure/service-fabric/service-fabric-application-model
[sf-aspnet-core]: /azure/service-fabric/service-fabric-add-a-web-frontend
[sf-auto-scale]: /azure/service-fabric/service-fabric-cluster-scale-up-down
[sf-compare-cloud-services]: /azure/service-fabric/service-fabric-cloud-services-migration-differences
[sf-connect-and-communicate]: /azure/service-fabric/service-fabric-connect-and-communicate-with-services
[sf-containers]: /azure/service-fabric/service-fabric-containers-overview
[sf-logs]: /azure/service-fabric/service-fabric-diagnostics-how-to-setup-wad
[sf-manifest-resources]: /azure/service-fabric/service-fabric-service-manifest-resources
[sf-migration]: /azure/service-fabric/service-fabric-cloud-services-migration-worker-role-stateless-service
[sf-multiple-environments]: /azure/service-fabric/service-fabric-manage-multiple-environment-app-configuration
[sf-node-types]: /azure/service-fabric/service-fabric-cluster-nodetypes
[sf-overview]: /azure/service-fabric/service-fabric-overview
[sf-placement-constraints]: /azure/service-fabric/service-fabric-cluster-resource-manager-cluster-description
[sf-reliable-collections]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections
[sf-reliable-services]: /azure/service-fabric/service-fabric-reliable-services-introduction
[sf-reverse-proxy]: /azure/service-fabric/service-fabric-reverseproxy
[sf-security]: /azure/service-fabric/service-fabric-cluster-security
[sf-why-microservices]: /azure/service-fabric/service-fabric-overview-microservices
[tailspin-book]: https://msdn.microsoft.com/library/ff966499.aspx
[tailspin-scenario]: https://msdn.microsoft.com/library/hh534482.aspx
[unity]: https://msdn.microsoft.com/library/ff647202.aspx
[vm-scale-sets]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
